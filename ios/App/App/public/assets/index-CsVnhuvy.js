function lf(t,s){for(var r=0;r<s.length;r++){const a=s[r];if(typeof a!="string"&&!Array.isArray(a)){for(const n in a)if(n!=="default"&&!(n in t)){const i=Object.getOwnPropertyDescriptor(a,n);i&&Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:()=>a[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var $t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function of(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function cf(t){if(t.__esModule)return t;var s=t.default;if(typeof s=="function"){var r=function a(){return this instanceof a?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};r.prototype=s.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(a){var n=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(r,a,n.get?n:{enumerable:!0,get:function(){return t[a]}})}),r}var Im={exports:{}},il={},Lm={exports:{}},ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _n=Symbol.for("react.element"),df=Symbol.for("react.portal"),uf=Symbol.for("react.fragment"),mf=Symbol.for("react.strict_mode"),hf=Symbol.for("react.profiler"),xf=Symbol.for("react.provider"),gf=Symbol.for("react.context"),ff=Symbol.for("react.forward_ref"),pf=Symbol.for("react.suspense"),yf=Symbol.for("react.memo"),bf=Symbol.for("react.lazy"),Yd=Symbol.iterator;function vf(t){return t===null||typeof t!="object"?null:(t=Yd&&t[Yd]||t["@@iterator"],typeof t=="function"?t:null)}var Mm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Om=Object.assign,Fm={};function ha(t,s,r){this.props=t,this.context=s,this.refs=Fm,this.updater=r||Mm}ha.prototype.isReactComponent={};ha.prototype.setState=function(t,s){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,s,"setState")};ha.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Um(){}Um.prototype=ha.prototype;function Ec(t,s,r){this.props=t,this.context=s,this.refs=Fm,this.updater=r||Mm}var Rc=Ec.prototype=new Um;Rc.constructor=Ec;Om(Rc,ha.prototype);Rc.isPureReactComponent=!0;var Jd=Array.isArray,qm=Object.prototype.hasOwnProperty,Pc={current:null},Bm={key:!0,ref:!0,__self:!0,__source:!0};function zm(t,s,r){var a,n={},i=null,l=null;if(s!=null)for(a in s.ref!==void 0&&(l=s.ref),s.key!==void 0&&(i=""+s.key),s)qm.call(s,a)&&!Bm.hasOwnProperty(a)&&(n[a]=s[a]);var o=arguments.length-2;if(o===1)n.children=r;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];n.children=c}if(t&&t.defaultProps)for(a in o=t.defaultProps,o)n[a]===void 0&&(n[a]=o[a]);return{$$typeof:_n,type:t,key:i,ref:l,props:n,_owner:Pc.current}}function jf(t,s){return{$$typeof:_n,type:t.type,key:s,ref:t.ref,props:t.props,_owner:t._owner}}function Tc(t){return typeof t=="object"&&t!==null&&t.$$typeof===_n}function wf(t){var s={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return s[r]})}var Qd=/\/+/g;function Dl(t,s){return typeof t=="object"&&t!==null&&t.key!=null?wf(""+t.key):s.toString(36)}function ci(t,s,r,a,n){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case _n:case df:l=!0}}if(l)return l=t,n=n(l),t=a===""?"."+Dl(l,0):a,Jd(n)?(r="",t!=null&&(r=t.replace(Qd,"$&/")+"/"),ci(n,s,r,"",function(d){return d})):n!=null&&(Tc(n)&&(n=jf(n,r+(!n.key||l&&l.key===n.key?"":(""+n.key).replace(Qd,"$&/")+"/")+t)),s.push(n)),1;if(l=0,a=a===""?".":a+":",Jd(t))for(var o=0;o<t.length;o++){i=t[o];var c=a+Dl(i,o);l+=ci(i,s,r,c,n)}else if(c=vf(t),typeof c=="function")for(t=c.call(t),o=0;!(i=t.next()).done;)i=i.value,c=a+Dl(i,o++),l+=ci(i,s,r,c,n);else if(i==="object")throw s=String(t),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return l}function In(t,s,r){if(t==null)return t;var a=[],n=0;return ci(t,a,"","",function(i){return s.call(r,i,n++)}),a}function Nf(t){if(t._status===-1){var s=t._result;s=s(),s.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=s)}if(t._status===1)return t._result.default;throw t._result}var ut={current:null},di={transition:null},_f={ReactCurrentDispatcher:ut,ReactCurrentBatchConfig:di,ReactCurrentOwner:Pc};function Vm(){throw Error("act(...) is not supported in production builds of React.")}ue.Children={map:In,forEach:function(t,s,r){In(t,function(){s.apply(this,arguments)},r)},count:function(t){var s=0;return In(t,function(){s++}),s},toArray:function(t){return In(t,function(s){return s})||[]},only:function(t){if(!Tc(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ue.Component=ha;ue.Fragment=uf;ue.Profiler=hf;ue.PureComponent=Ec;ue.StrictMode=mf;ue.Suspense=pf;ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_f;ue.act=Vm;ue.cloneElement=function(t,s,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var a=Om({},t.props),n=t.key,i=t.ref,l=t._owner;if(s!=null){if(s.ref!==void 0&&(i=s.ref,l=Pc.current),s.key!==void 0&&(n=""+s.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(c in s)qm.call(s,c)&&!Bm.hasOwnProperty(c)&&(a[c]=s[c]===void 0&&o!==void 0?o[c]:s[c])}var c=arguments.length-2;if(c===1)a.children=r;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];a.children=o}return{$$typeof:_n,type:t.type,key:n,ref:i,props:a,_owner:l}};ue.createContext=function(t){return t={$$typeof:gf,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:xf,_context:t},t.Consumer=t};ue.createElement=zm;ue.createFactory=function(t){var s=zm.bind(null,t);return s.type=t,s};ue.createRef=function(){return{current:null}};ue.forwardRef=function(t){return{$$typeof:ff,render:t}};ue.isValidElement=Tc;ue.lazy=function(t){return{$$typeof:bf,_payload:{_status:-1,_result:t},_init:Nf}};ue.memo=function(t,s){return{$$typeof:yf,type:t,compare:s===void 0?null:s}};ue.startTransition=function(t){var s=di.transition;di.transition={};try{t()}finally{di.transition=s}};ue.unstable_act=Vm;ue.useCallback=function(t,s){return ut.current.useCallback(t,s)};ue.useContext=function(t){return ut.current.useContext(t)};ue.useDebugValue=function(){};ue.useDeferredValue=function(t){return ut.current.useDeferredValue(t)};ue.useEffect=function(t,s){return ut.current.useEffect(t,s)};ue.useId=function(){return ut.current.useId()};ue.useImperativeHandle=function(t,s,r){return ut.current.useImperativeHandle(t,s,r)};ue.useInsertionEffect=function(t,s){return ut.current.useInsertionEffect(t,s)};ue.useLayoutEffect=function(t,s){return ut.current.useLayoutEffect(t,s)};ue.useMemo=function(t,s){return ut.current.useMemo(t,s)};ue.useReducer=function(t,s,r){return ut.current.useReducer(t,s,r)};ue.useRef=function(t){return ut.current.useRef(t)};ue.useState=function(t){return ut.current.useState(t)};ue.useSyncExternalStore=function(t,s,r){return ut.current.useSyncExternalStore(t,s,r)};ue.useTransition=function(){return ut.current.useTransition()};ue.version="18.3.1";Lm.exports=ue;var x=Lm.exports;const kf=of(x),Sf=lf({__proto__:null,default:kf},[x]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cf=x,Ef=Symbol.for("react.element"),Rf=Symbol.for("react.fragment"),Pf=Object.prototype.hasOwnProperty,Tf=Cf.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Af={key:!0,ref:!0,__self:!0,__source:!0};function Wm(t,s,r){var a,n={},i=null,l=null;r!==void 0&&(i=""+r),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(l=s.ref);for(a in s)Pf.call(s,a)&&!Af.hasOwnProperty(a)&&(n[a]=s[a]);if(t&&t.defaultProps)for(a in s=t.defaultProps,s)n[a]===void 0&&(n[a]=s[a]);return{$$typeof:Ef,type:t,key:i,ref:l,props:n,_owner:Tf.current}}il.Fragment=Rf;il.jsx=Wm;il.jsxs=Wm;Im.exports=il;var e=Im.exports,Hm={exports:{}},St={},Gm={exports:{}},Km={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function s($,L){var V=$.length;$.push(L);e:for(;0<V;){var S=V-1>>>1,U=$[S];if(0<n(U,L))$[S]=L,$[V]=U,V=S;else break e}}function r($){return $.length===0?null:$[0]}function a($){if($.length===0)return null;var L=$[0],V=$.pop();if(V!==L){$[0]=V;e:for(var S=0,U=$.length,P=U>>>1;S<P;){var A=2*(S+1)-1,W=$[A],z=A+1,Y=$[z];if(0>n(W,V))z<U&&0>n(Y,W)?($[S]=Y,$[z]=V,S=z):($[S]=W,$[A]=V,S=A);else if(z<U&&0>n(Y,V))$[S]=Y,$[z]=V,S=z;else break e}}return L}function n($,L){var V=$.sortIndex-L.sortIndex;return V!==0?V:$.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var c=[],d=[],m=1,u=null,h=3,f=!1,g=!1,j=!1,w=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y($){for(var L=r(d);L!==null;){if(L.callback===null)a(d);else if(L.startTime<=$)a(d),L.sortIndex=L.expirationTime,s(c,L);else break;L=r(d)}}function b($){if(j=!1,y($),!g)if(r(c)!==null)g=!0,H(N);else{var L=r(d);L!==null&&O(b,L.startTime-$)}}function N($,L){g=!1,j&&(j=!1,v(C),C=-1),f=!0;var V=h;try{for(y(L),u=r(c);u!==null&&(!(u.expirationTime>L)||$&&!M());){var S=u.callback;if(typeof S=="function"){u.callback=null,h=u.priorityLevel;var U=S(u.expirationTime<=L);L=t.unstable_now(),typeof U=="function"?u.callback=U:u===r(c)&&a(c),y(L)}else a(c);u=r(c)}if(u!==null)var P=!0;else{var A=r(d);A!==null&&O(b,A.startTime-L),P=!1}return P}finally{u=null,h=V,f=!1}}var k=!1,E=null,C=-1,R=5,T=-1;function M(){return!(t.unstable_now()-T<R)}function I(){if(E!==null){var $=t.unstable_now();T=$;var L=!0;try{L=E(!0,$)}finally{L?D():(k=!1,E=null)}}else k=!1}var D;if(typeof p=="function")D=function(){p(I)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,B=F.port2;F.port1.onmessage=I,D=function(){B.postMessage(null)}}else D=function(){w(I,0)};function H($){E=$,k||(k=!0,D())}function O($,L){C=w(function(){$(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,H(N))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function($){switch(h){case 1:case 2:case 3:var L=3;break;default:L=h}var V=h;h=L;try{return $()}finally{h=V}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,L){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var V=h;h=$;try{return L()}finally{h=V}},t.unstable_scheduleCallback=function($,L,V){var S=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?S+V:S):V=S,$){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=V+U,$={id:m++,callback:L,priorityLevel:$,startTime:V,expirationTime:U,sortIndex:-1},V>S?($.sortIndex=V,s(d,$),r(c)===null&&$===r(d)&&(j?(v(C),C=-1):j=!0,O(b,V-S))):($.sortIndex=U,s(c,$),g||f||(g=!0,H(N))),$},t.unstable_shouldYield=M,t.unstable_wrapCallback=function($){var L=h;return function(){var V=h;h=L;try{return $.apply(this,arguments)}finally{h=V}}}})(Km);Gm.exports=Km;var Df=Gm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $f=x,_t=Df;function K(t){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)s+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ym=new Set,Ja={};function fr(t,s){Jr(t,s),Jr(t+"Capture",s)}function Jr(t,s){for(Ja[t]=s,t=0;t<s.length;t++)Ym.add(s[t])}var xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vo=Object.prototype.hasOwnProperty,If=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xd={},Zd={};function Lf(t){return vo.call(Zd,t)?!0:vo.call(Xd,t)?!1:If.test(t)?Zd[t]=!0:(Xd[t]=!0,!1)}function Mf(t,s,r,a){if(r!==null&&r.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return a?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Of(t,s,r,a){if(s===null||typeof s>"u"||Mf(t,s,r,a))return!0;if(a)return!1;if(r!==null)switch(r.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function mt(t,s,r,a,n,i,l){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=a,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=s,this.sanitizeURL=i,this.removeEmptyString=l}var Ze={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ze[t]=new mt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var s=t[0];Ze[s]=new mt(s,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ze[t]=new mt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ze[t]=new mt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ze[t]=new mt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ze[t]=new mt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ze[t]=new mt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ze[t]=new mt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ze[t]=new mt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ac=/[\-:]([a-z])/g;function Dc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var s=t.replace(Ac,Dc);Ze[s]=new mt(s,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var s=t.replace(Ac,Dc);Ze[s]=new mt(s,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var s=t.replace(Ac,Dc);Ze[s]=new mt(s,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ze[t]=new mt(t,1,!1,t.toLowerCase(),null,!1,!1)});Ze.xlinkHref=new mt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ze[t]=new mt(t,1,!1,t.toLowerCase(),null,!0,!0)});function $c(t,s,r,a){var n=Ze.hasOwnProperty(s)?Ze[s]:null;(n!==null?n.type!==0:a||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Of(s,r,n,a)&&(r=null),a||n===null?Lf(s)&&(r===null?t.removeAttribute(s):t.setAttribute(s,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(s=n.attributeName,a=n.attributeNamespace,r===null?t.removeAttribute(s):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,a?t.setAttributeNS(a,s,r):t.setAttribute(s,r))))}var vs=$f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ln=Symbol.for("react.element"),Tr=Symbol.for("react.portal"),Ar=Symbol.for("react.fragment"),Ic=Symbol.for("react.strict_mode"),jo=Symbol.for("react.profiler"),Jm=Symbol.for("react.provider"),Qm=Symbol.for("react.context"),Lc=Symbol.for("react.forward_ref"),wo=Symbol.for("react.suspense"),No=Symbol.for("react.suspense_list"),Mc=Symbol.for("react.memo"),Es=Symbol.for("react.lazy"),Xm=Symbol.for("react.offscreen"),eu=Symbol.iterator;function Na(t){return t===null||typeof t!="object"?null:(t=eu&&t[eu]||t["@@iterator"],typeof t=="function"?t:null)}var De=Object.assign,$l;function Aa(t){if($l===void 0)try{throw Error()}catch(r){var s=r.stack.trim().match(/\n( *(at )?)/);$l=s&&s[1]||""}return`
`+$l+t}var Il=!1;function Ll(t,s){if(!t||Il)return"";Il=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(d){var a=d}Reflect.construct(t,[],s)}else{try{s.call()}catch(d){a=d}t.call(s.prototype)}else{try{throw Error()}catch(d){a=d}t()}}catch(d){if(d&&a&&typeof d.stack=="string"){for(var n=d.stack.split(`
`),i=a.stack.split(`
`),l=n.length-1,o=i.length-1;1<=l&&0<=o&&n[l]!==i[o];)o--;for(;1<=l&&0<=o;l--,o--)if(n[l]!==i[o]){if(l!==1||o!==1)do if(l--,o--,0>o||n[l]!==i[o]){var c=`
`+n[l].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=l&&0<=o);break}}}finally{Il=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Aa(t):""}function Ff(t){switch(t.tag){case 5:return Aa(t.type);case 16:return Aa("Lazy");case 13:return Aa("Suspense");case 19:return Aa("SuspenseList");case 0:case 2:case 15:return t=Ll(t.type,!1),t;case 11:return t=Ll(t.type.render,!1),t;case 1:return t=Ll(t.type,!0),t;default:return""}}function _o(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ar:return"Fragment";case Tr:return"Portal";case jo:return"Profiler";case Ic:return"StrictMode";case wo:return"Suspense";case No:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Qm:return(t.displayName||"Context")+".Consumer";case Jm:return(t._context.displayName||"Context")+".Provider";case Lc:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Mc:return s=t.displayName||null,s!==null?s:_o(t.type)||"Memo";case Es:s=t._payload,t=t._init;try{return _o(t(s))}catch{}}return null}function Uf(t){var s=t.type;switch(t.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=s.render,t=t.displayName||t.name||"",s.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _o(s);case 8:return s===Ic?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Ws(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Zm(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function qf(t){var s=Zm(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),a=""+t[s];if(!t.hasOwnProperty(s)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,i=r.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return n.call(this)},set:function(l){a=""+l,i.call(this,l)}}),Object.defineProperty(t,s,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(l){a=""+l},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function Mn(t){t._valueTracker||(t._valueTracker=qf(t))}function eh(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var r=s.getValue(),a="";return t&&(a=Zm(t)?t.checked?"true":"false":t.value),t=a,t!==r?(s.setValue(t),!0):!1}function Ni(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ko(t,s){var r=s.checked;return De({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function tu(t,s){var r=s.defaultValue==null?"":s.defaultValue,a=s.checked!=null?s.checked:s.defaultChecked;r=Ws(s.value!=null?s.value:r),t._wrapperState={initialChecked:a,initialValue:r,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function th(t,s){s=s.checked,s!=null&&$c(t,"checked",s,!1)}function So(t,s){th(t,s);var r=Ws(s.value),a=s.type;if(r!=null)a==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(a==="submit"||a==="reset"){t.removeAttribute("value");return}s.hasOwnProperty("value")?Co(t,s.type,r):s.hasOwnProperty("defaultValue")&&Co(t,s.type,Ws(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(t.defaultChecked=!!s.defaultChecked)}function su(t,s,r){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var a=s.type;if(!(a!=="submit"&&a!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+t._wrapperState.initialValue,r||s===t.value||(t.value=s),t.defaultValue=s}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function Co(t,s,r){(s!=="number"||Ni(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Da=Array.isArray;function Vr(t,s,r,a){if(t=t.options,s){s={};for(var n=0;n<r.length;n++)s["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=s.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&a&&(t[r].defaultSelected=!0)}else{for(r=""+Ws(r),s=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,a&&(t[n].defaultSelected=!0);return}s!==null||t[n].disabled||(s=t[n])}s!==null&&(s.selected=!0)}}function Eo(t,s){if(s.dangerouslySetInnerHTML!=null)throw Error(K(91));return De({},s,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ru(t,s){var r=s.value;if(r==null){if(r=s.children,s=s.defaultValue,r!=null){if(s!=null)throw Error(K(92));if(Da(r)){if(1<r.length)throw Error(K(93));r=r[0]}s=r}s==null&&(s=""),r=s}t._wrapperState={initialValue:Ws(r)}}function sh(t,s){var r=Ws(s.value),a=Ws(s.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),s.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),a!=null&&(t.defaultValue=""+a)}function au(t){var s=t.textContent;s===t._wrapperState.initialValue&&s!==""&&s!==null&&(t.value=s)}function rh(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ro(t,s){return t==null||t==="http://www.w3.org/1999/xhtml"?rh(s):t==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var On,ah=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,r,a,n){MSApp.execUnsafeLocalFunction(function(){return t(s,r,a,n)})}:t}(function(t,s){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=s;else{for(On=On||document.createElement("div"),On.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=On.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;s.firstChild;)t.appendChild(s.firstChild)}});function Qa(t,s){if(s){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=s;return}}t.textContent=s}var Ma={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bf=["Webkit","ms","Moz","O"];Object.keys(Ma).forEach(function(t){Bf.forEach(function(s){s=s+t.charAt(0).toUpperCase()+t.substring(1),Ma[s]=Ma[t]})});function nh(t,s,r){return s==null||typeof s=="boolean"||s===""?"":r||typeof s!="number"||s===0||Ma.hasOwnProperty(t)&&Ma[t]?(""+s).trim():s+"px"}function ih(t,s){t=t.style;for(var r in s)if(s.hasOwnProperty(r)){var a=r.indexOf("--")===0,n=nh(r,s[r],a);r==="float"&&(r="cssFloat"),a?t.setProperty(r,n):t[r]=n}}var zf=De({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Po(t,s){if(s){if(zf[t]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(K(137,t));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(K(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(K(61))}if(s.style!=null&&typeof s.style!="object")throw Error(K(62))}}function To(t,s){if(t.indexOf("-")===-1)return typeof s.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ao=null;function Oc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Do=null,Wr=null,Hr=null;function nu(t){if(t=Cn(t)){if(typeof Do!="function")throw Error(K(280));var s=t.stateNode;s&&(s=ul(s),Do(t.stateNode,t.type,s))}}function lh(t){Wr?Hr?Hr.push(t):Hr=[t]:Wr=t}function oh(){if(Wr){var t=Wr,s=Hr;if(Hr=Wr=null,nu(t),s)for(t=0;t<s.length;t++)nu(s[t])}}function ch(t,s){return t(s)}function dh(){}var Ml=!1;function uh(t,s,r){if(Ml)return t(s,r);Ml=!0;try{return ch(t,s,r)}finally{Ml=!1,(Wr!==null||Hr!==null)&&(dh(),oh())}}function Xa(t,s){var r=t.stateNode;if(r===null)return null;var a=ul(r);if(a===null)return null;r=a[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(t=t.type,a=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!a;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(K(231,s,typeof r));return r}var $o=!1;if(xs)try{var _a={};Object.defineProperty(_a,"passive",{get:function(){$o=!0}}),window.addEventListener("test",_a,_a),window.removeEventListener("test",_a,_a)}catch{$o=!1}function Vf(t,s,r,a,n,i,l,o,c){var d=Array.prototype.slice.call(arguments,3);try{s.apply(r,d)}catch(m){this.onError(m)}}var Oa=!1,_i=null,ki=!1,Io=null,Wf={onError:function(t){Oa=!0,_i=t}};function Hf(t,s,r,a,n,i,l,o,c){Oa=!1,_i=null,Vf.apply(Wf,arguments)}function Gf(t,s,r,a,n,i,l,o,c){if(Hf.apply(this,arguments),Oa){if(Oa){var d=_i;Oa=!1,_i=null}else throw Error(K(198));ki||(ki=!0,Io=d)}}function pr(t){var s=t,r=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,s.flags&4098&&(r=s.return),t=s.return;while(t)}return s.tag===3?r:null}function mh(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function iu(t){if(pr(t)!==t)throw Error(K(188))}function Kf(t){var s=t.alternate;if(!s){if(s=pr(t),s===null)throw Error(K(188));return s!==t?null:t}for(var r=t,a=s;;){var n=r.return;if(n===null)break;var i=n.alternate;if(i===null){if(a=n.return,a!==null){r=a;continue}break}if(n.child===i.child){for(i=n.child;i;){if(i===r)return iu(n),t;if(i===a)return iu(n),s;i=i.sibling}throw Error(K(188))}if(r.return!==a.return)r=n,a=i;else{for(var l=!1,o=n.child;o;){if(o===r){l=!0,r=n,a=i;break}if(o===a){l=!0,a=n,r=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===r){l=!0,r=i,a=n;break}if(o===a){l=!0,a=i,r=n;break}o=o.sibling}if(!l)throw Error(K(189))}}if(r.alternate!==a)throw Error(K(190))}if(r.tag!==3)throw Error(K(188));return r.stateNode.current===r?t:s}function hh(t){return t=Kf(t),t!==null?xh(t):null}function xh(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var s=xh(t);if(s!==null)return s;t=t.sibling}return null}var gh=_t.unstable_scheduleCallback,lu=_t.unstable_cancelCallback,Yf=_t.unstable_shouldYield,Jf=_t.unstable_requestPaint,Le=_t.unstable_now,Qf=_t.unstable_getCurrentPriorityLevel,Fc=_t.unstable_ImmediatePriority,fh=_t.unstable_UserBlockingPriority,Si=_t.unstable_NormalPriority,Xf=_t.unstable_LowPriority,ph=_t.unstable_IdlePriority,ll=null,rs=null;function Zf(t){if(rs&&typeof rs.onCommitFiberRoot=="function")try{rs.onCommitFiberRoot(ll,t,void 0,(t.current.flags&128)===128)}catch{}}var Ht=Math.clz32?Math.clz32:sp,ep=Math.log,tp=Math.LN2;function sp(t){return t>>>=0,t===0?32:31-(ep(t)/tp|0)|0}var Fn=64,Un=4194304;function $a(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ci(t,s){var r=t.pendingLanes;if(r===0)return 0;var a=0,n=t.suspendedLanes,i=t.pingedLanes,l=r&268435455;if(l!==0){var o=l&~n;o!==0?a=$a(o):(i&=l,i!==0&&(a=$a(i)))}else l=r&~n,l!==0?a=$a(l):i!==0&&(a=$a(i));if(a===0)return 0;if(s!==0&&s!==a&&!(s&n)&&(n=a&-a,i=s&-s,n>=i||n===16&&(i&4194240)!==0))return s;if(a&4&&(a|=r&16),s=t.entangledLanes,s!==0)for(t=t.entanglements,s&=a;0<s;)r=31-Ht(s),n=1<<r,a|=t[r],s&=~n;return a}function rp(t,s){switch(t){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ap(t,s){for(var r=t.suspendedLanes,a=t.pingedLanes,n=t.expirationTimes,i=t.pendingLanes;0<i;){var l=31-Ht(i),o=1<<l,c=n[l];c===-1?(!(o&r)||o&a)&&(n[l]=rp(o,s)):c<=s&&(t.expiredLanes|=o),i&=~o}}function Lo(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yh(){var t=Fn;return Fn<<=1,!(Fn&4194240)&&(Fn=64),t}function Ol(t){for(var s=[],r=0;31>r;r++)s.push(t);return s}function kn(t,s,r){t.pendingLanes|=s,s!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,s=31-Ht(s),t[s]=r}function np(t,s){var r=t.pendingLanes&~s;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=s,t.mutableReadLanes&=s,t.entangledLanes&=s,s=t.entanglements;var a=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-Ht(r),i=1<<n;s[n]=0,a[n]=-1,t[n]=-1,r&=~i}}function Uc(t,s){var r=t.entangledLanes|=s;for(t=t.entanglements;r;){var a=31-Ht(r),n=1<<a;n&s|t[a]&s&&(t[a]|=s),r&=~n}}var je=0;function bh(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var vh,qc,jh,wh,Nh,Mo=!1,qn=[],Ls=null,Ms=null,Os=null,Za=new Map,en=new Map,Ps=[],ip="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ou(t,s){switch(t){case"focusin":case"focusout":Ls=null;break;case"dragenter":case"dragleave":Ms=null;break;case"mouseover":case"mouseout":Os=null;break;case"pointerover":case"pointerout":Za.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":en.delete(s.pointerId)}}function ka(t,s,r,a,n,i){return t===null||t.nativeEvent!==i?(t={blockedOn:s,domEventName:r,eventSystemFlags:a,nativeEvent:i,targetContainers:[n]},s!==null&&(s=Cn(s),s!==null&&qc(s)),t):(t.eventSystemFlags|=a,s=t.targetContainers,n!==null&&s.indexOf(n)===-1&&s.push(n),t)}function lp(t,s,r,a,n){switch(s){case"focusin":return Ls=ka(Ls,t,s,r,a,n),!0;case"dragenter":return Ms=ka(Ms,t,s,r,a,n),!0;case"mouseover":return Os=ka(Os,t,s,r,a,n),!0;case"pointerover":var i=n.pointerId;return Za.set(i,ka(Za.get(i)||null,t,s,r,a,n)),!0;case"gotpointercapture":return i=n.pointerId,en.set(i,ka(en.get(i)||null,t,s,r,a,n)),!0}return!1}function _h(t){var s=ir(t.target);if(s!==null){var r=pr(s);if(r!==null){if(s=r.tag,s===13){if(s=mh(r),s!==null){t.blockedOn=s,Nh(t.priority,function(){jh(r)});return}}else if(s===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ui(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var r=Oo(t.domEventName,t.eventSystemFlags,s[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var a=new r.constructor(r.type,r);Ao=a,r.target.dispatchEvent(a),Ao=null}else return s=Cn(r),s!==null&&qc(s),t.blockedOn=r,!1;s.shift()}return!0}function cu(t,s,r){ui(t)&&r.delete(s)}function op(){Mo=!1,Ls!==null&&ui(Ls)&&(Ls=null),Ms!==null&&ui(Ms)&&(Ms=null),Os!==null&&ui(Os)&&(Os=null),Za.forEach(cu),en.forEach(cu)}function Sa(t,s){t.blockedOn===s&&(t.blockedOn=null,Mo||(Mo=!0,_t.unstable_scheduleCallback(_t.unstable_NormalPriority,op)))}function tn(t){function s(n){return Sa(n,t)}if(0<qn.length){Sa(qn[0],t);for(var r=1;r<qn.length;r++){var a=qn[r];a.blockedOn===t&&(a.blockedOn=null)}}for(Ls!==null&&Sa(Ls,t),Ms!==null&&Sa(Ms,t),Os!==null&&Sa(Os,t),Za.forEach(s),en.forEach(s),r=0;r<Ps.length;r++)a=Ps[r],a.blockedOn===t&&(a.blockedOn=null);for(;0<Ps.length&&(r=Ps[0],r.blockedOn===null);)_h(r),r.blockedOn===null&&Ps.shift()}var Gr=vs.ReactCurrentBatchConfig,Ei=!0;function cp(t,s,r,a){var n=je,i=Gr.transition;Gr.transition=null;try{je=1,Bc(t,s,r,a)}finally{je=n,Gr.transition=i}}function dp(t,s,r,a){var n=je,i=Gr.transition;Gr.transition=null;try{je=4,Bc(t,s,r,a)}finally{je=n,Gr.transition=i}}function Bc(t,s,r,a){if(Ei){var n=Oo(t,s,r,a);if(n===null)Kl(t,s,a,Ri,r),ou(t,a);else if(lp(n,t,s,r,a))a.stopPropagation();else if(ou(t,a),s&4&&-1<ip.indexOf(t)){for(;n!==null;){var i=Cn(n);if(i!==null&&vh(i),i=Oo(t,s,r,a),i===null&&Kl(t,s,a,Ri,r),i===n)break;n=i}n!==null&&a.stopPropagation()}else Kl(t,s,a,null,r)}}var Ri=null;function Oo(t,s,r,a){if(Ri=null,t=Oc(a),t=ir(t),t!==null)if(s=pr(t),s===null)t=null;else if(r=s.tag,r===13){if(t=mh(s),t!==null)return t;t=null}else if(r===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null);return Ri=t,null}function kh(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qf()){case Fc:return 1;case fh:return 4;case Si:case Xf:return 16;case ph:return 536870912;default:return 16}default:return 16}}var Ds=null,zc=null,mi=null;function Sh(){if(mi)return mi;var t,s=zc,r=s.length,a,n="value"in Ds?Ds.value:Ds.textContent,i=n.length;for(t=0;t<r&&s[t]===n[t];t++);var l=r-t;for(a=1;a<=l&&s[r-a]===n[i-a];a++);return mi=n.slice(t,1<a?1-a:void 0)}function hi(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Bn(){return!0}function du(){return!1}function Ct(t){function s(r,a,n,i,l){this._reactName=r,this._targetInst=n,this.type=a,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(r=t[o],this[o]=r?r(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Bn:du,this.isPropagationStopped=du,this}return De(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Bn)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Bn)},persist:function(){},isPersistent:Bn}),s}var xa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Vc=Ct(xa),Sn=De({},xa,{view:0,detail:0}),up=Ct(Sn),Fl,Ul,Ca,ol=De({},Sn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ca&&(Ca&&t.type==="mousemove"?(Fl=t.screenX-Ca.screenX,Ul=t.screenY-Ca.screenY):Ul=Fl=0,Ca=t),Fl)},movementY:function(t){return"movementY"in t?t.movementY:Ul}}),uu=Ct(ol),mp=De({},ol,{dataTransfer:0}),hp=Ct(mp),xp=De({},Sn,{relatedTarget:0}),ql=Ct(xp),gp=De({},xa,{animationName:0,elapsedTime:0,pseudoElement:0}),fp=Ct(gp),pp=De({},xa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yp=Ct(pp),bp=De({},xa,{data:0}),mu=Ct(bp),vp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Np(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=wp[t])?!!s[t]:!1}function Wc(){return Np}var _p=De({},Sn,{key:function(t){if(t.key){var s=vp[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=hi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?jp[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wc,charCode:function(t){return t.type==="keypress"?hi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?hi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),kp=Ct(_p),Sp=De({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hu=Ct(Sp),Cp=De({},Sn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wc}),Ep=Ct(Cp),Rp=De({},xa,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pp=Ct(Rp),Tp=De({},ol,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Ap=Ct(Tp),Dp=[9,13,27,32],Hc=xs&&"CompositionEvent"in window,Fa=null;xs&&"documentMode"in document&&(Fa=document.documentMode);var $p=xs&&"TextEvent"in window&&!Fa,Ch=xs&&(!Hc||Fa&&8<Fa&&11>=Fa),xu=" ",gu=!1;function Eh(t,s){switch(t){case"keyup":return Dp.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rh(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Dr=!1;function Ip(t,s){switch(t){case"compositionend":return Rh(s);case"keypress":return s.which!==32?null:(gu=!0,xu);case"textInput":return t=s.data,t===xu&&gu?null:t;default:return null}}function Lp(t,s){if(Dr)return t==="compositionend"||!Hc&&Eh(t,s)?(t=Sh(),mi=zc=Ds=null,Dr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ch&&s.locale!=="ko"?null:s.data;default:return null}}var Mp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fu(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!Mp[t.type]:s==="textarea"}function Ph(t,s,r,a){lh(a),s=Pi(s,"onChange"),0<s.length&&(r=new Vc("onChange","change",null,r,a),t.push({event:r,listeners:s}))}var Ua=null,sn=null;function Op(t){qh(t,0)}function cl(t){var s=Lr(t);if(eh(s))return t}function Fp(t,s){if(t==="change")return s}var Th=!1;if(xs){var Bl;if(xs){var zl="oninput"in document;if(!zl){var pu=document.createElement("div");pu.setAttribute("oninput","return;"),zl=typeof pu.oninput=="function"}Bl=zl}else Bl=!1;Th=Bl&&(!document.documentMode||9<document.documentMode)}function yu(){Ua&&(Ua.detachEvent("onpropertychange",Ah),sn=Ua=null)}function Ah(t){if(t.propertyName==="value"&&cl(sn)){var s=[];Ph(s,sn,t,Oc(t)),uh(Op,s)}}function Up(t,s,r){t==="focusin"?(yu(),Ua=s,sn=r,Ua.attachEvent("onpropertychange",Ah)):t==="focusout"&&yu()}function qp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cl(sn)}function Bp(t,s){if(t==="click")return cl(s)}function zp(t,s){if(t==="input"||t==="change")return cl(s)}function Vp(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Kt=typeof Object.is=="function"?Object.is:Vp;function rn(t,s){if(Kt(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var r=Object.keys(t),a=Object.keys(s);if(r.length!==a.length)return!1;for(a=0;a<r.length;a++){var n=r[a];if(!vo.call(s,n)||!Kt(t[n],s[n]))return!1}return!0}function bu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function vu(t,s){var r=bu(t);t=0;for(var a;r;){if(r.nodeType===3){if(a=t+r.textContent.length,t<=s&&a>=s)return{node:r,offset:s-t};t=a}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=bu(r)}}function Dh(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?Dh(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function $h(){for(var t=window,s=Ni();s instanceof t.HTMLIFrameElement;){try{var r=typeof s.contentWindow.location.href=="string"}catch{r=!1}if(r)t=s.contentWindow;else break;s=Ni(t.document)}return s}function Gc(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}function Wp(t){var s=$h(),r=t.focusedElem,a=t.selectionRange;if(s!==r&&r&&r.ownerDocument&&Dh(r.ownerDocument.documentElement,r)){if(a!==null&&Gc(r)){if(s=a.start,t=a.end,t===void 0&&(t=s),"selectionStart"in r)r.selectionStart=s,r.selectionEnd=Math.min(t,r.value.length);else if(t=(s=r.ownerDocument||document)&&s.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,i=Math.min(a.start,n);a=a.end===void 0?i:Math.min(a.end,n),!t.extend&&i>a&&(n=a,a=i,i=n),n=vu(r,i);var l=vu(r,a);n&&l&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(s=s.createRange(),s.setStart(n.node,n.offset),t.removeAllRanges(),i>a?(t.addRange(s),t.extend(l.node,l.offset)):(s.setEnd(l.node,l.offset),t.addRange(s)))}}for(s=[],t=r;t=t.parentNode;)t.nodeType===1&&s.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<s.length;r++)t=s[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Hp=xs&&"documentMode"in document&&11>=document.documentMode,$r=null,Fo=null,qa=null,Uo=!1;function ju(t,s,r){var a=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Uo||$r==null||$r!==Ni(a)||(a=$r,"selectionStart"in a&&Gc(a)?a={start:a.selectionStart,end:a.selectionEnd}:(a=(a.ownerDocument&&a.ownerDocument.defaultView||window).getSelection(),a={anchorNode:a.anchorNode,anchorOffset:a.anchorOffset,focusNode:a.focusNode,focusOffset:a.focusOffset}),qa&&rn(qa,a)||(qa=a,a=Pi(Fo,"onSelect"),0<a.length&&(s=new Vc("onSelect","select",null,s,r),t.push({event:s,listeners:a}),s.target=$r)))}function zn(t,s){var r={};return r[t.toLowerCase()]=s.toLowerCase(),r["Webkit"+t]="webkit"+s,r["Moz"+t]="moz"+s,r}var Ir={animationend:zn("Animation","AnimationEnd"),animationiteration:zn("Animation","AnimationIteration"),animationstart:zn("Animation","AnimationStart"),transitionend:zn("Transition","TransitionEnd")},Vl={},Ih={};xs&&(Ih=document.createElement("div").style,"AnimationEvent"in window||(delete Ir.animationend.animation,delete Ir.animationiteration.animation,delete Ir.animationstart.animation),"TransitionEvent"in window||delete Ir.transitionend.transition);function dl(t){if(Vl[t])return Vl[t];if(!Ir[t])return t;var s=Ir[t],r;for(r in s)if(s.hasOwnProperty(r)&&r in Ih)return Vl[t]=s[r];return t}var Lh=dl("animationend"),Mh=dl("animationiteration"),Oh=dl("animationstart"),Fh=dl("transitionend"),Uh=new Map,wu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ys(t,s){Uh.set(t,s),fr(s,[t])}for(var Wl=0;Wl<wu.length;Wl++){var Hl=wu[Wl],Gp=Hl.toLowerCase(),Kp=Hl[0].toUpperCase()+Hl.slice(1);Ys(Gp,"on"+Kp)}Ys(Lh,"onAnimationEnd");Ys(Mh,"onAnimationIteration");Ys(Oh,"onAnimationStart");Ys("dblclick","onDoubleClick");Ys("focusin","onFocus");Ys("focusout","onBlur");Ys(Fh,"onTransitionEnd");Jr("onMouseEnter",["mouseout","mouseover"]);Jr("onMouseLeave",["mouseout","mouseover"]);Jr("onPointerEnter",["pointerout","pointerover"]);Jr("onPointerLeave",["pointerout","pointerover"]);fr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fr("onBeforeInput",["compositionend","keypress","textInput","paste"]);fr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ia));function Nu(t,s,r){var a=t.type||"unknown-event";t.currentTarget=r,Gf(a,s,void 0,t),t.currentTarget=null}function qh(t,s){s=(s&4)!==0;for(var r=0;r<t.length;r++){var a=t[r],n=a.event;a=a.listeners;e:{var i=void 0;if(s)for(var l=a.length-1;0<=l;l--){var o=a[l],c=o.instance,d=o.currentTarget;if(o=o.listener,c!==i&&n.isPropagationStopped())break e;Nu(n,o,d),i=c}else for(l=0;l<a.length;l++){if(o=a[l],c=o.instance,d=o.currentTarget,o=o.listener,c!==i&&n.isPropagationStopped())break e;Nu(n,o,d),i=c}}}if(ki)throw t=Io,ki=!1,Io=null,t}function ke(t,s){var r=s[Wo];r===void 0&&(r=s[Wo]=new Set);var a=t+"__bubble";r.has(a)||(Bh(s,t,2,!1),r.add(a))}function Gl(t,s,r){var a=0;s&&(a|=4),Bh(r,t,a,s)}var Vn="_reactListening"+Math.random().toString(36).slice(2);function an(t){if(!t[Vn]){t[Vn]=!0,Ym.forEach(function(r){r!=="selectionchange"&&(Yp.has(r)||Gl(r,!1,t),Gl(r,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[Vn]||(s[Vn]=!0,Gl("selectionchange",!1,s))}}function Bh(t,s,r,a){switch(kh(s)){case 1:var n=cp;break;case 4:n=dp;break;default:n=Bc}r=n.bind(null,s,r,t),n=void 0,!$o||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(n=!0),a?n!==void 0?t.addEventListener(s,r,{capture:!0,passive:n}):t.addEventListener(s,r,!0):n!==void 0?t.addEventListener(s,r,{passive:n}):t.addEventListener(s,r,!1)}function Kl(t,s,r,a,n){var i=a;if(!(s&1)&&!(s&2)&&a!==null)e:for(;;){if(a===null)return;var l=a.tag;if(l===3||l===4){var o=a.stateNode.containerInfo;if(o===n||o.nodeType===8&&o.parentNode===n)break;if(l===4)for(l=a.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===n||c.nodeType===8&&c.parentNode===n))return;l=l.return}for(;o!==null;){if(l=ir(o),l===null)return;if(c=l.tag,c===5||c===6){a=i=l;continue e}o=o.parentNode}}a=a.return}uh(function(){var d=i,m=Oc(r),u=[];e:{var h=Uh.get(t);if(h!==void 0){var f=Vc,g=t;switch(t){case"keypress":if(hi(r)===0)break e;case"keydown":case"keyup":f=kp;break;case"focusin":g="focus",f=ql;break;case"focusout":g="blur",f=ql;break;case"beforeblur":case"afterblur":f=ql;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=uu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=hp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=Ep;break;case Lh:case Mh:case Oh:f=fp;break;case Fh:f=Pp;break;case"scroll":f=up;break;case"wheel":f=Ap;break;case"copy":case"cut":case"paste":f=yp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=hu}var j=(s&4)!==0,w=!j&&t==="scroll",v=j?h!==null?h+"Capture":null:h;j=[];for(var p=d,y;p!==null;){y=p;var b=y.stateNode;if(y.tag===5&&b!==null&&(y=b,v!==null&&(b=Xa(p,v),b!=null&&j.push(nn(p,b,y)))),w)break;p=p.return}0<j.length&&(h=new f(h,g,null,r,m),u.push({event:h,listeners:j}))}}if(!(s&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&r!==Ao&&(g=r.relatedTarget||r.fromElement)&&(ir(g)||g[gs]))break e;if((f||h)&&(h=m.window===m?m:(h=m.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=r.relatedTarget||r.toElement,f=d,g=g?ir(g):null,g!==null&&(w=pr(g),g!==w||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=d),f!==g)){if(j=uu,b="onMouseLeave",v="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(j=hu,b="onPointerLeave",v="onPointerEnter",p="pointer"),w=f==null?h:Lr(f),y=g==null?h:Lr(g),h=new j(b,p+"leave",f,r,m),h.target=w,h.relatedTarget=y,b=null,ir(m)===d&&(j=new j(v,p+"enter",g,r,m),j.target=y,j.relatedTarget=w,b=j),w=b,f&&g)t:{for(j=f,v=g,p=0,y=j;y;y=vr(y))p++;for(y=0,b=v;b;b=vr(b))y++;for(;0<p-y;)j=vr(j),p--;for(;0<y-p;)v=vr(v),y--;for(;p--;){if(j===v||v!==null&&j===v.alternate)break t;j=vr(j),v=vr(v)}j=null}else j=null;f!==null&&_u(u,h,f,j,!1),g!==null&&w!==null&&_u(u,w,g,j,!0)}}e:{if(h=d?Lr(d):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var N=Fp;else if(fu(h))if(Th)N=zp;else{N=qp;var k=Up}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(N=Bp);if(N&&(N=N(t,d))){Ph(u,N,r,m);break e}k&&k(t,h,d),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&Co(h,"number",h.value)}switch(k=d?Lr(d):window,t){case"focusin":(fu(k)||k.contentEditable==="true")&&($r=k,Fo=d,qa=null);break;case"focusout":qa=Fo=$r=null;break;case"mousedown":Uo=!0;break;case"contextmenu":case"mouseup":case"dragend":Uo=!1,ju(u,r,m);break;case"selectionchange":if(Hp)break;case"keydown":case"keyup":ju(u,r,m)}var E;if(Hc)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Dr?Eh(t,r)&&(C="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(C="onCompositionStart");C&&(Ch&&r.locale!=="ko"&&(Dr||C!=="onCompositionStart"?C==="onCompositionEnd"&&Dr&&(E=Sh()):(Ds=m,zc="value"in Ds?Ds.value:Ds.textContent,Dr=!0)),k=Pi(d,C),0<k.length&&(C=new mu(C,t,null,r,m),u.push({event:C,listeners:k}),E?C.data=E:(E=Rh(r),E!==null&&(C.data=E)))),(E=$p?Ip(t,r):Lp(t,r))&&(d=Pi(d,"onBeforeInput"),0<d.length&&(m=new mu("onBeforeInput","beforeinput",null,r,m),u.push({event:m,listeners:d}),m.data=E))}qh(u,s)})}function nn(t,s,r){return{instance:t,listener:s,currentTarget:r}}function Pi(t,s){for(var r=s+"Capture",a=[];t!==null;){var n=t,i=n.stateNode;n.tag===5&&i!==null&&(n=i,i=Xa(t,r),i!=null&&a.unshift(nn(t,i,n)),i=Xa(t,s),i!=null&&a.push(nn(t,i,n))),t=t.return}return a}function vr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _u(t,s,r,a,n){for(var i=s._reactName,l=[];r!==null&&r!==a;){var o=r,c=o.alternate,d=o.stateNode;if(c!==null&&c===a)break;o.tag===5&&d!==null&&(o=d,n?(c=Xa(r,i),c!=null&&l.unshift(nn(r,c,o))):n||(c=Xa(r,i),c!=null&&l.push(nn(r,c,o)))),r=r.return}l.length!==0&&t.push({event:s,listeners:l})}var Jp=/\r\n?/g,Qp=/\u0000|\uFFFD/g;function ku(t){return(typeof t=="string"?t:""+t).replace(Jp,`
`).replace(Qp,"")}function Wn(t,s,r){if(s=ku(s),ku(t)!==s&&r)throw Error(K(425))}function Ti(){}var qo=null,Bo=null;function zo(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Vo=typeof setTimeout=="function"?setTimeout:void 0,Xp=typeof clearTimeout=="function"?clearTimeout:void 0,Su=typeof Promise=="function"?Promise:void 0,Zp=typeof queueMicrotask=="function"?queueMicrotask:typeof Su<"u"?function(t){return Su.resolve(null).then(t).catch(e0)}:Vo;function e0(t){setTimeout(function(){throw t})}function Yl(t,s){var r=s,a=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(a===0){t.removeChild(n),tn(s);return}a--}else r!=="$"&&r!=="$?"&&r!=="$!"||a++;r=n}while(r);tn(s)}function Fs(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return t}function Cu(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(s===0)return t;s--}else r==="/$"&&s++}t=t.previousSibling}return null}var ga=Math.random().toString(36).slice(2),ts="__reactFiber$"+ga,ln="__reactProps$"+ga,gs="__reactContainer$"+ga,Wo="__reactEvents$"+ga,t0="__reactListeners$"+ga,s0="__reactHandles$"+ga;function ir(t){var s=t[ts];if(s)return s;for(var r=t.parentNode;r;){if(s=r[gs]||r[ts]){if(r=s.alternate,s.child!==null||r!==null&&r.child!==null)for(t=Cu(t);t!==null;){if(r=t[ts])return r;t=Cu(t)}return s}t=r,r=t.parentNode}return null}function Cn(t){return t=t[ts]||t[gs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Lr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(K(33))}function ul(t){return t[ln]||null}var Ho=[],Mr=-1;function Js(t){return{current:t}}function Se(t){0>Mr||(t.current=Ho[Mr],Ho[Mr]=null,Mr--)}function _e(t,s){Mr++,Ho[Mr]=t.current,t.current=s}var Hs={},rt=Js(Hs),ft=Js(!1),ur=Hs;function Qr(t,s){var r=t.type.contextTypes;if(!r)return Hs;var a=t.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===s)return a.__reactInternalMemoizedMaskedChildContext;var n={},i;for(i in r)n[i]=s[i];return a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=n),n}function pt(t){return t=t.childContextTypes,t!=null}function Ai(){Se(ft),Se(rt)}function Eu(t,s,r){if(rt.current!==Hs)throw Error(K(168));_e(rt,s),_e(ft,r)}function zh(t,s,r){var a=t.stateNode;if(s=s.childContextTypes,typeof a.getChildContext!="function")return r;a=a.getChildContext();for(var n in a)if(!(n in s))throw Error(K(108,Uf(t)||"Unknown",n));return De({},r,a)}function Di(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Hs,ur=rt.current,_e(rt,t),_e(ft,ft.current),!0}function Ru(t,s,r){var a=t.stateNode;if(!a)throw Error(K(169));r?(t=zh(t,s,ur),a.__reactInternalMemoizedMergedChildContext=t,Se(ft),Se(rt),_e(rt,t)):Se(ft),_e(ft,r)}var ds=null,ml=!1,Jl=!1;function Vh(t){ds===null?ds=[t]:ds.push(t)}function r0(t){ml=!0,Vh(t)}function Qs(){if(!Jl&&ds!==null){Jl=!0;var t=0,s=je;try{var r=ds;for(je=1;t<r.length;t++){var a=r[t];do a=a(!0);while(a!==null)}ds=null,ml=!1}catch(n){throw ds!==null&&(ds=ds.slice(t+1)),gh(Fc,Qs),n}finally{je=s,Jl=!1}}return null}var Or=[],Fr=0,$i=null,Ii=0,Pt=[],Tt=0,mr=null,us=1,ms="";function sr(t,s){Or[Fr++]=Ii,Or[Fr++]=$i,$i=t,Ii=s}function Wh(t,s,r){Pt[Tt++]=us,Pt[Tt++]=ms,Pt[Tt++]=mr,mr=t;var a=us;t=ms;var n=32-Ht(a)-1;a&=~(1<<n),r+=1;var i=32-Ht(s)+n;if(30<i){var l=n-n%5;i=(a&(1<<l)-1).toString(32),a>>=l,n-=l,us=1<<32-Ht(s)+n|r<<n|a,ms=i+t}else us=1<<i|r<<n|a,ms=t}function Kc(t){t.return!==null&&(sr(t,1),Wh(t,1,0))}function Yc(t){for(;t===$i;)$i=Or[--Fr],Or[Fr]=null,Ii=Or[--Fr],Or[Fr]=null;for(;t===mr;)mr=Pt[--Tt],Pt[Tt]=null,ms=Pt[--Tt],Pt[Tt]=null,us=Pt[--Tt],Pt[Tt]=null}var wt=null,jt=null,Ee=!1,Vt=null;function Hh(t,s){var r=At(5,null,null,0);r.elementType="DELETED",r.stateNode=s,r.return=t,s=t.deletions,s===null?(t.deletions=[r],t.flags|=16):s.push(r)}function Pu(t,s){switch(t.tag){case 5:var r=t.type;return s=s.nodeType!==1||r.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(t.stateNode=s,wt=t,jt=Fs(s.firstChild),!0):!1;case 6:return s=t.pendingProps===""||s.nodeType!==3?null:s,s!==null?(t.stateNode=s,wt=t,jt=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(r=mr!==null?{id:us,overflow:ms}:null,t.memoizedState={dehydrated:s,treeContext:r,retryLane:1073741824},r=At(18,null,null,0),r.stateNode=s,r.return=t,t.child=r,wt=t,jt=null,!0):!1;default:return!1}}function Go(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ko(t){if(Ee){var s=jt;if(s){var r=s;if(!Pu(t,s)){if(Go(t))throw Error(K(418));s=Fs(r.nextSibling);var a=wt;s&&Pu(t,s)?Hh(a,r):(t.flags=t.flags&-4097|2,Ee=!1,wt=t)}}else{if(Go(t))throw Error(K(418));t.flags=t.flags&-4097|2,Ee=!1,wt=t}}}function Tu(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;wt=t}function Hn(t){if(t!==wt)return!1;if(!Ee)return Tu(t),Ee=!0,!1;var s;if((s=t.tag!==3)&&!(s=t.tag!==5)&&(s=t.type,s=s!=="head"&&s!=="body"&&!zo(t.type,t.memoizedProps)),s&&(s=jt)){if(Go(t))throw Gh(),Error(K(418));for(;s;)Hh(t,s),s=Fs(s.nextSibling)}if(Tu(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(s===0){jt=Fs(t.nextSibling);break e}s--}else r!=="$"&&r!=="$!"&&r!=="$?"||s++}t=t.nextSibling}jt=null}}else jt=wt?Fs(t.stateNode.nextSibling):null;return!0}function Gh(){for(var t=jt;t;)t=Fs(t.nextSibling)}function Xr(){jt=wt=null,Ee=!1}function Jc(t){Vt===null?Vt=[t]:Vt.push(t)}var a0=vs.ReactCurrentBatchConfig;function Ea(t,s,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(K(309));var a=r.stateNode}if(!a)throw Error(K(147,t));var n=a,i=""+t;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===i?s.ref:(s=function(l){var o=n.refs;l===null?delete o[i]:o[i]=l},s._stringRef=i,s)}if(typeof t!="string")throw Error(K(284));if(!r._owner)throw Error(K(290,t))}return t}function Gn(t,s){throw t=Object.prototype.toString.call(s),Error(K(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t))}function Au(t){var s=t._init;return s(t._payload)}function Kh(t){function s(v,p){if(t){var y=v.deletions;y===null?(v.deletions=[p],v.flags|=16):y.push(p)}}function r(v,p){if(!t)return null;for(;p!==null;)s(v,p),p=p.sibling;return null}function a(v,p){for(v=new Map;p!==null;)p.key!==null?v.set(p.key,p):v.set(p.index,p),p=p.sibling;return v}function n(v,p){return v=zs(v,p),v.index=0,v.sibling=null,v}function i(v,p,y){return v.index=y,t?(y=v.alternate,y!==null?(y=y.index,y<p?(v.flags|=2,p):y):(v.flags|=2,p)):(v.flags|=1048576,p)}function l(v){return t&&v.alternate===null&&(v.flags|=2),v}function o(v,p,y,b){return p===null||p.tag!==6?(p=ro(y,v.mode,b),p.return=v,p):(p=n(p,y),p.return=v,p)}function c(v,p,y,b){var N=y.type;return N===Ar?m(v,p,y.props.children,b,y.key):p!==null&&(p.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Es&&Au(N)===p.type)?(b=n(p,y.props),b.ref=Ea(v,p,y),b.return=v,b):(b=vi(y.type,y.key,y.props,null,v.mode,b),b.ref=Ea(v,p,y),b.return=v,b)}function d(v,p,y,b){return p===null||p.tag!==4||p.stateNode.containerInfo!==y.containerInfo||p.stateNode.implementation!==y.implementation?(p=ao(y,v.mode,b),p.return=v,p):(p=n(p,y.children||[]),p.return=v,p)}function m(v,p,y,b,N){return p===null||p.tag!==7?(p=dr(y,v.mode,b,N),p.return=v,p):(p=n(p,y),p.return=v,p)}function u(v,p,y){if(typeof p=="string"&&p!==""||typeof p=="number")return p=ro(""+p,v.mode,y),p.return=v,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ln:return y=vi(p.type,p.key,p.props,null,v.mode,y),y.ref=Ea(v,null,p),y.return=v,y;case Tr:return p=ao(p,v.mode,y),p.return=v,p;case Es:var b=p._init;return u(v,b(p._payload),y)}if(Da(p)||Na(p))return p=dr(p,v.mode,y,null),p.return=v,p;Gn(v,p)}return null}function h(v,p,y,b){var N=p!==null?p.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return N!==null?null:o(v,p,""+y,b);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ln:return y.key===N?c(v,p,y,b):null;case Tr:return y.key===N?d(v,p,y,b):null;case Es:return N=y._init,h(v,p,N(y._payload),b)}if(Da(y)||Na(y))return N!==null?null:m(v,p,y,b,null);Gn(v,y)}return null}function f(v,p,y,b,N){if(typeof b=="string"&&b!==""||typeof b=="number")return v=v.get(y)||null,o(p,v,""+b,N);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Ln:return v=v.get(b.key===null?y:b.key)||null,c(p,v,b,N);case Tr:return v=v.get(b.key===null?y:b.key)||null,d(p,v,b,N);case Es:var k=b._init;return f(v,p,y,k(b._payload),N)}if(Da(b)||Na(b))return v=v.get(y)||null,m(p,v,b,N,null);Gn(p,b)}return null}function g(v,p,y,b){for(var N=null,k=null,E=p,C=p=0,R=null;E!==null&&C<y.length;C++){E.index>C?(R=E,E=null):R=E.sibling;var T=h(v,E,y[C],b);if(T===null){E===null&&(E=R);break}t&&E&&T.alternate===null&&s(v,E),p=i(T,p,C),k===null?N=T:k.sibling=T,k=T,E=R}if(C===y.length)return r(v,E),Ee&&sr(v,C),N;if(E===null){for(;C<y.length;C++)E=u(v,y[C],b),E!==null&&(p=i(E,p,C),k===null?N=E:k.sibling=E,k=E);return Ee&&sr(v,C),N}for(E=a(v,E);C<y.length;C++)R=f(E,v,C,y[C],b),R!==null&&(t&&R.alternate!==null&&E.delete(R.key===null?C:R.key),p=i(R,p,C),k===null?N=R:k.sibling=R,k=R);return t&&E.forEach(function(M){return s(v,M)}),Ee&&sr(v,C),N}function j(v,p,y,b){var N=Na(y);if(typeof N!="function")throw Error(K(150));if(y=N.call(y),y==null)throw Error(K(151));for(var k=N=null,E=p,C=p=0,R=null,T=y.next();E!==null&&!T.done;C++,T=y.next()){E.index>C?(R=E,E=null):R=E.sibling;var M=h(v,E,T.value,b);if(M===null){E===null&&(E=R);break}t&&E&&M.alternate===null&&s(v,E),p=i(M,p,C),k===null?N=M:k.sibling=M,k=M,E=R}if(T.done)return r(v,E),Ee&&sr(v,C),N;if(E===null){for(;!T.done;C++,T=y.next())T=u(v,T.value,b),T!==null&&(p=i(T,p,C),k===null?N=T:k.sibling=T,k=T);return Ee&&sr(v,C),N}for(E=a(v,E);!T.done;C++,T=y.next())T=f(E,v,C,T.value,b),T!==null&&(t&&T.alternate!==null&&E.delete(T.key===null?C:T.key),p=i(T,p,C),k===null?N=T:k.sibling=T,k=T);return t&&E.forEach(function(I){return s(v,I)}),Ee&&sr(v,C),N}function w(v,p,y,b){if(typeof y=="object"&&y!==null&&y.type===Ar&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Ln:e:{for(var N=y.key,k=p;k!==null;){if(k.key===N){if(N=y.type,N===Ar){if(k.tag===7){r(v,k.sibling),p=n(k,y.props.children),p.return=v,v=p;break e}}else if(k.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Es&&Au(N)===k.type){r(v,k.sibling),p=n(k,y.props),p.ref=Ea(v,k,y),p.return=v,v=p;break e}r(v,k);break}else s(v,k);k=k.sibling}y.type===Ar?(p=dr(y.props.children,v.mode,b,y.key),p.return=v,v=p):(b=vi(y.type,y.key,y.props,null,v.mode,b),b.ref=Ea(v,p,y),b.return=v,v=b)}return l(v);case Tr:e:{for(k=y.key;p!==null;){if(p.key===k)if(p.tag===4&&p.stateNode.containerInfo===y.containerInfo&&p.stateNode.implementation===y.implementation){r(v,p.sibling),p=n(p,y.children||[]),p.return=v,v=p;break e}else{r(v,p);break}else s(v,p);p=p.sibling}p=ao(y,v.mode,b),p.return=v,v=p}return l(v);case Es:return k=y._init,w(v,p,k(y._payload),b)}if(Da(y))return g(v,p,y,b);if(Na(y))return j(v,p,y,b);Gn(v,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,p!==null&&p.tag===6?(r(v,p.sibling),p=n(p,y),p.return=v,v=p):(r(v,p),p=ro(y,v.mode,b),p.return=v,v=p),l(v)):r(v,p)}return w}var Zr=Kh(!0),Yh=Kh(!1),Li=Js(null),Mi=null,Ur=null,Qc=null;function Xc(){Qc=Ur=Mi=null}function Zc(t){var s=Li.current;Se(Li),t._currentValue=s}function Yo(t,s,r){for(;t!==null;){var a=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,a!==null&&(a.childLanes|=s)):a!==null&&(a.childLanes&s)!==s&&(a.childLanes|=s),t===r)break;t=t.return}}function Kr(t,s){Mi=t,Qc=Ur=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&s&&(gt=!0),t.firstContext=null)}function It(t){var s=t._currentValue;if(Qc!==t)if(t={context:t,memoizedValue:s,next:null},Ur===null){if(Mi===null)throw Error(K(308));Ur=t,Mi.dependencies={lanes:0,firstContext:t}}else Ur=Ur.next=t;return s}var lr=null;function ed(t){lr===null?lr=[t]:lr.push(t)}function Jh(t,s,r,a){var n=s.interleaved;return n===null?(r.next=r,ed(s)):(r.next=n.next,n.next=r),s.interleaved=r,fs(t,a)}function fs(t,s){t.lanes|=s;var r=t.alternate;for(r!==null&&(r.lanes|=s),r=t,t=t.return;t!==null;)t.childLanes|=s,r=t.alternate,r!==null&&(r.childLanes|=s),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Rs=!1;function td(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Qh(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function hs(t,s){return{eventTime:t,lane:s,tag:0,payload:null,callback:null,next:null}}function Us(t,s,r){var a=t.updateQueue;if(a===null)return null;if(a=a.shared,ge&2){var n=a.pending;return n===null?s.next=s:(s.next=n.next,n.next=s),a.pending=s,fs(t,r)}return n=a.interleaved,n===null?(s.next=s,ed(a)):(s.next=n.next,n.next=s),a.interleaved=s,fs(t,r)}function xi(t,s,r){if(s=s.updateQueue,s!==null&&(s=s.shared,(r&4194240)!==0)){var a=s.lanes;a&=t.pendingLanes,r|=a,s.lanes=r,Uc(t,r)}}function Du(t,s){var r=t.updateQueue,a=t.alternate;if(a!==null&&(a=a.updateQueue,r===a)){var n=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var l={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?n=i=l:i=i.next=l,r=r.next}while(r!==null);i===null?n=i=s:i=i.next=s}else n=i=s;r={baseState:a.baseState,firstBaseUpdate:n,lastBaseUpdate:i,shared:a.shared,effects:a.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=s:t.next=s,r.lastBaseUpdate=s}function Oi(t,s,r,a){var n=t.updateQueue;Rs=!1;var i=n.firstBaseUpdate,l=n.lastBaseUpdate,o=n.shared.pending;if(o!==null){n.shared.pending=null;var c=o,d=c.next;c.next=null,l===null?i=d:l.next=d,l=c;var m=t.alternate;m!==null&&(m=m.updateQueue,o=m.lastBaseUpdate,o!==l&&(o===null?m.firstBaseUpdate=d:o.next=d,m.lastBaseUpdate=c))}if(i!==null){var u=n.baseState;l=0,m=d=c=null,o=i;do{var h=o.lane,f=o.eventTime;if((a&h)===h){m!==null&&(m=m.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=t,j=o;switch(h=s,f=r,j.tag){case 1:if(g=j.payload,typeof g=="function"){u=g.call(f,u,h);break e}u=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=j.payload,h=typeof g=="function"?g.call(f,u,h):g,h==null)break e;u=De({},u,h);break e;case 2:Rs=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,h=n.effects,h===null?n.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},m===null?(d=m=f,c=u):m=m.next=f,l|=h;if(o=o.next,o===null){if(o=n.shared.pending,o===null)break;h=o,o=h.next,h.next=null,n.lastBaseUpdate=h,n.shared.pending=null}}while(!0);if(m===null&&(c=u),n.baseState=c,n.firstBaseUpdate=d,n.lastBaseUpdate=m,s=n.shared.interleaved,s!==null){n=s;do l|=n.lane,n=n.next;while(n!==s)}else i===null&&(n.shared.lanes=0);xr|=l,t.lanes=l,t.memoizedState=u}}function $u(t,s,r){if(t=s.effects,s.effects=null,t!==null)for(s=0;s<t.length;s++){var a=t[s],n=a.callback;if(n!==null){if(a.callback=null,a=r,typeof n!="function")throw Error(K(191,n));n.call(a)}}}var En={},as=Js(En),on=Js(En),cn=Js(En);function or(t){if(t===En)throw Error(K(174));return t}function sd(t,s){switch(_e(cn,s),_e(on,t),_e(as,En),t=s.nodeType,t){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Ro(null,"");break;default:t=t===8?s.parentNode:s,s=t.namespaceURI||null,t=t.tagName,s=Ro(s,t)}Se(as),_e(as,s)}function ea(){Se(as),Se(on),Se(cn)}function Xh(t){or(cn.current);var s=or(as.current),r=Ro(s,t.type);s!==r&&(_e(on,t),_e(as,r))}function rd(t){on.current===t&&(Se(as),Se(on))}var Pe=Js(0);function Fi(t){for(var s=t;s!==null;){if(s.tag===13){var r=s.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ql=[];function ad(){for(var t=0;t<Ql.length;t++)Ql[t]._workInProgressVersionPrimary=null;Ql.length=0}var gi=vs.ReactCurrentDispatcher,Xl=vs.ReactCurrentBatchConfig,hr=0,Te=null,Ve=null,Ge=null,Ui=!1,Ba=!1,dn=0,n0=0;function et(){throw Error(K(321))}function nd(t,s){if(s===null)return!1;for(var r=0;r<s.length&&r<t.length;r++)if(!Kt(t[r],s[r]))return!1;return!0}function id(t,s,r,a,n,i){if(hr=i,Te=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,gi.current=t===null||t.memoizedState===null?c0:d0,t=r(a,n),Ba){i=0;do{if(Ba=!1,dn=0,25<=i)throw Error(K(301));i+=1,Ge=Ve=null,s.updateQueue=null,gi.current=u0,t=r(a,n)}while(Ba)}if(gi.current=qi,s=Ve!==null&&Ve.next!==null,hr=0,Ge=Ve=Te=null,Ui=!1,s)throw Error(K(300));return t}function ld(){var t=dn!==0;return dn=0,t}function Zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ge===null?Te.memoizedState=Ge=t:Ge=Ge.next=t,Ge}function Lt(){if(Ve===null){var t=Te.alternate;t=t!==null?t.memoizedState:null}else t=Ve.next;var s=Ge===null?Te.memoizedState:Ge.next;if(s!==null)Ge=s,Ve=t;else{if(t===null)throw Error(K(310));Ve=t,t={memoizedState:Ve.memoizedState,baseState:Ve.baseState,baseQueue:Ve.baseQueue,queue:Ve.queue,next:null},Ge===null?Te.memoizedState=Ge=t:Ge=Ge.next=t}return Ge}function un(t,s){return typeof s=="function"?s(t):s}function Zl(t){var s=Lt(),r=s.queue;if(r===null)throw Error(K(311));r.lastRenderedReducer=t;var a=Ve,n=a.baseQueue,i=r.pending;if(i!==null){if(n!==null){var l=n.next;n.next=i.next,i.next=l}a.baseQueue=n=i,r.pending=null}if(n!==null){i=n.next,a=a.baseState;var o=l=null,c=null,d=i;do{var m=d.lane;if((hr&m)===m)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),a=d.hasEagerState?d.eagerState:t(a,d.action);else{var u={lane:m,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(o=c=u,l=a):c=c.next=u,Te.lanes|=m,xr|=m}d=d.next}while(d!==null&&d!==i);c===null?l=a:c.next=o,Kt(a,s.memoizedState)||(gt=!0),s.memoizedState=a,s.baseState=l,s.baseQueue=c,r.lastRenderedState=a}if(t=r.interleaved,t!==null){n=t;do i=n.lane,Te.lanes|=i,xr|=i,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[s.memoizedState,r.dispatch]}function eo(t){var s=Lt(),r=s.queue;if(r===null)throw Error(K(311));r.lastRenderedReducer=t;var a=r.dispatch,n=r.pending,i=s.memoizedState;if(n!==null){r.pending=null;var l=n=n.next;do i=t(i,l.action),l=l.next;while(l!==n);Kt(i,s.memoizedState)||(gt=!0),s.memoizedState=i,s.baseQueue===null&&(s.baseState=i),r.lastRenderedState=i}return[i,a]}function Zh(){}function ex(t,s){var r=Te,a=Lt(),n=s(),i=!Kt(a.memoizedState,n);if(i&&(a.memoizedState=n,gt=!0),a=a.queue,od(rx.bind(null,r,a,t),[t]),a.getSnapshot!==s||i||Ge!==null&&Ge.memoizedState.tag&1){if(r.flags|=2048,mn(9,sx.bind(null,r,a,n,s),void 0,null),Ke===null)throw Error(K(349));hr&30||tx(r,s,n)}return n}function tx(t,s,r){t.flags|=16384,t={getSnapshot:s,value:r},s=Te.updateQueue,s===null?(s={lastEffect:null,stores:null},Te.updateQueue=s,s.stores=[t]):(r=s.stores,r===null?s.stores=[t]:r.push(t))}function sx(t,s,r,a){s.value=r,s.getSnapshot=a,ax(s)&&nx(t)}function rx(t,s,r){return r(function(){ax(s)&&nx(t)})}function ax(t){var s=t.getSnapshot;t=t.value;try{var r=s();return!Kt(t,r)}catch{return!0}}function nx(t){var s=fs(t,1);s!==null&&Gt(s,t,1,-1)}function Iu(t){var s=Zt();return typeof t=="function"&&(t=t()),s.memoizedState=s.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:un,lastRenderedState:t},s.queue=t,t=t.dispatch=o0.bind(null,Te,t),[s.memoizedState,t]}function mn(t,s,r,a){return t={tag:t,create:s,destroy:r,deps:a,next:null},s=Te.updateQueue,s===null?(s={lastEffect:null,stores:null},Te.updateQueue=s,s.lastEffect=t.next=t):(r=s.lastEffect,r===null?s.lastEffect=t.next=t:(a=r.next,r.next=t,t.next=a,s.lastEffect=t)),t}function ix(){return Lt().memoizedState}function fi(t,s,r,a){var n=Zt();Te.flags|=t,n.memoizedState=mn(1|s,r,void 0,a===void 0?null:a)}function hl(t,s,r,a){var n=Lt();a=a===void 0?null:a;var i=void 0;if(Ve!==null){var l=Ve.memoizedState;if(i=l.destroy,a!==null&&nd(a,l.deps)){n.memoizedState=mn(s,r,i,a);return}}Te.flags|=t,n.memoizedState=mn(1|s,r,i,a)}function Lu(t,s){return fi(8390656,8,t,s)}function od(t,s){return hl(2048,8,t,s)}function lx(t,s){return hl(4,2,t,s)}function ox(t,s){return hl(4,4,t,s)}function cx(t,s){if(typeof s=="function")return t=t(),s(t),function(){s(null)};if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function dx(t,s,r){return r=r!=null?r.concat([t]):null,hl(4,4,cx.bind(null,s,t),r)}function cd(){}function ux(t,s){var r=Lt();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&nd(s,a[1])?a[0]:(r.memoizedState=[t,s],t)}function mx(t,s){var r=Lt();s=s===void 0?null:s;var a=r.memoizedState;return a!==null&&s!==null&&nd(s,a[1])?a[0]:(t=t(),r.memoizedState=[t,s],t)}function hx(t,s,r){return hr&21?(Kt(r,s)||(r=yh(),Te.lanes|=r,xr|=r,t.baseState=!0),s):(t.baseState&&(t.baseState=!1,gt=!0),t.memoizedState=r)}function i0(t,s){var r=je;je=r!==0&&4>r?r:4,t(!0);var a=Xl.transition;Xl.transition={};try{t(!1),s()}finally{je=r,Xl.transition=a}}function xx(){return Lt().memoizedState}function l0(t,s,r){var a=Bs(t);if(r={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null},gx(t))fx(s,r);else if(r=Jh(t,s,r,a),r!==null){var n=ct();Gt(r,t,a,n),px(r,s,a)}}function o0(t,s,r){var a=Bs(t),n={lane:a,action:r,hasEagerState:!1,eagerState:null,next:null};if(gx(t))fx(s,n);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=s.lastRenderedReducer,i!==null))try{var l=s.lastRenderedState,o=i(l,r);if(n.hasEagerState=!0,n.eagerState=o,Kt(o,l)){var c=s.interleaved;c===null?(n.next=n,ed(s)):(n.next=c.next,c.next=n),s.interleaved=n;return}}catch{}finally{}r=Jh(t,s,n,a),r!==null&&(n=ct(),Gt(r,t,a,n),px(r,s,a))}}function gx(t){var s=t.alternate;return t===Te||s!==null&&s===Te}function fx(t,s){Ba=Ui=!0;var r=t.pending;r===null?s.next=s:(s.next=r.next,r.next=s),t.pending=s}function px(t,s,r){if(r&4194240){var a=s.lanes;a&=t.pendingLanes,r|=a,s.lanes=r,Uc(t,r)}}var qi={readContext:It,useCallback:et,useContext:et,useEffect:et,useImperativeHandle:et,useInsertionEffect:et,useLayoutEffect:et,useMemo:et,useReducer:et,useRef:et,useState:et,useDebugValue:et,useDeferredValue:et,useTransition:et,useMutableSource:et,useSyncExternalStore:et,useId:et,unstable_isNewReconciler:!1},c0={readContext:It,useCallback:function(t,s){return Zt().memoizedState=[t,s===void 0?null:s],t},useContext:It,useEffect:Lu,useImperativeHandle:function(t,s,r){return r=r!=null?r.concat([t]):null,fi(4194308,4,cx.bind(null,s,t),r)},useLayoutEffect:function(t,s){return fi(4194308,4,t,s)},useInsertionEffect:function(t,s){return fi(4,2,t,s)},useMemo:function(t,s){var r=Zt();return s=s===void 0?null:s,t=t(),r.memoizedState=[t,s],t},useReducer:function(t,s,r){var a=Zt();return s=r!==void 0?r(s):s,a.memoizedState=a.baseState=s,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},a.queue=t,t=t.dispatch=l0.bind(null,Te,t),[a.memoizedState,t]},useRef:function(t){var s=Zt();return t={current:t},s.memoizedState=t},useState:Iu,useDebugValue:cd,useDeferredValue:function(t){return Zt().memoizedState=t},useTransition:function(){var t=Iu(!1),s=t[0];return t=i0.bind(null,t[1]),Zt().memoizedState=t,[s,t]},useMutableSource:function(){},useSyncExternalStore:function(t,s,r){var a=Te,n=Zt();if(Ee){if(r===void 0)throw Error(K(407));r=r()}else{if(r=s(),Ke===null)throw Error(K(349));hr&30||tx(a,s,r)}n.memoizedState=r;var i={value:r,getSnapshot:s};return n.queue=i,Lu(rx.bind(null,a,i,t),[t]),a.flags|=2048,mn(9,sx.bind(null,a,i,r,s),void 0,null),r},useId:function(){var t=Zt(),s=Ke.identifierPrefix;if(Ee){var r=ms,a=us;r=(a&~(1<<32-Ht(a)-1)).toString(32)+r,s=":"+s+"R"+r,r=dn++,0<r&&(s+="H"+r.toString(32)),s+=":"}else r=n0++,s=":"+s+"r"+r.toString(32)+":";return t.memoizedState=s},unstable_isNewReconciler:!1},d0={readContext:It,useCallback:ux,useContext:It,useEffect:od,useImperativeHandle:dx,useInsertionEffect:lx,useLayoutEffect:ox,useMemo:mx,useReducer:Zl,useRef:ix,useState:function(){return Zl(un)},useDebugValue:cd,useDeferredValue:function(t){var s=Lt();return hx(s,Ve.memoizedState,t)},useTransition:function(){var t=Zl(un)[0],s=Lt().memoizedState;return[t,s]},useMutableSource:Zh,useSyncExternalStore:ex,useId:xx,unstable_isNewReconciler:!1},u0={readContext:It,useCallback:ux,useContext:It,useEffect:od,useImperativeHandle:dx,useInsertionEffect:lx,useLayoutEffect:ox,useMemo:mx,useReducer:eo,useRef:ix,useState:function(){return eo(un)},useDebugValue:cd,useDeferredValue:function(t){var s=Lt();return Ve===null?s.memoizedState=t:hx(s,Ve.memoizedState,t)},useTransition:function(){var t=eo(un)[0],s=Lt().memoizedState;return[t,s]},useMutableSource:Zh,useSyncExternalStore:ex,useId:xx,unstable_isNewReconciler:!1};function qt(t,s){if(t&&t.defaultProps){s=De({},s),t=t.defaultProps;for(var r in t)s[r]===void 0&&(s[r]=t[r]);return s}return s}function Jo(t,s,r,a){s=t.memoizedState,r=r(a,s),r=r==null?s:De({},s,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var xl={isMounted:function(t){return(t=t._reactInternals)?pr(t)===t:!1},enqueueSetState:function(t,s,r){t=t._reactInternals;var a=ct(),n=Bs(t),i=hs(a,n);i.payload=s,r!=null&&(i.callback=r),s=Us(t,i,n),s!==null&&(Gt(s,t,n,a),xi(s,t,n))},enqueueReplaceState:function(t,s,r){t=t._reactInternals;var a=ct(),n=Bs(t),i=hs(a,n);i.tag=1,i.payload=s,r!=null&&(i.callback=r),s=Us(t,i,n),s!==null&&(Gt(s,t,n,a),xi(s,t,n))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var r=ct(),a=Bs(t),n=hs(r,a);n.tag=2,s!=null&&(n.callback=s),s=Us(t,n,a),s!==null&&(Gt(s,t,a,r),xi(s,t,a))}};function Mu(t,s,r,a,n,i,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(a,i,l):s.prototype&&s.prototype.isPureReactComponent?!rn(r,a)||!rn(n,i):!0}function yx(t,s,r){var a=!1,n=Hs,i=s.contextType;return typeof i=="object"&&i!==null?i=It(i):(n=pt(s)?ur:rt.current,a=s.contextTypes,i=(a=a!=null)?Qr(t,n):Hs),s=new s(r,i),t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=xl,t.stateNode=s,s._reactInternals=t,a&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=i),s}function Ou(t,s,r,a){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(r,a),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(r,a),s.state!==t&&xl.enqueueReplaceState(s,s.state,null)}function Qo(t,s,r,a){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs={},td(t);var i=s.contextType;typeof i=="object"&&i!==null?n.context=It(i):(i=pt(s)?ur:rt.current,n.context=Qr(t,i)),n.state=t.memoizedState,i=s.getDerivedStateFromProps,typeof i=="function"&&(Jo(t,s,i,r),n.state=t.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(s=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),s!==n.state&&xl.enqueueReplaceState(n,n.state,null),Oi(t,r,n,a),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function ta(t,s){try{var r="",a=s;do r+=Ff(a),a=a.return;while(a);var n=r}catch(i){n=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:s,stack:n,digest:null}}function to(t,s,r){return{value:t,source:null,stack:r??null,digest:s??null}}function Xo(t,s){try{console.error(s.value)}catch(r){setTimeout(function(){throw r})}}var m0=typeof WeakMap=="function"?WeakMap:Map;function bx(t,s,r){r=hs(-1,r),r.tag=3,r.payload={element:null};var a=s.value;return r.callback=function(){zi||(zi=!0,oc=a),Xo(t,s)},r}function vx(t,s,r){r=hs(-1,r),r.tag=3;var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var n=s.value;r.payload=function(){return a(n)},r.callback=function(){Xo(t,s)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Xo(t,s),typeof a!="function"&&(qs===null?qs=new Set([this]):qs.add(this));var l=s.stack;this.componentDidCatch(s.value,{componentStack:l!==null?l:""})}),r}function Fu(t,s,r){var a=t.pingCache;if(a===null){a=t.pingCache=new m0;var n=new Set;a.set(s,n)}else n=a.get(s),n===void 0&&(n=new Set,a.set(s,n));n.has(r)||(n.add(r),t=S0.bind(null,t,s,r),s.then(t,t))}function Uu(t){do{var s;if((s=t.tag===13)&&(s=t.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return t;t=t.return}while(t!==null);return null}function qu(t,s,r,a,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===s?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(s=hs(-1,1),s.tag=2,Us(r,s,1))),r.lanes|=1),t)}var h0=vs.ReactCurrentOwner,gt=!1;function lt(t,s,r,a){s.child=t===null?Yh(s,null,r,a):Zr(s,t.child,r,a)}function Bu(t,s,r,a,n){r=r.render;var i=s.ref;return Kr(s,n),a=id(t,s,r,a,i,n),r=ld(),t!==null&&!gt?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~n,ps(t,s,n)):(Ee&&r&&Kc(s),s.flags|=1,lt(t,s,a,n),s.child)}function zu(t,s,r,a,n){if(t===null){var i=r.type;return typeof i=="function"&&!pd(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(s.tag=15,s.type=i,jx(t,s,i,a,n)):(t=vi(r.type,null,a,s,s.mode,n),t.ref=s.ref,t.return=s,s.child=t)}if(i=t.child,!(t.lanes&n)){var l=i.memoizedProps;if(r=r.compare,r=r!==null?r:rn,r(l,a)&&t.ref===s.ref)return ps(t,s,n)}return s.flags|=1,t=zs(i,a),t.ref=s.ref,t.return=s,s.child=t}function jx(t,s,r,a,n){if(t!==null){var i=t.memoizedProps;if(rn(i,a)&&t.ref===s.ref)if(gt=!1,s.pendingProps=a=i,(t.lanes&n)!==0)t.flags&131072&&(gt=!0);else return s.lanes=t.lanes,ps(t,s,n)}return Zo(t,s,r,a,n)}function wx(t,s,r){var a=s.pendingProps,n=a.children,i=t!==null?t.memoizedState:null;if(a.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},_e(Br,vt),vt|=r;else{if(!(r&1073741824))return t=i!==null?i.baseLanes|r:r,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:t,cachePool:null,transitions:null},s.updateQueue=null,_e(Br,vt),vt|=t,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},a=i!==null?i.baseLanes:r,_e(Br,vt),vt|=a}else i!==null?(a=i.baseLanes|r,s.memoizedState=null):a=r,_e(Br,vt),vt|=a;return lt(t,s,n,r),s.child}function Nx(t,s){var r=s.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(s.flags|=512,s.flags|=2097152)}function Zo(t,s,r,a,n){var i=pt(r)?ur:rt.current;return i=Qr(s,i),Kr(s,n),r=id(t,s,r,a,i,n),a=ld(),t!==null&&!gt?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~n,ps(t,s,n)):(Ee&&a&&Kc(s),s.flags|=1,lt(t,s,r,n),s.child)}function Vu(t,s,r,a,n){if(pt(r)){var i=!0;Di(s)}else i=!1;if(Kr(s,n),s.stateNode===null)pi(t,s),yx(s,r,a),Qo(s,r,a,n),a=!0;else if(t===null){var l=s.stateNode,o=s.memoizedProps;l.props=o;var c=l.context,d=r.contextType;typeof d=="object"&&d!==null?d=It(d):(d=pt(r)?ur:rt.current,d=Qr(s,d));var m=r.getDerivedStateFromProps,u=typeof m=="function"||typeof l.getSnapshotBeforeUpdate=="function";u||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==a||c!==d)&&Ou(s,l,a,d),Rs=!1;var h=s.memoizedState;l.state=h,Oi(s,a,l,n),c=s.memoizedState,o!==a||h!==c||ft.current||Rs?(typeof m=="function"&&(Jo(s,r,m,a),c=s.memoizedState),(o=Rs||Mu(s,r,o,a,h,c,d))?(u||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(s.flags|=4194308)):(typeof l.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=a,s.memoizedState=c),l.props=a,l.state=c,l.context=d,a=o):(typeof l.componentDidMount=="function"&&(s.flags|=4194308),a=!1)}else{l=s.stateNode,Qh(t,s),o=s.memoizedProps,d=s.type===s.elementType?o:qt(s.type,o),l.props=d,u=s.pendingProps,h=l.context,c=r.contextType,typeof c=="object"&&c!==null?c=It(c):(c=pt(r)?ur:rt.current,c=Qr(s,c));var f=r.getDerivedStateFromProps;(m=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==u||h!==c)&&Ou(s,l,a,c),Rs=!1,h=s.memoizedState,l.state=h,Oi(s,a,l,n);var g=s.memoizedState;o!==u||h!==g||ft.current||Rs?(typeof f=="function"&&(Jo(s,r,f,a),g=s.memoizedState),(d=Rs||Mu(s,r,d,a,h,g,c)||!1)?(m||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(a,g,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(a,g,c)),typeof l.componentDidUpdate=="function"&&(s.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(s.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(s.flags|=1024),s.memoizedProps=a,s.memoizedState=g),l.props=a,l.state=g,l.context=c,a=d):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(s.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(s.flags|=1024),a=!1)}return ec(t,s,r,a,i,n)}function ec(t,s,r,a,n,i){Nx(t,s);var l=(s.flags&128)!==0;if(!a&&!l)return n&&Ru(s,r,!1),ps(t,s,i);a=s.stateNode,h0.current=s;var o=l&&typeof r.getDerivedStateFromError!="function"?null:a.render();return s.flags|=1,t!==null&&l?(s.child=Zr(s,t.child,null,i),s.child=Zr(s,null,o,i)):lt(t,s,o,i),s.memoizedState=a.state,n&&Ru(s,r,!0),s.child}function _x(t){var s=t.stateNode;s.pendingContext?Eu(t,s.pendingContext,s.pendingContext!==s.context):s.context&&Eu(t,s.context,!1),sd(t,s.containerInfo)}function Wu(t,s,r,a,n){return Xr(),Jc(n),s.flags|=256,lt(t,s,r,a),s.child}var tc={dehydrated:null,treeContext:null,retryLane:0};function sc(t){return{baseLanes:t,cachePool:null,transitions:null}}function kx(t,s,r){var a=s.pendingProps,n=Pe.current,i=!1,l=(s.flags&128)!==0,o;if((o=l)||(o=t!==null&&t.memoizedState===null?!1:(n&2)!==0),o?(i=!0,s.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),_e(Pe,n&1),t===null)return Ko(s),t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(s.mode&1?t.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(l=a.children,t=a.fallback,i?(a=s.mode,i=s.child,l={mode:"hidden",children:l},!(a&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=pl(l,a,0,null),t=dr(t,a,r,null),i.return=s,t.return=s,i.sibling=t,s.child=i,s.child.memoizedState=sc(r),s.memoizedState=tc,t):dd(s,l));if(n=t.memoizedState,n!==null&&(o=n.dehydrated,o!==null))return x0(t,s,l,a,o,n,r);if(i){i=a.fallback,l=s.mode,n=t.child,o=n.sibling;var c={mode:"hidden",children:a.children};return!(l&1)&&s.child!==n?(a=s.child,a.childLanes=0,a.pendingProps=c,s.deletions=null):(a=zs(n,c),a.subtreeFlags=n.subtreeFlags&14680064),o!==null?i=zs(o,i):(i=dr(i,l,r,null),i.flags|=2),i.return=s,a.return=s,a.sibling=i,s.child=a,a=i,i=s.child,l=t.child.memoizedState,l=l===null?sc(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=t.childLanes&~r,s.memoizedState=tc,a}return i=t.child,t=i.sibling,a=zs(i,{mode:"visible",children:a.children}),!(s.mode&1)&&(a.lanes=r),a.return=s,a.sibling=null,t!==null&&(r=s.deletions,r===null?(s.deletions=[t],s.flags|=16):r.push(t)),s.child=a,s.memoizedState=null,a}function dd(t,s){return s=pl({mode:"visible",children:s},t.mode,0,null),s.return=t,t.child=s}function Kn(t,s,r,a){return a!==null&&Jc(a),Zr(s,t.child,null,r),t=dd(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function x0(t,s,r,a,n,i,l){if(r)return s.flags&256?(s.flags&=-257,a=to(Error(K(422))),Kn(t,s,l,a)):s.memoizedState!==null?(s.child=t.child,s.flags|=128,null):(i=a.fallback,n=s.mode,a=pl({mode:"visible",children:a.children},n,0,null),i=dr(i,n,l,null),i.flags|=2,a.return=s,i.return=s,a.sibling=i,s.child=a,s.mode&1&&Zr(s,t.child,null,l),s.child.memoizedState=sc(l),s.memoizedState=tc,i);if(!(s.mode&1))return Kn(t,s,l,null);if(n.data==="$!"){if(a=n.nextSibling&&n.nextSibling.dataset,a)var o=a.dgst;return a=o,i=Error(K(419)),a=to(i,a,void 0),Kn(t,s,l,a)}if(o=(l&t.childLanes)!==0,gt||o){if(a=Ke,a!==null){switch(l&-l){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(a.suspendedLanes|l)?0:n,n!==0&&n!==i.retryLane&&(i.retryLane=n,fs(t,n),Gt(a,t,n,-1))}return fd(),a=to(Error(K(421))),Kn(t,s,l,a)}return n.data==="$?"?(s.flags|=128,s.child=t.child,s=C0.bind(null,t),n._reactRetry=s,null):(t=i.treeContext,jt=Fs(n.nextSibling),wt=s,Ee=!0,Vt=null,t!==null&&(Pt[Tt++]=us,Pt[Tt++]=ms,Pt[Tt++]=mr,us=t.id,ms=t.overflow,mr=s),s=dd(s,a.children),s.flags|=4096,s)}function Hu(t,s,r){t.lanes|=s;var a=t.alternate;a!==null&&(a.lanes|=s),Yo(t.return,s,r)}function so(t,s,r,a,n){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:a,tail:r,tailMode:n}:(i.isBackwards=s,i.rendering=null,i.renderingStartTime=0,i.last=a,i.tail=r,i.tailMode=n)}function Sx(t,s,r){var a=s.pendingProps,n=a.revealOrder,i=a.tail;if(lt(t,s,a.children,r),a=Pe.current,a&2)a=a&1|2,s.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Hu(t,r,s);else if(t.tag===19)Hu(t,r,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}a&=1}if(_e(Pe,a),!(s.mode&1))s.memoizedState=null;else switch(n){case"forwards":for(r=s.child,n=null;r!==null;)t=r.alternate,t!==null&&Fi(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=s.child,s.child=null):(n=r.sibling,r.sibling=null),so(s,!1,n,r,i);break;case"backwards":for(r=null,n=s.child,s.child=null;n!==null;){if(t=n.alternate,t!==null&&Fi(t)===null){s.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}so(s,!0,r,null,i);break;case"together":so(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function pi(t,s){!(s.mode&1)&&t!==null&&(t.alternate=null,s.alternate=null,s.flags|=2)}function ps(t,s,r){if(t!==null&&(s.dependencies=t.dependencies),xr|=s.lanes,!(r&s.childLanes))return null;if(t!==null&&s.child!==t.child)throw Error(K(153));if(s.child!==null){for(t=s.child,r=zs(t,t.pendingProps),s.child=r,r.return=s;t.sibling!==null;)t=t.sibling,r=r.sibling=zs(t,t.pendingProps),r.return=s;r.sibling=null}return s.child}function g0(t,s,r){switch(s.tag){case 3:_x(s),Xr();break;case 5:Xh(s);break;case 1:pt(s.type)&&Di(s);break;case 4:sd(s,s.stateNode.containerInfo);break;case 10:var a=s.type._context,n=s.memoizedProps.value;_e(Li,a._currentValue),a._currentValue=n;break;case 13:if(a=s.memoizedState,a!==null)return a.dehydrated!==null?(_e(Pe,Pe.current&1),s.flags|=128,null):r&s.child.childLanes?kx(t,s,r):(_e(Pe,Pe.current&1),t=ps(t,s,r),t!==null?t.sibling:null);_e(Pe,Pe.current&1);break;case 19:if(a=(r&s.childLanes)!==0,t.flags&128){if(a)return Sx(t,s,r);s.flags|=128}if(n=s.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),_e(Pe,Pe.current),a)break;return null;case 22:case 23:return s.lanes=0,wx(t,s,r)}return ps(t,s,r)}var Cx,rc,Ex,Rx;Cx=function(t,s){for(var r=s.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};rc=function(){};Ex=function(t,s,r,a){var n=t.memoizedProps;if(n!==a){t=s.stateNode,or(as.current);var i=null;switch(r){case"input":n=ko(t,n),a=ko(t,a),i=[];break;case"select":n=De({},n,{value:void 0}),a=De({},a,{value:void 0}),i=[];break;case"textarea":n=Eo(t,n),a=Eo(t,a),i=[];break;default:typeof n.onClick!="function"&&typeof a.onClick=="function"&&(t.onclick=Ti)}Po(r,a);var l;r=null;for(d in n)if(!a.hasOwnProperty(d)&&n.hasOwnProperty(d)&&n[d]!=null)if(d==="style"){var o=n[d];for(l in o)o.hasOwnProperty(l)&&(r||(r={}),r[l]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Ja.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in a){var c=a[d];if(o=n!=null?n[d]:void 0,a.hasOwnProperty(d)&&c!==o&&(c!=null||o!=null))if(d==="style")if(o){for(l in o)!o.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(r||(r={}),r[l]="");for(l in c)c.hasOwnProperty(l)&&o[l]!==c[l]&&(r||(r={}),r[l]=c[l])}else r||(i||(i=[]),i.push(d,r)),r=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Ja.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ke("scroll",t),i||o===c||(i=[])):(i=i||[]).push(d,c))}r&&(i=i||[]).push("style",r);var d=i;(s.updateQueue=d)&&(s.flags|=4)}};Rx=function(t,s,r,a){r!==a&&(s.flags|=4)};function Ra(t,s){if(!Ee)switch(t.tailMode){case"hidden":s=t.tail;for(var r=null;s!==null;)s.alternate!==null&&(r=s),s=s.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:a.sibling=null}}function tt(t){var s=t.alternate!==null&&t.alternate.child===t.child,r=0,a=0;if(s)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,a|=n.subtreeFlags&14680064,a|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,a|=n.subtreeFlags,a|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=a,t.childLanes=r,s}function f0(t,s,r){var a=s.pendingProps;switch(Yc(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(s),null;case 1:return pt(s.type)&&Ai(),tt(s),null;case 3:return a=s.stateNode,ea(),Se(ft),Se(rt),ad(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&(Hn(s)?s.flags|=4:t===null||t.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Vt!==null&&(uc(Vt),Vt=null))),rc(t,s),tt(s),null;case 5:rd(s);var n=or(cn.current);if(r=s.type,t!==null&&s.stateNode!=null)Ex(t,s,r,a,n),t.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!a){if(s.stateNode===null)throw Error(K(166));return tt(s),null}if(t=or(as.current),Hn(s)){a=s.stateNode,r=s.type;var i=s.memoizedProps;switch(a[ts]=s,a[ln]=i,t=(s.mode&1)!==0,r){case"dialog":ke("cancel",a),ke("close",a);break;case"iframe":case"object":case"embed":ke("load",a);break;case"video":case"audio":for(n=0;n<Ia.length;n++)ke(Ia[n],a);break;case"source":ke("error",a);break;case"img":case"image":case"link":ke("error",a),ke("load",a);break;case"details":ke("toggle",a);break;case"input":tu(a,i),ke("invalid",a);break;case"select":a._wrapperState={wasMultiple:!!i.multiple},ke("invalid",a);break;case"textarea":ru(a,i),ke("invalid",a)}Po(r,i),n=null;for(var l in i)if(i.hasOwnProperty(l)){var o=i[l];l==="children"?typeof o=="string"?a.textContent!==o&&(i.suppressHydrationWarning!==!0&&Wn(a.textContent,o,t),n=["children",o]):typeof o=="number"&&a.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Wn(a.textContent,o,t),n=["children",""+o]):Ja.hasOwnProperty(l)&&o!=null&&l==="onScroll"&&ke("scroll",a)}switch(r){case"input":Mn(a),su(a,i,!0);break;case"textarea":Mn(a),au(a);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(a.onclick=Ti)}a=n,s.updateQueue=a,a!==null&&(s.flags|=4)}else{l=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=rh(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof a.is=="string"?t=l.createElement(r,{is:a.is}):(t=l.createElement(r),r==="select"&&(l=t,a.multiple?l.multiple=!0:a.size&&(l.size=a.size))):t=l.createElementNS(t,r),t[ts]=s,t[ln]=a,Cx(t,s,!1,!1),s.stateNode=t;e:{switch(l=To(r,a),r){case"dialog":ke("cancel",t),ke("close",t),n=a;break;case"iframe":case"object":case"embed":ke("load",t),n=a;break;case"video":case"audio":for(n=0;n<Ia.length;n++)ke(Ia[n],t);n=a;break;case"source":ke("error",t),n=a;break;case"img":case"image":case"link":ke("error",t),ke("load",t),n=a;break;case"details":ke("toggle",t),n=a;break;case"input":tu(t,a),n=ko(t,a),ke("invalid",t);break;case"option":n=a;break;case"select":t._wrapperState={wasMultiple:!!a.multiple},n=De({},a,{value:void 0}),ke("invalid",t);break;case"textarea":ru(t,a),n=Eo(t,a),ke("invalid",t);break;default:n=a}Po(r,n),o=n;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?ih(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&ah(t,c)):i==="children"?typeof c=="string"?(r!=="textarea"||c!=="")&&Qa(t,c):typeof c=="number"&&Qa(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ja.hasOwnProperty(i)?c!=null&&i==="onScroll"&&ke("scroll",t):c!=null&&$c(t,i,c,l))}switch(r){case"input":Mn(t),su(t,a,!1);break;case"textarea":Mn(t),au(t);break;case"option":a.value!=null&&t.setAttribute("value",""+Ws(a.value));break;case"select":t.multiple=!!a.multiple,i=a.value,i!=null?Vr(t,!!a.multiple,i,!1):a.defaultValue!=null&&Vr(t,!!a.multiple,a.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=Ti)}switch(r){case"button":case"input":case"select":case"textarea":a=!!a.autoFocus;break e;case"img":a=!0;break e;default:a=!1}}a&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return tt(s),null;case 6:if(t&&s.stateNode!=null)Rx(t,s,t.memoizedProps,a);else{if(typeof a!="string"&&s.stateNode===null)throw Error(K(166));if(r=or(cn.current),or(as.current),Hn(s)){if(a=s.stateNode,r=s.memoizedProps,a[ts]=s,(i=a.nodeValue!==r)&&(t=wt,t!==null))switch(t.tag){case 3:Wn(a.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Wn(a.nodeValue,r,(t.mode&1)!==0)}i&&(s.flags|=4)}else a=(r.nodeType===9?r:r.ownerDocument).createTextNode(a),a[ts]=s,s.stateNode=a}return tt(s),null;case 13:if(Se(Pe),a=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ee&&jt!==null&&s.mode&1&&!(s.flags&128))Gh(),Xr(),s.flags|=98560,i=!1;else if(i=Hn(s),a!==null&&a.dehydrated!==null){if(t===null){if(!i)throw Error(K(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(K(317));i[ts]=s}else Xr(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;tt(s),i=!1}else Vt!==null&&(uc(Vt),Vt=null),i=!0;if(!i)return s.flags&65536?s:null}return s.flags&128?(s.lanes=r,s):(a=a!==null,a!==(t!==null&&t.memoizedState!==null)&&a&&(s.child.flags|=8192,s.mode&1&&(t===null||Pe.current&1?We===0&&(We=3):fd())),s.updateQueue!==null&&(s.flags|=4),tt(s),null);case 4:return ea(),rc(t,s),t===null&&an(s.stateNode.containerInfo),tt(s),null;case 10:return Zc(s.type._context),tt(s),null;case 17:return pt(s.type)&&Ai(),tt(s),null;case 19:if(Se(Pe),i=s.memoizedState,i===null)return tt(s),null;if(a=(s.flags&128)!==0,l=i.rendering,l===null)if(a)Ra(i,!1);else{if(We!==0||t!==null&&t.flags&128)for(t=s.child;t!==null;){if(l=Fi(t),l!==null){for(s.flags|=128,Ra(i,!1),a=l.updateQueue,a!==null&&(s.updateQueue=a,s.flags|=4),s.subtreeFlags=0,a=r,r=s.child;r!==null;)i=r,t=a,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,t=l.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return _e(Pe,Pe.current&1|2),s.child}t=t.sibling}i.tail!==null&&Le()>sa&&(s.flags|=128,a=!0,Ra(i,!1),s.lanes=4194304)}else{if(!a)if(t=Fi(l),t!==null){if(s.flags|=128,a=!0,r=t.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),Ra(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!Ee)return tt(s),null}else 2*Le()-i.renderingStartTime>sa&&r!==1073741824&&(s.flags|=128,a=!0,Ra(i,!1),s.lanes=4194304);i.isBackwards?(l.sibling=s.child,s.child=l):(r=i.last,r!==null?r.sibling=l:s.child=l,i.last=l)}return i.tail!==null?(s=i.tail,i.rendering=s,i.tail=s.sibling,i.renderingStartTime=Le(),s.sibling=null,r=Pe.current,_e(Pe,a?r&1|2:r&1),s):(tt(s),null);case 22:case 23:return gd(),a=s.memoizedState!==null,t!==null&&t.memoizedState!==null!==a&&(s.flags|=8192),a&&s.mode&1?vt&1073741824&&(tt(s),s.subtreeFlags&6&&(s.flags|=8192)):tt(s),null;case 24:return null;case 25:return null}throw Error(K(156,s.tag))}function p0(t,s){switch(Yc(s),s.tag){case 1:return pt(s.type)&&Ai(),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return ea(),Se(ft),Se(rt),ad(),t=s.flags,t&65536&&!(t&128)?(s.flags=t&-65537|128,s):null;case 5:return rd(s),null;case 13:if(Se(Pe),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(K(340));Xr()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return Se(Pe),null;case 4:return ea(),null;case 10:return Zc(s.type._context),null;case 22:case 23:return gd(),null;case 24:return null;default:return null}}var Yn=!1,st=!1,y0=typeof WeakSet=="function"?WeakSet:Set,Q=null;function qr(t,s){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(a){$e(t,s,a)}else r.current=null}function ac(t,s,r){try{r()}catch(a){$e(t,s,a)}}var Gu=!1;function b0(t,s){if(qo=Ei,t=$h(),Gc(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var a=r.getSelection&&r.getSelection();if(a&&a.rangeCount!==0){r=a.anchorNode;var n=a.anchorOffset,i=a.focusNode;a=a.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var l=0,o=-1,c=-1,d=0,m=0,u=t,h=null;t:for(;;){for(var f;u!==r||n!==0&&u.nodeType!==3||(o=l+n),u!==i||a!==0&&u.nodeType!==3||(c=l+a),u.nodeType===3&&(l+=u.nodeValue.length),(f=u.firstChild)!==null;)h=u,u=f;for(;;){if(u===t)break t;if(h===r&&++d===n&&(o=l),h===i&&++m===a&&(c=l),(f=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=f}r=o===-1||c===-1?null:{start:o,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(Bo={focusedElem:t,selectionRange:r},Ei=!1,Q=s;Q!==null;)if(s=Q,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,Q=t;else for(;Q!==null;){s=Q;try{var g=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var j=g.memoizedProps,w=g.memoizedState,v=s.stateNode,p=v.getSnapshotBeforeUpdate(s.elementType===s.type?j:qt(s.type,j),w);v.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var y=s.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(K(163))}}catch(b){$e(s,s.return,b)}if(t=s.sibling,t!==null){t.return=s.return,Q=t;break}Q=s.return}return g=Gu,Gu=!1,g}function za(t,s,r){var a=s.updateQueue;if(a=a!==null?a.lastEffect:null,a!==null){var n=a=a.next;do{if((n.tag&t)===t){var i=n.destroy;n.destroy=void 0,i!==void 0&&ac(s,r,i)}n=n.next}while(n!==a)}}function gl(t,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var a=r.create;r.destroy=a()}r=r.next}while(r!==s)}}function nc(t){var s=t.ref;if(s!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof s=="function"?s(t):s.current=t}}function Px(t){var s=t.alternate;s!==null&&(t.alternate=null,Px(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&(delete s[ts],delete s[ln],delete s[Wo],delete s[t0],delete s[s0])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Tx(t){return t.tag===5||t.tag===3||t.tag===4}function Ku(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Tx(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ic(t,s,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,s?r.nodeType===8?r.parentNode.insertBefore(t,s):r.insertBefore(t,s):(r.nodeType===8?(s=r.parentNode,s.insertBefore(t,r)):(s=r,s.appendChild(t)),r=r._reactRootContainer,r!=null||s.onclick!==null||(s.onclick=Ti));else if(a!==4&&(t=t.child,t!==null))for(ic(t,s,r),t=t.sibling;t!==null;)ic(t,s,r),t=t.sibling}function lc(t,s,r){var a=t.tag;if(a===5||a===6)t=t.stateNode,s?r.insertBefore(t,s):r.appendChild(t);else if(a!==4&&(t=t.child,t!==null))for(lc(t,s,r),t=t.sibling;t!==null;)lc(t,s,r),t=t.sibling}var Je=null,Bt=!1;function _s(t,s,r){for(r=r.child;r!==null;)Ax(t,s,r),r=r.sibling}function Ax(t,s,r){if(rs&&typeof rs.onCommitFiberUnmount=="function")try{rs.onCommitFiberUnmount(ll,r)}catch{}switch(r.tag){case 5:st||qr(r,s);case 6:var a=Je,n=Bt;Je=null,_s(t,s,r),Je=a,Bt=n,Je!==null&&(Bt?(t=Je,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Je.removeChild(r.stateNode));break;case 18:Je!==null&&(Bt?(t=Je,r=r.stateNode,t.nodeType===8?Yl(t.parentNode,r):t.nodeType===1&&Yl(t,r),tn(t)):Yl(Je,r.stateNode));break;case 4:a=Je,n=Bt,Je=r.stateNode.containerInfo,Bt=!0,_s(t,s,r),Je=a,Bt=n;break;case 0:case 11:case 14:case 15:if(!st&&(a=r.updateQueue,a!==null&&(a=a.lastEffect,a!==null))){n=a=a.next;do{var i=n,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&ac(r,s,l),n=n.next}while(n!==a)}_s(t,s,r);break;case 1:if(!st&&(qr(r,s),a=r.stateNode,typeof a.componentWillUnmount=="function"))try{a.props=r.memoizedProps,a.state=r.memoizedState,a.componentWillUnmount()}catch(o){$e(r,s,o)}_s(t,s,r);break;case 21:_s(t,s,r);break;case 22:r.mode&1?(st=(a=st)||r.memoizedState!==null,_s(t,s,r),st=a):_s(t,s,r);break;default:_s(t,s,r)}}function Yu(t){var s=t.updateQueue;if(s!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new y0),s.forEach(function(a){var n=E0.bind(null,t,a);r.has(a)||(r.add(a),a.then(n,n))})}}function Ft(t,s){var r=s.deletions;if(r!==null)for(var a=0;a<r.length;a++){var n=r[a];try{var i=t,l=s,o=l;e:for(;o!==null;){switch(o.tag){case 5:Je=o.stateNode,Bt=!1;break e;case 3:Je=o.stateNode.containerInfo,Bt=!0;break e;case 4:Je=o.stateNode.containerInfo,Bt=!0;break e}o=o.return}if(Je===null)throw Error(K(160));Ax(i,l,n),Je=null,Bt=!1;var c=n.alternate;c!==null&&(c.return=null),n.return=null}catch(d){$e(n,s,d)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Dx(s,t),s=s.sibling}function Dx(t,s){var r=t.alternate,a=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ft(s,t),Xt(t),a&4){try{za(3,t,t.return),gl(3,t)}catch(j){$e(t,t.return,j)}try{za(5,t,t.return)}catch(j){$e(t,t.return,j)}}break;case 1:Ft(s,t),Xt(t),a&512&&r!==null&&qr(r,r.return);break;case 5:if(Ft(s,t),Xt(t),a&512&&r!==null&&qr(r,r.return),t.flags&32){var n=t.stateNode;try{Qa(n,"")}catch(j){$e(t,t.return,j)}}if(a&4&&(n=t.stateNode,n!=null)){var i=t.memoizedProps,l=r!==null?r.memoizedProps:i,o=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&th(n,i),To(o,l);var d=To(o,i);for(l=0;l<c.length;l+=2){var m=c[l],u=c[l+1];m==="style"?ih(n,u):m==="dangerouslySetInnerHTML"?ah(n,u):m==="children"?Qa(n,u):$c(n,m,u,d)}switch(o){case"input":So(n,i);break;case"textarea":sh(n,i);break;case"select":var h=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Vr(n,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?Vr(n,!!i.multiple,i.defaultValue,!0):Vr(n,!!i.multiple,i.multiple?[]:"",!1))}n[ln]=i}catch(j){$e(t,t.return,j)}}break;case 6:if(Ft(s,t),Xt(t),a&4){if(t.stateNode===null)throw Error(K(162));n=t.stateNode,i=t.memoizedProps;try{n.nodeValue=i}catch(j){$e(t,t.return,j)}}break;case 3:if(Ft(s,t),Xt(t),a&4&&r!==null&&r.memoizedState.isDehydrated)try{tn(s.containerInfo)}catch(j){$e(t,t.return,j)}break;case 4:Ft(s,t),Xt(t);break;case 13:Ft(s,t),Xt(t),n=t.child,n.flags&8192&&(i=n.memoizedState!==null,n.stateNode.isHidden=i,!i||n.alternate!==null&&n.alternate.memoizedState!==null||(hd=Le())),a&4&&Yu(t);break;case 22:if(m=r!==null&&r.memoizedState!==null,t.mode&1?(st=(d=st)||m,Ft(s,t),st=d):Ft(s,t),Xt(t),a&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!m&&t.mode&1)for(Q=t,m=t.child;m!==null;){for(u=Q=m;Q!==null;){switch(h=Q,f=h.child,h.tag){case 0:case 11:case 14:case 15:za(4,h,h.return);break;case 1:qr(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){a=h,r=h.return;try{s=a,g.props=s.memoizedProps,g.state=s.memoizedState,g.componentWillUnmount()}catch(j){$e(a,r,j)}}break;case 5:qr(h,h.return);break;case 22:if(h.memoizedState!==null){Qu(u);continue}}f!==null?(f.return=h,Q=f):Qu(u)}m=m.sibling}e:for(m=null,u=t;;){if(u.tag===5){if(m===null){m=u;try{n=u.stateNode,d?(i=n.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=u.stateNode,c=u.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=nh("display",l))}catch(j){$e(t,t.return,j)}}}else if(u.tag===6){if(m===null)try{u.stateNode.nodeValue=d?"":u.memoizedProps}catch(j){$e(t,t.return,j)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break e;for(;u.sibling===null;){if(u.return===null||u.return===t)break e;m===u&&(m=null),u=u.return}m===u&&(m=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Ft(s,t),Xt(t),a&4&&Yu(t);break;case 21:break;default:Ft(s,t),Xt(t)}}function Xt(t){var s=t.flags;if(s&2){try{e:{for(var r=t.return;r!==null;){if(Tx(r)){var a=r;break e}r=r.return}throw Error(K(160))}switch(a.tag){case 5:var n=a.stateNode;a.flags&32&&(Qa(n,""),a.flags&=-33);var i=Ku(t);lc(t,i,n);break;case 3:case 4:var l=a.stateNode.containerInfo,o=Ku(t);ic(t,o,l);break;default:throw Error(K(161))}}catch(c){$e(t,t.return,c)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function v0(t,s,r){Q=t,$x(t)}function $x(t,s,r){for(var a=(t.mode&1)!==0;Q!==null;){var n=Q,i=n.child;if(n.tag===22&&a){var l=n.memoizedState!==null||Yn;if(!l){var o=n.alternate,c=o!==null&&o.memoizedState!==null||st;o=Yn;var d=st;if(Yn=l,(st=c)&&!d)for(Q=n;Q!==null;)l=Q,c=l.child,l.tag===22&&l.memoizedState!==null?Xu(n):c!==null?(c.return=l,Q=c):Xu(n);for(;i!==null;)Q=i,$x(i),i=i.sibling;Q=n,Yn=o,st=d}Ju(t)}else n.subtreeFlags&8772&&i!==null?(i.return=n,Q=i):Ju(t)}}function Ju(t){for(;Q!==null;){var s=Q;if(s.flags&8772){var r=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:st||gl(5,s);break;case 1:var a=s.stateNode;if(s.flags&4&&!st)if(r===null)a.componentDidMount();else{var n=s.elementType===s.type?r.memoizedProps:qt(s.type,r.memoizedProps);a.componentDidUpdate(n,r.memoizedState,a.__reactInternalSnapshotBeforeUpdate)}var i=s.updateQueue;i!==null&&$u(s,i,a);break;case 3:var l=s.updateQueue;if(l!==null){if(r=null,s.child!==null)switch(s.child.tag){case 5:r=s.child.stateNode;break;case 1:r=s.child.stateNode}$u(s,l,r)}break;case 5:var o=s.stateNode;if(r===null&&s.flags&4){r=o;var c=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var d=s.alternate;if(d!==null){var m=d.memoizedState;if(m!==null){var u=m.dehydrated;u!==null&&tn(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(K(163))}st||s.flags&512&&nc(s)}catch(h){$e(s,s.return,h)}}if(s===t){Q=null;break}if(r=s.sibling,r!==null){r.return=s.return,Q=r;break}Q=s.return}}function Qu(t){for(;Q!==null;){var s=Q;if(s===t){Q=null;break}var r=s.sibling;if(r!==null){r.return=s.return,Q=r;break}Q=s.return}}function Xu(t){for(;Q!==null;){var s=Q;try{switch(s.tag){case 0:case 11:case 15:var r=s.return;try{gl(4,s)}catch(c){$e(s,r,c)}break;case 1:var a=s.stateNode;if(typeof a.componentDidMount=="function"){var n=s.return;try{a.componentDidMount()}catch(c){$e(s,n,c)}}var i=s.return;try{nc(s)}catch(c){$e(s,i,c)}break;case 5:var l=s.return;try{nc(s)}catch(c){$e(s,l,c)}}}catch(c){$e(s,s.return,c)}if(s===t){Q=null;break}var o=s.sibling;if(o!==null){o.return=s.return,Q=o;break}Q=s.return}}var j0=Math.ceil,Bi=vs.ReactCurrentDispatcher,ud=vs.ReactCurrentOwner,Dt=vs.ReactCurrentBatchConfig,ge=0,Ke=null,Ue=null,Xe=0,vt=0,Br=Js(0),We=0,hn=null,xr=0,fl=0,md=0,Va=null,ht=null,hd=0,sa=1/0,os=null,zi=!1,oc=null,qs=null,Jn=!1,$s=null,Vi=0,Wa=0,cc=null,yi=-1,bi=0;function ct(){return ge&6?Le():yi!==-1?yi:yi=Le()}function Bs(t){return t.mode&1?ge&2&&Xe!==0?Xe&-Xe:a0.transition!==null?(bi===0&&(bi=yh()),bi):(t=je,t!==0||(t=window.event,t=t===void 0?16:kh(t.type)),t):1}function Gt(t,s,r,a){if(50<Wa)throw Wa=0,cc=null,Error(K(185));kn(t,r,a),(!(ge&2)||t!==Ke)&&(t===Ke&&(!(ge&2)&&(fl|=r),We===4&&Ts(t,Xe)),yt(t,a),r===1&&ge===0&&!(s.mode&1)&&(sa=Le()+500,ml&&Qs()))}function yt(t,s){var r=t.callbackNode;ap(t,s);var a=Ci(t,t===Ke?Xe:0);if(a===0)r!==null&&lu(r),t.callbackNode=null,t.callbackPriority=0;else if(s=a&-a,t.callbackPriority!==s){if(r!=null&&lu(r),s===1)t.tag===0?r0(Zu.bind(null,t)):Vh(Zu.bind(null,t)),Zp(function(){!(ge&6)&&Qs()}),r=null;else{switch(bh(a)){case 1:r=Fc;break;case 4:r=fh;break;case 16:r=Si;break;case 536870912:r=ph;break;default:r=Si}r=Bx(r,Ix.bind(null,t))}t.callbackPriority=s,t.callbackNode=r}}function Ix(t,s){if(yi=-1,bi=0,ge&6)throw Error(K(327));var r=t.callbackNode;if(Yr()&&t.callbackNode!==r)return null;var a=Ci(t,t===Ke?Xe:0);if(a===0)return null;if(a&30||a&t.expiredLanes||s)s=Wi(t,a);else{s=a;var n=ge;ge|=2;var i=Mx();(Ke!==t||Xe!==s)&&(os=null,sa=Le()+500,cr(t,s));do try{_0();break}catch(o){Lx(t,o)}while(!0);Xc(),Bi.current=i,ge=n,Ue!==null?s=0:(Ke=null,Xe=0,s=We)}if(s!==0){if(s===2&&(n=Lo(t),n!==0&&(a=n,s=dc(t,n))),s===1)throw r=hn,cr(t,0),Ts(t,a),yt(t,Le()),r;if(s===6)Ts(t,a);else{if(n=t.current.alternate,!(a&30)&&!w0(n)&&(s=Wi(t,a),s===2&&(i=Lo(t),i!==0&&(a=i,s=dc(t,i))),s===1))throw r=hn,cr(t,0),Ts(t,a),yt(t,Le()),r;switch(t.finishedWork=n,t.finishedLanes=a,s){case 0:case 1:throw Error(K(345));case 2:rr(t,ht,os);break;case 3:if(Ts(t,a),(a&130023424)===a&&(s=hd+500-Le(),10<s)){if(Ci(t,0)!==0)break;if(n=t.suspendedLanes,(n&a)!==a){ct(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=Vo(rr.bind(null,t,ht,os),s);break}rr(t,ht,os);break;case 4:if(Ts(t,a),(a&4194240)===a)break;for(s=t.eventTimes,n=-1;0<a;){var l=31-Ht(a);i=1<<l,l=s[l],l>n&&(n=l),a&=~i}if(a=n,a=Le()-a,a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*j0(a/1960))-a,10<a){t.timeoutHandle=Vo(rr.bind(null,t,ht,os),a);break}rr(t,ht,os);break;case 5:rr(t,ht,os);break;default:throw Error(K(329))}}}return yt(t,Le()),t.callbackNode===r?Ix.bind(null,t):null}function dc(t,s){var r=Va;return t.current.memoizedState.isDehydrated&&(cr(t,s).flags|=256),t=Wi(t,s),t!==2&&(s=ht,ht=r,s!==null&&uc(s)),t}function uc(t){ht===null?ht=t:ht.push.apply(ht,t)}function w0(t){for(var s=t;;){if(s.flags&16384){var r=s.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var a=0;a<r.length;a++){var n=r[a],i=n.getSnapshot;n=n.value;try{if(!Kt(i(),n))return!1}catch{return!1}}}if(r=s.child,s.subtreeFlags&16384&&r!==null)r.return=s,s=r;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ts(t,s){for(s&=~md,s&=~fl,t.suspendedLanes|=s,t.pingedLanes&=~s,t=t.expirationTimes;0<s;){var r=31-Ht(s),a=1<<r;t[r]=-1,s&=~a}}function Zu(t){if(ge&6)throw Error(K(327));Yr();var s=Ci(t,0);if(!(s&1))return yt(t,Le()),null;var r=Wi(t,s);if(t.tag!==0&&r===2){var a=Lo(t);a!==0&&(s=a,r=dc(t,a))}if(r===1)throw r=hn,cr(t,0),Ts(t,s),yt(t,Le()),r;if(r===6)throw Error(K(345));return t.finishedWork=t.current.alternate,t.finishedLanes=s,rr(t,ht,os),yt(t,Le()),null}function xd(t,s){var r=ge;ge|=1;try{return t(s)}finally{ge=r,ge===0&&(sa=Le()+500,ml&&Qs())}}function gr(t){$s!==null&&$s.tag===0&&!(ge&6)&&Yr();var s=ge;ge|=1;var r=Dt.transition,a=je;try{if(Dt.transition=null,je=1,t)return t()}finally{je=a,Dt.transition=r,ge=s,!(ge&6)&&Qs()}}function gd(){vt=Br.current,Se(Br)}function cr(t,s){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Xp(r)),Ue!==null)for(r=Ue.return;r!==null;){var a=r;switch(Yc(a),a.tag){case 1:a=a.type.childContextTypes,a!=null&&Ai();break;case 3:ea(),Se(ft),Se(rt),ad();break;case 5:rd(a);break;case 4:ea();break;case 13:Se(Pe);break;case 19:Se(Pe);break;case 10:Zc(a.type._context);break;case 22:case 23:gd()}r=r.return}if(Ke=t,Ue=t=zs(t.current,null),Xe=vt=s,We=0,hn=null,md=fl=xr=0,ht=Va=null,lr!==null){for(s=0;s<lr.length;s++)if(r=lr[s],a=r.interleaved,a!==null){r.interleaved=null;var n=a.next,i=r.pending;if(i!==null){var l=i.next;i.next=n,a.next=l}r.pending=a}lr=null}return t}function Lx(t,s){do{var r=Ue;try{if(Xc(),gi.current=qi,Ui){for(var a=Te.memoizedState;a!==null;){var n=a.queue;n!==null&&(n.pending=null),a=a.next}Ui=!1}if(hr=0,Ge=Ve=Te=null,Ba=!1,dn=0,ud.current=null,r===null||r.return===null){We=1,hn=s,Ue=null;break}e:{var i=t,l=r.return,o=r,c=s;if(s=Xe,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,m=o,u=m.tag;if(!(m.mode&1)&&(u===0||u===11||u===15)){var h=m.alternate;h?(m.updateQueue=h.updateQueue,m.memoizedState=h.memoizedState,m.lanes=h.lanes):(m.updateQueue=null,m.memoizedState=null)}var f=Uu(l);if(f!==null){f.flags&=-257,qu(f,l,o,i,s),f.mode&1&&Fu(i,d,s),s=f,c=d;var g=s.updateQueue;if(g===null){var j=new Set;j.add(c),s.updateQueue=j}else g.add(c);break e}else{if(!(s&1)){Fu(i,d,s),fd();break e}c=Error(K(426))}}else if(Ee&&o.mode&1){var w=Uu(l);if(w!==null){!(w.flags&65536)&&(w.flags|=256),qu(w,l,o,i,s),Jc(ta(c,o));break e}}i=c=ta(c,o),We!==4&&(We=2),Va===null?Va=[i]:Va.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,s&=-s,i.lanes|=s;var v=bx(i,c,s);Du(i,v);break e;case 1:o=c;var p=i.type,y=i.stateNode;if(!(i.flags&128)&&(typeof p.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(qs===null||!qs.has(y)))){i.flags|=65536,s&=-s,i.lanes|=s;var b=vx(i,o,s);Du(i,b);break e}}i=i.return}while(i!==null)}Fx(r)}catch(N){s=N,Ue===r&&r!==null&&(Ue=r=r.return);continue}break}while(!0)}function Mx(){var t=Bi.current;return Bi.current=qi,t===null?qi:t}function fd(){(We===0||We===3||We===2)&&(We=4),Ke===null||!(xr&268435455)&&!(fl&268435455)||Ts(Ke,Xe)}function Wi(t,s){var r=ge;ge|=2;var a=Mx();(Ke!==t||Xe!==s)&&(os=null,cr(t,s));do try{N0();break}catch(n){Lx(t,n)}while(!0);if(Xc(),ge=r,Bi.current=a,Ue!==null)throw Error(K(261));return Ke=null,Xe=0,We}function N0(){for(;Ue!==null;)Ox(Ue)}function _0(){for(;Ue!==null&&!Yf();)Ox(Ue)}function Ox(t){var s=qx(t.alternate,t,vt);t.memoizedProps=t.pendingProps,s===null?Fx(t):Ue=s,ud.current=null}function Fx(t){var s=t;do{var r=s.alternate;if(t=s.return,s.flags&32768){if(r=p0(r,s),r!==null){r.flags&=32767,Ue=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{We=6,Ue=null;return}}else if(r=f0(r,s,vt),r!==null){Ue=r;return}if(s=s.sibling,s!==null){Ue=s;return}Ue=s=t}while(s!==null);We===0&&(We=5)}function rr(t,s,r){var a=je,n=Dt.transition;try{Dt.transition=null,je=1,k0(t,s,r,a)}finally{Dt.transition=n,je=a}return null}function k0(t,s,r,a){do Yr();while($s!==null);if(ge&6)throw Error(K(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(K(177));t.callbackNode=null,t.callbackPriority=0;var i=r.lanes|r.childLanes;if(np(t,i),t===Ke&&(Ue=Ke=null,Xe=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||Jn||(Jn=!0,Bx(Si,function(){return Yr(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=Dt.transition,Dt.transition=null;var l=je;je=1;var o=ge;ge|=4,ud.current=null,b0(t,r),Dx(r,t),Wp(Bo),Ei=!!qo,Bo=qo=null,t.current=r,v0(r),Jf(),ge=o,je=l,Dt.transition=i}else t.current=r;if(Jn&&(Jn=!1,$s=t,Vi=n),i=t.pendingLanes,i===0&&(qs=null),Zf(r.stateNode),yt(t,Le()),s!==null)for(a=t.onRecoverableError,r=0;r<s.length;r++)n=s[r],a(n.value,{componentStack:n.stack,digest:n.digest});if(zi)throw zi=!1,t=oc,oc=null,t;return Vi&1&&t.tag!==0&&Yr(),i=t.pendingLanes,i&1?t===cc?Wa++:(Wa=0,cc=t):Wa=0,Qs(),null}function Yr(){if($s!==null){var t=bh(Vi),s=Dt.transition,r=je;try{if(Dt.transition=null,je=16>t?16:t,$s===null)var a=!1;else{if(t=$s,$s=null,Vi=0,ge&6)throw Error(K(331));var n=ge;for(ge|=4,Q=t.current;Q!==null;){var i=Q,l=i.child;if(Q.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var d=o[c];for(Q=d;Q!==null;){var m=Q;switch(m.tag){case 0:case 11:case 15:za(8,m,i)}var u=m.child;if(u!==null)u.return=m,Q=u;else for(;Q!==null;){m=Q;var h=m.sibling,f=m.return;if(Px(m),m===d){Q=null;break}if(h!==null){h.return=f,Q=h;break}Q=f}}}var g=i.alternate;if(g!==null){var j=g.child;if(j!==null){g.child=null;do{var w=j.sibling;j.sibling=null,j=w}while(j!==null)}}Q=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,Q=l;else e:for(;Q!==null;){if(i=Q,i.flags&2048)switch(i.tag){case 0:case 11:case 15:za(9,i,i.return)}var v=i.sibling;if(v!==null){v.return=i.return,Q=v;break e}Q=i.return}}var p=t.current;for(Q=p;Q!==null;){l=Q;var y=l.child;if(l.subtreeFlags&2064&&y!==null)y.return=l,Q=y;else e:for(l=p;Q!==null;){if(o=Q,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:gl(9,o)}}catch(N){$e(o,o.return,N)}if(o===l){Q=null;break e}var b=o.sibling;if(b!==null){b.return=o.return,Q=b;break e}Q=o.return}}if(ge=n,Qs(),rs&&typeof rs.onPostCommitFiberRoot=="function")try{rs.onPostCommitFiberRoot(ll,t)}catch{}a=!0}return a}finally{je=r,Dt.transition=s}}return!1}function em(t,s,r){s=ta(r,s),s=bx(t,s,1),t=Us(t,s,1),s=ct(),t!==null&&(kn(t,1,s),yt(t,s))}function $e(t,s,r){if(t.tag===3)em(t,t,r);else for(;s!==null;){if(s.tag===3){em(s,t,r);break}else if(s.tag===1){var a=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof a.componentDidCatch=="function"&&(qs===null||!qs.has(a))){t=ta(r,t),t=vx(s,t,1),s=Us(s,t,1),t=ct(),s!==null&&(kn(s,1,t),yt(s,t));break}}s=s.return}}function S0(t,s,r){var a=t.pingCache;a!==null&&a.delete(s),s=ct(),t.pingedLanes|=t.suspendedLanes&r,Ke===t&&(Xe&r)===r&&(We===4||We===3&&(Xe&130023424)===Xe&&500>Le()-hd?cr(t,0):md|=r),yt(t,s)}function Ux(t,s){s===0&&(t.mode&1?(s=Un,Un<<=1,!(Un&130023424)&&(Un=4194304)):s=1);var r=ct();t=fs(t,s),t!==null&&(kn(t,s,r),yt(t,r))}function C0(t){var s=t.memoizedState,r=0;s!==null&&(r=s.retryLane),Ux(t,r)}function E0(t,s){var r=0;switch(t.tag){case 13:var a=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:a=t.stateNode;break;default:throw Error(K(314))}a!==null&&a.delete(s),Ux(t,r)}var qx;qx=function(t,s,r){if(t!==null)if(t.memoizedProps!==s.pendingProps||ft.current)gt=!0;else{if(!(t.lanes&r)&&!(s.flags&128))return gt=!1,g0(t,s,r);gt=!!(t.flags&131072)}else gt=!1,Ee&&s.flags&1048576&&Wh(s,Ii,s.index);switch(s.lanes=0,s.tag){case 2:var a=s.type;pi(t,s),t=s.pendingProps;var n=Qr(s,rt.current);Kr(s,r),n=id(null,s,a,t,n,r);var i=ld();return s.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,pt(a)?(i=!0,Di(s)):i=!1,s.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,td(s),n.updater=xl,s.stateNode=n,n._reactInternals=s,Qo(s,a,t,r),s=ec(null,s,a,!0,i,r)):(s.tag=0,Ee&&i&&Kc(s),lt(null,s,n,r),s=s.child),s;case 16:a=s.elementType;e:{switch(pi(t,s),t=s.pendingProps,n=a._init,a=n(a._payload),s.type=a,n=s.tag=P0(a),t=qt(a,t),n){case 0:s=Zo(null,s,a,t,r);break e;case 1:s=Vu(null,s,a,t,r);break e;case 11:s=Bu(null,s,a,t,r);break e;case 14:s=zu(null,s,a,qt(a.type,t),r);break e}throw Error(K(306,a,""))}return s;case 0:return a=s.type,n=s.pendingProps,n=s.elementType===a?n:qt(a,n),Zo(t,s,a,n,r);case 1:return a=s.type,n=s.pendingProps,n=s.elementType===a?n:qt(a,n),Vu(t,s,a,n,r);case 3:e:{if(_x(s),t===null)throw Error(K(387));a=s.pendingProps,i=s.memoizedState,n=i.element,Qh(t,s),Oi(s,a,null,r);var l=s.memoizedState;if(a=l.element,i.isDehydrated)if(i={element:a,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},s.updateQueue.baseState=i,s.memoizedState=i,s.flags&256){n=ta(Error(K(423)),s),s=Wu(t,s,a,r,n);break e}else if(a!==n){n=ta(Error(K(424)),s),s=Wu(t,s,a,r,n);break e}else for(jt=Fs(s.stateNode.containerInfo.firstChild),wt=s,Ee=!0,Vt=null,r=Yh(s,null,a,r),s.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Xr(),a===n){s=ps(t,s,r);break e}lt(t,s,a,r)}s=s.child}return s;case 5:return Xh(s),t===null&&Ko(s),a=s.type,n=s.pendingProps,i=t!==null?t.memoizedProps:null,l=n.children,zo(a,n)?l=null:i!==null&&zo(a,i)&&(s.flags|=32),Nx(t,s),lt(t,s,l,r),s.child;case 6:return t===null&&Ko(s),null;case 13:return kx(t,s,r);case 4:return sd(s,s.stateNode.containerInfo),a=s.pendingProps,t===null?s.child=Zr(s,null,a,r):lt(t,s,a,r),s.child;case 11:return a=s.type,n=s.pendingProps,n=s.elementType===a?n:qt(a,n),Bu(t,s,a,n,r);case 7:return lt(t,s,s.pendingProps,r),s.child;case 8:return lt(t,s,s.pendingProps.children,r),s.child;case 12:return lt(t,s,s.pendingProps.children,r),s.child;case 10:e:{if(a=s.type._context,n=s.pendingProps,i=s.memoizedProps,l=n.value,_e(Li,a._currentValue),a._currentValue=l,i!==null)if(Kt(i.value,l)){if(i.children===n.children&&!ft.current){s=ps(t,s,r);break e}}else for(i=s.child,i!==null&&(i.return=s);i!==null;){var o=i.dependencies;if(o!==null){l=i.child;for(var c=o.firstContext;c!==null;){if(c.context===a){if(i.tag===1){c=hs(-1,r&-r),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var m=d.pending;m===null?c.next=c:(c.next=m.next,m.next=c),d.pending=c}}i.lanes|=r,c=i.alternate,c!==null&&(c.lanes|=r),Yo(i.return,r,s),o.lanes|=r;break}c=c.next}}else if(i.tag===10)l=i.type===s.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(K(341));l.lanes|=r,o=l.alternate,o!==null&&(o.lanes|=r),Yo(l,r,s),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===s){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}lt(t,s,n.children,r),s=s.child}return s;case 9:return n=s.type,a=s.pendingProps.children,Kr(s,r),n=It(n),a=a(n),s.flags|=1,lt(t,s,a,r),s.child;case 14:return a=s.type,n=qt(a,s.pendingProps),n=qt(a.type,n),zu(t,s,a,n,r);case 15:return jx(t,s,s.type,s.pendingProps,r);case 17:return a=s.type,n=s.pendingProps,n=s.elementType===a?n:qt(a,n),pi(t,s),s.tag=1,pt(a)?(t=!0,Di(s)):t=!1,Kr(s,r),yx(s,a,n),Qo(s,a,n,r),ec(null,s,a,!0,t,r);case 19:return Sx(t,s,r);case 22:return wx(t,s,r)}throw Error(K(156,s.tag))};function Bx(t,s){return gh(t,s)}function R0(t,s,r,a){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function At(t,s,r,a){return new R0(t,s,r,a)}function pd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function P0(t){if(typeof t=="function")return pd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Lc)return 11;if(t===Mc)return 14}return 2}function zs(t,s){var r=t.alternate;return r===null?(r=At(t.tag,s,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=s,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,s=t.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function vi(t,s,r,a,n,i){var l=2;if(a=t,typeof t=="function")pd(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case Ar:return dr(r.children,n,i,s);case Ic:l=8,n|=8;break;case jo:return t=At(12,r,s,n|2),t.elementType=jo,t.lanes=i,t;case wo:return t=At(13,r,s,n),t.elementType=wo,t.lanes=i,t;case No:return t=At(19,r,s,n),t.elementType=No,t.lanes=i,t;case Xm:return pl(r,n,i,s);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Jm:l=10;break e;case Qm:l=9;break e;case Lc:l=11;break e;case Mc:l=14;break e;case Es:l=16,a=null;break e}throw Error(K(130,t==null?t:typeof t,""))}return s=At(l,r,s,n),s.elementType=t,s.type=a,s.lanes=i,s}function dr(t,s,r,a){return t=At(7,t,a,s),t.lanes=r,t}function pl(t,s,r,a){return t=At(22,t,a,s),t.elementType=Xm,t.lanes=r,t.stateNode={isHidden:!1},t}function ro(t,s,r){return t=At(6,t,null,s),t.lanes=r,t}function ao(t,s,r){return s=At(4,t.children!==null?t.children:[],t.key,s),s.lanes=r,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}function T0(t,s,r,a,n){this.tag=s,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ol(0),this.expirationTimes=Ol(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ol(0),this.identifierPrefix=a,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function yd(t,s,r,a,n,i,l,o,c){return t=new T0(t,s,r,o,c),s===1?(s=1,i===!0&&(s|=8)):s=0,i=At(3,null,null,s),t.current=i,i.stateNode=t,i.memoizedState={element:a,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},td(i),t}function A0(t,s,r){var a=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Tr,key:a==null?null:""+a,children:t,containerInfo:s,implementation:r}}function zx(t){if(!t)return Hs;t=t._reactInternals;e:{if(pr(t)!==t||t.tag!==1)throw Error(K(170));var s=t;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(pt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(K(171))}if(t.tag===1){var r=t.type;if(pt(r))return zh(t,r,s)}return s}function Vx(t,s,r,a,n,i,l,o,c){return t=yd(r,a,!0,t,n,i,l,o,c),t.context=zx(null),r=t.current,a=ct(),n=Bs(r),i=hs(a,n),i.callback=s??null,Us(r,i,n),t.current.lanes=n,kn(t,n,a),yt(t,a),t}function yl(t,s,r,a){var n=s.current,i=ct(),l=Bs(n);return r=zx(r),s.context===null?s.context=r:s.pendingContext=r,s=hs(i,l),s.payload={element:t},a=a===void 0?null:a,a!==null&&(s.callback=a),t=Us(n,s,l),t!==null&&(Gt(t,n,l,i),xi(t,n,l)),l}function Hi(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function tm(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<s?r:s}}function bd(t,s){tm(t,s),(t=t.alternate)&&tm(t,s)}function D0(){return null}var Wx=typeof reportError=="function"?reportError:function(t){console.error(t)};function vd(t){this._internalRoot=t}bl.prototype.render=vd.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(K(409));yl(t,s,null,null)};bl.prototype.unmount=vd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;gr(function(){yl(null,t,null,null)}),s[gs]=null}};function bl(t){this._internalRoot=t}bl.prototype.unstable_scheduleHydration=function(t){if(t){var s=wh();t={blockedOn:null,target:t,priority:s};for(var r=0;r<Ps.length&&s!==0&&s<Ps[r].priority;r++);Ps.splice(r,0,t),r===0&&_h(t)}};function jd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function sm(){}function $0(t,s,r,a,n){if(n){if(typeof a=="function"){var i=a;a=function(){var d=Hi(l);i.call(d)}}var l=Vx(s,a,t,0,null,!1,!1,"",sm);return t._reactRootContainer=l,t[gs]=l.current,an(t.nodeType===8?t.parentNode:t),gr(),l}for(;n=t.lastChild;)t.removeChild(n);if(typeof a=="function"){var o=a;a=function(){var d=Hi(c);o.call(d)}}var c=yd(t,0,!1,null,null,!1,!1,"",sm);return t._reactRootContainer=c,t[gs]=c.current,an(t.nodeType===8?t.parentNode:t),gr(function(){yl(s,c,r,a)}),c}function jl(t,s,r,a,n){var i=r._reactRootContainer;if(i){var l=i;if(typeof n=="function"){var o=n;n=function(){var c=Hi(l);o.call(c)}}yl(s,l,t,n)}else l=$0(r,s,t,n,a);return Hi(l)}vh=function(t){switch(t.tag){case 3:var s=t.stateNode;if(s.current.memoizedState.isDehydrated){var r=$a(s.pendingLanes);r!==0&&(Uc(s,r|1),yt(s,Le()),!(ge&6)&&(sa=Le()+500,Qs()))}break;case 13:gr(function(){var a=fs(t,1);if(a!==null){var n=ct();Gt(a,t,1,n)}}),bd(t,1)}};qc=function(t){if(t.tag===13){var s=fs(t,134217728);if(s!==null){var r=ct();Gt(s,t,134217728,r)}bd(t,134217728)}};jh=function(t){if(t.tag===13){var s=Bs(t),r=fs(t,s);if(r!==null){var a=ct();Gt(r,t,s,a)}bd(t,s)}};wh=function(){return je};Nh=function(t,s){var r=je;try{return je=t,s()}finally{je=r}};Do=function(t,s,r){switch(s){case"input":if(So(t,r),s=r.name,r.type==="radio"&&s!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<r.length;s++){var a=r[s];if(a!==t&&a.form===t.form){var n=ul(a);if(!n)throw Error(K(90));eh(a),So(a,n)}}}break;case"textarea":sh(t,r);break;case"select":s=r.value,s!=null&&Vr(t,!!r.multiple,s,!1)}};ch=xd;dh=gr;var I0={usingClientEntryPoint:!1,Events:[Cn,Lr,ul,lh,oh,xd]},Pa={findFiberByHostInstance:ir,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},L0={bundleType:Pa.bundleType,version:Pa.version,rendererPackageName:Pa.rendererPackageName,rendererConfig:Pa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=hh(t),t===null?null:t.stateNode},findFiberByHostInstance:Pa.findFiberByHostInstance||D0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Qn=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Qn.isDisabled&&Qn.supportsFiber)try{ll=Qn.inject(L0),rs=Qn}catch{}}St.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I0;St.createPortal=function(t,s){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jd(s))throw Error(K(200));return A0(t,s,null,r)};St.createRoot=function(t,s){if(!jd(t))throw Error(K(299));var r=!1,a="",n=Wx;return s!=null&&(s.unstable_strictMode===!0&&(r=!0),s.identifierPrefix!==void 0&&(a=s.identifierPrefix),s.onRecoverableError!==void 0&&(n=s.onRecoverableError)),s=yd(t,1,!1,null,null,r,!1,a,n),t[gs]=s.current,an(t.nodeType===8?t.parentNode:t),new vd(s)};St.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(K(188)):(t=Object.keys(t).join(","),Error(K(268,t)));return t=hh(s),t=t===null?null:t.stateNode,t};St.flushSync=function(t){return gr(t)};St.hydrate=function(t,s,r){if(!vl(s))throw Error(K(200));return jl(null,t,s,!0,r)};St.hydrateRoot=function(t,s,r){if(!jd(t))throw Error(K(405));var a=r!=null&&r.hydratedSources||null,n=!1,i="",l=Wx;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(l=r.onRecoverableError)),s=Vx(s,null,t,1,r??null,n,!1,i,l),t[gs]=s.current,an(t),a)for(t=0;t<a.length;t++)r=a[t],n=r._getVersion,n=n(r._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[r,n]:s.mutableSourceEagerHydrationData.push(r,n);return new bl(s)};St.render=function(t,s,r){if(!vl(s))throw Error(K(200));return jl(null,t,s,!1,r)};St.unmountComponentAtNode=function(t){if(!vl(t))throw Error(K(40));return t._reactRootContainer?(gr(function(){jl(null,null,t,!1,function(){t._reactRootContainer=null,t[gs]=null})}),!0):!1};St.unstable_batchedUpdates=xd;St.unstable_renderSubtreeIntoContainer=function(t,s,r,a){if(!vl(r))throw Error(K(200));if(t==null||t._reactInternals===void 0)throw Error(K(38));return jl(t,s,r,!1,a)};St.version="18.3.1-next-f1338f8080-20240426";function Hx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Hx)}catch(t){console.error(t)}}Hx(),Hm.exports=St;var M0=Hm.exports,Gx,rm=M0;Gx=rm.createRoot,rm.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xn(){return xn=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},xn.apply(this,arguments)}var Is;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Is||(Is={}));const am="popstate";function O0(t){t===void 0&&(t={});function s(a,n){let{pathname:i,search:l,hash:o}=a.location;return Gi("",{pathname:i,search:l,hash:o},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function r(a,n){return typeof n=="string"?n:gn(n)}return Kx(s,r,null,t)}function F0(t){t===void 0&&(t={});function s(n,i){let{pathname:l="/",search:o="",hash:c=""}=yr(n.location.hash.substr(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),Gi("",{pathname:l,search:o,hash:c},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function r(n,i){let l=n.document.querySelector("base"),o="";if(l&&l.getAttribute("href")){let c=n.location.href,d=c.indexOf("#");o=d===-1?c:c.slice(0,d)}return o+"#"+(typeof i=="string"?i:gn(i))}function a(n,i){wd(n.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(i)+")")}return Kx(s,r,a,t)}function Ae(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function wd(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function U0(){return Math.random().toString(36).substr(2,8)}function nm(t,s){return{usr:t.state,key:t.key,idx:s}}function Gi(t,s,r,a){return r===void 0&&(r=null),xn({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof s=="string"?yr(s):s,{state:r,key:s&&s.key||a||U0()})}function gn(t){let{pathname:s="/",search:r="",hash:a=""}=t;return r&&r!=="?"&&(s+=r.charAt(0)==="?"?r:"?"+r),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function yr(t){let s={};if(t){let r=t.indexOf("#");r>=0&&(s.hash=t.substr(r),t=t.substr(0,r));let a=t.indexOf("?");a>=0&&(s.search=t.substr(a),t=t.substr(0,a)),t&&(s.pathname=t)}return s}function Kx(t,s,r,a){a===void 0&&(a={});let{window:n=document.defaultView,v5Compat:i=!1}=a,l=n.history,o=Is.Pop,c=null,d=m();d==null&&(d=0,l.replaceState(xn({},l.state,{idx:d}),""));function m(){return(l.state||{idx:null}).idx}function u(){o=Is.Pop;let w=m(),v=w==null?null:w-d;d=w,c&&c({action:o,location:j.location,delta:v})}function h(w,v){o=Is.Push;let p=Gi(j.location,w,v);r&&r(p,w),d=m()+1;let y=nm(p,d),b=j.createHref(p);try{l.pushState(y,"",b)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;n.location.assign(b)}i&&c&&c({action:o,location:j.location,delta:1})}function f(w,v){o=Is.Replace;let p=Gi(j.location,w,v);r&&r(p,w),d=m();let y=nm(p,d),b=j.createHref(p);l.replaceState(y,"",b),i&&c&&c({action:o,location:j.location,delta:0})}function g(w){let v=n.location.origin!=="null"?n.location.origin:n.location.href,p=typeof w=="string"?w:gn(w);return p=p.replace(/ $/,"%20"),Ae(v,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,v)}let j={get action(){return o},get location(){return t(n,l)},listen(w){if(c)throw new Error("A history only accepts one active listener");return n.addEventListener(am,u),c=w,()=>{n.removeEventListener(am,u),c=null}},createHref(w){return s(n,w)},createURL:g,encodeLocation(w){let v=g(w);return{pathname:v.pathname,search:v.search,hash:v.hash}},push:h,replace:f,go(w){return l.go(w)}};return j}var im;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(im||(im={}));function q0(t,s,r){return r===void 0&&(r="/"),B0(t,s,r,!1)}function B0(t,s,r,a){let n=typeof s=="string"?yr(s):s,i=ra(n.pathname||"/",r);if(i==null)return null;let l=Yx(t);z0(l);let o=null;for(let c=0;o==null&&c<l.length;++c){let d=ey(i);o=X0(l[c],d,a)}return o}function Yx(t,s,r,a){s===void 0&&(s=[]),r===void 0&&(r=[]),a===void 0&&(a="");let n=(i,l,o)=>{let c={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};c.relativePath.startsWith("/")&&(Ae(c.relativePath.startsWith(a),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(a.length));let d=Vs([a,c.relativePath]),m=r.concat(c);i.children&&i.children.length>0&&(Ae(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),Yx(i.children,s,m,d)),!(i.path==null&&!i.index)&&s.push({path:d,score:J0(d,i.index),routesMeta:m})};return t.forEach((i,l)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))n(i,l);else for(let c of Jx(i.path))n(i,l,c)}),s}function Jx(t){let s=t.split("/");if(s.length===0)return[];let[r,...a]=s,n=r.endsWith("?"),i=r.replace(/\?$/,"");if(a.length===0)return n?[i,""]:[i];let l=Jx(a.join("/")),o=[];return o.push(...l.map(c=>c===""?i:[i,c].join("/"))),n&&o.push(...l),o.map(c=>t.startsWith("/")&&c===""?"/":c)}function z0(t){t.sort((s,r)=>s.score!==r.score?r.score-s.score:Q0(s.routesMeta.map(a=>a.childrenIndex),r.routesMeta.map(a=>a.childrenIndex)))}const V0=/^:[\w-]+$/,W0=3,H0=2,G0=1,K0=10,Y0=-2,lm=t=>t==="*";function J0(t,s){let r=t.split("/"),a=r.length;return r.some(lm)&&(a+=Y0),s&&(a+=H0),r.filter(n=>!lm(n)).reduce((n,i)=>n+(V0.test(i)?W0:i===""?G0:K0),a)}function Q0(t,s){return t.length===s.length&&t.slice(0,-1).every((a,n)=>a===s[n])?t[t.length-1]-s[s.length-1]:0}function X0(t,s,r){let{routesMeta:a}=t,n={},i="/",l=[];for(let o=0;o<a.length;++o){let c=a[o],d=o===a.length-1,m=i==="/"?s:s.slice(i.length)||"/",u=Ki({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},m),h=c.route;if(!u&&d&&r&&!a[a.length-1].route.index&&(u=Ki({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},m)),!u)return null;Object.assign(n,u.params),l.push({params:n,pathname:Vs([i,u.pathname]),pathnameBase:ay(Vs([i,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(i=Vs([i,u.pathnameBase]))}return l}function Ki(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,a]=Z0(t.path,t.caseSensitive,t.end),n=s.match(r);if(!n)return null;let i=n[0],l=i.replace(/(.)\/+$/,"$1"),o=n.slice(1);return{params:a.reduce((d,m,u)=>{let{paramName:h,isOptional:f}=m;if(h==="*"){let j=o[u]||"";l=i.slice(0,i.length-j.length).replace(/(.)\/+$/,"$1")}const g=o[u];return f&&!g?d[h]=void 0:d[h]=(g||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:l,pattern:t}}function Z0(t,s,r){s===void 0&&(s=!1),r===void 0&&(r=!0),wd(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],n="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,c)=>(a.push({paramName:o,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),n+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?n+="\\/*$":t!==""&&t!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,s?void 0:"i"),a]}function ey(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return wd(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),t}}function ra(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let r=s.endsWith("/")?s.length-1:s.length,a=t.charAt(r);return a&&a!=="/"?null:t.slice(r)||"/"}function ty(t,s){s===void 0&&(s="/");let{pathname:r,search:a="",hash:n=""}=typeof t=="string"?yr(t):t;return{pathname:r?r.startsWith("/")?r:sy(r,s):s,search:ny(a),hash:iy(n)}}function sy(t,s){let r=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(n=>{n===".."?r.length>1&&r.pop():n!=="."&&r.push(n)}),r.length>1?r.join("/"):"/"}function no(t,s,r,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ry(t){return t.filter((s,r)=>r===0||s.route.path&&s.route.path.length>0)}function Nd(t,s){let r=ry(t);return s?r.map((a,n)=>n===r.length-1?a.pathname:a.pathnameBase):r.map(a=>a.pathnameBase)}function _d(t,s,r,a){a===void 0&&(a=!1);let n;typeof t=="string"?n=yr(t):(n=xn({},t),Ae(!n.pathname||!n.pathname.includes("?"),no("?","pathname","search",n)),Ae(!n.pathname||!n.pathname.includes("#"),no("#","pathname","hash",n)),Ae(!n.search||!n.search.includes("#"),no("#","search","hash",n)));let i=t===""||n.pathname==="",l=i?"/":n.pathname,o;if(l==null)o=r;else{let u=s.length-1;if(!a&&l.startsWith("..")){let h=l.split("/");for(;h[0]==="..";)h.shift(),u-=1;n.pathname=h.join("/")}o=u>=0?s[u]:"/"}let c=ty(n,o),d=l&&l!=="/"&&l.endsWith("/"),m=(i||l===".")&&r.endsWith("/");return!c.pathname.endsWith("/")&&(d||m)&&(c.pathname+="/"),c}const Vs=t=>t.join("/").replace(/\/\/+/g,"/"),ay=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),ny=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,iy=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function ly(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Qx=["post","put","patch","delete"];new Set(Qx);const oy=["get",...Qx];new Set(oy);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function fn(){return fn=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},fn.apply(this,arguments)}const wl=x.createContext(null),Xx=x.createContext(null),js=x.createContext(null),Nl=x.createContext(null),ws=x.createContext({outlet:null,matches:[],isDataRoute:!1}),Zx=x.createContext(null);function cy(t,s){let{relative:r}=s===void 0?{}:s;fa()||Ae(!1);let{basename:a,navigator:n}=x.useContext(js),{hash:i,pathname:l,search:o}=kl(t,{relative:r}),c=l;return a!=="/"&&(c=l==="/"?a:Vs([a,l])),n.createHref({pathname:c,search:o,hash:i})}function fa(){return x.useContext(Nl)!=null}function Xs(){return fa()||Ae(!1),x.useContext(Nl).location}function eg(t){x.useContext(js).static||x.useLayoutEffect(t)}function ie(){let{isDataRoute:t}=x.useContext(ws);return t?wy():dy()}function dy(){fa()||Ae(!1);let t=x.useContext(wl),{basename:s,future:r,navigator:a}=x.useContext(js),{matches:n}=x.useContext(ws),{pathname:i}=Xs(),l=JSON.stringify(Nd(n,r.v7_relativeSplatPath)),o=x.useRef(!1);return eg(()=>{o.current=!0}),x.useCallback(function(d,m){if(m===void 0&&(m={}),!o.current)return;if(typeof d=="number"){a.go(d);return}let u=_d(d,JSON.parse(l),i,m.relative==="path");t==null&&s!=="/"&&(u.pathname=u.pathname==="/"?s:Vs([s,u.pathname])),(m.replace?a.replace:a.push)(u,m.state,m)},[s,a,l,i,t])}function _l(){let{matches:t}=x.useContext(ws),s=t[t.length-1];return s?s.params:{}}function kl(t,s){let{relative:r}=s===void 0?{}:s,{future:a}=x.useContext(js),{matches:n}=x.useContext(ws),{pathname:i}=Xs(),l=JSON.stringify(Nd(n,a.v7_relativeSplatPath));return x.useMemo(()=>_d(t,JSON.parse(l),i,r==="path"),[t,l,i,r])}function uy(t,s){return my(t,s)}function my(t,s,r,a){fa()||Ae(!1);let{navigator:n}=x.useContext(js),{matches:i}=x.useContext(ws),l=i[i.length-1],o=l?l.params:{};l&&l.pathname;let c=l?l.pathnameBase:"/";l&&l.route;let d=Xs(),m;if(s){var u;let w=typeof s=="string"?yr(s):s;c==="/"||(u=w.pathname)!=null&&u.startsWith(c)||Ae(!1),m=w}else m=d;let h=m.pathname||"/",f=h;if(c!=="/"){let w=c.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(w.length).join("/")}let g=q0(t,{pathname:f}),j=py(g&&g.map(w=>Object.assign({},w,{params:Object.assign({},o,w.params),pathname:Vs([c,n.encodeLocation?n.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?c:Vs([c,n.encodeLocation?n.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),i,r,a);return s&&j?x.createElement(Nl.Provider,{value:{location:fn({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:Is.Pop}},j):j}function hy(){let t=jy(),s=ly(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},s),r?x.createElement("pre",{style:n},r):null,null)}const xy=x.createElement(hy,null);class gy extends x.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,r){return r.location!==s.location||r.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:r.error,location:r.location,revalidation:s.revalidation||r.revalidation}}componentDidCatch(s,r){console.error("React Router caught the following error during render",s,r)}render(){return this.state.error!==void 0?x.createElement(ws.Provider,{value:this.props.routeContext},x.createElement(Zx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function fy(t){let{routeContext:s,match:r,children:a}=t,n=x.useContext(wl);return n&&n.static&&n.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=r.route.id),x.createElement(ws.Provider,{value:s},a)}function py(t,s,r,a){var n;if(s===void 0&&(s=[]),r===void 0&&(r=null),a===void 0&&(a=null),t==null){var i;if(!r)return null;if(r.errors)t=r.matches;else if((i=a)!=null&&i.v7_partialHydration&&s.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let l=t,o=(n=r)==null?void 0:n.errors;if(o!=null){let m=l.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id])!==void 0);m>=0||Ae(!1),l=l.slice(0,Math.min(l.length,m+1))}let c=!1,d=-1;if(r&&a&&a.v7_partialHydration)for(let m=0;m<l.length;m++){let u=l[m];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(d=m),u.route.id){let{loaderData:h,errors:f}=r,g=u.route.loader&&h[u.route.id]===void 0&&(!f||f[u.route.id]===void 0);if(u.route.lazy||g){c=!0,d>=0?l=l.slice(0,d+1):l=[l[0]];break}}}return l.reduceRight((m,u,h)=>{let f,g=!1,j=null,w=null;r&&(f=o&&u.route.id?o[u.route.id]:void 0,j=u.route.errorElement||xy,c&&(d<0&&h===0?(g=!0,w=null):d===h&&(g=!0,w=u.route.hydrateFallbackElement||null)));let v=s.concat(l.slice(0,h+1)),p=()=>{let y;return f?y=j:g?y=w:u.route.Component?y=x.createElement(u.route.Component,null):u.route.element?y=u.route.element:y=m,x.createElement(fy,{match:u,routeContext:{outlet:m,matches:v,isDataRoute:r!=null},children:y})};return r&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?x.createElement(gy,{location:r.location,revalidation:r.revalidation,component:j,error:f,children:p(),routeContext:{outlet:null,matches:v,isDataRoute:!0}}):p()},null)}var tg=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(tg||{}),Yi=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Yi||{});function yy(t){let s=x.useContext(wl);return s||Ae(!1),s}function by(t){let s=x.useContext(Xx);return s||Ae(!1),s}function vy(t){let s=x.useContext(ws);return s||Ae(!1),s}function sg(t){let s=vy(),r=s.matches[s.matches.length-1];return r.route.id||Ae(!1),r.route.id}function jy(){var t;let s=x.useContext(Zx),r=by(Yi.UseRouteError),a=sg(Yi.UseRouteError);return s!==void 0?s:(t=r.errors)==null?void 0:t[a]}function wy(){let{router:t}=yy(tg.UseNavigateStable),s=sg(Yi.UseNavigateStable),r=x.useRef(!1);return eg(()=>{r.current=!0}),x.useCallback(function(n,i){i===void 0&&(i={}),r.current&&(typeof n=="number"?t.navigate(n):t.navigate(n,fn({fromRouteId:s},i)))},[t,s])}function rg(t,s){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function kd(t){let{to:s,replace:r,state:a,relative:n}=t;fa()||Ae(!1);let{future:i,static:l}=x.useContext(js),{matches:o}=x.useContext(ws),{pathname:c}=Xs(),d=ie(),m=_d(s,Nd(o,i.v7_relativeSplatPath),c,n==="path"),u=JSON.stringify(m);return x.useEffect(()=>d(JSON.parse(u),{replace:r,state:a,relative:n}),[d,u,n,r,a]),null}function oe(t){Ae(!1)}function ag(t){let{basename:s="/",children:r=null,location:a,navigationType:n=Is.Pop,navigator:i,static:l=!1,future:o}=t;fa()&&Ae(!1);let c=s.replace(/^\/*/,"/"),d=x.useMemo(()=>({basename:c,navigator:i,static:l,future:fn({v7_relativeSplatPath:!1},o)}),[c,o,i,l]);typeof a=="string"&&(a=yr(a));let{pathname:m="/",search:u="",hash:h="",state:f=null,key:g="default"}=a,j=x.useMemo(()=>{let w=ra(m,c);return w==null?null:{location:{pathname:w,search:u,hash:h,state:f,key:g},navigationType:n}},[c,m,u,h,f,g,n]);return j==null?null:x.createElement(js.Provider,{value:d},x.createElement(Nl.Provider,{children:r,value:j}))}function Ny(t){let{children:s,location:r}=t;return uy(mc(s),r)}new Promise(()=>{});function mc(t,s){s===void 0&&(s=[]);let r=[];return x.Children.forEach(t,(a,n)=>{if(!x.isValidElement(a))return;let i=[...s,n];if(a.type===x.Fragment){r.push.apply(r,mc(a.props.children,i));return}a.type!==oe&&Ae(!1),!a.props.index||!a.props.children||Ae(!1);let l={id:a.props.id||i.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(l.children=mc(a.props.children,i)),r.push(l)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ji(){return Ji=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Ji.apply(this,arguments)}function ng(t,s){if(t==null)return{};var r={},a=Object.keys(t),n,i;for(i=0;i<a.length;i++)n=a[i],!(s.indexOf(n)>=0)&&(r[n]=t[n]);return r}function _y(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function ky(t,s){return t.button===0&&(!s||s==="_self")&&!_y(t)}const Sy=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],Cy=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],Ey="6";try{window.__reactRouterVersion=Ey}catch{}const Ry=x.createContext({isTransitioning:!1}),Py="startTransition",Qi=Sf[Py];function Ty(t){let{basename:s,children:r,future:a,window:n}=t,i=x.useRef();i.current==null&&(i.current=O0({window:n,v5Compat:!0}));let l=i.current,[o,c]=x.useState({action:l.action,location:l.location}),{v7_startTransition:d}=a||{},m=x.useCallback(u=>{d&&Qi?Qi(()=>c(u)):c(u)},[c,d]);return x.useLayoutEffect(()=>l.listen(m),[l,m]),x.useEffect(()=>rg(a),[a]),x.createElement(ag,{basename:s,children:r,location:o.location,navigationType:o.action,navigator:l,future:a})}function Ay(t){let{basename:s,children:r,future:a,window:n}=t,i=x.useRef();i.current==null&&(i.current=F0({window:n,v5Compat:!0}));let l=i.current,[o,c]=x.useState({action:l.action,location:l.location}),{v7_startTransition:d}=a||{},m=x.useCallback(u=>{d&&Qi?Qi(()=>c(u)):c(u)},[c,d]);return x.useLayoutEffect(()=>l.listen(m),[l,m]),x.useEffect(()=>rg(a),[a]),x.createElement(ag,{basename:s,children:r,location:o.location,navigationType:o.action,navigator:l,future:a})}const Dy=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",$y=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ie=x.forwardRef(function(s,r){let{onClick:a,relative:n,reloadDocument:i,replace:l,state:o,target:c,to:d,preventScrollReset:m,viewTransition:u}=s,h=ng(s,Sy),{basename:f}=x.useContext(js),g,j=!1;if(typeof d=="string"&&$y.test(d)&&(g=d,Dy))try{let y=new URL(window.location.href),b=d.startsWith("//")?new URL(y.protocol+d):new URL(d),N=ra(b.pathname,f);b.origin===y.origin&&N!=null?d=N+b.search+b.hash:j=!0}catch{}let w=cy(d,{relative:n}),v=Ly(d,{replace:l,state:o,target:c,preventScrollReset:m,relative:n,viewTransition:u});function p(y){a&&a(y),y.defaultPrevented||v(y)}return x.createElement("a",Ji({},h,{href:g||w,onClick:j||i?a:p,ref:r,target:c}))}),io=x.forwardRef(function(s,r){let{"aria-current":a="page",caseSensitive:n=!1,className:i="",end:l=!1,style:o,to:c,viewTransition:d,children:m}=s,u=ng(s,Cy),h=kl(c,{relative:u.relative}),f=Xs(),g=x.useContext(Xx),{navigator:j,basename:w}=x.useContext(js),v=g!=null&&My(h)&&d===!0,p=j.encodeLocation?j.encodeLocation(h).pathname:h.pathname,y=f.pathname,b=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(y=y.toLowerCase(),b=b?b.toLowerCase():null,p=p.toLowerCase()),b&&w&&(b=ra(b,w)||b);const N=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let k=y===p||!l&&y.startsWith(p)&&y.charAt(N)==="/",E=b!=null&&(b===p||!l&&b.startsWith(p)&&b.charAt(p.length)==="/"),C={isActive:k,isPending:E,isTransitioning:v},R=k?a:void 0,T;typeof i=="function"?T=i(C):T=[i,k?"active":null,E?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let M=typeof o=="function"?o(C):o;return x.createElement(Ie,Ji({},u,{"aria-current":R,className:T,ref:r,style:M,to:c,viewTransition:d}),typeof m=="function"?m(C):m)});var hc;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(hc||(hc={}));var om;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(om||(om={}));function Iy(t){let s=x.useContext(wl);return s||Ae(!1),s}function Ly(t,s){let{target:r,replace:a,state:n,preventScrollReset:i,relative:l,viewTransition:o}=s===void 0?{}:s,c=ie(),d=Xs(),m=kl(t,{relative:l});return x.useCallback(u=>{if(ky(u,r)){u.preventDefault();let h=a!==void 0?a:gn(d)===gn(m);c(t,{replace:h,state:n,preventScrollReset:i,relative:l,viewTransition:o})}},[d,c,m,a,n,r,t,i,l,o])}function My(t,s){s===void 0&&(s={});let r=x.useContext(Ry);r==null&&Ae(!1);let{basename:a}=Iy(hc.useViewTransitionState),n=kl(t,{relative:s.relative});if(!r.isTransitioning)return!1;let i=ra(r.currentLocation.pathname,a)||r.currentLocation.pathname,l=ra(r.nextLocation.pathname,a)||r.nextLocation.pathname;return Ki(n.pathname,l)!=null||Ki(n.pathname,i)!=null}/*! Capacitor: https://capacitorjs.com/ - MIT License */var aa;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(aa||(aa={}));class lo extends Error{constructor(s,r,a){super(s),this.message=s,this.code=r,this.data=a}}const Oy=t=>{var s,r;return t!=null&&t.androidBridge?"android":!((r=(s=t==null?void 0:t.webkit)===null||s===void 0?void 0:s.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},Fy=t=>{const s=t.CapacitorCustomPlatform||null,r=t.Capacitor||{},a=r.Plugins=r.Plugins||{},n=()=>s!==null?s.name:Oy(t),i=()=>n()!=="web",l=u=>{const h=d.get(u);return!!(h!=null&&h.platforms.has(n())||o(u))},o=u=>{var h;return(h=r.PluginHeaders)===null||h===void 0?void 0:h.find(f=>f.name===u)},c=u=>t.console.error(u),d=new Map,m=(u,h={})=>{const f=d.get(u);if(f)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),f.proxy;const g=n(),j=o(u);let w;const v=async()=>(!w&&g in h?w=typeof h[g]=="function"?w=await h[g]():w=h[g]:s!==null&&!w&&"web"in h&&(w=typeof h.web=="function"?w=await h.web():w=h.web),w),p=(C,R)=>{var T,M;if(j){const I=j==null?void 0:j.methods.find(D=>R===D.name);if(I)return I.rtype==="promise"?D=>r.nativePromise(u,R.toString(),D):(D,F)=>r.nativeCallback(u,R.toString(),D,F);if(C)return(T=C[R])===null||T===void 0?void 0:T.bind(C)}else{if(C)return(M=C[R])===null||M===void 0?void 0:M.bind(C);throw new lo(`"${u}" plugin is not implemented on ${g}`,aa.Unimplemented)}},y=C=>{let R;const T=(...M)=>{const I=v().then(D=>{const F=p(D,C);if(F){const B=F(...M);return R=B==null?void 0:B.remove,B}else throw new lo(`"${u}.${C}()" is not implemented on ${g}`,aa.Unimplemented)});return C==="addListener"&&(I.remove=async()=>R()),I};return T.toString=()=>`${C.toString()}() { [capacitor code] }`,Object.defineProperty(T,"name",{value:C,writable:!1,configurable:!1}),T},b=y("addListener"),N=y("removeListener"),k=(C,R)=>{const T=b({eventName:C},R),M=async()=>{const D=await T;N({eventName:C,callbackId:D},R)},I=new Promise(D=>T.then(()=>D({remove:M})));return I.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await M()},I},E=new Proxy({},{get(C,R){switch(R){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return j?k:b;case"removeListener":return N;default:return y(R)}}});return a[u]=E,d.set(u,{name:u,proxy:E,platforms:new Set([...Object.keys(h),...j?[g]:[]])}),E};return r.convertFileSrc||(r.convertFileSrc=u=>u),r.getPlatform=n,r.handleError=c,r.isNativePlatform=i,r.isPluginAvailable=l,r.registerPlugin=m,r.Exception=lo,r.DEBUG=!!r.DEBUG,r.isLoggingEnabled=!!r.isLoggingEnabled,r},Uy=t=>t.Capacitor=Fy(t),Xi=Uy(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Sd=Xi.registerPlugin;class Cd{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(s,r){let a=!1;this.listeners[s]||(this.listeners[s]=[],a=!0),this.listeners[s].push(r);const i=this.windowListeners[s];i&&!i.registered&&this.addWindowListener(i),a&&this.sendRetainedArgumentsForEvent(s);const l=async()=>this.removeListener(s,r);return Promise.resolve({remove:l})}async removeAllListeners(){this.listeners={};for(const s in this.windowListeners)this.removeWindowListener(this.windowListeners[s]);this.windowListeners={}}notifyListeners(s,r,a){const n=this.listeners[s];if(!n){if(a){let i=this.retainedEventArguments[s];i||(i=[]),i.push(r),this.retainedEventArguments[s]=i}return}n.forEach(i=>i(r))}hasListeners(s){var r;return!!(!((r=this.listeners[s])===null||r===void 0)&&r.length)}registerWindowListener(s,r){this.windowListeners[r]={registered:!1,windowEventName:s,pluginEventName:r,handler:a=>{this.notifyListeners(r,a)}}}unimplemented(s="not implemented"){return new Xi.Exception(s,aa.Unimplemented)}unavailable(s="not available"){return new Xi.Exception(s,aa.Unavailable)}async removeListener(s,r){const a=this.listeners[s];if(!a)return;const n=a.indexOf(r);this.listeners[s].splice(n,1),this.listeners[s].length||this.removeWindowListener(this.windowListeners[s])}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}sendRetainedArgumentsForEvent(s){const r=this.retainedEventArguments[s];r&&(delete this.retainedEventArguments[s],r.forEach(a=>{this.notifyListeners(s,a)}))}}const cm=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),dm=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class qy extends Cd{async getCookies(){const s=document.cookie,r={};return s.split(";").forEach(a=>{if(a.length<=0)return;let[n,i]=a.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");n=dm(n).trim(),i=dm(i).trim(),r[n]=i}),r}async setCookie(s){try{const r=cm(s.key),a=cm(s.value),n=`; expires=${(s.expires||"").replace("expires=","")}`,i=(s.path||"/").replace("path=",""),l=s.url!=null&&s.url.length>0?`domain=${s.url}`:"";document.cookie=`${r}=${a||""}${n}; path=${i}; ${l};`}catch(r){return Promise.reject(r)}}async deleteCookie(s){try{document.cookie=`${s.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}}async clearCookies(){try{const s=document.cookie.split(";")||[];for(const r of s)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(s){return Promise.reject(s)}}async clearAllCookies(){try{await this.clearCookies()}catch(s){return Promise.reject(s)}}}Sd("CapacitorCookies",{web:()=>new qy});const By=async t=>new Promise((s,r)=>{const a=new FileReader;a.onload=()=>{const n=a.result;s(n.indexOf(",")>=0?n.split(",")[1]:n)},a.onerror=n=>r(n),a.readAsDataURL(t)}),zy=(t={})=>{const s=Object.keys(t);return Object.keys(t).map(n=>n.toLocaleLowerCase()).reduce((n,i,l)=>(n[i]=t[s[l]],n),{})},Vy=(t,s=!0)=>t?Object.entries(t).reduce((a,n)=>{const[i,l]=n;let o,c;return Array.isArray(l)?(c="",l.forEach(d=>{o=s?encodeURIComponent(d):d,c+=`${i}=${o}&`}),c.slice(0,-1)):(o=s?encodeURIComponent(l):l,c=`${i}=${o}`),`${a}&${c}`},"").substr(1):null,Wy=(t,s={})=>{const r=Object.assign({method:t.method||"GET",headers:t.headers},s),n=zy(t.headers)["content-type"]||"";if(typeof t.data=="string")r.body=t.data;else if(n.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[l,o]of Object.entries(t.data||{}))i.set(l,o);r.body=i.toString()}else if(n.includes("multipart/form-data")||t.data instanceof FormData){const i=new FormData;if(t.data instanceof FormData)t.data.forEach((o,c)=>{i.append(c,o)});else for(const o of Object.keys(t.data))i.append(o,t.data[o]);r.body=i;const l=new Headers(r.headers);l.delete("content-type"),r.headers=l}else(n.includes("application/json")||typeof t.data=="object")&&(r.body=JSON.stringify(t.data));return r};class Hy extends Cd{async request(s){const r=Wy(s,s.webFetchExtra),a=Vy(s.params,s.shouldEncodeUrlParams),n=a?`${s.url}?${a}`:s.url,i=await fetch(n,r),l=i.headers.get("content-type")||"";let{responseType:o="text"}=i.ok?s:{};l.includes("application/json")&&(o="json");let c,d;switch(o){case"arraybuffer":case"blob":d=await i.blob(),c=await By(d);break;case"json":c=await i.json();break;case"document":case"text":default:c=await i.text()}const m={};return i.headers.forEach((u,h)=>{m[h]=u}),{data:c,headers:m,status:i.status,url:i.url}}async get(s){return this.request(Object.assign(Object.assign({},s),{method:"GET"}))}async post(s){return this.request(Object.assign(Object.assign({},s),{method:"POST"}))}async put(s){return this.request(Object.assign(Object.assign({},s),{method:"PUT"}))}async patch(s){return this.request(Object.assign(Object.assign({},s),{method:"PATCH"}))}async delete(s){return this.request(Object.assign(Object.assign({},s),{method:"DELETE"}))}}Sd("CapacitorHttp",{web:()=>new Hy});var um;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(um||(um={}));var mm;(function(t){t.StatusBar="StatusBar",t.NavigationBar="NavigationBar"})(mm||(mm={}));class Gy extends Cd{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}Sd("SystemBars",{web:()=>new Gy});const Ky="modulepreload",Yy=function(t){return"/"+t},hm={},pa=function(s,r,a){let n=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),o=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(r.map(c=>{if(c=Yy(c),c in hm)return;hm[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":Ky,d||(u.as="script"),u.crossOrigin="",u.href=c,o&&u.setAttribute("nonce",o),document.head.appendChild(u),d)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(l){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=l,window.dispatchEvent(o),!o.defaultPrevented)throw l}return n.then(l=>{for(const o of l||[])o.status==="rejected"&&i(o.reason);return s().catch(i)})},Jy=t=>{let s;return t?s=t:typeof fetch>"u"?s=(...r)=>pa(async()=>{const{default:a}=await Promise.resolve().then(()=>ya);return{default:a}},void 0).then(({default:a})=>a(...r)):s=fetch,(...r)=>s(...r)};class Ed extends Error{constructor(s,r="FunctionsError",a){super(s),this.name=r,this.context=a}}class Qy extends Ed{constructor(s){super("Failed to send a request to the Edge Function","FunctionsFetchError",s)}}class xm extends Ed{constructor(s){super("Relay Error invoking the Edge Function","FunctionsRelayError",s)}}class gm extends Ed{constructor(s){super("Edge Function returned a non-2xx status code","FunctionsHttpError",s)}}var xc;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(xc||(xc={}));var Xy=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};class Zy{constructor(s,{headers:r={},customFetch:a,region:n=xc.Any}={}){this.url=s,this.headers=r,this.region=n,this.fetch=Jy(a)}setAuth(s){this.headers.Authorization=`Bearer ${s}`}invoke(s,r={}){var a;return Xy(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:l}=r;let o={},{region:c}=r;c||(c=this.region);const d=new URL(`${this.url}/${s}`);c&&c!=="any"&&(o["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let m;l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",m=l):typeof l=="string"?(o["Content-Type"]="text/plain",m=l):typeof FormData<"u"&&l instanceof FormData?m=l:(o["Content-Type"]="application/json",m=JSON.stringify(l)));const u=yield this.fetch(d.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:m}).catch(j=>{throw new Qy(j)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new xm(u);if(!u.ok)throw new gm(u);let f=((a=u.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield u.json():f==="application/octet-stream"?g=yield u.blob():f==="text/event-stream"?g=u:f==="multipart/form-data"?g=yield u.formData():g=yield u.text(),{data:g,error:null,response:u}}catch(n){return{data:null,error:n,response:n instanceof gm||n instanceof xm?n.context:void 0}}})}}var xt={},Rd={},Sl={},Rn={},Cl={},El={},eb=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},na=eb();const tb=na.fetch,ig=na.fetch.bind(na),lg=na.Headers,sb=na.Request,rb=na.Response,ya=Object.freeze(Object.defineProperty({__proto__:null,Headers:lg,Request:sb,Response:rb,default:ig,fetch:tb},Symbol.toStringTag,{value:"Module"})),ab=cf(ya);var Rl={};Object.defineProperty(Rl,"__esModule",{value:!0});let nb=class extends Error{constructor(s){super(s.message),this.name="PostgrestError",this.details=s.details,this.hint=s.hint,this.code=s.code}};Rl.default=nb;var og=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(El,"__esModule",{value:!0});const ib=og(ab),lb=og(Rl);let ob=class{constructor(s){var r,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(r=s.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=s.signal,this.isMaybeSingle=(a=s.isMaybeSingle)!==null&&a!==void 0?a:!1,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=ib.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,r){return this.headers=new Headers(this.headers),this.headers.set(s,r),this}then(s,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let n=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var l,o,c,d;let m=null,u=null,h=null,f=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const p=await i.text();p===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((l=this.headers.get("Accept"))===null||l===void 0)&&l.includes("application/vnd.pgrst.plan+text"))?u=p:u=JSON.parse(p))}const w=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),v=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");w&&v&&v.length>1&&(h=parseInt(v[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(m={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,g="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const w=await i.text();try{m=JSON.parse(w),Array.isArray(m)&&i.status===404&&(u=[],m=null,f=200,g="OK")}catch{i.status===404&&w===""?(f=204,g="No Content"):m={message:w}}if(m&&this.isMaybeSingle&&(!((d=m==null?void 0:m.details)===null||d===void 0)&&d.includes("0 rows"))&&(m=null,f=200,g="OK"),m&&this.shouldThrowOnError)throw new lb.default(m)}return{error:m,data:u,count:h,status:f,statusText:g}});return this.shouldThrowOnError||(n=n.catch(i=>{var l,o,c;return{error:{message:`${(l=i==null?void 0:i.name)!==null&&l!==void 0?l:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(s,r)}returns(){return this}overrideTypes(){return this}};El.default=ob;var cb=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Cl,"__esModule",{value:!0});const db=cb(El);let ub=class extends db.default{select(s){let r=!1;const a=(s??"*").split("").map(n=>/\s/.test(n)&&!r?"":(n==='"'&&(r=!r),n)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:r=!0,nullsFirst:a,foreignTable:n,referencedTable:i=n}={}){const l=i?`${i}.order`:"order",o=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${o?`${o},`:""}${s}.${r?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:r,referencedTable:a=r}={}){const n=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(n,`${s}`),this}range(s,r,{foreignTable:a,referencedTable:n=a}={}){const i=typeof n>"u"?"offset":`${n}.offset`,l=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${s}`),this.url.searchParams.set(l,`${r-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:r=!1,settings:a=!1,buffers:n=!1,wal:i=!1,format:l="text"}={}){var o;const c=[s?"analyze":null,r?"verbose":null,a?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${d}"; options=${c};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}};Cl.default=ub;var mb=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Rn,"__esModule",{value:!0});const hb=mb(Cl);let xb=class extends hb.default{eq(s,r){return this.url.searchParams.append(s,`eq.${r}`),this}neq(s,r){return this.url.searchParams.append(s,`neq.${r}`),this}gt(s,r){return this.url.searchParams.append(s,`gt.${r}`),this}gte(s,r){return this.url.searchParams.append(s,`gte.${r}`),this}lt(s,r){return this.url.searchParams.append(s,`lt.${r}`),this}lte(s,r){return this.url.searchParams.append(s,`lte.${r}`),this}like(s,r){return this.url.searchParams.append(s,`like.${r}`),this}likeAllOf(s,r){return this.url.searchParams.append(s,`like(all).{${r.join(",")}}`),this}likeAnyOf(s,r){return this.url.searchParams.append(s,`like(any).{${r.join(",")}}`),this}ilike(s,r){return this.url.searchParams.append(s,`ilike.${r}`),this}ilikeAllOf(s,r){return this.url.searchParams.append(s,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(s,r){return this.url.searchParams.append(s,`ilike(any).{${r.join(",")}}`),this}is(s,r){return this.url.searchParams.append(s,`is.${r}`),this}in(s,r){const a=Array.from(new Set(r)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,r){return typeof r=="string"?this.url.searchParams.append(s,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(s,`cs.{${r.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(r)}`),this}containedBy(s,r){return typeof r=="string"?this.url.searchParams.append(s,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(s,`cd.{${r.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(r)}`),this}rangeGt(s,r){return this.url.searchParams.append(s,`sr.${r}`),this}rangeGte(s,r){return this.url.searchParams.append(s,`nxl.${r}`),this}rangeLt(s,r){return this.url.searchParams.append(s,`sl.${r}`),this}rangeLte(s,r){return this.url.searchParams.append(s,`nxr.${r}`),this}rangeAdjacent(s,r){return this.url.searchParams.append(s,`adj.${r}`),this}overlaps(s,r){return typeof r=="string"?this.url.searchParams.append(s,`ov.${r}`):this.url.searchParams.append(s,`ov.{${r.join(",")}}`),this}textSearch(s,r,{config:a,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${i}fts${l}.${r}`),this}match(s){return Object.entries(s).forEach(([r,a])=>{this.url.searchParams.append(r,`eq.${a}`)}),this}not(s,r,a){return this.url.searchParams.append(s,`not.${r}.${a}`),this}or(s,{foreignTable:r,referencedTable:a=r}={}){const n=a?`${a}.or`:"or";return this.url.searchParams.append(n,`(${s})`),this}filter(s,r,a){return this.url.searchParams.append(s,`${r}.${a}`),this}};Rn.default=xb;var gb=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Sl,"__esModule",{value:!0});const Ta=gb(Rn);let fb=class{constructor(s,{headers:r={},schema:a,fetch:n}){this.url=s,this.headers=new Headers(r),this.schema=a,this.fetch=n}select(s,{head:r=!1,count:a}={}){const n=r?"HEAD":"GET";let i=!1;const l=(s??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",l),a&&this.headers.append("Prefer",`count=${a}`),new Ta.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:r,defaultToNull:a=!0}={}){var n;const i="POST";if(r&&this.headers.append("Prefer",`count=${r}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const l=s.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(l.length>0){const o=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new Ta.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(s,{onConflict:r,ignoreDuplicates:a=!1,count:n,defaultToNull:i=!0}={}){var l;const o="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const c=s.reduce((d,m)=>d.concat(Object.keys(m)),[]);if(c.length>0){const d=[...new Set(c)].map(m=>`"${m}"`);this.url.searchParams.set("columns",d.join(","))}}return new Ta.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(s,{count:r}={}){var a;const n="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new Ta.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var r;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new Ta.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};Sl.default=fb;var cg=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Rd,"__esModule",{value:!0});const pb=cg(Sl),yb=cg(Rn);let bb=class dg{constructor(s,{headers:r={},schema:a,fetch:n}={}){this.url=s,this.headers=new Headers(r),this.schemaName=a,this.fetch=n}from(s){const r=new URL(`${this.url}/${s}`);return new pb.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new dg(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,r={},{head:a=!1,get:n=!1,count:i}={}){var l;let o;const c=new URL(`${this.url}/rpc/${s}`);let d;a||n?(o=a?"HEAD":"GET",Object.entries(r).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{c.searchParams.append(u,h)})):(o="POST",d=r);const m=new Headers(this.headers);return i&&m.set("Prefer",`count=${i}`),new yb.default({method:o,url:c,headers:m,schema:this.schemaName,body:d,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}};Rd.default=bb;var ba=$t&&$t.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(xt,"__esModule",{value:!0});xt.PostgrestError=xt.PostgrestBuilder=xt.PostgrestTransformBuilder=xt.PostgrestFilterBuilder=xt.PostgrestQueryBuilder=xt.PostgrestClient=void 0;const ug=ba(Rd);xt.PostgrestClient=ug.default;const mg=ba(Sl);xt.PostgrestQueryBuilder=mg.default;const hg=ba(Rn);xt.PostgrestFilterBuilder=hg.default;const xg=ba(Cl);xt.PostgrestTransformBuilder=xg.default;const gg=ba(El);xt.PostgrestBuilder=gg.default;const fg=ba(Rl);xt.PostgrestError=fg.default;var vb=xt.default={PostgrestClient:ug.default,PostgrestQueryBuilder:mg.default,PostgrestFilterBuilder:hg.default,PostgrestTransformBuilder:xg.default,PostgrestBuilder:gg.default,PostgrestError:fg.default};const{PostgrestClient:jb,PostgrestQueryBuilder:p1,PostgrestFilterBuilder:y1,PostgrestTransformBuilder:b1,PostgrestBuilder:v1,PostgrestError:j1}=vb;class wb{static detectEnvironment(){var s;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((s=navigator.userAgent)===null||s===void 0)&&s.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const a=r.node,n=parseInt(a.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const s=this.detectEnvironment();if(s.constructor)return s.constructor;let r=s.error||"WebSocket not supported in this environment.";throw s.workaround&&(r+=`

Suggested solution: ${s.workaround}`),new Error(r)}static createWebSocket(s,r){const a=this.getWebSocketConstructor();return new a(s,r)}static isWebSocketSupported(){try{const s=this.detectEnvironment();return s.type==="native"||s.type==="ws"}catch{return!1}}}const Nb="2.15.5",_b=`realtime-js/${Nb}`,kb="1.0.0",gc=1e4,Sb=1e3,Cb=100;var Ha;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Ha||(Ha={}));var Be;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Be||(Be={}));var zt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(zt||(zt={}));var fc;(function(t){t.websocket="websocket"})(fc||(fc={}));var nr;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(nr||(nr={}));class Eb{constructor(){this.HEADER_LENGTH=1}decode(s,r){return s.constructor===ArrayBuffer?r(this._binaryDecode(s)):r(typeof s=="string"?JSON.parse(s):{})}_binaryDecode(s){const r=new DataView(s),a=new TextDecoder;return this._decodeBroadcast(s,r,a)}_decodeBroadcast(s,r,a){const n=r.getUint8(1),i=r.getUint8(2);let l=this.HEADER_LENGTH+2;const o=a.decode(s.slice(l,l+n));l=l+n;const c=a.decode(s.slice(l,l+i));l=l+i;const d=JSON.parse(a.decode(s.slice(l,s.byteLength)));return{ref:null,topic:o,event:c,payload:d}}}class pg{constructor(s,r){this.callback=s,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=s,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ne;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ne||(Ne={}));const fm=(t,s,r={})=>{var a;const n=(a=r.skipTypes)!==null&&a!==void 0?a:[];return Object.keys(s).reduce((i,l)=>(i[l]=Rb(l,t,s,n),i),{})},Rb=(t,s,r,a)=>{const n=s.find(o=>o.name===t),i=n==null?void 0:n.type,l=r[t];return i&&!a.includes(i)?yg(i,l):pc(l)},yg=(t,s)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return Db(s,r)}switch(t){case Ne.bool:return Pb(s);case Ne.float4:case Ne.float8:case Ne.int2:case Ne.int4:case Ne.int8:case Ne.numeric:case Ne.oid:return Tb(s);case Ne.json:case Ne.jsonb:return Ab(s);case Ne.timestamp:return $b(s);case Ne.abstime:case Ne.date:case Ne.daterange:case Ne.int4range:case Ne.int8range:case Ne.money:case Ne.reltime:case Ne.text:case Ne.time:case Ne.timestamptz:case Ne.timetz:case Ne.tsrange:case Ne.tstzrange:return pc(s);default:return pc(s)}},pc=t=>t,Pb=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Tb=t=>{if(typeof t=="string"){const s=parseFloat(t);if(!Number.isNaN(s))return s}return t},Ab=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(s){return console.log(`JSON parse error: ${s}`),t}return t},Db=(t,s)=>{if(typeof t!="string")return t;const r=t.length-1,a=t[r];if(t[0]==="{"&&a==="}"){let i;const l=t.slice(1,r);try{i=JSON.parse("["+l+"]")}catch{i=l?l.split(","):[]}return i.map(o=>yg(s,o))}return t},$b=t=>typeof t=="string"?t.replace(" ","T"):t,bg=t=>{let s=t;return s=s.replace(/^ws/i,"http"),s=s.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),s.replace(/\/+$/,"")+"/api/broadcast"};class oo{constructor(s,r,a={},n=gc){this.channel=s,this.event=r,this.payload=a,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(s){this.timeout=s,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(s){this.payload=Object.assign(Object.assign({},this.payload),s)}receive(s,r){var a;return this._hasReceived(s)&&r((a=this.receivedResp)===null||a===void 0?void 0:a.response),this.recHooks.push({status:s,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const s=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},s),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(s,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:s,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:s,response:r}){this.recHooks.filter(a=>a.status===s).forEach(a=>a.callback(r))}_hasReceived(s){return this.receivedResp&&this.receivedResp.status===s}}var pm;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(pm||(pm={}));class Ga{constructor(s,r){this.channel=s,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const a=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(a.state,{},n=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ga.syncState(this.state,n,i,l),this.pendingDiffs.forEach(c=>{this.state=Ga.syncDiff(this.state,c,i,l)}),this.pendingDiffs=[],o()}),this.channel._on(a.diff,{},n=>{const{onJoin:i,onLeave:l,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ga.syncDiff(this.state,n,i,l),o())}),this.onJoin((n,i,l)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:l})}),this.onLeave((n,i,l)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(s,r,a,n){const i=this.cloneDeep(s),l=this.transformState(r),o={},c={};return this.map(i,(d,m)=>{l[d]||(c[d]=m)}),this.map(l,(d,m)=>{const u=i[d];if(u){const h=m.map(w=>w.presence_ref),f=u.map(w=>w.presence_ref),g=m.filter(w=>f.indexOf(w.presence_ref)<0),j=u.filter(w=>h.indexOf(w.presence_ref)<0);g.length>0&&(o[d]=g),j.length>0&&(c[d]=j)}else o[d]=m}),this.syncDiff(i,{joins:o,leaves:c},a,n)}static syncDiff(s,r,a,n){const{joins:i,leaves:l}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return a||(a=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var d;const m=(d=s[o])!==null&&d!==void 0?d:[];if(s[o]=this.cloneDeep(c),m.length>0){const u=s[o].map(f=>f.presence_ref),h=m.filter(f=>u.indexOf(f.presence_ref)<0);s[o].unshift(...h)}a(o,m,c)}),this.map(l,(o,c)=>{let d=s[o];if(!d)return;const m=c.map(u=>u.presence_ref);d=d.filter(u=>m.indexOf(u.presence_ref)<0),s[o]=d,n(o,d,c),d.length===0&&delete s[o]}),s}static map(s,r){return Object.getOwnPropertyNames(s).map(a=>r(a,s[a]))}static transformState(s){return s=this.cloneDeep(s),Object.getOwnPropertyNames(s).reduce((r,a)=>{const n=s[a];return"metas"in n?r[a]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[a]=n,r},{})}static cloneDeep(s){return JSON.parse(JSON.stringify(s))}onJoin(s){this.caller.onJoin=s}onLeave(s){this.caller.onLeave=s}onSync(s){this.caller.onSync=s}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ym;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(ym||(ym={}));var Ka;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Ka||(Ka={}));var cs;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(cs||(cs={}));class Pd{constructor(s,r={config:{}},a){this.topic=s,this.params=r,this.socket=a,this.bindings={},this.state=Be.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=s.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new oo(this,zt.join,this.params,this.timeout),this.rejoinTimer=new pg(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Be.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Be.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=Be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Be.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=Be.errored,this.rejoinTimer.scheduleTimeout())}),this._on(zt.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new Ga(this),this.broadcastEndpointURL=bg(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(s,r=this.timeout){var a,n,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Be.closed){const{config:{broadcast:l,presence:o,private:c}}=this.params,d=(n=(a=this.bindings.postgres_changes)===null||a===void 0?void 0:a.map(f=>f.filter))!==null&&n!==void 0?n:[],m=!!this.bindings[Ka.PRESENCE]&&this.bindings[Ka.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,u={},h={broadcast:l,presence:Object.assign(Object.assign({},o),{enabled:m}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>s==null?void 0:s(cs.CHANNEL_ERROR,f)),this._onClose(()=>s==null?void 0:s(cs.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:f})=>{var g;if(this.socket.setAuth(),f===void 0){s==null||s(cs.SUBSCRIBED);return}else{const j=this.bindings.postgres_changes,w=(g=j==null?void 0:j.length)!==null&&g!==void 0?g:0,v=[];for(let p=0;p<w;p++){const y=j[p],{filter:{event:b,schema:N,table:k,filter:E}}=y,C=f&&f[p];if(C&&C.event===b&&C.schema===N&&C.table===k&&C.filter===E)v.push(Object.assign(Object.assign({},y),{id:C.id}));else{this.unsubscribe(),this.state=Be.errored,s==null||s(cs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,s&&s(cs.SUBSCRIBED);return}}).receive("error",f=>{this.state=Be.errored,s==null||s(cs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{s==null||s(cs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(s,r={}){return await this.send({type:"presence",event:"track",payload:s},r.timeout||this.timeout)}async untrack(s={}){return await this.send({type:"presence",event:"untrack"},s)}on(s,r,a){return this.state===Be.joined&&s===Ka.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(s,r,a)}async send(s,r={}){var a,n;if(!this._canPush()&&s.type==="broadcast"){const{event:i,payload:l}=s,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:l,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var l,o,c;const d=this._push(s.type,s,r.timeout||this.timeout);s.type==="broadcast"&&!(!((c=(o=(l=this.params)===null||l===void 0?void 0:l.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(s){this.joinPush.updatePayload(s)}unsubscribe(s=this.timeout){this.state=Be.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(zt.close,"leave",this._joinRef())};this.joinPush.destroy();let a=null;return new Promise(n=>{a=new oo(this,zt.leave,{},s),a.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),a.send(),this._canPush()||a.trigger("ok",{})}).finally(()=>{a==null||a.destroy()})}teardown(){this.pushBuffer.forEach(s=>s.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Be.closed,this.bindings={}}async _fetchWithTimeout(s,r,a){const n=new AbortController,i=setTimeout(()=>n.abort(),a),l=await this.socket.fetch(s,Object.assign(Object.assign({},r),{signal:n.signal}));return clearTimeout(i),l}_push(s,r,a=this.timeout){if(!this.joinedOnce)throw`tried to push '${s}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new oo(this,s,r,a);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(s){if(s.startTimeout(),this.pushBuffer.push(s),this.pushBuffer.length>Cb){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(s,r,a){return r}_isMember(s){return this.topic===s}_joinRef(){return this.joinPush.ref}_trigger(s,r,a){var n,i;const l=s.toLocaleLowerCase(),{close:o,error:c,leave:d,join:m}=zt;if(a&&[o,c,d,m].indexOf(l)>=0&&a!==this._joinRef())return;let h=this._onMessage(l,r,a);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,j,w;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((w=(j=f.filter)===null||j===void 0?void 0:j.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===l}).map(f=>f.callback(h,a)):(i=this.bindings[l])===null||i===void 0||i.filter(f=>{var g,j,w,v,p,y;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in f){const b=f.id,N=(g=f.filter)===null||g===void 0?void 0:g.event;return b&&((j=r.ids)===null||j===void 0?void 0:j.includes(b))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((w=r.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const b=(p=(v=f==null?void 0:f.filter)===null||v===void 0?void 0:v.event)===null||p===void 0?void 0:p.toLocaleLowerCase();return b==="*"||b===((y=r==null?void 0:r.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===l}).map(f=>{if(typeof h=="object"&&"ids"in h){const g=h.data,{schema:j,table:w,commit_timestamp:v,type:p,errors:y}=g;h=Object.assign(Object.assign({},{schema:j,table:w,commit_timestamp:v,eventType:p,new:{},old:{},errors:y}),this._getPayloadRecords(g))}f.callback(h,a)})}_isClosed(){return this.state===Be.closed}_isJoined(){return this.state===Be.joined}_isJoining(){return this.state===Be.joining}_isLeaving(){return this.state===Be.leaving}_replyEventName(s){return`chan_reply_${s}`}_on(s,r,a){const n=s.toLocaleLowerCase(),i={type:n,filter:r,callback:a};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(s,r){const a=s.toLocaleLowerCase();return this.bindings[a]&&(this.bindings[a]=this.bindings[a].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===a&&Pd.isEqual(n.filter,r))})),this}static isEqual(s,r){if(Object.keys(s).length!==Object.keys(r).length)return!1;for(const a in s)if(s[a]!==r[a])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(s){this._on(zt.close,{},s)}_onError(s){this._on(zt.error,{},r=>s(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(s=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Be.joining,this.joinPush.resend(s))}_getPayloadRecords(s){const r={new:{},old:{}};return(s.type==="INSERT"||s.type==="UPDATE")&&(r.new=fm(s.columns,s.record)),(s.type==="UPDATE"||s.type==="DELETE")&&(r.old=fm(s.columns,s.old_record)),r}}const co=()=>{},Xn={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Ib=[1e3,2e3,5e3,1e4],Lb=1e4,Mb=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ob{constructor(s,r){var a;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=gc,this.transport=null,this.heartbeatIntervalMs=Xn.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=co,this.ref=0,this.reconnectTimer=null,this.logger=co,this.conn=null,this.sendBuffer=[],this.serializer=new Eb,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let i;return n?i=n:typeof fetch>"u"?i=(...l)=>pa(async()=>{const{default:o}=await Promise.resolve().then(()=>ya);return{default:o}},void 0).then(({default:o})=>o(...l)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...l)=>i(...l)},!(!((a=r==null?void 0:r.params)===null||a===void 0)&&a.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${s}/${fc.websocket}`,this.httpEndpoint=bg(s),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=wb.createWebSocket(this.endpointURL())}catch(s){this._setConnectionState("disconnected");const r=s.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:kb}))}disconnect(s,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const a=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(a),this._setConnectionState("disconnected")},s?this.conn.close(s,r??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(s){const r=await s.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const s=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),s}log(s,r,a){this.logger(s,r,a)}connectionState(){switch(this.conn&&this.conn.readyState){case Ha.connecting:return nr.Connecting;case Ha.open:return nr.Open;case Ha.closing:return nr.Closing;default:return nr.Closed}}isConnected(){return this.connectionState()===nr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(s,r={config:{}}){const a=`realtime:${s}`,n=this.getChannels().find(i=>i.topic===a);if(n)return n;{const i=new Pd(`realtime:${s}`,r,this);return this.channels.push(i),i}}push(s){const{topic:r,event:a,payload:n,ref:i}=s,l=()=>{this.encode(s,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${r} ${a} (${i})`,n),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(s=null){this._authPromise=this._performAuth(s);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var s;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(s=this.conn)===null||s===void 0||s.close(Sb,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Xn.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(s){this.heartbeatCallback=s}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(s=>s()),this.sendBuffer=[])}_makeRef(){let s=this.ref+1;return s===this.ref?this.ref=0:this.ref=s,this.ref.toString()}_leaveOpenTopic(s){let r=this.channels.find(a=>a.topic===s&&(a._isJoined()||a._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${s}"`),r.unsubscribe())}_remove(s){this.channels=this.channels.filter(r=>r.topic!==s.topic)}_onConnMessage(s){this.decode(s.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:a,event:n,payload:i,ref:l}=r,o=l?`(${l})`:"",c=i.status||"";this.log("receive",`${c} ${a} ${n} ${o}`.trim(),i),this.channels.filter(d=>d._isMember(a)).forEach(d=>d._trigger(n,i,l)),this._triggerStateCallbacks("message",r)})}_clearTimer(s){var r;s==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):s==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=s=>this._onConnError(s),this.conn.onmessage=s=>this._onConnMessage(s),this.conn.onclose=s=>this._onConnClose(s))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(s=>s.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const s=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(s),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(s){var r;this._setConnectionState("disconnected"),this.log("transport","close",s),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",s)}_onConnError(s){this._setConnectionState("disconnected"),this.log("transport",`${s}`),this._triggerChanError(),this._triggerStateCallbacks("error",s)}_triggerChanError(){this.channels.forEach(s=>s._trigger(zt.error))}_appendParams(s,r){if(Object.keys(r).length===0)return s;const a=s.match(/\?/)?"&":"?",n=new URLSearchParams(r);return`${s}${a}${n}`}_workerObjectUrl(s){let r;if(s)r=s;else{const a=new Blob([Mb],{type:"application/javascript"});r=URL.createObjectURL(a)}return r}_setConnectionState(s,r=!1){this._connectionState=s,s==="connecting"?this._wasManualDisconnect=!1:s==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(s=null){let r;s?r=s:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(a=>{const n={access_token:r,version:_b};r&&a.updateJoinPayload(n),a.joinedOnce&&a._isJoined()&&a._push(zt.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(s="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${s}`,r)})}_triggerStateCallbacks(s,r){try{this.stateChangeCallbacks[s].forEach(a=>{try{a(r)}catch(n){this.log("error",`error in ${s} callback`,n)}})}catch(a){this.log("error",`error triggering ${s} callbacks`,a)}}_setupReconnectionTimer(){this.reconnectTimer=new pg(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Xn.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(s){var r,a,n,i,l,o,c,d,m;if(this.transport=(r=s==null?void 0:s.transport)!==null&&r!==void 0?r:null,this.timeout=(a=s==null?void 0:s.timeout)!==null&&a!==void 0?a:gc,this.heartbeatIntervalMs=(n=s==null?void 0:s.heartbeatIntervalMs)!==null&&n!==void 0?n:Xn.HEARTBEAT_INTERVAL,this.worker=(i=s==null?void 0:s.worker)!==null&&i!==void 0?i:!1,this.accessToken=(l=s==null?void 0:s.accessToken)!==null&&l!==void 0?l:null,this.heartbeatCallback=(o=s==null?void 0:s.heartbeatCallback)!==null&&o!==void 0?o:co,s!=null&&s.params&&(this.params=s.params),s!=null&&s.logger&&(this.logger=s.logger),(s!=null&&s.logLevel||s!=null&&s.log_level)&&(this.logLevel=s.logLevel||s.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=s==null?void 0:s.reconnectAfterMs)!==null&&c!==void 0?c:u=>Ib[u-1]||Lb,this.encode=(d=s==null?void 0:s.encode)!==null&&d!==void 0?d:(u,h)=>h(JSON.stringify(u)),this.decode=(m=s==null?void 0:s.decode)!==null&&m!==void 0?m:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=s==null?void 0:s.workerUrl}}}class Td extends Error{constructor(s){super(s),this.__isStorageError=!0,this.name="StorageError"}}function ze(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class Fb extends Td{constructor(s,r,a){super(s),this.name="StorageApiError",this.status=r,this.statusCode=a}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class yc extends Td{constructor(s,r){super(s),this.name="StorageUnknownError",this.originalError=r}}var Ub=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};const vg=t=>{let s;return t?s=t:typeof fetch>"u"?s=(...r)=>pa(async()=>{const{default:a}=await Promise.resolve().then(()=>ya);return{default:a}},void 0).then(({default:a})=>a(...r)):s=fetch,(...r)=>s(...r)},qb=()=>Ub(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield pa(()=>Promise.resolve().then(()=>ya),void 0)).Response:Response}),bc=t=>{if(Array.isArray(t))return t.map(r=>bc(r));if(typeof t=="function"||t!==Object(t))return t;const s={};return Object.entries(t).forEach(([r,a])=>{const n=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));s[n]=bc(a)}),s},Bb=t=>{if(typeof t!="object"||t===null)return!1;const s=Object.getPrototypeOf(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var br=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};const uo=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),zb=(t,s,r)=>br(void 0,void 0,void 0,function*(){const a=yield qb();t instanceof a&&!(r!=null&&r.noResolveJson)?t.json().then(n=>{const i=t.status||500,l=(n==null?void 0:n.statusCode)||i+"";s(new Fb(uo(n),i,l))}).catch(n=>{s(new yc(uo(n),n))}):s(new yc(uo(t),t))}),Vb=(t,s,r,a)=>{const n={method:t,headers:(s==null?void 0:s.headers)||{}};return t==="GET"||!a?n:(Bb(a)?(n.headers=Object.assign({"Content-Type":"application/json"},s==null?void 0:s.headers),n.body=JSON.stringify(a)):n.body=a,s!=null&&s.duplex&&(n.duplex=s.duplex),Object.assign(Object.assign({},n),r))};function Pn(t,s,r,a,n,i){return br(this,void 0,void 0,function*(){return new Promise((l,o)=>{t(r,Vb(s,a,n,i)).then(c=>{if(!c.ok)throw c;return a!=null&&a.noResolveJson?c:c.json()}).then(c=>l(c)).catch(c=>zb(c,o,a))})})}function Zi(t,s,r,a){return br(this,void 0,void 0,function*(){return Pn(t,"GET",s,r,a)})}function es(t,s,r,a,n){return br(this,void 0,void 0,function*(){return Pn(t,"POST",s,a,n,r)})}function vc(t,s,r,a,n){return br(this,void 0,void 0,function*(){return Pn(t,"PUT",s,a,n,r)})}function Wb(t,s,r,a){return br(this,void 0,void 0,function*(){return Pn(t,"HEAD",s,Object.assign(Object.assign({},r),{noResolveJson:!0}),a)})}function jg(t,s,r,a,n){return br(this,void 0,void 0,function*(){return Pn(t,"DELETE",s,a,n,r)})}var it=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};const Hb={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},bm={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Gb{constructor(s,r={},a,n){this.shouldThrowOnError=!1,this.url=s,this.headers=r,this.bucketId=a,this.fetch=vg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(s,r,a,n){return it(this,void 0,void 0,function*(){try{let i;const l=Object.assign(Object.assign({},bm),n);let o=Object.assign(Object.assign({},this.headers),s==="POST"&&{"x-upsert":String(l.upsert)});const c=l.metadata;typeof Blob<"u"&&a instanceof Blob?(i=new FormData,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",a)):typeof FormData<"u"&&a instanceof FormData?(i=a,i.append("cacheControl",l.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=a,o["cache-control"]=`max-age=${l.cacheControl}`,o["content-type"]=l.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const d=this._removeEmptyFolders(r),m=this._getFinalPath(d),u=yield(s=="PUT"?vc:es)(this.fetch,`${this.url}/object/${m}`,i,Object.assign({headers:o},l!=null&&l.duplex?{duplex:l.duplex}:{}));return{data:{path:d,id:u.Id,fullPath:u.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ze(i))return{data:null,error:i};throw i}})}upload(s,r,a){return it(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",s,r,a)})}uploadToSignedUrl(s,r,a,n){return it(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(s),l=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${l}`);o.searchParams.set("token",r);try{let c;const d=Object.assign({upsert:bm.upsert},n),m=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&a instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",a)):typeof FormData<"u"&&a instanceof FormData?(c=a,c.append("cacheControl",d.cacheControl)):(c=a,m["cache-control"]=`max-age=${d.cacheControl}`,m["content-type"]=d.contentType);const u=yield vc(this.fetch,o.toString(),c,{headers:m});return{data:{path:i,fullPath:u.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ze(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(s,r){return it(this,void 0,void 0,function*(){try{let a=this._getFinalPath(s);const n=Object.assign({},this.headers);r!=null&&r.upsert&&(n["x-upsert"]="true");const i=yield es(this.fetch,`${this.url}/object/upload/sign/${a}`,{},{headers:n}),l=new URL(this.url+i.url),o=l.searchParams.get("token");if(!o)throw new Td("No token returned by API");return{data:{signedUrl:l.toString(),path:s,token:o},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a))return{data:null,error:a};throw a}})}update(s,r,a){return it(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",s,r,a)})}move(s,r,a){return it(this,void 0,void 0,function*(){try{return{data:yield es(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:s,destinationKey:r,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}copy(s,r,a){return it(this,void 0,void 0,function*(){try{return{data:{path:(yield es(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:s,destinationKey:r,destinationBucket:a==null?void 0:a.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}createSignedUrl(s,r,a){return it(this,void 0,void 0,function*(){try{let n=this._getFinalPath(s),i=yield es(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:r},a!=null&&a.transform?{transform:a.transform}:{}),{headers:this.headers});const l=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${l}`)},{data:i,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}createSignedUrls(s,r,a){return it(this,void 0,void 0,function*(){try{const n=yield es(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:s},{headers:this.headers}),i=a!=null&&a.download?`&download=${a.download===!0?"":a.download}`:"";return{data:n.map(l=>Object.assign(Object.assign({},l),{signedUrl:l.signedURL?encodeURI(`${this.url}${l.signedURL}${i}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}download(s,r){return it(this,void 0,void 0,function*(){const n=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),l=i?`?${i}`:"";try{const o=this._getFinalPath(s);return{data:yield(yield Zi(this.fetch,`${this.url}/${n}/${o}${l}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(ze(o))return{data:null,error:o};throw o}})}info(s){return it(this,void 0,void 0,function*(){const r=this._getFinalPath(s);try{const a=yield Zi(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:bc(a),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a))return{data:null,error:a};throw a}})}exists(s){return it(this,void 0,void 0,function*(){const r=this._getFinalPath(s);try{return yield Wb(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a)&&a instanceof yc){const n=a.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:a}}throw a}})}getPublicUrl(s,r){const a=this._getFinalPath(s),n=[],i=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";i!==""&&n.push(i);const o=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${a}${d}`)}}}remove(s){return it(this,void 0,void 0,function*(){try{return{data:yield jg(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:s},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ze(r))return{data:null,error:r};throw r}})}list(s,r,a){return it(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Hb),r),{prefix:s||""});return{data:yield es(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},a),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ze(n))return{data:null,error:n};throw n}})}listV2(s,r){return it(this,void 0,void 0,function*(){try{const a=Object.assign({},s);return{data:yield es(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a))return{data:null,error:a};throw a}})}encodeMetadata(s){return JSON.stringify(s)}toBase64(s){return typeof Buffer<"u"?Buffer.from(s).toString("base64"):btoa(s)}_getFinalPath(s){return`${this.bucketId}/${s.replace(/^\/+/,"")}`}_removeEmptyFolders(s){return s.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(s){const r=[];return s.width&&r.push(`width=${s.width}`),s.height&&r.push(`height=${s.height}`),s.resize&&r.push(`resize=${s.resize}`),s.format&&r.push(`format=${s.format}`),s.quality&&r.push(`quality=${s.quality}`),r.join("&")}}const Kb="2.12.1",Yb={"X-Client-Info":`storage-js/${Kb}`};var jr=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};class Jb{constructor(s,r={},a,n){this.shouldThrowOnError=!1;const i=new URL(s);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},Yb),r),this.fetch=vg(a)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return jr(this,void 0,void 0,function*(){try{return{data:yield Zi(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ze(s))return{data:null,error:s};throw s}})}getBucket(s){return jr(this,void 0,void 0,function*(){try{return{data:yield Zi(this.fetch,`${this.url}/bucket/${s}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ze(r))return{data:null,error:r};throw r}})}createBucket(s,r={public:!1}){return jr(this,void 0,void 0,function*(){try{return{data:yield es(this.fetch,`${this.url}/bucket`,{id:s,name:s,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a))return{data:null,error:a};throw a}})}updateBucket(s,r){return jr(this,void 0,void 0,function*(){try{return{data:yield vc(this.fetch,`${this.url}/bucket/${s}`,{id:s,name:s,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ze(a))return{data:null,error:a};throw a}})}emptyBucket(s){return jr(this,void 0,void 0,function*(){try{return{data:yield es(this.fetch,`${this.url}/bucket/${s}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ze(r))return{data:null,error:r};throw r}})}deleteBucket(s){return jr(this,void 0,void 0,function*(){try{return{data:yield jg(this.fetch,`${this.url}/bucket/${s}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ze(r))return{data:null,error:r};throw r}})}}class Qb extends Jb{constructor(s,r={},a,n){super(s,r,a,n)}from(s){return new Gb(this.url,this.headers,s,this.fetch)}}const Xb="2.57.4";let La="";typeof Deno<"u"?La="deno":typeof document<"u"?La="web":typeof navigator<"u"&&navigator.product==="ReactNative"?La="react-native":La="node";const Zb={"X-Client-Info":`supabase-js-${La}/${Xb}`},ev={headers:Zb},tv={schema:"public"},sv={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},rv={};var av=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};const nv=t=>{let s;return t?s=t:typeof fetch>"u"?s=ig:s=fetch,(...r)=>s(...r)},iv=()=>typeof Headers>"u"?lg:Headers,lv=(t,s,r)=>{const a=nv(r),n=iv();return(i,l)=>av(void 0,void 0,void 0,function*(){var o;const c=(o=yield s())!==null&&o!==void 0?o:t;let d=new n(l==null?void 0:l.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),a(i,Object.assign(Object.assign({},l),{headers:d}))})};var ov=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};function cv(t){return t.endsWith("/")?t:t+"/"}function dv(t,s){var r,a;const{db:n,auth:i,realtime:l,global:o}=t,{db:c,auth:d,realtime:m,global:u}=s,h={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},m),l),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},(r=u==null?void 0:u.headers)!==null&&r!==void 0?r:{}),(a=o==null?void 0:o.headers)!==null&&a!==void 0?a:{})}),accessToken:()=>ov(this,void 0,void 0,function*(){return""})};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function uv(t){const s=t==null?void 0:t.trim();if(!s)throw new Error("supabaseUrl is required.");if(!s.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(cv(s))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const wg="2.71.1",Er=30*1e3,jc=3,mo=jc*Er,mv="http://localhost:9999",hv="supabase.auth.token",xv={"X-Client-Info":`gotrue-js/${wg}`},wc="X-Supabase-Api-Version",Ng={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},gv=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,fv=10*60*1e3;class pn extends Error{constructor(s,r,a){super(s),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=a}}function se(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class pv extends pn{constructor(s,r,a){super(s,r,a),this.name="AuthApiError",this.status=r,this.code=a}}function yv(t){return se(t)&&t.name==="AuthApiError"}class _g extends pn{constructor(s,r){super(s),this.name="AuthUnknownError",this.originalError=r}}class Zs extends pn{constructor(s,r,a,n){super(s,a,n),this.name=r,this.status=a}}class Cs extends Zs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function bv(t){return se(t)&&t.name==="AuthSessionMissingError"}class Zn extends Zs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ei extends Zs{constructor(s){super(s,"AuthInvalidCredentialsError",400,void 0)}}class ti extends Zs{constructor(s,r=null){super(s,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vv(t){return se(t)&&t.name==="AuthImplicitGrantRedirectError"}class vm extends Zs{constructor(s,r=null){super(s,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Nc extends Zs{constructor(s,r){super(s,"AuthRetryableFetchError",r,void 0)}}function ho(t){return se(t)&&t.name==="AuthRetryableFetchError"}class jm extends Zs{constructor(s,r,a){super(s,"AuthWeakPasswordError",r,"weak_password"),this.reasons=a}}class _c extends Zs{constructor(s){super(s,"AuthInvalidJwtError",400,"invalid_jwt")}}const el="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wm=` 	
\r=`.split(""),jv=(()=>{const t=new Array(128);for(let s=0;s<t.length;s+=1)t[s]=-1;for(let s=0;s<wm.length;s+=1)t[wm[s].charCodeAt(0)]=-2;for(let s=0;s<el.length;s+=1)t[el[s].charCodeAt(0)]=s;return t})();function Nm(t,s,r){if(t!==null)for(s.queue=s.queue<<8|t,s.queuedBits+=8;s.queuedBits>=6;){const a=s.queue>>s.queuedBits-6&63;r(el[a]),s.queuedBits-=6}else if(s.queuedBits>0)for(s.queue=s.queue<<6-s.queuedBits,s.queuedBits=6;s.queuedBits>=6;){const a=s.queue>>s.queuedBits-6&63;r(el[a]),s.queuedBits-=6}}function kg(t,s,r){const a=jv[t];if(a>-1)for(s.queue=s.queue<<6|a,s.queuedBits+=6;s.queuedBits>=8;)r(s.queue>>s.queuedBits-8&255),s.queuedBits-=8;else{if(a===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function _m(t){const s=[],r=l=>{s.push(String.fromCodePoint(l))},a={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=l=>{_v(l,a,r)};for(let l=0;l<t.length;l+=1)kg(t.charCodeAt(l),n,i);return s.join("")}function wv(t,s){if(t<=127){s(t);return}else if(t<=2047){s(192|t>>6),s(128|t&63);return}else if(t<=65535){s(224|t>>12),s(128|t>>6&63),s(128|t&63);return}else if(t<=1114111){s(240|t>>18),s(128|t>>12&63),s(128|t>>6&63),s(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Nv(t,s){for(let r=0;r<t.length;r+=1){let a=t.charCodeAt(r);if(a>55295&&a<=56319){const n=(a-55296)*1024&65535;a=(t.charCodeAt(r+1)-56320&65535|n)+65536,r+=1}wv(a,s)}}function _v(t,s,r){if(s.utf8seq===0){if(t<=127){r(t);return}for(let a=1;a<6;a+=1)if(!(t>>7-a&1)){s.utf8seq=a;break}if(s.utf8seq===2)s.codepoint=t&31;else if(s.utf8seq===3)s.codepoint=t&15;else if(s.utf8seq===4)s.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");s.utf8seq-=1}else if(s.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");s.codepoint=s.codepoint<<6|t&63,s.utf8seq-=1,s.utf8seq===0&&r(s.codepoint)}}function kv(t){const s=[],r={queue:0,queuedBits:0},a=n=>{s.push(n)};for(let n=0;n<t.length;n+=1)kg(t.charCodeAt(n),r,a);return new Uint8Array(s)}function Sv(t){const s=[];return Nv(t,r=>s.push(r)),new Uint8Array(s)}function Cv(t){const s=[],r={queue:0,queuedBits:0},a=n=>{s.push(n)};return t.forEach(n=>Nm(n,r,a)),Nm(null,r,a),s.join("")}function Ev(t){return Math.round(Date.now()/1e3)+t}function Rv(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const s=Math.random()*16|0;return(t=="x"?s:s&3|8).toString(16)})}const Ut=()=>typeof window<"u"&&typeof document<"u",er={tested:!1,writable:!1},Sg=()=>{if(!Ut())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(er.tested)return er.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),er.tested=!0,er.writable=!0}catch{er.tested=!0,er.writable=!1}return er.writable};function Pv(t){const s={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((n,i)=>{s[i]=n})}catch{}return r.searchParams.forEach((a,n)=>{s[n]=a}),s}const Cg=t=>{let s;return t?s=t:typeof fetch>"u"?s=(...r)=>pa(async()=>{const{default:a}=await Promise.resolve().then(()=>ya);return{default:a}},void 0).then(({default:a})=>a(...r)):s=fetch,(...r)=>s(...r)},Tv=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Rr=async(t,s,r)=>{await t.setItem(s,JSON.stringify(r))},tr=async(t,s)=>{const r=await t.getItem(s);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ks=async(t,s)=>{await t.removeItem(s)};class Pl{constructor(){this.promise=new Pl.promiseConstructor((s,r)=>{this.resolve=s,this.reject=r})}}Pl.promiseConstructor=Promise;function xo(t){const s=t.split(".");if(s.length!==3)throw new _c("Invalid JWT structure");for(let a=0;a<s.length;a++)if(!gv.test(s[a]))throw new _c("JWT not in base64url format");return{header:JSON.parse(_m(s[0])),payload:JSON.parse(_m(s[1])),signature:kv(s[2]),raw:{header:s[0],payload:s[1]}}}async function Av(t){return await new Promise(s=>{setTimeout(()=>s(null),t)})}function Dv(t,s){return new Promise((a,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const l=await t(i);if(!s(i,null,l)){a(l);return}}catch(l){if(!s(i,l)){n(l);return}}})()})}function $v(t){return("0"+t.toString(16)).substr(-2)}function Iv(){const s=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",a=r.length;let n="";for(let i=0;i<56;i++)n+=r.charAt(Math.floor(Math.random()*a));return n}return crypto.getRandomValues(s),Array.from(s,$v).join("")}async function Lv(t){const r=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",r),n=new Uint8Array(a);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}async function Mv(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await Lv(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function wr(t,s,r=!1){const a=Iv();let n=a;r&&(n+="/PASSWORD_RECOVERY"),await Rr(t,`${s}-code-verifier`,n);const i=await Mv(a);return[i,a===i?"plain":"s256"]}const Ov=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Fv(t){const s=t.headers.get(wc);if(!s||!s.match(Ov))return null;try{return new Date(`${s}T00:00:00.0Z`)}catch{return null}}function Uv(t){if(!t)throw new Error("Missing exp claim");const s=Math.floor(Date.now()/1e3);if(t<=s)throw new Error("JWT has expired")}function qv(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Bv=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Nr(t){if(!Bv.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function go(){const t={};return new Proxy(t,{get:(s,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const a=r.toString();if(a==="Symbol(Symbol.toPrimitive)"||a==="Symbol(Symbol.toStringTag)"||a==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(s,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(s,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function km(t){return JSON.parse(JSON.stringify(t))}var zv=function(t,s){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(r[a[n]]=t[a[n]]);return r};const ar=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Vv=[502,503,504];async function Sm(t){var s;if(!Tv(t))throw new Nc(ar(t),0);if(Vv.includes(t.status))throw new Nc(ar(t),t.status);let r;try{r=await t.json()}catch(i){throw new _g(ar(i),i)}let a;const n=Fv(t);if(n&&n.getTime()>=Ng["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?a=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(a=r.error_code),a){if(a==="weak_password")throw new jm(ar(r),t.status,((s=r.weak_password)===null||s===void 0?void 0:s.reasons)||[]);if(a==="session_not_found")throw new Cs}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,l)=>i&&typeof l=="string",!0))throw new jm(ar(r),t.status,r.weak_password.reasons);throw new pv(ar(r),t.status||500,a)}const Wv=(t,s,r,a)=>{const n={method:t,headers:(s==null?void 0:s.headers)||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},s==null?void 0:s.headers),n.body=JSON.stringify(a),Object.assign(Object.assign({},n),r))};async function ce(t,s,r,a){var n;const i=Object.assign({},a==null?void 0:a.headers);i[wc]||(i[wc]=Ng["2024-01-01"].name),a!=null&&a.jwt&&(i.Authorization=`Bearer ${a.jwt}`);const l=(n=a==null?void 0:a.query)!==null&&n!==void 0?n:{};a!=null&&a.redirectTo&&(l.redirect_to=a.redirectTo);const o=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",c=await Hv(t,s,r+o,{headers:i,noResolveJson:a==null?void 0:a.noResolveJson},{},a==null?void 0:a.body);return a!=null&&a.xform?a==null?void 0:a.xform(c):{data:Object.assign({},c),error:null}}async function Hv(t,s,r,a,n,i){const l=Wv(s,a,n,i);let o;try{o=await t(r,Object.assign({},l))}catch(c){throw console.error(c),new Nc(ar(c),0)}if(o.ok||await Sm(o),a!=null&&a.noResolveJson)return o;try{return await o.json()}catch(c){await Sm(c)}}function ls(t){var s;let r=null;Jv(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=Ev(t.expires_in)));const a=(s=t.user)!==null&&s!==void 0?s:t;return{data:{session:r,user:a},error:null}}function Cm(t){const s=ls(t);return!s.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,a)=>r&&typeof a=="string",!0)&&(s.data.weak_password=t.weak_password),s}function As(t){var s;return{data:{user:(s=t.user)!==null&&s!==void 0?s:t},error:null}}function Gv(t){return{data:t,error:null}}function Kv(t){const{action_link:s,email_otp:r,hashed_token:a,redirect_to:n,verification_type:i}=t,l=zv(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:s,email_otp:r,hashed_token:a,redirect_to:n,verification_type:i},c=Object.assign({},l);return{data:{properties:o,user:c},error:null}}function Yv(t){return t}function Jv(t){return t.access_token&&t.refresh_token&&t.expires_in}const fo=["global","local","others"];var Qv=function(t,s){var r={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(t);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(t,a[n])&&(r[a[n]]=t[a[n]]);return r};class Xv{constructor({url:s="",headers:r={},fetch:a}){this.url=s,this.headers=r,this.fetch=Cg(a),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(s,r=fo[0]){if(fo.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fo.join(", ")}`);try{return await ce(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:s,noResolveJson:!0}),{data:null,error:null}}catch(a){if(se(a))return{data:null,error:a};throw a}}async inviteUserByEmail(s,r={}){try{return await ce(this.fetch,"POST",`${this.url}/invite`,{body:{email:s,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:As})}catch(a){if(se(a))return{data:{user:null},error:a};throw a}}async generateLink(s){try{const{options:r}=s,a=Qv(s,["options"]),n=Object.assign(Object.assign({},a),r);return"newEmail"in a&&(n.new_email=a==null?void 0:a.newEmail,delete n.newEmail),await ce(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Kv,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(se(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(s){try{return await ce(this.fetch,"POST",`${this.url}/admin/users`,{body:s,headers:this.headers,xform:As})}catch(r){if(se(r))return{data:{user:null},error:r};throw r}}async listUsers(s){var r,a,n,i,l,o,c;try{const d={nextPage:null,lastPage:0,total:0},m=await ce(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(a=(r=s==null?void 0:s.page)===null||r===void 0?void 0:r.toString())!==null&&a!==void 0?a:"",per_page:(i=(n=s==null?void 0:s.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:Yv});if(m.error)throw m.error;const u=await m.json(),h=(l=m.headers.get("x-total-count"))!==null&&l!==void 0?l:0,f=(c=(o=m.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(g=>{const j=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(g.split(";")[1].split("=")[1]);d[`${w}Page`]=j}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},u),d),error:null}}catch(d){if(se(d))return{data:{users:[]},error:d};throw d}}async getUserById(s){Nr(s);try{return await ce(this.fetch,"GET",`${this.url}/admin/users/${s}`,{headers:this.headers,xform:As})}catch(r){if(se(r))return{data:{user:null},error:r};throw r}}async updateUserById(s,r){Nr(s);try{return await ce(this.fetch,"PUT",`${this.url}/admin/users/${s}`,{body:r,headers:this.headers,xform:As})}catch(a){if(se(a))return{data:{user:null},error:a};throw a}}async deleteUser(s,r=!1){Nr(s);try{return await ce(this.fetch,"DELETE",`${this.url}/admin/users/${s}`,{headers:this.headers,body:{should_soft_delete:r},xform:As})}catch(a){if(se(a))return{data:{user:null},error:a};throw a}}async _listFactors(s){Nr(s.userId);try{const{data:r,error:a}=await ce(this.fetch,"GET",`${this.url}/admin/users/${s.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:r,error:a}}catch(r){if(se(r))return{data:null,error:r};throw r}}async _deleteFactor(s){Nr(s.userId),Nr(s.id);try{return{data:await ce(this.fetch,"DELETE",`${this.url}/admin/users/${s.userId}/factors/${s.id}`,{headers:this.headers}),error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}}}function Em(t={}){return{getItem:s=>t[s]||null,setItem:(s,r)=>{t[s]=r},removeItem:s=>{delete t[s]}}}function Zv(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const _r={debug:!!(globalThis&&Sg()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Eg extends Error{constructor(s){super(s),this.isAcquireTimeout=!0}}class ej extends Eg{}async function tj(t,s,r){_r.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,s);const a=new globalThis.AbortController;return s>0&&setTimeout(()=>{a.abort(),_r.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},s),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,s===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:a.signal},async n=>{if(n){_r.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await r()}finally{_r.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(s===0)throw _r.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new ej(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(_r.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}Zv();const sj={url:mv,storageKey:hv,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:xv,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Rm(t,s,r){return await r()}const kr={};class yn{constructor(s){var r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=yn.nextInstanceID,yn.nextInstanceID+=1,this.instanceID>0&&Ut()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},sj),s);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Xv({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Cg(n.fetch),this.lock=n.lock||Rm,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Ut()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=tj:this.lock=Rm,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Sg()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Em(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Em(this.memoryStorage)),Ut()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var s,r;return(r=(s=kr[this.storageKey])===null||s===void 0?void 0:s.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(s){kr[this.storageKey]=Object.assign(Object.assign({},kr[this.storageKey]),{jwks:s})}get jwks_cached_at(){var s,r;return(r=(s=kr[this.storageKey])===null||s===void 0?void 0:s.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(s){kr[this.storageKey]=Object.assign(Object.assign({},kr[this.storageKey]),{cachedAt:s})}_debug(...s){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${wg}) ${new Date().toISOString()}`,...s),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var s;try{const r=Pv(window.location.href);let a="none";if(this._isImplicitGrantCallback(r)?a="implicit":await this._isPKCECallback(r)&&(a="pkce"),Ut()&&this.detectSessionInUrl&&a!=="none"){const{data:n,error:i}=await this._getSessionFromURL(r,a);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),vv(i)){const c=(s=i.details)===null||s===void 0?void 0:s.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:l,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",l,"redirect type",o),await this._saveSession(l),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return se(r)?{error:r}:{error:new _g("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(s){var r,a,n;try{const i=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(a=(r=s==null?void 0:s.options)===null||r===void 0?void 0:r.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:(n=s==null?void 0:s.options)===null||n===void 0?void 0:n.captchaToken}},xform:ls}),{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(se(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(s){var r,a,n;try{let i;if("email"in s){const{email:m,password:u,options:h}=s;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await wr(this.storage,this.storageKey)),i=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:m,password:u,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:g},xform:ls})}else if("phone"in s){const{phone:m,password:u,options:h}=s;i=await ce(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:u,data:(a=h==null?void 0:h.data)!==null&&a!==void 0?a:{},channel:(n=h==null?void 0:h.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:ls})}else throw new ei("You must provide either an email or phone number and a password");const{data:l,error:o}=i;if(o||!l)return{data:{user:null,session:null},error:o};const c=l.session,d=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(se(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(s){try{let r;if("email"in s){const{email:i,password:l,options:o}=s;r=await ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Cm})}else if("phone"in s){const{phone:i,password:l,options:o}=s;r=await ce(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:l,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Cm})}else throw new ei("You must provide either an email or phone number and a password");const{data:a,error:n}=r;return n?{data:{user:null,session:null},error:n}:!a||!a.session||!a.user?{data:{user:null,session:null},error:new Zn}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign({user:a.user,session:a.session},a.weak_password?{weakPassword:a.weak_password}:null),error:n})}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(s){var r,a,n,i;return await this._handleProviderSignIn(s.provider,{redirectTo:(r=s.options)===null||r===void 0?void 0:r.redirectTo,scopes:(a=s.options)===null||a===void 0?void 0:a.scopes,queryParams:(n=s.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=s.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(s){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(s))}async signInWithWeb3(s){const{chain:r}=s;if(r==="solana")return await this.signInWithSolana(s);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(s){var r,a,n,i,l,o,c,d,m,u,h,f;let g,j;if("message"in s)g=s.message,j=s.signature;else{const{chain:w,wallet:v,statement:p,options:y}=s;let b;if(Ut())if(typeof v=="object")b=v;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))b=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=v}const N=new URL((r=y==null?void 0:y.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in b&&b.signIn){const k=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:N.host,uri:N.href}),p?{statement:p}:null));let E;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")E=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)E=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)g=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),j=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${N.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${N.href}`,`Issued At: ${(n=(a=y==null?void 0:y.signInWithSolana)===null||a===void 0?void 0:a.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((i=y==null?void 0:y.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((c=y==null?void 0:y.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((d=y==null?void 0:y.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((u=(m=y==null?void 0:y.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||u===void 0)&&u.length?["Resources",...y.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const k=await b.signMessage(new TextEncoder().encode(g),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");j=k}}try{const{data:w,error:v}=await ce(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Cv(j)},!((h=s.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=s.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:ls});if(v)throw v;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new Zn}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:v})}catch(w){if(se(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(s){const r=await tr(this.storage,`${this.storageKey}-code-verifier`),[a,n]=(r??"").split("/");try{const{data:i,error:l}=await ce(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:s,code_verifier:a},xform:ls});if(await ks(this.storage,`${this.storageKey}-code-verifier`),l)throw l;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Zn}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:l})}catch(i){if(se(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(s){try{const{options:r,provider:a,token:n,access_token:i,nonce:l}=s,o=await ce(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:a,id_token:n,access_token:i,nonce:l,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ls}),{data:c,error:d}=o;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Zn}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(s){var r,a,n,i,l;try{if("email"in s){const{email:o,options:c}=s;let d=null,m=null;this.flowType==="pkce"&&([d,m]=await wr(this.storage,this.storageKey));const{error:u}=await ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(a=c==null?void 0:c.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:m},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in s){const{phone:o,options:c}=s,{data:d,error:m}=await ce(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(l=c==null?void 0:c.channel)!==null&&l!==void 0?l:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:m}}throw new ei("You must provide either an email or phone number.")}catch(o){if(se(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(s){var r,a;try{let n,i;"options"in s&&(n=(r=s.options)===null||r===void 0?void 0:r.redirectTo,i=(a=s.options)===null||a===void 0?void 0:a.captchaToken);const{data:l,error:o}=await ce(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},s),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:ls});if(o)throw o;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,d=l.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(s.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(se(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(s){var r,a,n;try{let i=null,l=null;return this.flowType==="pkce"&&([i,l]=await wr(this.storage,this.storageKey)),await ce(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in s?{provider_id:s.providerId}:null),"domain"in s?{domain:s.domain}:null),{redirect_to:(a=(r=s.options)===null||r===void 0?void 0:r.redirectTo)!==null&&a!==void 0?a:void 0}),!((n=s==null?void 0:s.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:s.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:l}),headers:this.headers,xform:Gv})}catch(i){if(se(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async s=>{const{data:{session:r},error:a}=s;if(a)throw a;if(!r)throw new Cs;const{error:n}=await ce(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:n}})}catch(s){if(se(s))return{data:{user:null,session:null},error:s};throw s}}async resend(s){try{const r=`${this.url}/resend`;if("email"in s){const{email:a,type:n,options:i}=s,{error:l}=await ce(this.fetch,"POST",r,{headers:this.headers,body:{email:a,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:l}}else if("phone"in s){const{phone:a,type:n,options:i}=s,{data:l,error:o}=await ce(this.fetch,"POST",r,{headers:this.headers,body:{phone:a,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:o}}throw new ei("You must provide either an email or phone number and a type")}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(s,r){this._debug("#_acquireLock","begin",s);try{if(this.lockAcquired){const a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await a,await r()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,s,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const a=r();for(this.pendingInLock.push((async()=>{try{await a}catch{}})()),await a;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(s){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await s(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let s=null;const r=await tr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?s=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!s)return{data:{session:null},error:null};const a=s.expires_at?s.expires_at*1e3-Date.now()<mo:!1;if(this._debug("#__loadSession()",`session has${a?"":" not"} expired`,"expires_at",s.expires_at),!a){if(this.userStorage){const l=await tr(this.userStorage,this.storageKey+"-user");l!=null&&l.user?s.user=l.user:s.user=go()}if(this.storage.isServer&&s.user){let l=this.suppressGetSessionWarning;s=new Proxy(s,{get:(c,d,m)=>(!l&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,m))})}return{data:{session:s},error:null}}const{session:n,error:i}=await this._callRefreshToken(s.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(s){return s?await this._getUser(s):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(s){try{return s?await ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:s,xform:As}):await this._useSession(async r=>{var a,n,i;const{data:l,error:o}=r;if(o)throw o;return!(!((a=l.session)===null||a===void 0)&&a.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Cs}:await ce(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:As})})}catch(r){if(se(r))return bv(r)&&(await this._removeSession(),await ks(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(s,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(s,r))}async _updateUser(s,r={}){try{return await this._useSession(async a=>{const{data:n,error:i}=a;if(i)throw i;if(!n.session)throw new Cs;const l=n.session;let o=null,c=null;this.flowType==="pkce"&&s.email!=null&&([o,c]=await wr(this.storage,this.storageKey));const{data:d,error:m}=await ce(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},s),{code_challenge:o,code_challenge_method:c}),jwt:l.access_token,xform:As});if(m)throw m;return l.user=d.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),{data:{user:l.user},error:null}})}catch(a){if(se(a))return{data:{user:null},error:a};throw a}}async setSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(s))}async _setSession(s){try{if(!s.access_token||!s.refresh_token)throw new Cs;const r=Date.now()/1e3;let a=r,n=!0,i=null;const{payload:l}=xo(s.access_token);if(l.exp&&(a=l.exp,n=a<=r),n){const{session:o,error:c}=await this._callRefreshToken(s.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(s.access_token);if(c)throw c;i={access_token:s.access_token,refresh_token:s.refresh_token,user:o.user,token_type:"bearer",expires_in:a-r,expires_at:a},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(r){if(se(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(s){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(s))}async _refreshSession(s){try{return await this._useSession(async r=>{var a;if(!s){const{data:l,error:o}=r;if(o)throw o;s=(a=l.session)!==null&&a!==void 0?a:void 0}if(!(s!=null&&s.refresh_token))throw new Cs;const{session:n,error:i}=await this._callRefreshToken(s.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(s,r){try{if(!Ut())throw new ti("No browser detected.");if(s.error||s.error_description||s.error_code)throw new ti(s.error_description||"Error in URL with unspecified error_description",{error:s.error||"unspecified_error",code:s.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new vm("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ti("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!s.code)throw new vm("No code detected.");const{data:p,error:y}=await this._exchangeCodeForSession(s.code);if(y)throw y;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:p.session,redirectType:null},error:null}}const{provider_token:a,provider_refresh_token:n,access_token:i,refresh_token:l,expires_in:o,expires_at:c,token_type:d}=s;if(!i||!o||!l||!d)throw new ti("No session defined in URL");const m=Math.round(Date.now()/1e3),u=parseInt(o);let h=m+u;c&&(h=parseInt(c));const f=h-m;f*1e3<=Er&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);const g=h-u;m-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,h,m):m-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,h,m);const{data:j,error:w}=await this._getUser(i);if(w)throw w;const v={provider_token:a,provider_refresh_token:n,access_token:i,expires_in:u,expires_at:h,refresh_token:l,token_type:d,user:j.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:s.type},error:null}}catch(a){if(se(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(s){return!!(s.access_token||s.error_description)}async _isPKCECallback(s){const r=await tr(this.storage,`${this.storageKey}-code-verifier`);return!!(s.code&&r)}async signOut(s={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(s))}async _signOut({scope:s}={scope:"global"}){return await this._useSession(async r=>{var a;const{data:n,error:i}=r;if(i)return{error:i};const l=(a=n.session)===null||a===void 0?void 0:a.access_token;if(l){const{error:o}=await this.admin.signOut(l,s);if(o&&!(yv(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return s!=="others"&&(await this._removeSession(),await ks(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(s){const r=Rv(),a={id:r,callback:s,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,a),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:a}}}async _emitInitialSession(s){return await this._useSession(async r=>{var a,n;try{const{data:{session:i},error:l}=r;if(l)throw l;await((a=this.stateChangeEmitters.get(s))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",s,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(s))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",s,"error",i),console.error(i)}})}async resetPasswordForEmail(s,r={}){let a=null,n=null;this.flowType==="pkce"&&([a,n]=await wr(this.storage,this.storageKey,!0));try{return await ce(this.fetch,"POST",`${this.url}/recover`,{body:{email:s,code_challenge:a,code_challenge_method:n,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(se(i))return{data:null,error:i};throw i}}async getUserIdentities(){var s;try{const{data:r,error:a}=await this.getUser();if(a)throw a;return{data:{identities:(s=r.user.identities)!==null&&s!==void 0?s:[]},error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}}async linkIdentity(s){var r;try{const{data:a,error:n}=await this._useSession(async i=>{var l,o,c,d,m;const{data:u,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,s.provider,{redirectTo:(l=s.options)===null||l===void 0?void 0:l.redirectTo,scopes:(o=s.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=s.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ce(this.fetch,"GET",f,{headers:this.headers,jwt:(m=(d=u.session)===null||d===void 0?void 0:d.access_token)!==null&&m!==void 0?m:void 0})});if(n)throw n;return Ut()&&!(!((r=s.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(a==null?void 0:a.url),{data:{provider:s.provider,url:a==null?void 0:a.url},error:null}}catch(a){if(se(a))return{data:{provider:s.provider,url:null},error:a};throw a}}async unlinkIdentity(s){try{return await this._useSession(async r=>{var a,n;const{data:i,error:l}=r;if(l)throw l;return await ce(this.fetch,"DELETE",`${this.url}/user/identities/${s.identity_id}`,{headers:this.headers,jwt:(n=(a=i.session)===null||a===void 0?void 0:a.access_token)!==null&&n!==void 0?n:void 0})})}catch(r){if(se(r))return{data:null,error:r};throw r}}async _refreshAccessToken(s){const r=`#_refreshAccessToken(${s.substring(0,5)}...)`;this._debug(r,"begin");try{const a=Date.now();return await Dv(async n=>(n>0&&await Av(200*Math.pow(2,n-1)),this._debug(r,"refreshing attempt",n),await ce(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:s},headers:this.headers,xform:ls})),(n,i)=>{const l=200*Math.pow(2,n);return i&&ho(i)&&Date.now()+l-a<Er})}catch(a){if(this._debug(r,"error",a),se(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(r,"end")}}_isValidSession(s){return typeof s=="object"&&s!==null&&"access_token"in s&&"refresh_token"in s&&"expires_at"in s}async _handleProviderSignIn(s,r){const a=await this._getUrlForProvider(`${this.url}/authorize`,s,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",s,"options",r,"url",a),Ut()&&!r.skipBrowserRedirect&&window.location.assign(a),{data:{provider:s,url:a},error:null}}async _recoverAndRefresh(){var s,r;const a="#_recoverAndRefresh()";this._debug(a,"begin");try{const n=await tr(this.storage,this.storageKey);if(n&&this.userStorage){let l=await tr(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!l&&(l={user:n.user},await Rr(this.userStorage,this.storageKey+"-user",l)),n.user=(s=l==null?void 0:l.user)!==null&&s!==void 0?s:go()}else if(n&&!n.user&&!n.user){const l=await tr(this.storage,this.storageKey+"-user");l&&(l!=null&&l.user)?(n.user=l.user,await ks(this.storage,this.storageKey+"-user"),await Rr(this.storage,this.storageKey,n)):n.user=go()}if(this._debug(a,"session from storage",n),!this._isValidSession(n)){this._debug(a,"session is not valid"),n!==null&&await this._removeSession();return}const i=((r=n.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<mo;if(this._debug(a,`session has${i?"":" not"} expired with margin of ${mo}s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:l}=await this._callRefreshToken(n.refresh_token);l&&(console.error(l),ho(l)||(this._debug(a,"refresh failed with a non-retryable error, removing the session",l),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:l,error:o}=await this._getUser(n.access_token);!o&&(l!=null&&l.user)?(n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(a,"could not get user data, skipping SIGNED_IN notification")}catch(l){console.error("Error getting user data:",l),this._debug(a,"error getting user data, skipping SIGNED_IN notification",l)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(a,"error",n),console.error(n);return}finally{this._debug(a,"end")}}async _callRefreshToken(s){var r,a;if(!s)throw new Cs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${s.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new Pl;const{data:i,error:l}=await this._refreshAccessToken(s);if(l)throw l;if(!i.session)throw new Cs;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),se(i)){const l={session:null,error:i};return ho(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(l),l}throw(a=this.refreshingDeferred)===null||a===void 0||a.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(s,r,a=!0){const n=`#_notifyAllSubscribers(${s})`;this._debug(n,"begin",r,`broadcast = ${a}`);try{this.broadcastChannel&&a&&this.broadcastChannel.postMessage({event:s,session:r});const i=[],l=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(s,r)}catch(c){i.push(c)}});if(await Promise.all(l),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(s){this._debug("#_saveSession()",s),this.suppressGetSessionWarning=!0;const r=Object.assign({},s),a=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!a&&r.user&&await Rr(this.userStorage,this.storageKey+"-user",{user:r.user});const n=Object.assign({},r);delete n.user;const i=km(n);await Rr(this.storage,this.storageKey,i)}else{const n=km(r);await Rr(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await ks(this.storage,this.storageKey),await ks(this.storage,this.storageKey+"-code-verifier"),await ks(this.storage,this.storageKey+"-user"),this.userStorage&&await ks(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const s=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{s&&Ut()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",s)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const s=setInterval(()=>this._autoRefreshTokenTick(),Er);this.autoRefreshTicker=s,s&&typeof s=="object"&&typeof s.unref=="function"?s.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(s),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const s=this.autoRefreshTicker;this.autoRefreshTicker=null,s&&clearInterval(s)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const s=Date.now();try{return await this._useSession(async r=>{const{data:{session:a}}=r;if(!a||!a.refresh_token||!a.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((a.expires_at*1e3-s)/Er);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Er}ms, refresh threshold is ${jc} ticks`),n<=jc&&await this._callRefreshToken(a.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(s){if(s.isAcquireTimeout||s instanceof Eg)this._debug("auto refresh token tick lock not available");else throw s}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ut()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(s){console.error("_handleVisibilityChange",s)}}async _onVisibilityChanged(s){const r=`#_onVisibilityChanged(${s})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),s||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(s,r,a){const n=[`provider=${encodeURIComponent(r)}`];if(a!=null&&a.redirectTo&&n.push(`redirect_to=${encodeURIComponent(a.redirectTo)}`),a!=null&&a.scopes&&n.push(`scopes=${encodeURIComponent(a.scopes)}`),this.flowType==="pkce"){const[i,l]=await wr(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(l)}`});n.push(o.toString())}if(a!=null&&a.queryParams){const i=new URLSearchParams(a.queryParams);n.push(i.toString())}return a!=null&&a.skipBrowserRedirect&&n.push(`skip_http_redirect=${a.skipBrowserRedirect}`),`${s}?${n.join("&")}`}async _unenroll(s){try{return await this._useSession(async r=>{var a;const{data:n,error:i}=r;return i?{data:null,error:i}:await ce(this.fetch,"DELETE",`${this.url}/factors/${s.factorId}`,{headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(se(r))return{data:null,error:r};throw r}}async _enroll(s){try{return await this._useSession(async r=>{var a,n;const{data:i,error:l}=r;if(l)return{data:null,error:l};const o=Object.assign({friendly_name:s.friendlyName,factor_type:s.factorType},s.factorType==="phone"?{phone:s.phone}:{issuer:s.issuer}),{data:c,error:d}=await ce(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(a=i==null?void 0:i.session)===null||a===void 0?void 0:a.access_token});return d?{data:null,error:d}:(s.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(se(r))return{data:null,error:r};throw r}}async _verify(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:n,error:i}=r;if(i)return{data:null,error:i};const{data:l,error:o}=await ce(this.fetch,"POST",`${this.url}/factors/${s.factorId}/verify`,{body:{code:s.code,challenge_id:s.challengeId},headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:o})})}catch(r){if(se(r))return{data:null,error:r};throw r}})}async _challenge(s){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var a;const{data:n,error:i}=r;return i?{data:null,error:i}:await ce(this.fetch,"POST",`${this.url}/factors/${s.factorId}/challenge`,{body:{channel:s.channel},headers:this.headers,jwt:(a=n==null?void 0:n.session)===null||a===void 0?void 0:a.access_token})})}catch(r){if(se(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(s){const{data:r,error:a}=await this._challenge({factorId:s.factorId});return a?{data:null,error:a}:await this._verify({factorId:s.factorId,challengeId:r.id,code:s.code})}async _listFactors(){const{data:{user:s},error:r}=await this.getUser();if(r)return{data:null,error:r};const a=(s==null?void 0:s.factors)||[],n=a.filter(l=>l.factor_type==="totp"&&l.status==="verified"),i=a.filter(l=>l.factor_type==="phone"&&l.status==="verified");return{data:{all:a,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async s=>{var r,a;const{data:{session:n},error:i}=s;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=xo(n.access_token);let o=null;l.aal&&(o=l.aal);let c=o;((a=(r=n.user.factors)===null||r===void 0?void 0:r.filter(u=>u.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(c="aal2");const m=l.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:m},error:null}}))}async fetchJwk(s,r={keys:[]}){let a=r.keys.find(o=>o.kid===s);if(a)return a;const n=Date.now();if(a=this.jwks.keys.find(o=>o.kid===s),a&&this.jwks_cached_at+fv>n)return a;const{data:i,error:l}=await ce(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(l)throw l;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=n,a=i.keys.find(o=>o.kid===s),!a)?null:a}async getClaims(s,r={}){try{let a=s;if(!a){const{data:f,error:g}=await this.getSession();if(g||!f.session)return{data:null,error:g};a=f.session.access_token}const{header:n,payload:i,signature:l,raw:{header:o,payload:c}}=xo(a);r!=null&&r.allowExpired||Uv(i.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!d){const{error:f}=await this.getUser(a);if(f)throw f;return{data:{claims:i,header:n,signature:l},error:null}}const m=qv(n.alg),u=await crypto.subtle.importKey("jwk",d,m,!0,["verify"]);if(!await crypto.subtle.verify(m,u,l,Sv(`${o}.${c}`)))throw new _c("Invalid JWT signature");return{data:{claims:i,header:n,signature:l},error:null}}catch(a){if(se(a))return{data:null,error:a};throw a}}}yn.nextInstanceID=0;const rj=yn;class aj extends rj{constructor(s){super(s)}}var nj=function(t,s,r,a){function n(i){return i instanceof r?i:new r(function(l){l(i)})}return new(r||(r=Promise))(function(i,l){function o(m){try{d(a.next(m))}catch(u){l(u)}}function c(m){try{d(a.throw(m))}catch(u){l(u)}}function d(m){m.done?i(m.value):n(m.value).then(o,c)}d((a=a.apply(t,s||[])).next())})};class ij{constructor(s,r,a){var n,i,l;this.supabaseUrl=s,this.supabaseKey=r;const o=uv(s);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const c=`sb-${o.hostname.split(".")[0]}-auth-token`,d={db:tv,realtime:rv,auth:Object.assign(Object.assign({},sv),{storageKey:c}),global:ev},m=dv(a??{},d);this.storageKey=(n=m.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=m.global.headers)!==null&&i!==void 0?i:{},m.accessToken?(this.accessToken=m.accessToken,this.auth=new Proxy({},{get:(u,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((l=m.auth)!==null&&l!==void 0?l:{},this.headers,m.global.fetch),this.fetch=lv(r,this._getAccessToken.bind(this),m.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},m.realtime)),this.rest=new jb(new URL("rest/v1",o).href,{headers:this.headers,schema:m.db.schema,fetch:this.fetch}),this.storage=new Qb(this.storageUrl.href,this.headers,this.fetch,a==null?void 0:a.storage),m.accessToken||this._listenForAuthEvents()}get functions(){return new Zy(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(s){return this.rest.from(s)}schema(s){return this.rest.schema(s)}rpc(s,r={},a={}){return this.rest.rpc(s,r,a)}channel(s,r={config:{}}){return this.realtime.channel(s,r)}getChannels(){return this.realtime.getChannels()}removeChannel(s){return this.realtime.removeChannel(s)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var s,r;return nj(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:a}=yield this.auth.getSession();return(r=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:s,persistSession:r,detectSessionInUrl:a,storage:n,userStorage:i,storageKey:l,flowType:o,lock:c,debug:d},m,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new aj({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),m),storageKey:l,autoRefreshToken:s,persistSession:r,detectSessionInUrl:a,storage:n,userStorage:i,flowType:o,lock:c,debug:d,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(s){return new Ob(this.realtimeUrl.href,Object.assign(Object.assign({},s),{params:Object.assign({apikey:this.supabaseKey},s==null?void 0:s.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,a)=>{this._handleTokenChanged(r,"CLIENT",a==null?void 0:a.access_token)})}_handleTokenChanged(s,r,a){(s==="TOKEN_REFRESHED"||s==="SIGNED_IN")&&this.changedAccessToken!==a?this.changedAccessToken=a:s==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const lj=(t,s,r)=>new ij(t,s,r);function oj(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const s=t.match(/^v(\d+)\./);return s?parseInt(s[1],10)<=18:!1}oj()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const cj="https://uqofmsreosfjflmgurzb.supabase.co",dj="YOUR_SUPABASE_ANON_KEY",_=lj(cj,dj,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),Rg=x.createContext(void 0);function uj({children:t}){const[s,r]=x.useState(null),[a,n]=x.useState(null),[i,l]=x.useState(null),[o,c]=x.useState(!0);x.useEffect(()=>{_.auth.getSession().then(({data:{session:C}})=>{l(C),r((C==null?void 0:C.user)??null),C!=null&&C.user?d(C.user.id):c(!1)});const{data:{subscription:E}}=_.auth.onAuthStateChange(async(C,R)=>{l(R),r((R==null?void 0:R.user)??null),R!=null&&R.user?d(R.user.id):(n(null),c(!1))});return()=>E.unsubscribe()},[]);const d=async E=>{try{const{data:C,error:R}=await _.from("profiles").select("*").eq("id",E).maybeSingle();if(R)throw R;n(C)}catch(C){console.error("Error loading profile:",C)}finally{c(!1)}},m=async(E,C,R,T)=>{try{const{data:M,error:I}=await _.auth.signUp({email:E,password:C});if(I)return{error:I};if(!M.user)return{error:new pn("User creation failed")};const{error:D}=await _.from("profiles").insert([{id:M.user.id,email:M.user.email,full_name:R,phone:T}]);return D&&console.error("Error creating profile:",D),{error:null}}catch(M){return{error:M}}},u=async(E,C)=>{const{error:R}=await _.auth.signInWithPassword({email:E,password:C});return{error:R}},h=async()=>{const{error:E}=await _.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});return{error:E}},f=async()=>{const{error:E}=await _.auth.signInWithOAuth({provider:"facebook",options:{redirectTo:`${window.location.origin}/`}});return{error:E}},g=async(E,C=!1)=>{try{if(C){const{error:R}=await _.auth.signInWithOtp({phone:E});return{error:R}}else{const{error:R}=await _.auth.signInWithOtp({email:E,options:{shouldCreateUser:!1}});return{error:R}}}catch(R){return{error:R}}},j=async(E,C,R=!1)=>{try{if(R){const{error:T}=await _.auth.verifyOtp({phone:E,token:C,type:"sms"});return{error:T}}else{const{error:T}=await _.auth.verifyOtp({email:E,token:C,type:"email"});return{error:T}}}catch(T){return{error:T}}},w=async()=>{const{error:E}=await _.auth.signOut();return{error:E}},v=async E=>{const{error:C}=await _.auth.resetPasswordForEmail(E,{redirectTo:`${window.location.origin}/reset-password`});return{error:C}},p=async E=>{if(!s)return{error:new Error("Not authenticated")};try{const{error:C}=await _.from("profiles").update(E).eq("id",s.id);if(C)throw C;return n(R=>R?{...R,...E}:null),{error:null}}catch(C){return{error:C}}},y=async()=>{if(!(s!=null&&s.email))return{error:new pn("No email address")};const{error:E}=await _.auth.resend({type:"signup",email:s.email});return{error:E}},b=!!(s!=null&&s.email_confirmed_at),N=(a==null?void 0:a.is_admin)===!0,k={user:s,profile:a,session:i,loading:o,isEmailVerified:b,isAdmin:N,signUp:m,signIn:u,signInWithGoogle:h,signInWithFacebook:f,signInWithOTP:g,verifyOTP:j,signOut:w,resetPassword:v,updateProfile:p,resendVerificationEmail:y};return e.jsx(Rg.Provider,{value:k,children:t})}function X(){const t=x.useContext(Rg);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t}const mj=x.createContext(void 0);function hj({children:t}){const{user:s}=X(),[r,a]=x.useState([]),[n,i]=x.useState(0),[l,o]=x.useState(null),[c,d]=x.useState(null),[m,u]=x.useState(null),h=async()=>{if(s)try{const{data:j,error:w}=await _.from("notifications").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(50);if(w)throw w;a(j||[]),i((j==null?void 0:j.filter(v=>!v.is_read).length)||0)}catch(j){console.error("Error loading notifications:",j)}},f=async j=>{try{const{error:w}=await _.from("notifications").update({is_read:!0}).eq("id",j);if(w)throw w;a(v=>v.map(p=>p.id===j?{...p,is_read:!0}:p)),i(v=>Math.max(0,v-1))}catch(w){console.error("Error marking notification as read:",w)}},g=async()=>{if(s)try{const{error:j}=await _.from("notifications").update({is_read:!0}).eq("user_id",s.id).eq("is_read",!1);if(j)throw j;a(w=>w.map(v=>({...v,is_read:!0}))),i(0)}catch(j){console.error("Error marking all as read:",j)}};return x.useEffect(()=>{if(!s){l&&(_.removeChannel(l),o(null)),c&&(_.removeChannel(c),d(null)),m&&(_.removeChannel(m),u(null)),a([]),i(0);return}h();const j=_.channel("notifications-channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${s.id}`},p=>{const y=p.new;a(b=>[y,...b]),i(b=>b+1)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:`user_id=eq.${s.id}`},p=>{const y=p.new;a(b=>b.map(N=>N.id===y.id?y:N)),y.is_read&&i(b=>Math.max(0,b-1))}).subscribe(),w=_.channel("bookings-channel").on("postgres_changes",{event:"*",schema:"public",table:"ride_bookings"},()=>{window.dispatchEvent(new CustomEvent("booking-update"))}).subscribe(),v=_.channel("messages-channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`recipient_id=eq.${s.id}`},()=>{window.dispatchEvent(new CustomEvent("message-received"))}).subscribe();return o(j),d(w),u(v),()=>{j&&_.removeChannel(j),w&&_.removeChannel(w),v&&_.removeChannel(v)}},[s]),e.jsx(mj.Provider,{value:{unreadNotifications:n,notifications:r,markAsRead:f,markAllAsRead:g,refreshNotifications:h},children:t})}/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var xj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gj=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),G=(t,s)=>{const r=x.forwardRef(({color:a="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:o="",children:c,...d},m)=>x.createElement("svg",{ref:m,...xj,width:n,height:n,stroke:a,strokeWidth:l?Number(i)*24/Number(n):i,className:["lucide",`lucide-${gj(t)}`,o].join(" "),...d},[...s.map(([u,h])=>x.createElement(u,h)),...Array.isArray(c)?c:[c]]));return r.displayName=`${t}`,r};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fj=G("Accessibility",[["circle",{cx:"16",cy:"4",r:"1",key:"1grugj"}],["path",{d:"m18 19 1-7-6 1",key:"r0i19z"}],["path",{d:"m5 8 3-3 5.5 3-2.36 3.5",key:"9ptxx2"}],["path",{d:"M4.24 14.5a5 5 0 0 0 6.88 6",key:"10kmtu"}],["path",{d:"M13.76 17.5a5 5 0 0 0-6.88-6",key:"2qq6rc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=G("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=G("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=G("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=G("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ji=G("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=G("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pg=G("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=G("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pj=G("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yj=G("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ad=G("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const po=G("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=G("Bug",[["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M9 7.13v-1a3.003 3.003 0 1 1 6 0v1",key:"d7y7pr"}],["path",{d:"M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6",key:"xs1cw7"}],["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M6.53 9C4.6 8.8 3 7.1 3 5",key:"32zzws"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"M3 21c0-2.1 1.7-3.9 3.8-4",key:"4p0ekp"}],["path",{d:"M20.97 5c0 2.1-1.6 3.8-3.5 4",key:"18gb23"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M17.2 17c2.1.1 3.8 1.9 3.8 4",key:"k3fwyw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=G("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=G("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=G("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=G("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=G("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=G("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=G("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wi=G("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bj=G("Cigarette",[["path",{d:"M18 12H2v4h16",key:"2rt1hm"}],["path",{d:"M22 12v4",key:"142cbu"}],["path",{d:"M7 12v4",key:"jqww69"}],["path",{d:"M18 8c0-2.5-2-2.5-2-5",key:"1il607"}],["path",{d:"M22 8c0-2.5-2-2.5-2-5",key:"1gah44"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vj=G("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=G("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=G("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tg=G("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dd=G("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=G("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jj=G("Dog",[["path",{d:"M10 5.172C10 3.782 8.423 2.679 6.5 3c-2.823.47-4.113 6.006-4 7 .08.703 1.725 1.722 3.656 1 1.261-.472 1.96-1.45 2.344-2.5",key:"19br0u"}],["path",{d:"M14.267 5.172c0-1.39 1.577-2.493 3.5-2.172 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.855-1.45-2.239-2.5",key:"11n1an"}],["path",{d:"M8 14v.5",key:"1nzgdb"}],["path",{d:"M16 14v.5",key:"1lajdz"}],["path",{d:"M11.25 16.25h1.5L12 17l-.75-.75Z",key:"12kq1m"}],["path",{d:"M4.42 11.247A13.152 13.152 0 0 0 4 14.556C4 18.728 7.582 21 12 21s8-2.272 8-6.444c0-1.061-.162-2.2-.493-3.309m-9.243-6.082A8.801 8.801 0 0 1 12 5c.78 0 1.5.108 2.161.306",key:"wsu29d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const va=G("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=G("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ag=G("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Id=G("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=G("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=G("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=G("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=G("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kc=G("Fingerprint",[["path",{d:"M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4",key:"1jc9o5"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12c0-.7.12-1.37.34-2",key:"1mxgy1"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2c0 .47 0 1.17-.02 2",key:"1fgabc"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=G("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wj=G("Flower2",[["path",{d:"M12 5a3 3 0 1 1 3 3m-3-3a3 3 0 1 0-3 3m3-3v1M9 8a3 3 0 1 0 3 3M9 8h1m5 0a3 3 0 1 1-3 3m3-3h-1m-2 3v-1",key:"3pnvol"}],["circle",{cx:"12",cy:"8",r:"2",key:"1822b1"}],["path",{d:"M12 10v12",key:"6ubwww"}],["path",{d:"M12 22c4.2 0 7-1.667 7-5-4.2 0-7 1.667-7 5Z",key:"9hd38g"}],["path",{d:"M12 22c-4.2 0-7-1.667-7-5 4.2 0 7 1.667 7 5Z",key:"ufn41s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=G("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nj=G("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _j=G("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $g=G("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Md=G("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=G("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kj=G("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ig=G("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=G("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=G("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sj=G("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=G("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=G("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cj=G("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=G("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=G("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=G("Medal",[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=G("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=G("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ej=G("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=G("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=G("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=G("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rj=G("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=G("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pj=G("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fd=G("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tj=G("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=G("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=G("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const si=G("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aj=G("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=G("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=G("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tl=G("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Og=G("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fg=G("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dj=G("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=G("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=G("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=G("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=G("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $j=G("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=G("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ug=G("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=G("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=G("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ca=G("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=G("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=G("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ij=G("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=G("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bd=G("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=G("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=G("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=G("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lj=G("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=G("Wind",[["path",{d:"M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2",key:"1k4u03"}],["path",{d:"M9.6 4.6A2 2 0 1 1 11 8H2",key:"b7d0fd"}],["path",{d:"M12.6 19.4A2 2 0 1 0 14 16H2",key:"1p5cb3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=G("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=G("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=G("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function Dn({children:t}){return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 auth-bg overflow-hidden relative",children:[e.jsx("style",{children:`
        @keyframes float {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          33% { transform: translate(30px, -30px) rotate(120deg); }
          66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        @keyframes float-delayed {
          0%, 100% { transform: translate(0, 0) rotate(0deg); }
          33% { transform: translate(-30px, 30px) rotate(-120deg); }
          66% { transform: translate(20px, -20px) rotate(-240deg); }
        }

        @keyframes gradient-shift {
          0%, 100% { opacity: 0.8; }
          50% { opacity: 1; }
        }

        @keyframes pulse-glow {
          0%, 100% { opacity: 0.5; filter: blur(60px); }
          50% { opacity: 0.8; filter: blur(80px); }
        }

        .auth-bg {
          background: linear-gradient(135deg, #E53E3E 0%, #F56565 25%, #FC8181 50%, #F97316 75%, #FFA500 100%);
          background-size: 400% 400%;
          animation: gradient-flow 15s ease infinite;
        }

        @keyframes gradient-flow {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }

        .auth-bg::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(248,250,255,0.98) 100%);
          z-index: 1;
        }

        .floating-shape {
          position: absolute;
          border-radius: 50%;
          filter: blur(60px);
          opacity: 0.6;
          z-index: 2;
        }

        .shape-1 {
          width: 500px;
          height: 500px;
          background: linear-gradient(135deg, rgba(229, 62, 62, 0.3), rgba(245, 101, 101, 0.2));
          top: -250px;
          left: -250px;
          animation: float 20s ease-in-out infinite;
        }

        .shape-2 {
          width: 400px;
          height: 400px;
          background: linear-gradient(135deg, rgba(252, 129, 129, 0.3), rgba(255, 107, 107, 0.2));
          bottom: -200px;
          right: -200px;
          animation: float-delayed 25s ease-in-out infinite;
        }

        .shape-3 {
          width: 350px;
          height: 350px;
          background: linear-gradient(135deg, rgba(249, 115, 22, 0.25), rgba(251, 146, 60, 0.2));
          top: 50%;
          right: -150px;
          animation: float 22s ease-in-out infinite 5s;
        }

        .shape-4 {
          width: 300px;
          height: 300px;
          background: linear-gradient(135deg, rgba(245, 101, 101, 0.2), rgba(252, 129, 129, 0.15));
          bottom: 20%;
          left: -100px;
          animation: float-delayed 18s ease-in-out infinite 3s;
        }

        .auth-content {
          position: relative;
          z-index: 10;
        }
      `}),e.jsx("div",{className:"floating-shape shape-1"}),e.jsx("div",{className:"floating-shape shape-2"}),e.jsx("div",{className:"floating-shape shape-3"}),e.jsx("div",{className:"floating-shape shape-4"}),e.jsx("div",{className:"auth-content",children:t})]})}function zd({size:t="md",showText:s=!0,className:r="",clickable:a=!0}){const n={sm:"w-10 h-10",md:"w-14 h-14",lg:"w-16 h-16"},i={sm:"w-5 h-5",md:"w-7 h-7",lg:"w-8 h-8"},l={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-4 h-4"},o={sm:"text-base",md:"text-xl",lg:"text-2xl"},c=e.jsxs("div",{className:`flex items-center gap-3 ${r}`,children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:`${n[t]} bg-gradient-to-br from-red-500 via-red-600 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg transform hover:scale-105 transition-transform duration-200`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent rounded-2xl"}),e.jsxs("div",{className:"relative",children:[e.jsx(pe,{className:`${i[t]} text-white drop-shadow-md`,strokeWidth:2.5}),e.jsx(re,{className:`${l[t]} text-white absolute -bottom-1 -right-1 bg-orange-500 rounded-full p-0.5`,strokeWidth:3})]})]})}),s&&e.jsxs("div",{children:[e.jsx("span",{className:`${o[t]} font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent`,children:"Carpool Network"}),e.jsx("p",{className:"text-xs font-medium text-orange-600 -mt-1",children:"Community Carpooling"})]})]});return a?e.jsx(Ie,{to:"/",className:"cursor-pointer",children:c}):c}const Pm={"/signin":[{text:"Sharing rides can reduce the number of cars on the road during peak hours."},{text:"Carpooling helps lower fuel use per person compared to driving alone."},{text:"Fewer cars can mean smoother commutes and less time spent in traffic."},{text:"Sharing a ride can reduce parking demand around busy areas."},{text:"Splitting a trip can make commuting more affordable."},{text:"Fewer vehicles can help reduce local air pollution in city centres."},{text:"Carpooling uses existing seats more efficiently."},{text:"A shared commute can feel less stressful when planned well."},{text:"Regular carpooling can help build community connections."},{text:"Ride-sharing can complement public transport for the last mile."}],"/signup":[{text:"Joining a carpool network connects you with local commuters."},{text:"New members help create more ride-sharing opportunities."},{text:"Carpooling can save you money on fuel and parking costs."},{text:"Shared rides mean fewer cars clogging up the roads."},{text:"By carpooling, you contribute to cleaner air in your community."},{text:"Ride-sharing helps reduce the environmental impact of daily commutes."},{text:"Carpooling can turn your commute into productive or social time."},{text:"Fewer solo drivers means less traffic congestion for everyone."},{text:"Sharing rides can make commuting more enjoyable and less isolating."},{text:"Carpooling networks thrive when more people participate."}],"/forgot-password":[{text:"Carpooling helps reduce carbon emissions per traveler."},{text:"Shared rides can make your daily commute more affordable."},{text:"Fewer cars on the road means less wear on infrastructure."},{text:"Carpooling can reduce the need for additional parking spaces."},{text:"Ride-sharing helps connect areas with limited public transport."},{text:"Choosing to share a ride is a simple habit that can reduce overall emissions."},{text:"Carpooling can help you meet neighbors and build community."},{text:"Shared commutes can reduce stress compared to driving alone in traffic."},{text:"Fewer vehicles means quieter, more pleasant neighborhoods."},{text:"Carpooling makes better use of vehicles that would otherwise travel empty."}],"/reset-password":[{text:"Carpooling can significantly lower your transportation costs."},{text:"Shared rides help reduce traffic congestion in urban areas."},{text:"Fewer cars means better air quality for everyone."},{text:"Ride-sharing can make commuting more social and enjoyable."},{text:"Carpooling helps maximize the efficiency of existing vehicles."},{text:"Sharing rides can reduce the environmental footprint of travel."},{text:"Fewer solo drivers means less demand for parking infrastructure."},{text:"Carpooling can turn wasted commute time into productive time."},{text:"Shared rides help support sustainable urban mobility."},{text:"Choosing to carpool is a practical way to reduce emissions."}],"/verify-otp":[{text:"Every shared ride helps reduce traffic congestion."},{text:"Carpooling makes your commute more cost-effective."},{text:"Fewer cars on the road means cleaner air for your community."},{text:"Shared rides can make your daily commute less stressful."},{text:"Carpooling helps reduce the carbon footprint of travel."},{text:"Ride-sharing connects people and builds community ties."},{text:"Fewer vehicles means less noise pollution in neighborhoods."},{text:"Carpooling helps make better use of existing road capacity."},{text:"Shared commutes can reduce the need for expensive parking."},{text:"Choosing to carpool contributes to a more sustainable future."}]};function Mj(t){return Pm[t]||Pm["/signin"]}function Oj({route:t,autoRotate:s=!0,rotationInterval:r=1e4}){const a=Mj(t),[n,i]=x.useState(0),[l,o]=x.useState(!0),[c,d]=x.useState([]),m=()=>{const f=a.map((g,j)=>j).filter(g=>!c.includes(g));return f.length===0?(d([]),Math.floor(Math.random()*a.length)):f[Math.floor(Math.random()*f.length)]},u=()=>{o(!1),setTimeout(()=>{const f=m();i(f),d(g=>[...g,f]),o(!0)},200)};x.useEffect(()=>{if(!s)return;const f=setInterval(()=>{u()},r);return()=>clearInterval(f)},[s,r,c]);const h=a[n];return e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx("div",{className:`transition-opacity duration-200 ${l?"opacity-100":"opacity-0"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(Sj,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Did you know?"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-blue-600 transition-colors","aria-label":"Show another fact",children:e.jsx(Oe,{className:"w-3.5 h-3.5"})})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:h.text}),h.sourceUrl&&e.jsxs("a",{href:h.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-2 text-xs text-blue-600 hover:text-blue-700 transition-colors",children:[e.jsx("span",{children:h.sourceLabel||"Source"}),e.jsx(Id,{className:"w-3 h-3"}),h.publishedDate&&e.jsxs("span",{className:"text-gray-500",children:["(",h.publishedDate,")"]})]})]})]})})})}function $n({title:t,subtitle:s,children:r,showImpactFacts:a=!0,impactFactsRoute:n="/signin"}){return e.jsxs("div",{className:"w-full max-w-md animate-fade-in-up",children:[e.jsx("style",{children:`
        @keyframes fade-in-up {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .animate-fade-in-up {
          animation: fade-in-up 0.6s ease-out;
        }

        .glass-card {
          background: rgba(255, 255, 255, 0.85);
          backdrop-filter: blur(20px);
          -webkit-backdrop-filter: blur(20px);
          border: 1px solid rgba(255, 255, 255, 0.3);
          box-shadow:
            0 8px 32px 0 rgba(31, 38, 135, 0.15),
            0 0 0 1px rgba(255, 255, 255, 0.5) inset;
        }

        .glass-card:hover {
          box-shadow:
            0 12px 48px 0 rgba(31, 38, 135, 0.2),
            0 0 0 1px rgba(255, 255, 255, 0.6) inset;
          transition: all 0.3s ease;
        }

        .logo-glow {
          filter: drop-shadow(0 4px 12px rgba(229, 62, 62, 0.3));
          animation: logo-pulse 3s ease-in-out infinite;
        }

        @keyframes logo-pulse {
          0%, 100% {
            filter: drop-shadow(0 4px 12px rgba(229, 62, 62, 0.3));
          }
          50% {
            filter: drop-shadow(0 6px 20px rgba(229, 62, 62, 0.5));
          }
        }

        .title-gradient {
          background: linear-gradient(135deg, #E53E3E 0%, #F56565 50%, #F97316 100%);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
      `}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center mb-6 logo-glow",children:e.jsx(zd,{size:"lg",showText:!1})}),e.jsx("h1",{className:"text-4xl font-bold mb-2 title-gradient",children:t}),s&&e.jsx("p",{className:"text-gray-600 text-lg font-medium",children:s})]}),e.jsxs("div",{className:"glass-card rounded-3xl p-8 transition-all duration-300",children:[r,a&&e.jsx(Oj,{route:n})]})]})}function da(){return typeof window<"u"&&window.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}function Cc(t){const s=t.replace(/-/g,"+").replace(/_/g,"/"),r=s.padEnd(s.length+(4-s.length%4)%4,"="),a=atob(r),n=new Uint8Array(a.length);for(let i=0;i<a.length;i++)n[i]=a.charCodeAt(i);return n.buffer}function zr(t){const s=new Uint8Array(t);let r="";for(let a=0;a<s.length;a++)r+=String.fromCharCode(s[a]);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function qg(t){var f;if(!da())throw new Error("Passkeys are not supported in this browser");const{data:{session:s},error:r}=await _.auth.getSession();if(r||!s)throw new Error("You must be signed in to register a passkey");const n=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/passkey-register/start",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({deviceName:t})});if(!n.ok){const g=await n.json();throw new Error(g.error||"Failed to start passkey registration")}const i=await n.json(),l={challenge:Cc(i.challenge),rp:i.rp,user:{id:Cc(i.user.id),name:i.user.name,displayName:i.user.displayName},pubKeyCredParams:i.pubKeyCredParams,timeout:i.timeout,attestation:i.attestation,authenticatorSelection:i.authenticatorSelection},o=await navigator.credentials.create({publicKey:l});if(!o)throw new Error("Failed to create passkey credential");const c=o.response,d=c.getPublicKey(),m=d?zr(d):"",h=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/passkey-register/complete",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({challenge:i.challenge,credentialId:zr(o.rawId),publicKey:m,transports:((f=c.getTransports)==null?void 0:f.call(c))||[],deviceName:t})});if(!h.ok){const g=await h.json();throw new Error(g.error||"Failed to complete passkey registration")}}async function Fj(){if(!da())throw new Error("Passkeys are not supported in this browser");const s=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/passkey-authenticate/start",{method:"POST",headers:{"Content-Type":"application/json",Apikey:"YOUR_SUPABASE_ANON_KEY"},body:JSON.stringify({})});if(!s.ok){const c=await s.json();throw new Error(c.error||"Failed to start passkey authentication")}const r=await s.json(),a={challenge:Cc(r.challenge),timeout:r.timeout,rpId:r.rpId,userVerification:r.userVerification},n=await navigator.credentials.get({publicKey:a});if(!n)throw new Error("Failed to get passkey credential");const i=n.response,o=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/passkey-authenticate/complete",{method:"POST",headers:{"Content-Type":"application/json",Apikey:"YOUR_SUPABASE_ANON_KEY"},body:JSON.stringify({challenge:r.challenge,credentialId:zr(n.rawId),signature:zr(i.signature),authenticatorData:zr(i.authenticatorData),clientDataJSON:zr(i.clientDataJSON)})});if(!o.ok){const c=await o.json();throw new Error(c.error||"Failed to complete passkey authentication")}throw await o.json(),new Error("Passkey authentication successful, but session creation is not yet implemented. Please use password or OTP authentication for now.")}async function Bg(){const{data:t,error:s}=await _.from("passkey_credentials").select("id, device_name, created_at, last_used_at").order("created_at",{ascending:!1});if(s)throw s;return t||[]}async function zg(t){const{error:s}=await _.from("passkey_credentials").delete().eq("id",t);if(s)throw s}const Uj=Object.freeze(Object.defineProperty({__proto__:null,authenticateWithPasskey:Fj,deletePasskey:zg,getPasskeys:Bg,isPasskeySupported:da,registerPasskey:qg},Symbol.toStringTag,{value:"Module"}));function qj({onPasskeyLogin:t,disabled:s=!1}){const[r,a]=x.useState(!1),[n,i]=x.useState(!1);x.useEffect(()=>{i(da())},[]);const l=async()=>{a(!0);try{await t()}finally{a(!1)}};return n?e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{type:"button",onClick:l,disabled:s||r,className:"w-full bg-gradient-to-r from-red-600 to-red-700 text-white py-3.5 rounded-xl font-semibold hover:from-red-700 hover:to-red-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 shadow-lg shadow-red-500/20",children:r?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Authenticating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(kc,{className:"w-5 h-5"}),"Sign in with Passkey"]})}),e.jsx("p",{className:"text-xs text-center text-gray-500",children:"Fast and secure. No password needed."})]}):null}function Vg({onGoogleSignIn:t,onFacebookSignIn:s,disabled:r=!1}){const[a,n]=x.useState(!1),[i,l]=x.useState(!1),o=async()=>{n(!0);try{await t()}finally{n(!1)}},c=async()=>{l(!0);try{await s()}finally{l(!1)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{type:"button",onClick:o,disabled:r||a||i,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-white border-2 border-gray-200 rounded-xl hover:border-red-300 hover:bg-red-50 hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed font-semibold text-gray-700 group",children:[a?e.jsx(at,{className:"w-5 h-5 animate-spin text-red-600"}):e.jsxs("svg",{className:"w-5 h-5 group-hover:scale-110 transition-transform",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"group-hover:text-red-700 transition-colors",children:"Continue with Google"})]}),e.jsxs("button",{type:"button",onClick:c,disabled:r||a||i,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-white border-2 border-gray-200 rounded-xl hover:border-red-400 hover:bg-red-50 hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed font-semibold text-gray-700 group",children:[i?e.jsx(at,{className:"w-5 h-5 animate-spin text-red-600"}):e.jsx("svg",{className:"w-5 h-5 group-hover:scale-110 transition-transform",viewBox:"0 0 24 24",fill:"#1877F2",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),e.jsx("span",{className:"group-hover:text-red-700 transition-colors",children:"Continue with Facebook"})]})]})}function Bj({onSubmit:t,disabled:s=!1}){const[r,a]=x.useState(""),[n,i]=x.useState(""),[l,o]=x.useState(!1),[c,d]=x.useState(!1),m=async u=>{if(u.preventDefault(),!(!r.trim()||!n.trim())){d(!0);try{await t(r,n)}finally{d(!1)}}};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identifier",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email or Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"identifier",type:"text",value:r,onChange:u=>a(u.target.value),placeholder:"Email or phone",required:!0,autoComplete:"username",disabled:s||c,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all hover:border-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"password",type:l?"text":"password",value:n,onChange:u=>i(u.target.value),placeholder:"Enter your password",required:!0,autoComplete:"current-password",disabled:s||c,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all hover:border-gray-400"}),e.jsx("button",{type:"button",onClick:()=>o(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",disabled:s||c,children:l?e.jsx(vn,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]})]}),e.jsx("button",{type:"submit",disabled:s||c||!r.trim()||!n.trim(),className:"w-full bg-gradient-to-r from-red-600 to-orange-500 text-white py-3 rounded-xl font-semibold hover:from-red-700 hover:to-orange-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-red-500/30 hover:shadow-xl hover:shadow-red-500/40",children:c?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Signing in..."]}):"Sign In"})]})}function zj({onSendOTP:t,disabled:s=!1}){const[r,a]=x.useState(""),[n,i]=x.useState(!1),[l,o]=x.useState(0),c=r.trim().startsWith("+")||/^\d+$/.test(r.trim()),d=async m=>{if(m.preventDefault(),!(!r.trim()||l>0)){i(!0);try{await t(r,c),o(30);const u=setInterval(()=>{o(h=>h<=1?(clearInterval(u),0):h-1)},1e3)}finally{i(!1)}}};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"identifier",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email or Phone Number"}),e.jsxs("div",{className:"relative",children:[c?e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}):e.jsx(Jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"identifier",type:"text",value:r,onChange:m=>a(m.target.value),placeholder:"Email or phone",required:!0,disabled:s||n||l>0,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]}),e.jsx("p",{className:"mt-1.5 text-xs text-gray-500",children:c?"Include country code (e.g., +44 7700 900000)":"We'll send a one-time code to your email"})]}),l>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-2.5 rounded-lg text-sm",children:["Please wait ",l," seconds before requesting another code."]}),e.jsx("button",{type:"submit",disabled:s||n||!r.trim()||l>0,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Sending code..."]}):"Send Code"})]})}function Vj(){const t=ie(),[s,r]=x.useState("password"),[a,n]=x.useState(""),{signIn:i,signInWithGoogle:l,signInWithFacebook:o,signInWithOTP:c}=X(),d=async()=>{n("");try{const{authenticateWithPasskey:g}=await pa(async()=>{const{authenticateWithPasskey:j}=await Promise.resolve().then(()=>Uj);return{authenticateWithPasskey:j}},void 0);await g(),t("/")}catch(g){n(g.message||"Passkey authentication failed. Please try another method.")}},m=async()=>{n("");try{const{error:g}=await l();g&&n(g.message)}catch{n("An unexpected error occurred")}},u=async()=>{n("");try{const{error:g}=await o();g&&n(g.message)}catch{n("An unexpected error occurred")}},h=async(g,j)=>{n("");try{if(!g.includes("@")){n("Please use your email address for password login, or switch to OTP for phone login.");return}const{error:v}=await i(g,j);v?v.message.includes("Email not confirmed")?n("Please verify your email before signing in. Check your inbox for the verification link."):n(v.message):t("/")}catch{n("An unexpected error occurred")}},f=async(g,j)=>{n("");try{const{error:w}=await c(g,j);w?n(w.message):t("/verify-otp",{state:{identifier:g,type:j?"phone":"email",isSignup:!1}})}catch{n("An unexpected error occurred")}};return e.jsx(Dn,{children:e.jsxs($n,{title:"Welcome Back",subtitle:"Sign in to continue carpooling",impactFactsRoute:"/signin",children:[a&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl flex items-start gap-3 animate-shake shadow-lg shadow-red-100",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 text-sm font-medium",children:a})]}),e.jsx("style",{children:`
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
          }

          .animate-shake {
            animation: shake 0.4s ease-in-out;
          }
        `}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(qj,{onPasskeyLogin:d}),e.jsxs("div",{className:"relative my-8",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-400 font-medium",children:"or"})})]}),e.jsx(Vg,{onGoogleSignIn:m,onFacebookSignIn:u}),e.jsxs("div",{className:"relative my-8",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-400 font-medium",children:"or continue with"})})]}),s==="password"?e.jsxs(e.Fragment,{children:[e.jsx(Bj,{onSubmit:h}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-sm",children:[e.jsx(Ie,{to:"/forgot-password",className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Forgot password?"}),e.jsx("button",{onClick:()=>r("otp"),className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Use a one-time code instead"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 text-sm text-gray-600 text-center bg-blue-50 border border-blue-100 rounded-xl p-3",children:e.jsx("span",{className:"font-medium",children:" We'll send a one-time code to your email or phone."})}),e.jsx(zj,{onSendOTP:f}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx("button",{onClick:()=>r("password"),className:"text-blue-600 hover:text-blue-700 font-medium transition-colors",children:"Use password instead"})})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 text-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Don't have an account? "}),e.jsx(Ie,{to:"/signup",className:"text-blue-600 hover:text-blue-700 font-semibold hover:underline transition-all",children:"Sign up"})]})]})})}const Wj="https://uqofmsreosfjflmgurzb.supabase.co",Hj="YOUR_SUPABASE_ANON_KEY";async function Gj(t){try{return await(await fetch(`${Wj}/functions/v1/validate-email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Hj}`},body:JSON.stringify({email:t})})).json()}catch(s){return console.error("Error validating email:",s),{valid:!1,error:"Failed to validate email. Please try again."}}}function Kj({onSubmit:t,disabled:s=!1}){const[r,a]=x.useState(""),[n,i]=x.useState(""),[l,o]=x.useState(""),[c,d]=x.useState(""),[m,u]=x.useState(""),[h,f]=x.useState(!1),[g,j]=x.useState(!1),[w,v]=x.useState(!1),[p,y]=x.useState(!1),[b,N]=x.useState(null),[k,E]=x.useState("");x.useEffect(()=>{if(!n||n.length<3){N(null),E("");return}const M=setTimeout(async()=>{y(!0),E("");const I=await Gj(n);N(I.valid),!I.valid&&I.error&&E(I.error),y(!1)},800);return()=>clearTimeout(M)},[n]);const C=async M=>{if(M.preventDefault(),!(!n.trim()||!c.trim()||!r.trim()||!l.trim())&&c===m&&!(c.length<6)){v(!0);try{await t(n,c,r,l)}finally{v(!1)}}},R=c&&m&&c===m,T=c.length>=6;return e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(kt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"fullName",type:"text",value:r,onChange:M=>a(M.target.value),placeholder:"Enter your full name",required:!0,disabled:s||w,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"email",type:"email",value:n,onChange:M=>i(M.target.value),placeholder:"Enter your email",required:!0,disabled:s||w,className:`w-full pl-10 pr-12 py-3 border rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed ${b===!1?"border-red-300 bg-red-50":b===!0?"border-green-300 bg-green-50":"border-gray-300"}`}),e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[p&&e.jsx(at,{className:"w-5 h-5 text-red-500 animate-spin"}),!p&&b===!0&&e.jsx(ee,{className:"w-5 h-5 text-green-600"}),!p&&b===!1&&e.jsx(Qe,{className:"w-5 h-5 text-red-600"})]})]}),k&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:k}),b===!0&&e.jsx("p",{className:"mt-1 text-xs text-green-600",children:" Email is valid"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"phone",type:"tel",value:l,onChange:M=>o(M.target.value),placeholder:"+44 7700 900000",required:!0,disabled:s||w,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"password",type:h?"text":"password",value:c,onChange:M=>d(M.target.value),placeholder:"Create a password",required:!0,disabled:s||w,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"}),e.jsx("button",{type:"button",onClick:()=>f(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:s||w,children:h?e.jsx(vn,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"confirmPassword",type:g?"text":"password",value:m,onChange:M=>u(M.target.value),placeholder:"Confirm your password",required:!0,disabled:s||w,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"}),e.jsx("button",{type:"button",onClick:()=>j(!g),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:s||w,children:g?e.jsx(vn,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]}),m&&e.jsx("p",{className:`mt-1 text-xs ${R?"text-green-600":"text-red-600"}`,children:R?" Passwords match":" Passwords do not match"})]}),e.jsx("button",{type:"submit",disabled:s||w||!T||!R||!r.trim()||!n.trim()||!l.trim()||p||b!==!0,className:"w-full bg-gradient-to-r from-red-600 to-orange-500 text-white py-3 rounded-xl font-semibold hover:from-red-700 hover:to-orange-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-red-500/30",children:w?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Creating account..."]}):"Create Account"})]})}function Yj(){const t=ie(),[s,r]=x.useState(""),{signUp:a,signInWithGoogle:n,signInWithFacebook:i}=X(),l=async()=>{r("");try{const{error:d}=await n();d&&r(d.message)}catch{r("An unexpected error occurred")}},o=async()=>{r("");try{const{error:d}=await i();d&&r(d.message)}catch{r("An unexpected error occurred")}},c=async(d,m,u,h)=>{r("");try{const{error:f}=await a(d,m,u,h);f?r(f.message):t("/")}catch{r("An unexpected error occurred")}};return e.jsx(Dn,{children:e.jsxs($n,{title:"Create Account",subtitle:"Join the carpooling community",impactFactsRoute:"/signup",children:[s&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl flex items-start gap-3 animate-shake shadow-lg shadow-red-100",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 text-sm font-medium",children:s})]}),e.jsx("style",{children:`
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
          }

          .animate-shake {
            animation: shake 0.4s ease-in-out;
          }
        `}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Vg,{onGoogleSignIn:l,onFacebookSignIn:o}),e.jsxs("div",{className:"relative my-8",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-4 bg-white text-gray-400 font-medium",children:"or"})})]}),e.jsx(Kj,{onSubmit:c}),e.jsxs("p",{className:"mt-6 text-xs text-center text-gray-500 bg-gray-50 border border-gray-200 rounded-xl p-3",children:["By continuing, you agree to our"," ",e.jsx(Ie,{to:"/terms",className:"text-blue-600 hover:text-blue-700 font-semibold hover:underline",children:"Terms of Service"})," ","and"," ",e.jsx(Ie,{to:"/privacy",className:"text-blue-600 hover:text-blue-700 font-semibold hover:underline",children:"Privacy Policy"})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 text-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Already have an account? "}),e.jsx(Ie,{to:"/signin",className:"text-blue-600 hover:text-blue-700 font-semibold hover:underline transition-all",children:"Sign in"})]})]})})}function Jj({identifier:t,identifierType:s,onVerify:r,onResend:a,onChangeIdentifier:n,disabled:i=!1}){const[l,o]=x.useState(["","","","","",""]),[c,d]=x.useState(!1),[m,u]=x.useState(!1),[h,f]=x.useState(0),g=x.useRef([]);x.useEffect(()=>{var N;(N=g.current[0])==null||N.focus()},[]),x.useEffect(()=>{if(h>0){const N=setTimeout(()=>f(h-1),1e3);return()=>clearTimeout(N)}},[h]);const j=(N,k)=>{var C;if(!/^\d*$/.test(k))return;const E=[...l];E[N]=k.slice(-1),o(E),k&&N<5&&((C=g.current[N+1])==null||C.focus())},w=(N,k)=>{var E;k.key==="Backspace"&&!l[N]&&N>0&&((E=g.current[N-1])==null||E.focus())},v=N=>{var C;N.preventDefault();const k=N.clipboardData.getData("text").replace(/\D/g,"").slice(0,6),E=[...l];for(let R=0;R<k.length;R++)E[R]=k[R];o(E),(C=g.current[Math.min(k.length,5)])==null||C.focus()},p=async N=>{N.preventDefault();const k=l.join("");if(k.length===6){d(!0);try{await r(k)}finally{d(!1)}}},y=async()=>{u(!0);try{await a(),f(30)}finally{u(!1)}},b=l.every(N=>N!=="");return e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Enter the 6-digit code sent to"}),e.jsx("p",{className:"font-medium text-gray-900 mt-1",children:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3 text-center",children:"Verification Code"}),e.jsx("div",{className:"flex gap-2 justify-center",children:l.map((N,k)=>e.jsx("input",{ref:E=>g.current[k]=E,type:"text",inputMode:"numeric",maxLength:1,value:N,onChange:E=>j(k,E.target.value),onKeyDown:E=>w(k,E),onPaste:v,disabled:i||c,className:"w-12 h-14 text-center text-xl font-semibold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"},k))})]}),e.jsx("button",{type:"submit",disabled:i||c||!b,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Verifying..."]}):"Verify Code"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm",children:[e.jsx("button",{type:"button",onClick:y,disabled:h>0||m,className:"text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending...":h>0?`Resend in ${h}s`:"Resend code"}),n&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"|"}),e.jsxs("button",{type:"button",onClick:n,className:"text-gray-600 hover:text-gray-700 font-medium flex items-center gap-1",children:[e.jsx(Re,{className:"w-4 h-4"}),"Change ",s]})]})]})]})}function Qj(){const t=ie(),s=Xs(),[r,a]=x.useState(""),{verifyOTP:n,signInWithOTP:i}=X(),{identifier:l,type:o,isSignup:c}=s.state||{};if(!l||!o)return e.jsx(kd,{to:"/signin",replace:!0});const d=o==="phone",m=async f=>{a("");try{const{error:g}=await n(l,f,d);g?a(g.message):t("/")}catch{a("An unexpected error occurred")}},u=async()=>{a("");try{const{error:f}=await i(l,d);f&&a(f.message)}catch{a("Failed to resend code")}},h=()=>{t(c?"/signup":"/signin")};return e.jsx(Dn,{children:e.jsxs($n,{title:"Verify Your Code",subtitle:`We sent a code to ${d?"your phone":"your email"}`,impactFactsRoute:"/verify-otp",children:[r&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1 text-sm",children:r})]}),e.jsx(Jj,{identifier:l,identifierType:d?"phone":"email",onVerify:m,onResend:u,onChangeIdentifier:h})]})})}function Xj(){const{user:t,resendVerificationEmail:s,signOut:r}=X(),[a,n]=x.useState(!1),[i,l]=x.useState(""),[o,c]=x.useState(""),d=async()=>{n(!0),l(""),c("");const{error:u}=await s();u?c("Failed to resend verification email. Please try again."):l("Verification email sent! Please check your inbox."),n(!1)},m=async()=>{await r()};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-green-50 flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsx(zd,{})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Jt,{className:"w-10 h-10 text-blue-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Verify Your Email"}),e.jsx("p",{className:"text-gray-600",children:"We've sent a verification link to:"}),e.jsx("p",{className:"text-blue-600 font-semibold mt-2",children:t==null?void 0:t.email})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Please check your email"}),e.jsx("p",{children:"Click the verification link in the email we sent you. You may need to check your spam folder."})]})]})}),i&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-green-800",children:i})]})}),o&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-red-800",children:o})]})}),e.jsxs("button",{onClick:d,disabled:a,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center justify-center gap-2 mb-4",children:[e.jsx(Oe,{className:`w-5 h-5 ${a?"animate-spin":""}`}),a?"Sending...":"Resend Verification Email"]}),e.jsx("button",{onClick:m,className:"w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-200 transition-colors",children:"Sign Out"}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Already verified?"," ",e.jsx("button",{onClick:()=>window.location.reload(),className:"text-blue-600 hover:text-blue-700 font-semibold",children:"Refresh Page"})]})})]})})}function Zj(){const[t,s]=x.useState("email"),[r,a]=x.useState(""),[n,i]=x.useState(""),[l,o]=x.useState(""),[c,d]=x.useState(!1),[m,u]=x.useState(!1),{resetPassword:h}=X(),f=async g=>{g.preventDefault(),o(""),u(!0);try{if(t==="email"){const{error:j}=await h(r);j?o(j.message):d(!0)}else o("Phone recovery is coming soon. Please use email recovery for now.")}catch{o("An unexpected error occurred")}finally{u(!1)}};return e.jsx(Dn,{children:e.jsxs($n,{title:"Reset Password",subtitle:"We'll email you a reset link",impactFactsRoute:"/forgot-password",showImpactFacts:!c,children:[l&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl flex items-start gap-3 animate-shake shadow-lg shadow-red-100",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 text-sm font-medium",children:l})]}),e.jsx("style",{children:`
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
          }

          .animate-shake {
            animation: shake 0.4s ease-in-out;
          }

          .method-tab {
            transition: all 0.3s ease;
          }

          .method-tab.active {
            background: linear-gradient(135deg, #E53E3E, #F97316);
            color: white;
            box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
          }
        `}),c?e.jsxs("div",{className:"text-center py-8 animate-fade-in",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full mb-6 shadow-lg",children:e.jsx(ee,{className:"w-10 h-10 text-green-600"})}),e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:["Check Your ",t==="email"?"Email":"Phone"]}),e.jsxs("p",{className:"text-gray-600 mb-2",children:["We've sent a password reset ",t==="email"?"link":"code"," to"]}),e.jsx("p",{className:"font-semibold text-gray-900 mb-6 text-lg",children:t==="email"?r:n}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6 text-sm text-gray-700",children:[e.jsx(me,{className:"w-5 h-5 text-red-600 mx-auto mb-2"}),e.jsx("p",{children:"For security, the link expires in 1 hour. Check your spam folder if you don't see it."})]}),e.jsxs(Ie,{to:"/signin",className:"inline-flex items-center gap-2 bg-gradient-to-r from-red-600 to-orange-500 text-white px-6 py-3 rounded-xl font-semibold hover:from-red-700 hover:to-orange-600 transition-all shadow-lg hover:shadow-xl",children:[e.jsx(Re,{className:"w-4 h-4"}),"Back to Sign In"]})]}):e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-50 to-orange-50 border border-red-200 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Secure Account Recovery"}),e.jsx("p",{children:"Choose your preferred method to reset your password securely."})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("email"),className:`method-tab flex flex-col items-center gap-2 p-4 rounded-xl border-2 ${t==="email"?"active border-transparent":"border-gray-200 hover:border-red-300 hover:bg-red-50"}`,children:[e.jsx(Jt,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-semibold",children:"Email"})]}),e.jsxs("button",{type:"button",onClick:()=>s("phone"),className:`method-tab flex flex-col items-center gap-2 p-4 rounded-xl border-2 ${t==="phone"?"active border-transparent":"border-gray-200 hover:border-red-300 hover:bg-red-50"}`,children:[e.jsx(dt,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-semibold",children:"Phone"})]})]}),t==="email"?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Jt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"email",type:"email",value:r,onChange:g=>a(g.target.value),placeholder:"Enter your email",required:!0,disabled:m,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"We'll send a secure reset link to this email"})]})}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(dt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"phone",type:"tel",value:n,onChange:g=>i(g.target.value),placeholder:"+44 7700 900000",required:!0,disabled:m,className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all"})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"We'll send a verification code via SMS"})]})}),e.jsx("button",{type:"submit",disabled:m||(t==="email"?!r.trim():!n.trim()),className:"w-full bg-gradient-to-r from-red-600 to-orange-500 text-white py-3 rounded-xl font-semibold hover:from-red-700 hover:to-orange-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-red-500/30 hover:shadow-xl",children:m?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:["Send ",t==="email"?"Reset Link":"Verification Code"]})}),e.jsx("div",{className:"text-center",children:e.jsxs(Ie,{to:"/signin",className:"inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-700 font-medium transition-all hover:underline",children:[e.jsx(Re,{className:"w-4 h-4"}),"Back to Sign In"]})})]})]})})}function ew(){const t=ie(),[s,r]=x.useState(""),[a,n]=x.useState(""),[i,l]=x.useState(!1),[o,c]=x.useState(!1),[d,m]=x.useState(""),[u,h]=x.useState(!1),[f,g]=x.useState(!1),j=x.useMemo(()=>[{label:"At least 8 characters",met:s.length>=8},{label:"Contains uppercase letter",met:/[A-Z]/.test(s)},{label:"Contains lowercase letter",met:/[a-z]/.test(s)},{label:"Contains a number",met:/[0-9]/.test(s)},{label:"Contains special character",met:/[!@#$%^&*(),.?":{}|<>]/.test(s)}],[s]),w=x.useMemo(()=>{const b=j.filter(N=>N.met).length;return b===0?{label:"",color:"",width:0}:b<=2?{label:"Weak",color:"bg-red-500",width:33}:b<=3?{label:"Fair",color:"bg-yellow-500",width:50}:b<=4?{label:"Good",color:"bg-blue-500",width:75}:{label:"Strong",color:"bg-green-500",width:100}},[j]),v=async b=>{if(b.preventDefault(),m(""),s.length<8){m("Password must be at least 8 characters");return}if(!j.every(k=>k.met)){m("Please meet all password requirements");return}if(s!==a){m("Passwords do not match");return}g(!0);try{const{error:k}=await _.auth.updateUser({password:s});k?m(k.message):(h(!0),setTimeout(()=>{t("/signin")},2500))}catch{m("An unexpected error occurred")}finally{g(!1)}},p=s&&a&&s===a,y=j.every(b=>b.met);return e.jsx(Dn,{children:e.jsxs($n,{title:"Set New Password",subtitle:"Choose a strong password",impactFactsRoute:"/reset-password",showImpactFacts:!u,children:[d&&e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-red-50 to-rose-50 border border-red-200 text-red-700 px-4 py-3 rounded-2xl flex items-start gap-3 animate-shake shadow-lg shadow-red-100",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0 mt-0.5 animate-pulse"}),e.jsx("div",{className:"flex-1 text-sm font-medium",children:d})]}),e.jsx("style",{children:`
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
          }

          .animate-shake {
            animation: shake 0.4s ease-in-out;
          }

          @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
          }

          .confetti-piece {
            animation: confetti 2s ease-out forwards;
          }
        `}),u?e.jsxs("div",{className:"text-center py-8 relative overflow-hidden",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full mb-6 shadow-lg animate-bounce",children:e.jsx(ee,{className:"w-10 h-10 text-green-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Password Updated!"}),e.jsx("p",{className:"text-gray-600 mb-2 text-lg",children:"Your password has been successfully reset."}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6 text-sm text-gray-700",children:e.jsx("p",{className:"font-semibold",children:" Your account is now secure"})}),e.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Redirecting to sign in..."})]}):e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"password",type:i?"text":"password",value:s,onChange:b=>r(b.target.value),placeholder:"Enter new password",required:!0,disabled:f,className:"w-full pl-10 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all"}),e.jsx("button",{type:"button",onClick:()=>l(!i),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:i?e.jsx(vn,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]}),s&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:`h-full ${w.color} transition-all duration-300`,style:{width:`${w.width}%`}})}),w.label&&e.jsx("span",{className:`text-xs font-semibold ${w.label==="Weak"?"text-red-600":w.label==="Fair"?"text-yellow-600":w.label==="Good"?"text-blue-600":"text-green-600"}`,children:w.label})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-3 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:"Password Requirements:"}),j.map((b,N)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[b.met?e.jsx(Pr,{className:"w-4 h-4 text-green-600 flex-shrink-0"}):e.jsx(ot,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:b.met?"text-green-700 font-medium":"text-gray-600",children:b.label})]},N))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ks,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{id:"confirmPassword",type:o?"text":"password",value:a,onChange:b=>n(b.target.value),placeholder:"Confirm new password",required:!0,disabled:f,className:`w-full pl-10 pr-12 py-3 border rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed transition-all ${a&&(p?"border-green-300 bg-green-50":"border-red-300 bg-red-50")}`}),e.jsx("button",{type:"button",onClick:()=>c(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:o?e.jsx(vn,{className:"w-5 h-5"}):e.jsx(Ye,{className:"w-5 h-5"})})]}),a&&e.jsx("p",{className:`mt-1 text-xs ${p?"text-green-600":"text-red-600"}`,children:p?" Passwords match":" Passwords do not match"})]}),e.jsx("button",{type:"submit",disabled:f||!y||!p,className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-3 rounded-xl font-semibold hover:from-blue-700 hover:to-cyan-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",children:f?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),"Updating..."]}):"Update Password"}),e.jsx("div",{className:"text-center text-sm",children:e.jsx(Ie,{to:"/signin",className:"text-gray-600 hover:text-gray-700 font-medium hover:underline transition-all",children:"Cancel"})})]})]})})}async function tw(t,s=10){try{const{data:r,error:a}=await _.rpc("get_smart_recommendations",{p_user_id:t,p_limit:s});if(a)throw a;return r||[]}catch(r){return console.error("Failed to get smart recommendations:",r),[]}}async function sw(t){try{const{error:s}=await _.from("user_recommendations").update({clicked:!0,clicked_at:new Date().toISOString()}).eq("id",t);if(s)throw s;return!0}catch(s){return console.error("Failed to mark recommendation clicked:",s),!1}}async function rw(t){try{const{error:s}=await _.from("user_recommendations").update({dismissed:!0}).eq("id",t);if(s)throw s;return!0}catch(s){return console.error("Failed to dismiss recommendation:",s),!1}}async function aw(t){try{const{data:{user:s}}=await _.auth.getUser();if(!s)return!1;const{error:r}=await _.from("recommendation_feedback").insert({recommendation_id:t.recommendation_id,user_id:s.id,feedback_type:t.feedback_type,rating:t.rating||null,comment:t.comment||null});if(r)throw r;return!0}catch(s){return console.error("Failed to submit recommendation feedback:",s),!1}}function nw(){const{user:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState(!0),[l,o]=x.useState(null);x.useEffect(()=>{t&&c()},[t]);const c=async()=>{if(t){i(!0);try{const g=await tw(t.id,5);a(g)}catch(g){console.error("Failed to load recommendations:",g)}finally{i(!1)}}},d=async g=>{g.ride_id&&(await sw(g.recommendation_id),s(`/rides/${g.ride_id}`))},m=async g=>{await rw(g),a(r.filter(j=>j.recommendation_id!==g))},u=async(g,j)=>{await aw({recommendation_id:g,feedback_type:j?"helpful":"not_helpful",rating:j?5:2}),o(g),setTimeout(()=>o(null),2e3)},h=g=>{const j=[];return g.smoking_match&&j.push("Smoking preference match"),g.pets_match&&j.push("Pet-friendly"),g.music_match&&j.push("Music preference match"),g.matches_recent_search&&j.push("Based on your searches"),g.driver_trust_score&&g.driver_trust_score>70&&j.push("Highly rated driver"),j},f=g=>g>=80?"text-green-600 bg-green-50 border-green-200":g>=60?"text-blue-600 bg-blue-50 border-blue-200":"text-gray-600 bg-gray-50 border-gray-200";return!t||n||r.length===0?null:e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Al,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Recommended for You"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"Personalized picks"})]}),e.jsx("div",{className:"space-y-3",children:r.map(g=>{const j=g.ride_details;if(!j)return null;const w=h(g.reasoning);return e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200 hover:border-blue-300 transition-all group",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${f(g.score)}`,children:[e.jsx(we,{className:"w-3 h-3 inline mr-1"}),g.score,"% match"]}),e.jsx(Fe,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("button",{onClick:()=>d(g),className:"text-left w-full hover:text-blue-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-900 font-semibold mb-1",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:j.origin}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:j.destination})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),new Date(j.departure_time).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(va,{className:"w-4 h-4"}),"",j.price_per_seat]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),j.available_seats," seats"]})]})]}),w.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:w.map((v,p)=>e.jsx("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded-full border border-blue-200",children:v},p))})]}),e.jsx("button",{onClick:()=>m(g.recommendation_id),className:"p-1 hover:bg-gray-100 rounded transition-colors ml-2",title:"Dismiss",children:e.jsx(ot,{className:"w-4 h-4 text-gray-400"})})]}),l===g.recommendation_id?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(wn,{className:"w-4 h-4"}),e.jsx("span",{children:"Thanks for your feedback!"})]}):e.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-100",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Was this helpful?"}),e.jsx("button",{onClick:()=>u(g.recommendation_id,!0),className:"p-1.5 hover:bg-green-50 rounded transition-colors",title:"Helpful",children:e.jsx(wn,{className:"w-3.5 h-3.5 text-gray-400 hover:text-green-600"})}),e.jsx("button",{onClick:()=>u(g.recommendation_id,!1),className:"p-1.5 hover:bg-red-50 rounded transition-colors",title:"Not helpful",children:e.jsx(Ug,{className:"w-3.5 h-3.5 text-gray-400 hover:text-red-600"})})]})]},g.recommendation_id)})}),e.jsx("button",{onClick:()=>s("/find-rides"),className:"w-full mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"View All Rides"})]})}function iw(){var m;const{profile:t}=X(),s=ie(),[r,a]=x.useState({totalRidesOffered:0,totalRidesTaken:0,upcomingRides:0,activeRides:0}),[n,i]=x.useState([]),[l,o]=x.useState(!0);x.useEffect(()=>{c();const u=_.channel("home-rides-changes").on("postgres_changes",{event:"*",schema:"public",table:"rides"},()=>{c()}).on("postgres_changes",{event:"*",schema:"public",table:"ride_bookings"},()=>{c()}).subscribe();return()=>{_.removeChannel(u)}},[]);const c=async()=>{try{const{data:u}=await _.from("rides").select("*",{count:"exact",head:!0}).eq("status","active").gt("available_seats",0),{data:h}=await _.from("rides").select(`
          id,
          origin,
          destination,
          departure_time,
          available_seats,
          driver:profiles!rides_driver_id_fkey(full_name, average_rating)
        `).eq("status","active").gt("available_seats",0).gte("departure_time",new Date().toISOString()).order("departure_time",{ascending:!0}).limit(5);a({totalRidesOffered:(t==null?void 0:t.total_rides_offered)||0,totalRidesTaken:(t==null?void 0:t.total_rides_taken)||0,upcomingRides:(u==null?void 0:u.length)||0,activeRides:(u==null?void 0:u.length)||0});const f=(h||[]).filter(g=>g.available_seats>0);i(f)}catch(u){console.error("Error loading dashboard data:",u)}finally{o(!1)}},d=u=>new Date(u).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Welcome back, ",(m=t==null?void 0:t.full_name)==null?void 0:m.split(" ")[0],"!"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Here's your carpooling activity"})]}),e.jsx(nw,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-6 h-6 text-blue-600"})}),e.jsx(Fe,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:r.totalRidesOffered}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Rides Offered"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-green-600"})}),e.jsx(Fe,{className:"w-5 h-5 text-green-500"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:r.totalRidesTaken}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Rides Taken"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-orange-600"})})}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:r.upcomingRides}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Available Rides"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("div",{className:"text-2xl",children:""})})}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:(t==null?void 0:t.average_rating.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Your Rating"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>s("/find-rides"),className:"w-full flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 rounded-xl transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(xe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Find a Ride"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Search available rides"})]})]}),e.jsx(ji,{className:"w-5 h-5 text-blue-600 group-hover:translate-x-1 transition-transform"})]}),e.jsxs("button",{onClick:()=>s("/request-ride"),className:"w-full flex items-center justify-between p-4 bg-orange-50 hover:bg-orange-100 rounded-xl transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-600 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Request a Ride"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Post where you need to go"})]})]}),e.jsx(ji,{className:"w-5 h-5 text-orange-600 group-hover:translate-x-1 transition-transform"})]}),e.jsxs("button",{onClick:()=>s("/post-ride"),className:"w-full flex items-center justify-between p-4 bg-green-50 hover:bg-green-100 rounded-xl transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Offer a Ride"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Post your trip"})]})]}),e.jsx(ji,{className:"w-5 h-5 text-green-600 group-hover:translate-x-1 transition-transform"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Available Rides"}),e.jsx("button",{onClick:()=>s("/find-rides"),className:"text-sm text-blue-600 hover:underline",children:"View all"})]}),e.jsx("div",{className:"space-y-3",children:n.length===0?e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No upcoming rides available"}):n.filter(u=>u.available_seats>0).map(u=>{var h,f;return e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors cursor-pointer",onClick:()=>s("/find-rides"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700 mb-1",children:[e.jsx("span",{className:"font-medium",children:u.origin}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"font-medium",children:u.destination})]}),e.jsx("p",{className:"text-xs text-gray-600",children:d(u.departure_time)}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-600",children:(h=u.driver)==null?void 0:h.full_name}),e.jsx("span",{className:"text-xs text-gray-400",children:""}),e.jsxs("span",{className:"text-xs text-gray-600",children:[" ",(f=u.driver)==null?void 0:f.average_rating.toFixed(1)]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[u.available_seats," ",u.available_seats===1?"seat":"seats"]})})]})},u.id)})})]})]})]})}function ua({value:t="",onChange:s,onLocationSelect:r,placeholder:a="Enter location",label:n,required:i=!1,id:l}){const o=x.useRef(null),c=x.useRef(null),d=x.useRef(!1),[m,u]=x.useState(!1);x.useEffect(()=>{const f=async()=>{if(typeof window.google<"u"&&window.google.maps){g();return}const j="YOUR_GOOGLE_MAPS_API_KEY";if(document.querySelector('script[src*="maps.googleapis.com"]')){const w=setInterval(()=>{typeof window.google<"u"&&window.google.maps&&(clearInterval(w),g())},100);return}try{const w=document.createElement("script");w.src=`https://maps.googleapis.com/maps/api/js?key=${j}&libraries=places`,w.async=!0,w.defer=!0,w.onload=()=>g(),document.head.appendChild(w)}catch(w){console.error("Error loading Google Maps:",w)}},g=()=>{if(!o.current||c.current)return;const j=new google.maps.places.Autocomplete(o.current,{componentRestrictions:{country:"gb"},fields:["address_components","geometry","name","formatted_address"]});j.addListener("place_changed",()=>{var v;const w=j.getPlace();if(w.formatted_address&&((v=w.geometry)!=null&&v.location)){if(d.current=!0,u(!0),s&&s(w.formatted_address,w),r){const p={address:w.formatted_address,lat:w.geometry.location.lat(),lng:w.geometry.location.lng()};console.log("Location selected:",p),r(p)}setTimeout(()=>{d.current=!1},0)}}),c.current=j};f()},[s]),x.useEffect(()=>{o.current&&!d.current&&(o.current.value=t)},[t]);const h=f=>{u(!1),s&&s(f.target.value)};return e.jsxs("div",{children:[n&&e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[n,i&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{ref:o,id:l,type:"text",defaultValue:t,onChange:h,placeholder:a,required:i,autoComplete:"off",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})}class lw{constructor(){this.cache=new Map,this.pendingRequests=new Map}async get(s,r,a=3e5,n){const i=this.cache.get(s),l=Date.now();if(i&&l-i.timestamp<i.ttl)return i.data;const o=this.pendingRequests.get(s);if(o)return o;const c=r().then(d=>(this.cache.set(s,{data:d,timestamp:l,ttl:a}),this.pendingRequests.delete(s),d)).catch(d=>{if(this.pendingRequests.delete(s),n){const m=n();return this.cache.set(s,{data:m,timestamp:l,ttl:6e4}),m}throw d});return this.pendingRequests.set(s,c),c}invalidate(s){if(!s){this.cache.clear();return}Array.from(this.cache.keys()).forEach(a=>{a.includes(s)&&this.cache.delete(a)})}clear(){this.cache.clear(),this.pendingRequests.clear()}}const ri=new lw,Sr="YOUR_GOOGLE_MAPS_API_KEY";function ow(t,s){return s==="mi"?t*.621371:t}function cw(t,s){return`${ow(t,s).toFixed(1)} ${s}`}class dw{constructor(){this.directionsService=null,typeof google<"u"&&google.maps&&(this.directionsService=new google.maps.DirectionsService)}async getWeather(s,r){return this.getWeatherForecast(s,r)}async getMultipleRouteOptions(s,r,a){const n=`routes:${s.lat},${s.lng}:${r.lat},${r.lng}:${(a==null?void 0:a.toISOString())||"now"}`;return ri.get(n,async()=>{var c,d;const i="https://routes.googleapis.com/directions/v2:computeRoutes",l=[],o=[{type:"TRAFFIC_AWARE",name:"Fastest Route",desc:"Optimized for current traffic"},{type:"SHORTEST",name:"Shortest Route",desc:"Minimum distance"},{type:"FUEL_EFFICIENT",name:"Eco-Friendly Route",desc:"Best fuel economy"}];try{for(const m of o){const u={origin:{location:{latLng:{latitude:s.lat,longitude:s.lng}}},destination:{location:{latLng:{latitude:r.lat,longitude:r.lng}}},travelMode:"DRIVE",routingPreference:m.type,computeAlternativeRoutes:!1,languageCode:"en-GB",units:"METRIC"};a&&(u.departureTime=a.toISOString());const h=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":Sr,"X-Goog-FieldMask":"routes.duration,routes.staticDuration,routes.distanceMeters,routes.polyline,routes.legs"},body:JSON.stringify(u)});if(h.ok){const g=(c=(await h.json()).routes)==null?void 0:c[0];if(g){const j=(g.distanceMeters/1e3).toFixed(1),w=g.duration?parseInt(g.duration.replace("s","")):null,v=g.staticDuration?parseInt(g.staticDuration.replace("s","")):null,p=w||v||0,y=Math.round(p/60),b=w&&v&&w>v?`${Math.round(w/60)} min (with traffic)`:null;l.push({name:m.name,description:m.desc,distance:`${j} km`,duration:`${y} min`,distanceValue:g.distanceMeters,durationValue:p,polyline:((d=g.polyline)==null?void 0:d.encodedPolyline)||"",optimizationType:m.type==="TRAFFIC_AWARE"?"FASTEST":m.type==="SHORTEST"?"SHORTEST":"ECO_FRIENDLY",fuelEfficiency:m.type==="FUEL_EFFICIENT"?"Optimized":void 0,trafficDuration:b||void 0})}}}if(l.length>1){const m=l.reduce((h,f)=>h+f.distanceValue,0)/l.length,u=l.reduce((h,f)=>h+f.durationValue,0)/l.length;l.push({name:"Balanced Route",description:"Best balance of time and distance",distance:`${(m/1e3).toFixed(1)} km`,duration:`${Math.round(u/60)} min`,distanceValue:m,durationValue:u,polyline:l[0].polyline,optimizationType:"BALANCED"})}return l.length>0?l:await this.getFallbackRoute(s,r)}catch(m){return console.error("Routes API error:",m),await this.getFallbackRoute(s,r)}},6e5)}async getFallbackRoute(s,r){if(!this.directionsService)return[];try{const a=await this.getDirections(s,r);return[{name:"Standard Route",description:"Default route",distance:a.distance,duration:a.duration,distanceValue:a.distanceValue,durationValue:a.durationValue,polyline:a.polyline,optimizationType:"BALANCED"}]}catch{return[]}}async getDirections(s,r,a){if(!this.directionsService)throw new Error("Google Maps not loaded");const n={origin:new google.maps.LatLng(s.lat,s.lng),destination:new google.maps.LatLng(r.lat,r.lng),travelMode:google.maps.TravelMode.DRIVING,waypoints:a||[],optimizeWaypoints:!0,avoidHighways:!1,avoidTolls:!1};return new Promise((i,l)=>{this.directionsService.route(n,(o,c)=>{var d,m,u,h;if(c===google.maps.DirectionsStatus.OK&&o){const f=o.routes[0],g=f.legs[0];i({distance:((d=g.distance)==null?void 0:d.text)||"",duration:((m=g.duration)==null?void 0:m.text)||"",distanceValue:((u=g.distance)==null?void 0:u.value)||0,durationValue:((h=g.duration)==null?void 0:h.value)||0,polyline:f.overview_polyline||"",steps:g.steps})}else l(new Error(`Directions request failed: ${c}`))})})}async getWeatherForecast(s,r,a){const n=Math.floor(a?a.getTime()/108e5:Date.now()/108e5),i=`weather:${s.toFixed(2)},${r.toFixed(2)}:${n}`;return ri.get(i,async()=>{var d,m,u,h,f,g;const l=`https://weather.googleapis.com/v1/weather?location=${s},${r}&key=${Sr}`,o=await fetch(l,{method:"GET",headers:{Accept:"application/json"}});if(!o.ok)throw new Error(`Weather API returned ${o.status}`);const c=await o.json();return{temperature:((d=c.temperature)==null?void 0:d.value)||20,condition:((m=c.condition)==null?void 0:m.description)||"Partly Cloudy",humidity:((u=c.humidity)==null?void 0:u.value)||60,windSpeed:((f=(h=c.wind)==null?void 0:h.speed)==null?void 0:f.value)||10,icon:((g=c.condition)==null?void 0:g.icon)||"partly_cloudy",forecast:a?this.generateForecast(a):void 0}},6e5,()=>this.getMockWeatherData(a))}getMockWeatherData(s){const r=15+Math.random()*10,a=["Sunny","Partly Cloudy","Cloudy","Light Rain"],n=a[Math.floor(Math.random()*a.length)];return{temperature:Math.round(r),condition:n,humidity:50+Math.floor(Math.random()*30),windSpeed:5+Math.floor(Math.random()*15),icon:n.toLowerCase().replace(" ","_"),forecast:s?this.generateForecast(s):void 0}}generateForecast(s){const r=[],a=["Sunny","Partly Cloudy","Cloudy","Light Rain"];for(let n=0;n<5;n++){const i=new Date(s);i.setDate(i.getDate()+n),r.push({date:i.toLocaleDateString("en-GB",{weekday:"short",month:"short",day:"numeric"}),temperature:Math.round(12+Math.random()*12),condition:a[Math.floor(Math.random()*a.length)],precipitationChance:Math.floor(Math.random()*60)})}return r}async getAirQuality(s,r){const a=Math.floor(Date.now()/216e5),n=`airquality:${s.toFixed(2)},${r.toFixed(2)}:${a}`;return ri.get(n,async()=>{var u;const i=`https://airquality.googleapis.com/v1/currentConditions:lookup?key=${Sr}`,l=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:{latitude:s,longitude:r}})});if(!l.ok)throw new Error(`Air Quality API returned ${l.status}`);const d=((await l.json()).indexes||[])[0]||{},m={Excellent:"#00E400",Good:"#92D050",Moderate:"#FFFF00",Poor:"#FF7E00","Very Poor":"#FF0000",Severe:"#8F3F97"};return{aqi:d.aqi||50,category:d.category||"Good",dominantPollutant:d.dominantPollutant||"pm25",healthRecommendations:((u=d.healthRecommendations)==null?void 0:u.generalPopulation)||"Air quality is acceptable",color:m[d.category]||"#92D050"}},18e5,()=>({aqi:50,category:"Good",dominantPollutant:"pm25",healthRecommendations:"Air quality data unavailable",color:"#92D050"}))}async getPollenData(s,r){var n;const a=`https://pollen.googleapis.com/v1/forecast:lookup?key=${Sr}&location.latitude=${s}&location.longitude=${r}&days=1`;try{const i=await fetch(a);if(!i.ok)throw new Error("Pollen API request failed");const o=(n=(await i.json()).dailyInfo)==null?void 0:n[0];return((o==null?void 0:o.pollenTypeInfo)||[]).map(d=>{var m,u,h;return{plantType:d.displayName||d.code,index:((m=d.indexInfo)==null?void 0:m.value)||0,category:((u=d.indexInfo)==null?void 0:u.category)||"Low",description:this.getPollenDescription(((h=d.indexInfo)==null?void 0:h.category)||"Low")}})}catch(i){return console.error("Pollen API error:",i),this.getMockPollenData()}}getMockPollenData(){return["Tree","Grass","Weed"].map(r=>({plantType:r,index:Math.floor(Math.random()*5),category:["Low","Low-Medium","Medium","Medium-High","High"][Math.floor(Math.random()*5)],description:"Pollen levels are typical for this time of year"}))}getPollenDescription(s){return{Low:"Pollen levels are low and pose little risk","Low-Medium":"Pollen levels are slightly elevated",Medium:"Moderate pollen levels, sensitive individuals may experience symptoms","Medium-High":"High pollen levels, precautions recommended",High:"Very high pollen levels, outdoor activities may be affected"}[s]||"No data available"}async searchNearbyPlaces(s,r,a,n=5e3){const i=`places:${a}:${s.toFixed(2)},${r.toFixed(2)}:${n}`;return ri.get(i,async()=>{const l="https://places.googleapis.com/v1/places:searchNearby";try{const o=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":Sr,"X-Goog-FieldMask":"places.displayName,places.formattedAddress,places.location,places.types,places.rating,places.currentOpeningHours"},body:JSON.stringify({locationRestriction:{circle:{center:{latitude:s,longitude:r},radius:n}},includedTypes:[a],maxResultCount:10})});if(!o.ok)throw new Error("Places API request failed");return((await o.json()).places||[]).map(m=>{var u,h,f,g;return{name:((u=m.displayName)==null?void 0:u.text)||"",address:m.formattedAddress||"",placeId:m.id||"",location:{lat:((h=m.location)==null?void 0:h.latitude)||0,lng:((f=m.location)==null?void 0:f.longitude)||0},types:m.types||[],rating:m.rating,openNow:(g=m.currentOpeningHours)==null?void 0:g.openNow}})}catch(o){return console.error("Places API error:",o),[]}},9e5)}getStaticMapUrl(s,r=13,a=600,n=400,i){let l=`https://maps.googleapis.com/maps/api/staticmap?center=${s.lat},${s.lng}&zoom=${r}&size=${a}x${n}&key=${Sr}`;return i&&i.length>0&&i.forEach(o=>{const c=o.label?`|label:${o.label}`:"";l+=`&markers=color:red${c}|${o.lat},${o.lng}`}),l}calculateDetour(s,r){const a=(r-s)/1e3,n=(r-s)/s*100;return{detourKm:Math.round(a*10)/10,detourPercent:Math.round(n*10)/10}}}const Wt=new dw,uw={xs:"w-8 h-8 text-xs",sm:"w-12 h-12 text-sm",md:"w-16 h-16 text-base",lg:"w-20 h-20 text-lg",xl:"w-24 h-24 text-xl","2xl":"w-32 h-32 text-2xl"},Tm={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-7 h-7","2xl":"w-8 h-8"};function mw(t){let s=0;for(let a=0;a<t.length;a++)s=t.charCodeAt(a)+((s<<5)-s);const r=["bg-blue-500","bg-green-500","bg-orange-500","bg-red-500","bg-purple-500","bg-teal-500","bg-pink-500","bg-indigo-500","bg-yellow-500","bg-cyan-500"];return r[Math.abs(s)%r.length]}function rl({user:t,size:s="md",onClick:r,rating:a,verified:n,showOnlineStatus:i,className:l=""}){var p;const[o,c]=x.useState(!1),[d,m]=x.useState(!0),u=((p=t.full_name)==null?void 0:p.split(" ").map(y=>y[0]).slice(0,2).join("").toUpperCase())||"?",h=mw(t.id),f=!!r,g=`
    ${uw[s]}
    ${l}
    rounded-full
    flex
    items-center
    justify-center
    overflow-hidden
    relative
    ${f?"cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200":""}
  `.trim(),j=()=>{m(!1)},w=()=>{c(!0),m(!1)},v=t.avatar_url&&!o;return e.jsxs("div",{className:g,onClick:r,role:f?"button":void 0,children:[v?e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:`absolute inset-0 ${h} animate-pulse`}),e.jsx("img",{src:t.avatar_url,alt:t.full_name,className:"w-full h-full object-cover",onLoad:j,onError:w})]}):e.jsx("div",{className:`w-full h-full ${h} flex items-center justify-center text-white font-semibold`,children:u}),n&&e.jsx("div",{className:`absolute bottom-0 right-0 ${Tm[s]} bg-green-500 rounded-full flex items-center justify-center border-2 border-white`,children:e.jsx(ee,{className:"w-full h-full text-white p-0.5"})}),a!==void 0&&a>0&&e.jsxs("div",{className:`absolute -bottom-1 left-1/2 transform -translate-x-1/2 bg-yellow-400 rounded-full px-1.5 py-0.5 flex items-center gap-0.5 border border-white shadow-sm ${s==="xs"||s==="sm"?"text-[10px]":"text-xs"}`,children:[e.jsx(we,{className:`${s==="xs"||s==="sm"?"w-2 h-2":"w-3 h-3"} fill-current text-white`}),e.jsx("span",{className:"text-white font-bold",children:a.toFixed(1)})]}),i&&e.jsx("div",{className:`absolute top-0 right-0 ${Tm[s]} bg-green-500 rounded-full border-2 border-white`})]})}function al(t,s){return t===s?"/profile":`/user/${t}`}function hw(){const{user:t}=X(),s=ie(),[r,a]=x.useState(""),[n,i]=x.useState(""),[l,o]=x.useState(""),[c,d]=x.useState(1),[m,u]=x.useState([]),[h,f]=x.useState(!1),[g,j]=x.useState(!1);x.useState(!1);const[w,v]=x.useState(0),[p,y]=x.useState(!1),[b,N]=x.useState("match_score"),[k,E]=x.useState([]);x.useState(!1);const[C,R]=x.useState(null);x.useEffect(()=>{T(),I(),M();const O=_.channel("rides-changes").on("postgres_changes",{event:"*",schema:"public",table:"rides"},()=>{I()}).on("postgres_changes",{event:"*",schema:"public",table:"ride_bookings"},()=>{I()}).subscribe();return()=>{_.removeChannel(O)}},[]);const T=async()=>{if(t)try{const{data:O,error:$}=await _.rpc("check_booking_eligibility");!$&&O&&O.length>0&&R(O[0])}catch(O){console.error("Error checking eligibility:",O)}},M=async()=>{if(t)try{const{data:O,error:$}=await _.from("trip_requests").select("*").eq("rider_id",t.id).in("status",["active","pending"]).order("created_at",{ascending:!1});if($)throw $;E(O||[])}catch(O){console.error("Error loading trip requests:",O)}},I=async()=>{if(t){f(!0);try{const{data:O,error:$}=await _.from("rides").select(`
          *,
          driver:profiles!rides_driver_id_fkey(*),
          vehicle:vehicles(*)
        `).eq("status","active").neq("driver_id",t.id).gt("available_seats",0).gte("departure_time",new Date().toISOString()).order("departure_time",{ascending:!0}).limit(50);if($)throw $;const L=O||[],[V,S]=await Promise.all([_.from("ride_bookings").select("ride_id, id, status").eq("passenger_id",t.id).in("ride_id",L.map(z=>z.id)),_.from("reliability_scores").select("user_id, reliability_score").in("user_id",L.map(z=>z.driver_id))]),U=V.data||[],P=S.data||[];let W=(await Promise.all(L.map(async z=>{const Y=U.find(le=>le.ride_id===z.id),Z=P.find(le=>le.user_id===z.driver_id);let ae=null;if(z.origin_lat&&z.origin_lng)try{ae=await Wt.getWeather(z.origin_lat,z.origin_lng)}catch(le){console.error("Failed to load weather:",le)}return{...z,userBooking:Y?{id:Y.id,status:Y.status}:void 0,reliabilityScore:(Z==null?void 0:Z.reliability_score)||100,weather:ae&&ae.condition!=="Unavailable"?{temperature:ae.temperature,condition:ae.condition}:void 0}}))).filter(z=>z.available_seats>0);w>0&&(W=W.filter(z=>z.driver.average_rating>=w)),p&&(W=W.filter(z=>z.driver.email_verified&&z.driver.phone_verified)),b==="rating"?W.sort((z,Y)=>Y.driver.average_rating-z.driver.average_rating):b==="match_score"&&W.some(z=>z.matchScore)&&W.sort((z,Y)=>(Y.matchScore||0)-(z.matchScore||0)),u(W)}catch(O){console.error("Error loading rides:",O)}finally{f(!1)}}},D=async O=>{if(O.preventDefault(),!!t){f(!0),j(!0);try{let $=_.from("rides").select(`
          *,
          driver:profiles!rides_driver_id_fkey(*),
          vehicle:vehicles(*)
        `).eq("status","active").neq("driver_id",t.id).gte("available_seats",c).gt("available_seats",0);if(l){const W=new Date(l);W.setHours(0,0,0,0);const z=new Date(l);z.setHours(23,59,59,999),$=$.gte("departure_time",W.toISOString()).lte("departure_time",z.toISOString())}else $=$.gte("departure_time",new Date().toISOString());$=$.order("departure_time",{ascending:!0}).limit(20);const{data:L,error:V}=await $;if(V)throw V;const S=L||[],{data:U}=await _.from("ride_bookings").select("ride_id, id, status").eq("passenger_id",t.id).in("ride_id",S.map(W=>W.id)),A=(await Promise.all(S.map(async W=>{const z=U==null?void 0:U.find(Z=>Z.ride_id===W.id);let Y=null;if(W.origin_lat&&W.origin_lng)try{Y=await Wt.getWeather(W.origin_lat,W.origin_lng)}catch(Z){console.error("Failed to load weather:",Z)}return{...W,userBooking:z?{id:z.id,status:z.status}:void 0,weather:Y&&Y.condition!=="Unavailable"?{temperature:Y.temperature,condition:Y.condition}:void 0}}))).filter(W=>W.available_seats>0);u(A)}catch($){console.error("Error searching rides:",$)}finally{f(!1)}}},F=async O=>{if(t)try{const{error:$}=await _.from("ride_bookings").insert([{ride_id:O,passenger_id:t.id,pickup_location:r||"To be confirmed",pickup_lat:0,pickup_lng:0,dropoff_location:n||"To be confirmed",dropoff_lat:0,dropoff_lng:0,seats_requested:c}]);if($)throw $;alert("Ride request sent successfully!"),I()}catch($){$.code==="23505"?alert("You have already requested this ride"):alert("Failed to request ride. Please try again.")}},B=O=>new Date(O).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),H=O=>O>=90?"text-green-600":O>=70?"text-blue-600":O>=50?"text-yellow-600":"text-red-600";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Find a Ride"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Search for available rides in your area"})]}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(ua,{id:"search-origin-input",label:"From",value:r,onChange:O=>a(O),placeholder:"Enter pickup location"}),e.jsx(ua,{id:"search-destination-input",label:"To",value:n,onChange:O=>i(O),placeholder:"Enter destination"})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"w-4 h-4 inline mr-1"}),"Date"]}),e.jsx("input",{type:"date",value:l,onChange:O=>o(O.target.value),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4 inline mr-1"}),"Seats"]}),e.jsx("select",{value:c,onChange:O=>d(Number(O.target.value)),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[1,2,3,4].map(O=>e.jsxs("option",{value:O,children:[O," ",O===1?"seat":"seats"]},O))})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"submit",disabled:h,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5"}),h?"Searching...":"Search"]})})]})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:g?`${m.length} rides found`:"All Available Rides"})}),h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):m.length===0?e.jsx("div",{className:"bg-white rounded-xl p-12 text-center border border-gray-200",children:e.jsx("p",{className:"text-gray-600",children:g?"No rides found matching your criteria":"No rides available"})}):e.jsx("div",{className:"space-y-4",children:m.filter(O=>O.available_seats>0&&O.id).map(O=>e.jsxs("div",{className:`bg-white border rounded-xl p-6 hover:shadow-lg transition-all ${O.userBooking&&O.userBooking.status!=="cancelled"?"border-green-300 bg-green-50":"border-gray-200"}`,children:[O.userBooking&&O.userBooking.status!=="cancelled"&&e.jsxs("div",{className:"mb-4 flex items-center gap-2 bg-green-100 border border-green-300 rounded-lg px-4 py-2",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-800",children:["Already Booked - Status: ",O.userBooking.status.charAt(0).toUpperCase()+O.userBooking.status.slice(1)]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(rl,{user:O.driver,size:"lg",rating:O.driver.average_rating,onClick:()=>s(al(O.driver.id,t==null?void 0:t.id))}),e.jsxs("div",{children:[e.jsx("p",{onClick:()=>s(al(O.driver.id,t==null?void 0:t.id)),className:"font-semibold text-gray-900 cursor-pointer hover:text-green-600 transition-colors",children:O.driver.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-400 fill-current"}),O.driver.average_rating.toFixed(1)]}),e.jsx("span",{children:""}),e.jsxs("span",{children:[O.driver.total_rides_offered," rides"]}),O.reliabilityScore&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsxs("span",{className:`flex items-center gap-1 font-medium ${H(O.reliabilityScore)}`,children:[e.jsx(Shield,{className:"w-4 h-4"}),O.reliabilityScore," reliability"]})]})]}),O.matchScore&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${O.matchScore>=80?"bg-green-100 text-green-800":O.matchScore>=60?"bg-blue-100 text-blue-800":O.matchScore>=40?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[O.matchScore,"% Match"]})}),O.weather&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-600",children:[e.jsx(An,{className:"w-3 h-3"}),e.jsxs("span",{children:[Math.round(O.weather.temperature),"C - ",O.weather.condition]})]})]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:O.origin}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"font-medium",children:O.destination})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),B(O.departure_time)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),O.available_seats," of ",O.total_seats," seats"]}),O.vehicle&&e.jsxs("span",{children:[O.vehicle.color," ",O.vehicle.make," ",O.vehicle.model]})]}),O.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2 line-clamp-2",children:O.notes})]}),e.jsxs("div",{className:"flex lg:flex-col gap-2 lg:justify-center",children:[e.jsxs("button",{onClick:()=>s(`/rides/${O.id}`),className:"flex-1 lg:flex-none px-6 py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors font-medium whitespace-nowrap flex items-center justify-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),"View Details"]}),O.userBooking&&O.userBooking.status!=="cancelled"?e.jsx("button",{onClick:()=>s(`/bookings/${O.userBooking.id}`),className:"flex-1 lg:flex-none px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium whitespace-nowrap",children:"View Booking"}):e.jsx("button",{onClick:()=>F(O.id),className:"flex-1 lg:flex-none px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium whitespace-nowrap",children:"Request Ride"})]})]})]},O.id))})]})]})}function xw({action:t="perform this action"}){const{user:s,isEmailVerified:r,resendVerificationEmail:a}=X(),[n,i]=x.useState(!1),[l,o]=x.useState(!1),[c,d]=x.useState(""),[m,u]=x.useState(!1);if(r||m)return null;const h=async()=>{i(!0),d("");const{error:f}=await a();f?d(f.message):o(!0),i(!1)};return e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-amber-800",children:"Email verification required"}),e.jsxs("p",{className:"text-sm text-amber-700 mt-1",children:["Please verify your email address to ",t,". Check your inbox for the verification link."]}),(s==null?void 0:s.email)&&e.jsxs("p",{className:"text-xs text-amber-600 mt-1",children:["Sent to: ",s.email]}),c&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:c}),l?e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-green-700",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Verification email sent!"})]}):e.jsxs("button",{onClick:h,disabled:n,className:"mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 disabled:opacity-50 transition-colors",children:[e.jsx(Jt,{className:"w-4 h-4"}),n?"Sending...":"Resend verification email"]})]}),e.jsx("button",{onClick:()=>u(!0),className:"p-1 hover:bg-amber-100 rounded transition-colors",children:e.jsx(ot,{className:"w-4 h-4 text-amber-600"})})]})})}function gw({isOpen:t,onClose:s,onCompleteSetup:r}){return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[100]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Complete Your Profile"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ot,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(ia,{className:"w-8 h-8 text-amber-600"})}),e.jsx("p",{className:"text-gray-600 text-center",children:"To use this feature, please complete your profile by adding a profile picture. This helps maintain trust and safety in our community."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ia,{className:"w-4 h-4"}),"Complete Setup"]})]})]})}):null}function Wg(){const{profile:t}=X(),s=ie(),[r,a]=x.useState(!1),n=()=>t?!!(t.profile_photo_path||t.avatar_url||t.profile_photo_url):!1,i=c=>n()?!0:(a(!0),!1),l=()=>{a(!1),s("/profile")},o=()=>e.jsx(gw,{isOpen:r,onClose:()=>a(!1),onCompleteSetup:l});return{checkAccess:i,isProfileComplete:n(),ServiceGatingModal:o}}function fw(){const{user:t,isEmailVerified:s}=X(),r=ie(),{checkAccess:a,ServiceGatingModal:n}=Wg(),[i,l]=x.useState(!1),[o,c]=x.useState(!0),[d,m]=x.useState(4),[u,h]=x.useState({origin:"",destination:"",departureDate:"",departureTime:"",availableSeats:1,notes:"",isRecurring:!1,timeType:"depart"}),[f,g]=x.useState({lat:0,lng:0}),[j,w]=x.useState({lat:0,lng:0}),[v,p]=x.useState(!1),[y,b]=x.useState(!1),[N,k]=x.useState("");x.useEffect(()=>{E()},[t]);const E=async()=>{if(t)try{const{data:R,error:T}=await _.from("vehicles").select("id, capacity").eq("user_id",t.id).eq("is_active",!0).limit(1).maybeSingle();if(T)throw T;if(l(!!R),R!=null&&R.capacity){const M=R.capacity-1;m(M),h(I=>({...I,availableSeats:Math.min(I.availableSeats,M)}))}}catch(R){console.error("Error checking vehicle:",R)}finally{c(!1)}},C=async R=>{if(R.preventDefault(),!!t&&a("post-ride")){if(!s){k("Please verify your email address before posting rides.");return}k(""),p(!0);try{const{data:T}=await _.from("vehicles").select("*").eq("user_id",t.id).eq("is_active",!0).limit(1).maybeSingle();if(!T){k("Please add a vehicle to your profile first"),p(!1);return}const M=new Date(`${u.departureDate}T${u.departureTime}`).toISOString(),I=(T.capacity||5)-1,D=Math.min(u.availableSeats,I),{error:F}=await _.from("rides").insert([{driver_id:t.id,vehicle_id:T.id,origin:u.origin,origin_lat:f.lat,origin_lng:f.lng,destination:u.destination,destination_lat:j.lat,destination_lng:j.lng,departure_time:M,available_seats:D,total_seats:D,notes:u.notes,is_recurring:u.isRecurring}]);if(F)throw F;b(!0),h({origin:"",destination:"",departureDate:"",departureTime:"",availableSeats:1,notes:"",isRecurring:!1,timeType:"depart"}),setTimeout(()=>{r("/my-rides")},2e3)}catch(T){console.error("Error posting ride:",T),k("Failed to post ride. Please try again.")}finally{p(!1)}}};return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):i?e.jsxs(e.Fragment,{children:[e.jsx(n,{}),e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Post a Ride"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Share your journey with the community"})]}),e.jsx(xw,{action:"post rides"}),y&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-6 py-4 rounded-xl flex items-center gap-3",children:[e.jsx(ee,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Ride posted successfully!"}),e.jsx("p",{className:"text-sm",children:"Redirecting to your rides..."})]})]}),N&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-xl flex items-center gap-3",children:[e.jsx(ne,{className:"w-6 h-6"}),e.jsx("p",{children:N})]}),e.jsx("div",{className:"bg-white rounded-xl p-8 border border-gray-200 shadow-sm",children:e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsx(ua,{id:"origin-input",label:"Pickup Location",value:u.origin,onChange:(R,T)=>{var M;h(I=>({...I,origin:R})),(M=T==null?void 0:T.geometry)!=null&&M.location&&g({lat:T.geometry.location.lat(),lng:T.geometry.location.lng()})},placeholder:"Enter starting point",required:!0}),e.jsx(ua,{id:"destination-input",label:"Destination",value:u.destination,onChange:(R,T)=>{var M;h(I=>({...I,destination:R})),(M=T==null?void 0:T.geometry)!=null&&M.location&&w({lat:T.geometry.location.lat(),lng:T.geometry.location.lng()})},placeholder:"Enter destination",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Time Type"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>h({...u,timeType:"depart"}),className:`flex-1 py-3 px-4 rounded-xl font-medium transition-all ${u.timeType==="depart"?"bg-blue-600 text-white ring-2 ring-blue-400":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Depart After"}),e.jsx("button",{type:"button",onClick:()=>h({...u,timeType:"arrive"}),className:`flex-1 py-3 px-4 rounded-xl font-medium transition-all ${u.timeType==="arrive"?"bg-blue-600 text-white ring-2 ring-blue-400":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Arrive By"})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:u.timeType==="depart"?"You will depart after this time":"You want to arrive by this time"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"w-4 h-4 inline mr-1"}),"Date"]}),e.jsx("input",{type:"date",value:u.departureDate,onChange:R=>h({...u,departureDate:R.target.value}),min:new Date().toISOString().split("T")[0],className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ye,{className:"w-4 h-4 inline mr-1"}),u.timeType==="depart"?"Departure Time":"Arrival Time"]}),e.jsx("input",{type:"time",value:u.departureTime,onChange:R=>h({...u,departureTime:R.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4 inline mr-1"}),"Available Seats"]}),e.jsx("select",{value:u.availableSeats,onChange:R=>h({...u,availableSeats:Number(R.target.value)}),className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Array.from({length:d},(R,T)=>T+1).map(R=>e.jsxs("option",{value:R,children:[R," ",R===1?"seat":"seats"]},R))}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Your vehicle has ",d," passenger seats available (excluding driver)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:u.notes,onChange:R=>h({...u,notes:R.target.value}),placeholder:"Any additional information about your ride...",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"recurring",checked:u.isRecurring,onChange:R=>h({...u,isRecurring:R.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"recurring",className:"text-sm text-gray-700",children:"This is a recurring ride"})]}),e.jsxs("button",{type:"submit",disabled:v,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),v?"Posting Ride...":"Post Ride"]})]})})]})]}):e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-8 text-center",children:[e.jsx(ne,{className:"w-16 h-16 text-yellow-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Vehicle Registered"}),e.jsx("p",{className:"text-gray-700 mb-6",children:"You need to add a vehicle to your profile before you can offer rides."}),e.jsx("button",{onClick:()=>r("/profile"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:"Go to Profile"})]})})}function pw(){const t=ie(),{user:s}=X();Wg();const[r,a]=x.useState(!1),[n,i]=x.useState(""),[l,o]=x.useState(null),[c,d]=x.useState(null),[m,u]=x.useState(""),[h,f]=x.useState(!1),[g,j]=x.useState(1),[w,v]=x.useState("");x.useEffect(()=>{console.log("Location state updated:",{fromLocation:l,toLocation:c}),l&&c&&n==="Please select both pickup and destination locations"&&i("")},[l,c,n]);const p=async b=>{if(b.preventDefault(),!s){i("You must be logged in to request a ride");return}if(!l||!c){i("Please select both pickup and destination locations");return}if(!m){i("Please select a departure time");return}a(!0),i("");try{const{error:N}=await _.from("ride_requests").insert({requester_id:s.id,from_location:l.address,from_lat:l.lat,from_lng:l.lng,to_location:c.address,to_lat:c.lat,to_lng:c.lng,departure_time:m,flexible_time:h,seats_needed:g,notes:w.trim(),status:"pending"});if(N)throw N;t("/my-rides?tab=requests")}catch(N){console.error("Error creating ride request:",N),i(N.message||"Failed to create ride request")}finally{a(!1)}},y=new Date().toISOString().slice(0,16);return e.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Request a Ride"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tell drivers where you need to go and when. They can offer to give you a ride."}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Pickup Location"]}),e.jsx(ua,{onLocationSelect:b=>o(b),placeholder:"Where do you need to be picked up?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Destination"]}),e.jsx(ua,{onLocationSelect:b=>d(b),placeholder:"Where do you want to go?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Departure Time"]}),e.jsx("input",{type:"datetime-local",value:m,onChange:b=>u(b.target.value),min:y,required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"flexible",checked:h,onChange:b=>f(b.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"flexible",className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(ye,{className:"w-4 h-4"}),"Flexible with time (within 1-2 hours)"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Number of Seats Needed"]}),e.jsx("select",{value:g,onChange:b=>j(parseInt(b.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[1,2,3,4,5,6,7,8].map(b=>e.jsxs("option",{value:b,children:[b," ",b===1?"seat":"seats"]},b))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Additional Notes (Optional)"]}),e.jsx("textarea",{value:w,onChange:b=>v(b.target.value),placeholder:"Any additional details for potential drivers...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),n&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:n})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>t(-1),className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Posting Request...":"Post Ride Request"})]})]})]})})}function yw(){const{profile:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState(!0);x.useEffect(()=>{t!=null&&t.id&&l()},[t==null?void 0:t.id]);const l=async()=>{try{i(!0);const{data:h,error:f}=await _.from("rides").select("*").eq("driver_id",t==null?void 0:t.id).eq("is_recurring",!0).order("departure_time",{ascending:!0});if(f)throw f;a(h||[])}catch(h){console.error("Error loading recurring rides:",h)}finally{i(!1)}},o=async h=>{try{const{error:f}=await _.from("rides").update({status:"paused"}).eq("id",h);if(f)throw f;await l()}catch(f){console.error("Error pausing ride:",f)}},c=async h=>{try{const{error:f}=await _.from("rides").update({status:"active"}).eq("id",h);if(f)throw f;await l()}catch(f){console.error("Error resuming ride:",f)}},d=async h=>{if(confirm("Are you sure you want to delete this recurring ride? This cannot be undone."))try{const{error:f}=await _.from("rides").delete().eq("id",h);if(f)throw f;await l()}catch(f){console.error("Error deleting ride:",f)}},m=h=>{if(!h)return"Custom schedule";if(h.type==="daily")return"Every day";if(h.type==="weekly"){const f=h.days||[];return f.length===5&&!f.includes("saturday")&&!f.includes("sunday")?"Weekdays":f.length===7?"Every day":`Every ${f.map(j=>j.charAt(0).toUpperCase()+j.slice(1,3)).join(", ")}`}else if(h.type==="monthly")return`Monthly on day ${h.dayOfMonth||"1"}`;return"Custom schedule"},u=h=>new Date(h).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});return n?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(si,{className:"w-6 h-6 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Recurring Rides"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your regular commute schedules"})]})]}),e.jsxs("button",{onClick:()=>s("/post-ride"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx(oa,{className:"w-5 h-5"}),"New Recurring Ride"]})]})}),e.jsx("div",{className:"p-6",children:r.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(si,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No recurring rides"}),e.jsx("p",{className:"text-sm mb-4",children:"Set up regular rides for your daily commute"}),e.jsx("button",{onClick:()=>s("/post-ride"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Create Recurring Ride"})]}):e.jsx("div",{className:"space-y-4",children:r.map(h=>e.jsx("div",{className:`p-5 rounded-xl border-2 transition-all ${h.status==="active"?"bg-blue-50 border-blue-200":"bg-gray-50 border-gray-200 opacity-75"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-3 rounded-full flex-shrink-0 ${h.status==="active"?"bg-blue-100":"bg-gray-200"}`,children:e.jsx(si,{className:`w-6 h-6 ${h.status==="active"?"text-blue-600":"text-gray-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("h4",{className:"font-bold text-gray-900",children:[h.origin,"  ",h.destination]}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full ${h.status==="active"?"bg-green-100 text-green-800":"bg-gray-200 text-gray-700"}`,children:h.status==="active"?"Active":"Paused"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:m(h.recurrence_pattern)})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:u(h.departure_time)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:h.estimated_distance?`${Math.round(h.estimated_distance)} km`:"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:h.estimated_duration?`${Math.round(h.estimated_duration/60)} min`:"N/A"})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-gray-700 font-medium",children:[h.available_seats," seats"]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.status==="active"?e.jsxs("button",{onClick:()=>o(h.id),className:"px-3 py-1.5 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 transition-colors text-sm font-medium flex items-center gap-1",children:[e.jsx(Mg,{className:"w-4 h-4"}),"Pause"]}):e.jsxs("button",{onClick:()=>c(h.id),className:"px-3 py-1.5 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 transition-colors text-sm font-medium flex items-center gap-1",children:[e.jsx(Fd,{className:"w-4 h-4"}),"Resume"]}),e.jsxs("button",{onClick:()=>s(`/rides/${h.id}`),className:"px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors text-sm font-medium flex items-center gap-1",children:[e.jsx(qd,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>d(h.id),className:"px-3 py-1.5 bg-red-100 text-red-800 rounded-lg hover:bg-red-200 transition-colors text-sm font-medium flex items-center gap-1",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Delete"]})]})]})]})},h.id))})}),e.jsx("div",{className:"p-6 bg-blue-50 border-t border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full flex-shrink-0",children:e.jsx(si,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-semibold mb-1",children:"About Recurring Rides"}),e.jsx("p",{className:"text-blue-800",children:"Set up recurring rides for your regular commutes. These rides will automatically be available for booking on the scheduled days, saving you time. You can pause or edit them anytime."})]})]})})]})}function bw({rideId:t,onComplete:s}){X();const[r,a]=x.useState(null),[n,i]=x.useState([]),[l,o]=x.useState(!0),[c,d]=x.useState(!1),[m,u]=x.useState(null);x.useEffect(()=>{h(),f();const y=setInterval(()=>{c&&j()},3e4);return()=>clearInterval(y)},[t,c]);const h=async()=>{try{const{data:y,error:b}=await _.rpc("get_active_ride_tracking",{p_ride_id:t});!b&&y&&y.length>0&&(a(y[0]),d(!0))}catch(y){console.error("Error loading tracking:",y)}finally{o(!1)}},f=async()=>{try{const{data:y,error:b}=await _.from("ride_bookings").select(`
          id,
          passenger_id,
          seats_requested,
          status,
          pickup_location,
          dropoff_location,
          passenger:profiles!ride_bookings_passenger_id_fkey(full_name)
        `).eq("ride_id",t).in("status",["confirmed","active","completed"]);if(b)throw b;const N=(y||[]).map(k=>({id:k.passenger_id,full_name:k.passenger.full_name,seats_requested:k.seats_requested,status:k.status,pickup_location:k.pickup_location,dropoff_location:k.dropoff_location}));i(N)}catch(y){console.error("Error loading passengers:",y)}},g=async()=>{if(!navigator.geolocation){alert("Geolocation is not supported by your browser");return}try{const y=await new Promise((k,E)=>{navigator.geolocation.getCurrentPosition(k,E)}),{data:b,error:N}=await _.rpc("start_ride_tracking",{p_ride_id:t,p_initial_lat:y.coords.latitude,p_initial_lng:y.coords.longitude});if(N)throw N;if(b&&b.length>0){const k=b[0];k.success?(d(!0),alert("Ride tracking started! Safe travels!"),h()):alert(k.message||"Failed to start tracking")}}catch(y){console.error("Error starting tracking:",y),alert(y.message||"Failed to start tracking")}},j=async()=>{if(navigator.geolocation)try{const y=await new Promise((b,N)=>{navigator.geolocation.getCurrentPosition(b,N)});await _.rpc("update_ride_location",{p_ride_id:t,p_lat:y.coords.latitude,p_lng:y.coords.longitude,p_speed_kmh:y.coords.speed?y.coords.speed*3.6:0,p_heading:y.coords.heading||0})}catch(y){console.error("Error updating location:",y)}},w=async y=>{u(y);try{const{data:b,error:N}=await _.rpc("mark_passenger_picked_up",{p_ride_id:t,p_passenger_id:y});if(N)throw N;b&&b.length>0&&b[0].success&&(alert("Passenger marked as picked up!"),f())}catch(b){console.error("Error marking picked up:",b),alert(b.message||"Failed to mark passenger as picked up")}finally{u(null)}},v=async y=>{u(y);try{const{data:b,error:N}=await _.rpc("mark_passenger_dropped_off",{p_ride_id:t,p_passenger_id:y});if(N)throw N;b&&b.length>0&&b[0].success&&(alert("Passenger marked as dropped off!"),f())}catch(b){console.error("Error marking dropped off:",b),alert(b.message||"Failed to mark passenger as dropped off")}finally{u(null)}},p=async()=>{if(confirm("Are you sure you want to complete this ride? All passengers must be dropped off."))try{const{data:y,error:b}=await _.rpc("complete_ride_tracking",{p_ride_id:t});if(b)throw b;if(y&&y.length>0){const N=y[0];N.success?(alert(`Ride completed successfully!
Duration: ${N.total_duration_minutes} minutes

Please review your passengers.`),s&&s()):alert(N.message||"Failed to complete ride")}}catch(y){console.error("Error completing ride:",y),alert(y.message||"Failed to complete ride")}};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsx("div",{className:"space-y-6",children:c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"font-medium text-green-900",children:"Ride in Progress - Location tracking active"})]})}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Passengers (",n.length,")"]}),e.jsx("div",{className:"space-y-3",children:n.map(y=>e.jsx("div",{className:`border rounded-lg p-4 ${y.status==="completed"?"bg-green-50 border-green-200":y.status==="active"?"bg-blue-50 border-blue-200":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:y.full_name}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),y.pickup_location,"  ",y.dropoff_location]}),e.jsxs("div",{className:"mt-1",children:[y.seats_requested," seat(s)"]})]}),e.jsxs("div",{className:"mt-2",children:[y.status==="confirmed"&&e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded",children:"Waiting for pickup"}),y.status==="active"&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Onboard"}),y.status==="completed"&&e.jsx("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Dropped off"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[y.status==="confirmed"&&e.jsxs("button",{onClick:()=>w(y.id),disabled:m===y.id,className:"px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ee,{className:"w-4 h-4"}),"Pick Up"]}),y.status==="active"&&e.jsxs("button",{onClick:()=>v(y.id),disabled:m===y.id,className:"px-3 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ee,{className:"w-4 h-4"}),"Drop Off"]})]})]})},y.id))}),n.every(y=>y.status==="completed")&&n.length>0&&e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("button",{onClick:p,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Complete Ride"]})})]})]}):e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Qt,{className:"w-8 h-8 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Start Ride Tracking"}),e.jsx("p",{className:"text-gray-600",children:"Start tracking to notify passengers and enable live location sharing"}),e.jsx("button",{onClick:g,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Start Tracking"})]})})})}function vw(){const{user:t}=X(),s=ie(),[r,a]=x.useState("offered"),[n,i]=x.useState([]),[l,o]=x.useState([]),[c,d]=x.useState([]),[m,u]=x.useState([]),[h,f]=x.useState([]),[g,j]=x.useState([]),[w,v]=x.useState([]),[p,y]=x.useState(!0),[b,N]=x.useState(null),[k,E]=x.useState(null),[C,R]=x.useState(null);x.useEffect(()=>{M(),r!=="requests"&&r!=="passengers"&&T();const S=()=>{M(),r!=="requests"&&r!=="passengers"&&T()};return window.addEventListener("booking-update",S),()=>{window.removeEventListener("booking-update",S)}},[t,r]);const T=async()=>{if(t)try{const{data:S,error:U}=await _.from("rides").select("id").eq("driver_id",t.id);if(U)throw U;const P=(S==null?void 0:S.map(A=>A.id))||[];if(P.length>0){const{data:A,error:W}=await _.from("ride_bookings").select("id").in("ride_id",P).eq("status","pending");!W&&A&&d(A)}}catch(S){console.error("Error loading requests count:",S)}},M=async()=>{if(t){y(!0);try{if(r==="offered"){const{data:S,error:U}=await _.from("rides").select("*").eq("driver_id",t.id).order("departure_time",{ascending:!1});if(U)throw U;i(S||[])}else if(r==="booked"){const{data:S,error:U}=await _.from("ride_bookings").select(`
            *,
            ride:rides(
              id,
              origin,
              destination,
              departure_time,
              driver:profiles!rides_driver_id_fkey(full_name, average_rating)
            )
          `).eq("passenger_id",t.id).order("created_at",{ascending:!1});if(U)throw U;o(S||[])}else if(r==="requests"){const{data:S,error:U}=await _.from("rides").select("id").eq("driver_id",t.id);if(U)throw U;const P=(S==null?void 0:S.map(A=>A.id))||[];if(P.length>0){const{data:A,error:W}=await _.from("ride_bookings").select(`
              *,
              passenger:profiles(
                id,
                full_name,
                average_rating,
                total_bookings,
                cancelled_bookings,
                last_minute_cancellations,
                reliability_score,
                bio
              ),
              ride:rides(
                id,
                origin,
                destination,
                departure_time,
                available_seats
              )
            `).in("ride_id",P).eq("status","pending").order("created_at",{ascending:!1});if(W)throw console.error("Error loading booking requests:",W),W;console.log("Booking requests loaded:",A),d(A||[])}else d([])}else if(r==="passengers"){const{data:S,error:U}=await _.from("rides").select("id").eq("driver_id",t.id);if(U)throw U;const P=(S==null?void 0:S.map(A=>A.id))||[];if(P.length>0){const{data:A,error:W}=await _.from("ride_bookings").select(`
              *,
              passenger:profiles(
                id,
                full_name,
                average_rating,
                total_bookings,
                cancelled_bookings,
                last_minute_cancellations,
                reliability_score,
                bio,
                phone
              ),
              ride:rides(
                id,
                origin,
                destination,
                departure_time,
                available_seats
              )
            `).in("ride_id",P).eq("status","confirmed").order("created_at",{ascending:!1});if(W)throw console.error("Error loading confirmed passengers:",W),W;u(A||[])}else u([])}else if(r==="myRequests"){const{data:S,error:U}=await _.from("ride_requests").select("*").eq("requester_id",t.id).order("departure_time",{ascending:!1});if(U)throw U;f(S||[])}else if(r==="pendingReviews"){const{data:S,error:U}=await _.rpc("get_pending_reviews");if(U)throw console.error("Error loading pending reviews:",U),U;j(S||[])}else if(r==="matchedPassengers"){const{data:S,error:U}=await _.from("rides").select("id, origin, destination, departure_time").eq("driver_id",t.id).eq("status","active").gte("departure_time",new Date().toISOString());if(U)throw U;const P=[];for(const A of S||[]){const{data:W,error:z}=await _.rpc("get_ride_matches_for_driver",{p_ride_id:A.id});!z&&W&&P.push(...W.map(Y=>({...Y,ride_id:A.id,ride_origin:A.origin,ride_destination:A.destination,departure_time:A.departure_time})))}v(P)}}catch(S){console.error("Error loading rides:",S)}finally{y(!1)}}},I=async S=>{if(confirm("Are you sure you want to delete this ride? This action cannot be undone.")){N(S);try{const{error:U}=await _.from("rides").delete().eq("id",S);if(U)throw U;i(P=>P.filter(A=>A.id!==S)),alert("Ride deleted successfully!")}catch(U){console.error("Error deleting ride:",U),alert("Failed to delete ride. Please try again.")}finally{N(null)}}},D=async S=>{if(confirm("Are you sure you want to cancel this ride?")){N(S);try{const{error:U}=await _.from("rides").update({status:"cancelled"}).eq("id",S);if(U)throw U;M(),alert("Ride cancelled successfully!")}catch(U){console.error("Error cancelling ride:",U),alert("Failed to cancel ride. Please try again.")}finally{N(null)}}},F=async S=>{if(confirm(`Accept booking request from ${S.passenger.full_name}?`)){E(S.id);try{const{error:U}=await _.rpc("driver_decide_booking",{p_booking_id:S.id,p_decision:"confirmed"});if(U)throw U;alert("Booking request accepted!"),M()}catch(U){console.error("Error accepting request:",U),alert(U.message||"Failed to accept request. Please try again.")}finally{E(null)}}},B=async S=>{if(prompt("Reason for rejecting (optional):")!==null&&confirm(`Reject booking request from ${S.passenger.full_name}?`)){E(S.id);try{const{error:P}=await _.rpc("driver_decide_booking",{p_booking_id:S.id,p_decision:"cancelled"});if(P)throw P;alert("Booking request rejected."),M()}catch(P){console.error("Error rejecting request:",P),alert(P.message||"Failed to reject request. Please try again.")}finally{E(null)}}},H=async(S,U)=>{const P=prompt("Please provide a reason for cancellation (optional):");if(P!==null&&confirm("Are you sure you want to cancel this booking?")){N(S);try{const{error:A}=await _.rpc("cancel_booking",{p_booking_id:S,p_reason:P||"No reason provided"});if(A)throw A;M(),alert("Booking cancelled successfully!")}catch(A){console.error("Error cancelling booking:",A);const W=A.message||"Failed to cancel booking. Please try again.";W.includes("already cancelled")?alert("This booking is already cancelled."):alert(W)}finally{N(null)}}},O=S=>new Date(S).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),$=S=>new Date(S)<new Date,L=(S,U=!1)=>{if(U)return"bg-gray-200 text-gray-800";switch(S){case"active":return"bg-green-100 text-green-800";case"in-progress":return"bg-blue-100 text-blue-800";case"completed":return"bg-gray-200 text-gray-800";case"cancelled":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-900";case"confirmed":return"bg-green-100 text-green-900";default:return"bg-gray-200 text-gray-800"}},V=(S,U=!1)=>U?"expired":S;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Rides"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your rides and bookings"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"border-b border-gray-200 flex",children:[e.jsx("button",{onClick:()=>a("offered"),className:`flex-1 px-6 py-4 font-medium transition-colors ${r==="offered"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Rides I'm Offering"}),e.jsxs("button",{onClick:()=>a("requests"),className:`flex-1 px-6 py-4 font-medium transition-colors relative ${r==="requests"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:["Requests",c.length>0&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-red-600 rounded-full",children:c.length})]}),e.jsxs("button",{onClick:()=>a("passengers"),className:`flex-1 px-6 py-4 font-medium transition-colors ${r==="passengers"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:["Passengers",m.length>0&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-green-600 rounded-full",children:m.length})]}),e.jsx("button",{onClick:()=>a("booked"),className:`flex-1 px-6 py-4 font-medium transition-colors ${r==="booked"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"My Bookings"}),e.jsx("button",{onClick:()=>a("myRequests"),className:`flex-1 px-6 py-4 font-medium transition-colors ${r==="myRequests"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"My Ride Requests"}),e.jsxs("button",{onClick:()=>a("pendingReviews"),className:`flex-1 px-6 py-4 font-medium transition-colors relative ${r==="pendingReviews"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:["Pending Reviews",g.length>0&&r!=="pendingReviews"&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-yellow-600 rounded-full",children:g.length})]}),e.jsxs("button",{onClick:()=>a("matchedPassengers"),className:`flex-1 px-6 py-4 font-medium transition-colors relative ${r==="matchedPassengers"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:["Matched Passengers",w.length>0&&r!=="matchedPassengers"&&e.jsx("span",{className:"ml-2 inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-blue-600 rounded-full",children:w.length})]})]}),e.jsx("div",{className:"p-6",children:p?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):r==="offered"?e.jsx("div",{className:"space-y-4",children:n.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(pe,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No rides offered yet"}),e.jsx("p",{className:"text-sm",children:"Start by posting your first ride!"})]}):n.map(S=>{const U=$(S.departure_time),P=S.status==="cancelled";return e.jsxs("div",{className:`border rounded-xl p-6 transition-all ${U||P?"border-gray-200 bg-gray-50 opacity-75":"border-gray-200 bg-white hover:shadow-lg cursor-pointer"}`,onClick:()=>{!U&&!P&&s(`/rides/${S.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${L(S.status,U)}`,children:V(S.status,U)}),S.is_recurring&&e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:"Recurring"}),U&&!P&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ne,{className:"w-3 h-3"}),"Past departure time"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!U&&!P&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A=>{A.stopPropagation(),s(`/rides/${S.id}`)},className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Details",children:e.jsx(Ye,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),alert("Edit functionality coming soon!")},className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit Ride",children:e.jsx(Rj,{className:"w-4 h-4"})}),e.jsx("button",{onClick:A=>{A.stopPropagation(),D(S.id)},className:"p-2 text-orange-600 hover:bg-orange-50 rounded-lg transition-colors",title:"Cancel Ride",disabled:b===S.id,children:e.jsx(ne,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:A=>{A.stopPropagation(),I(S.id)},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Ride",disabled:b===S.id,children:b===S.id?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ns,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:S.origin}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"font-medium",children:S.destination})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),O(S.departure_time)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),S.available_seats,"/",S.total_seats," available"]})]}),S.notes&&e.jsx("p",{className:"mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3 line-clamp-2",children:S.notes}),(S.status==="active"||S.status==="in-progress")&&!U&&e.jsxs("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[e.jsxs("button",{onClick:A=>{A.stopPropagation(),R(C===S.id?null:S.id)},className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),C===S.id?"Hide Tracking":"Manage Ride Tracking"]}),C===S.id&&e.jsx("div",{className:"mt-4 border-t border-gray-200 pt-4",children:e.jsx(bw,{rideId:S.id,onComplete:()=>{R(null),M()}})})]})]},S.id)})}):r==="requests"?e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No pending requests"}),e.jsx("p",{className:"text-sm",children:"Booking requests will appear here"})]}):c.map(S=>{if(!S.passenger||!S.ride)return console.error("Invalid booking request data:",S),null;const U=S.passenger.reliability_score>=4.5?"text-green-600":S.passenger.reliability_score>=3.5?"text-yellow-600":"text-red-600";return e.jsxs("div",{className:"border-2 border-blue-200 rounded-xl p-6 bg-blue-50",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-200 rounded-full flex items-center justify-center text-2xl font-bold text-blue-700 flex-shrink-0",children:S.passenger.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:S.passenger.full_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-1 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),S.passenger.average_rating.toFixed(1)]}),e.jsxs("span",{className:"text-gray-600",children:[S.passenger.total_bookings," bookings"]}),e.jsxs("span",{className:`flex items-center gap-1 font-medium ${U}`,children:[e.jsx(me,{className:"w-4 h-4"}),S.passenger.reliability_score.toFixed(1)," reliability"]})]}),S.passenger.cancelled_bookings>0&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 bg-white px-3 py-1 rounded-lg inline-block",children:[" ",S.passenger.cancelled_bookings," cancellations",S.passenger.last_minute_cancellations>0&&` (${S.passenger.last_minute_cancellations} last-minute)`]}),S.passenger.bio&&e.jsxs("p",{className:"mt-2 text-sm text-gray-700 italic line-clamp-2",children:['"',S.passenger.bio,'"']})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),"Trip Details"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"From:"})," ",S.pickup_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"To:"})," ",S.dropoff_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Seats:"})," ",S.seats_requested]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),"Ride Info"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Route:"})," ",S.ride.origin,"  ",S.ride.destination]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Departure:"})," ",O(S.ride.departure_time)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Requested:"})," ",new Date(S.created_at).toLocaleString()]})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>F(S),disabled:k===S.id,className:"flex-1 bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:k===S.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5"}),"Accept"]})}),e.jsx("button",{onClick:()=>B(S),disabled:k===S.id,className:"flex-1 bg-red-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:k===S.id?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"w-5 h-5"}),"Reject"]})})]})]},S.id)})}):r==="passengers"?e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No confirmed passengers"}),e.jsx("p",{className:"text-sm",children:"Passengers will appear here after you accept booking requests"})]}):m.map(S=>!S.passenger||!S.ride?null:e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 border border-green-200",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-200 rounded-full flex items-center justify-center text-2xl font-bold text-green-700 flex-shrink-0",children:S.passenger.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-900",children:S.passenger.full_name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-1 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),S.passenger.average_rating.toFixed(1)]}),e.jsxs("span",{className:"text-gray-600",children:[S.passenger.total_bookings," bookings"]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-green-600",children:[e.jsx(me,{className:"w-4 h-4"}),S.passenger.reliability_score.toFixed(1)," reliability"]})]})]})]}),e.jsx("div",{className:"bg-white rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),"Ride Details"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Route:"})," ",S.ride.origin,"  ",S.ride.destination]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Departure:"})," ",O(S.ride.departure_time)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Seats Booked:"})," ",S.seats_requested]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),"Pickup & Drop-off"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pickup:"})," ",S.pickup_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Drop-off:"})," ",S.dropoff_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Confirmed:"})," ",new Date(S.updated_at).toLocaleString()]})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{s("/messages",{state:{userId:S.passenger.id,userName:S.passenger.full_name}})},className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(Nt,{className:"w-5 h-5"}),"Message Passenger"]}),S.passenger.phone&&e.jsxs("a",{href:`tel:${S.passenger.phone}`,className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(dt,{className:"w-5 h-5"}),"Call"]})]})]},S.id))}):r==="booked"?e.jsx("div",{className:"space-y-4",children:l.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No bookings yet"}),e.jsx("p",{className:"text-sm",children:"Find a ride to get started!"})]}):l.map(S=>{var W,z;const U=$(S.ride.departure_time),P=S.status==="cancelled",A=!U&&!P&&(S.status==="pending"||S.status==="confirmed");return e.jsxs("div",{className:`border rounded-xl p-6 transition-all ${U||P?"border-gray-200 bg-gray-50 opacity-75":"border-gray-200 bg-white hover:shadow-lg cursor-pointer"}`,onClick:()=>{!U&&!P&&s(`/bookings/${S.id}`)},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${L(S.status,U)}`,children:V(S.status,U)}),U&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ne,{className:"w-3 h-3"}),"Past departure time"]})]}),A&&e.jsx("button",{onClick:Y=>{Y.stopPropagation(),H(S.id,S.ride.departure_time)},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Cancel Booking",disabled:b===S.id,children:b===S.id?e.jsx("div",{className:"w-4 h-4 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Qe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:S.pickup_location}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"font-medium",children:S.dropoff_location})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),O(S.ride.departure_time)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),S.seats_requested," ",S.seats_requested===1?"seat":"seats"]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-100 text-sm text-gray-600",children:e.jsxs("p",{children:["Driver: ",e.jsx("span",{className:"font-medium",children:(W=S.ride.driver)==null?void 0:W.full_name}),"  ",e.jsxs("span",{className:"text-yellow-600",children:[" ",(z=S.ride.driver)==null?void 0:z.average_rating.toFixed(1)]})]})})]},S.id)})}):r==="myRequests"?e.jsx("div",{className:"space-y-4",children:h.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(xe,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No ride requests yet"}),e.jsx("p",{className:"text-sm mb-4",children:"Post a ride request to find a driver"}),e.jsxs("button",{onClick:()=>s("/request-ride"),className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(xe,{className:"w-5 h-5"}),"Request a Ride"]})]}):h.map(S=>{const U=$(S.departure_time),P=S.status==="cancelled";return e.jsxs("div",{className:`border rounded-xl p-6 ${U||P?"border-gray-200 bg-gray-50 opacity-75":"border-blue-200 bg-blue-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${L(S.status,U)}`,children:V(S.status,U)}),U&&e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ne,{className:"w-3 h-3"}),"Past departure time"]}),S.flexible_time&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium",children:"Flexible Time"})]}),!U&&!P&&e.jsx("button",{onClick:()=>{confirm("Are you sure you want to cancel this ride request?")&&_.from("ride_requests").update({status:"cancelled"}).eq("id",S.id).then(()=>M())},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Cancel Request",children:e.jsx(Qe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:S.from_location}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"font-medium",children:S.to_location})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),O(S.departure_time)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-4 h-4"}),S.seats_needed," ",S.seats_needed===1?"seat":"seats"," needed"]})]}),S.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium mb-1",children:"Additional Notes:"}),e.jsx("p",{children:S.notes})]}),e.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:["Posted ",new Date(S.created_at).toLocaleDateString()]})]},S.id)})}):r==="pendingReviews"?e.jsx("div",{className:"space-y-4",children:g.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(we,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No pending reviews"}),e.jsx("p",{className:"text-sm",children:"You're all caught up! Reviews will appear here after completing rides."})]}):g.map(S=>e.jsxs("div",{className:"border-2 border-yellow-200 rounded-xl p-6 bg-yellow-50",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-14 h-14 bg-yellow-200 rounded-full flex items-center justify-center text-2xl font-bold text-yellow-700 flex-shrink-0",children:S.reviewee_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:S.reviewee_name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["As: ",e.jsx("span",{className:"font-medium capitalize",children:S.role})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[S.ride_origin,"  ",S.ride_destination]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Completed: ",new Date(S.completed_at).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx(we,{className:"w-4 h-4 inline text-yellow-500 mr-1"}),"Please share your experience to help other users"]})}),e.jsxs("button",{onClick:()=>s(`/bookings/${S.booking_id}`),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-5 h-5"}),"Leave Review"]})]},S.booking_id))}):r==="matchedPassengers"?e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No matched passengers yet"}),e.jsx("p",{className:"text-sm",children:"Our algorithm will find potential passengers that match your upcoming rides."})]}):w.map(S=>{const U=S.match_score>=80?"bg-green-100 text-green-800":S.match_score>=60?"bg-blue-100 text-blue-800":S.match_score>=40?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800";return e.jsxs("div",{className:"border-2 border-blue-200 rounded-xl p-6 bg-gradient-to-br from-blue-50 to-white",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:"w-14 h-14 bg-blue-200 rounded-full flex items-center justify-center text-2xl font-bold text-blue-700 flex-shrink-0",children:S.passenger_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-900",children:S.passenger_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),S.passenger_rating.toFixed(1)]}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${U}`,children:[S.match_score,"% Match"]})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),"Passenger's Trip"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"From:"})," ",S.from_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"To:"})," ",S.to_location]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Seats Needed:"})," ",S.seats_needed]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-blue-600"}),"Your Ride"]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Route:"})," ",S.ride_origin,"  ",S.ride_destination]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Departure:"})," ",O(S.departure_time)]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Matched ",new Date(S.created_at).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>{s("/messages",{state:{userId:S.passenger_id,userName:S.passenger_name}})},className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(Nt,{className:"w-5 h-5"}),"Contact Passenger"]}),e.jsxs("button",{onClick:()=>s(`/rides/${S.ride_id}`),className:"flex-1 border-2 border-blue-600 text-blue-600 px-6 py-3 rounded-lg hover:bg-blue-50 transition-colors font-medium flex items-center justify-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),"View Ride"]})]})]},S.match_id)})}):null})]}),e.jsx(yw,{})]})}function jw({initialConversationId:t}){const{user:s,isEmailVerified:r}=X();ie();const[a,n]=x.useState([]),[i,l]=x.useState(t||null),[o,c]=x.useState([]),[d,m]=x.useState(""),[u,h]=x.useState(!0),[f,g]=x.useState(""),[j,w]=x.useState(!1),v=x.useRef(null),p=x.useRef(null),y=x.useCallback(()=>{var D;(D=v.current)==null||D.scrollIntoView({behavior:"smooth"})},[]);x.useEffect(()=>{y()},[o,y]);const b=x.useCallback(async()=>{if(s)try{const{data:D,error:F}=await _.from("conversations").select(`
          *,
          members:conversation_members(
            user_id,
            role,
            profiles(id, full_name, avatar_url, profile_photo_url)
          )
        `).order("updated_at",{ascending:!1});if(F)throw F;const B=await Promise.all((D||[]).map(async H=>{const{data:O}=await _.from("chat_messages").select("*, sender:profiles(id, full_name, avatar_url, profile_photo_url)").eq("conversation_id",H.id).order("created_at",{ascending:!1}).limit(1).maybeSingle(),{data:$}=await _.from("chat_messages").select("id, sender_id").eq("conversation_id",H.id).neq("sender_id",s.id);let L=0;if($)for(const V of $){const{data:S}=await _.from("message_reads").select("id").eq("message_id",V.id).eq("user_id",s.id).maybeSingle();S||L++}return{...H,latest_message:O,unread_count:L}}));n(B)}catch(D){console.error("Error loading conversations:",D)}finally{h(!1)}},[s]),N=x.useCallback(async D=>{try{const{data:F,error:B}=await _.from("chat_messages").select("*, sender:profiles(id, full_name, avatar_url, profile_photo_url)").eq("conversation_id",D).order("created_at",{ascending:!0});if(B)throw B;c(F||[])}catch(F){console.error("Error loading messages:",F)}},[]),k=x.useCallback(async D=>{if(s)try{const{data:F}=await _.from("chat_messages").select("id").eq("conversation_id",D).neq("sender_id",s.id);if(!F||F.length===0)return;for(const B of F)await _.from("message_reads").insert({message_id:B.id,user_id:s.id}).onConflict("message_id,user_id").ignore();await b()}catch(F){console.error("Error marking messages as read:",F)}},[s,b]);x.useEffect(()=>{if(!s)return;const D=_.channel("chat-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},F=>{const B=F.new;i===B.conversation_id&&(N(B.conversation_id),B.sender_id!==s.id&&setTimeout(()=>{_.from("message_reads").insert({message_id:B.id,user_id:s.id}).onConflict("message_id,user_id").ignore()},500)),b()}).on("postgres_changes",{event:"INSERT",schema:"public",table:"message_reads"},()=>{b()}).subscribe();return()=>{_.removeChannel(D)}},[s,i,N,b]),x.useEffect(()=>{s&&b()},[s,b]),x.useEffect(()=>{i&&(N(i),k(i))},[i,N,k]);const E=async D=>{if(D.preventDefault(),!(!s||!i||!d.trim()||!r||j)){w(!0);try{const{error:F}=await _.from("chat_messages").insert({conversation_id:i,sender_id:s.id,body:d.trim(),type:"TEXT"});if(F)throw F;m(""),y()}catch(F){console.error("Error sending message:",F),alert("Failed to send message. Please try again.")}finally{w(!1)}}},C=D=>D.members.filter(F=>F.user_id!==(s==null?void 0:s.id)),R=D=>{const F=C(D);return F.length===0?"You":F.length===1?F[0].profiles.full_name:F.map(B=>B.profiles.full_name).join(", ")},T=D=>{const F=new Date(D),H=new Date().getTime()-F.getTime(),O=Math.floor(H/(1e3*60*60*24));return O===0?F.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}):O===1?"Yesterday":O<7?F.toLocaleDateString("en-GB",{weekday:"short"}):F.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit"})},M=a.filter(D=>R(D).toLowerCase().includes(f.toLowerCase())),I=a.find(D=>D.id===i);return u?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsx("div",{className:"w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):e.jsxs("div",{className:"flex h-[calc(100vh-64px)] bg-gray-50",children:[e.jsxs("div",{className:`w-full md:w-96 bg-white border-r border-gray-200 flex flex-col ${i?"hidden md:flex":"flex"}`,children:[e.jsxs("div",{className:"p-4 bg-green-600 text-white",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Messages"}),e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:f,onChange:D=>g(D.target.value),className:"w-full pl-10 pr-4 py-2 bg-white text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-300"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:M.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 p-6",children:[e.jsx(Nt,{className:"w-16 h-16 mb-4 text-gray-300"}),e.jsx("p",{className:"text-center",children:"No conversations yet"})]}):M.map(D=>{C(D);const F=R(D).charAt(0).toUpperCase();return e.jsx("button",{onClick:()=>l(D.id),className:`w-full p-4 border-b border-gray-100 hover:bg-gray-50 transition-colors text-left ${i===D.id?"bg-green-50":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-semibold text-lg",children:F}),D.unread_count>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:D.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:R(D)}),D.latest_message&&e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:T(D.latest_message.created_at)})]}),D.latest_message&&e.jsx("p",{className:`text-sm truncate ${D.unread_count>0?"font-semibold text-gray-900":"text-gray-600"}`,children:D.latest_message.body})]})]})},D.id)})})]}),e.jsx("div",{className:`flex-1 flex flex-col bg-gray-50 ${i?"flex":"hidden md:flex"}`,children:I?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-4 flex items-center gap-3 shadow-sm",children:[e.jsx("button",{onClick:()=>l(null),className:"md:hidden p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Re,{className:"w-5 h-5 text-gray-600"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-semibold",children:R(I).charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:R(I)}),e.jsx("p",{className:"text-xs text-gray-500",children:I.type==="RIDE_MATCH"?"Ride Chat":I.type==="TRIP_MATCH"?"Trip Chat":"Direct Message"})]})]}),e.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto p-4 space-y-4",style:{paddingBottom:"env(safe-area-inset-bottom, 20px)"},children:[o.map(D=>{const F=D.sender_id===(s==null?void 0:s.id);return e.jsx("div",{className:`flex ${F?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] rounded-lg px-4 py-2 ${F?"bg-green-500 text-white":"bg-white text-gray-900 shadow-sm"}`,children:[e.jsx("p",{className:"break-words",children:D.body}),e.jsx("span",{className:`text-xs mt-1 block ${F?"text-white/70":"text-gray-500"}`,children:new Date(D.created_at).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})]})},D.id)}),e.jsx("div",{ref:v})]}),e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 safe-area-bottom",children:[!r&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-sm mb-3 bg-amber-50 px-3 py-2 rounded-lg",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Verify your email to send messages"})]}),e.jsxs("form",{onSubmit:E,className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:D=>m(D.target.value),placeholder:r?"Type a message...":"Verify email to send",disabled:!r||j,className:"flex-1 px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 disabled:bg-gray-100",style:{fontSize:"16px"}}),e.jsx("button",{type:"submit",disabled:!d.trim()||!r||j,className:"p-3 bg-green-500 text-white rounded-full hover:bg-green-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex-shrink-0",children:e.jsx(Tl,{className:"w-5 h-5"})})]})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Nt,{className:"w-24 h-24 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Select a conversation"}),e.jsx("p",{className:"text-gray-400",children:"Choose a conversation from the list to start messaging"})]})})})]})}async function Hg(t){try{let s=_.from("conversations").select("id, members:conversation_members(user_id)");t.type==="RIDE_MATCH"&&t.rideId?s=s.eq("type","RIDE_MATCH").eq("ride_id",t.rideId):t.type==="TRIP_MATCH"&&t.tripRequestId?s=s.eq("type","TRIP_MATCH").eq("trip_request_id",t.tripRequestId):t.type==="FRIENDS_DM"&&(s=s.eq("type","FRIENDS_DM"));const{data:r}=await s;if(t.type==="FRIENDS_DM"&&r){const c=t.members.map(d=>d.userId).sort();for(const d of r){const m=d.members.map(u=>u.user_id).sort();if(m.length===c.length&&m.every((u,h)=>u===c[h]))return d.id}}if(t.type!=="FRIENDS_DM"&&r&&r.length>0){const c=t.members.map(d=>d.userId).sort();for(const d of r){const m=d.members.map(u=>u.user_id).sort();if(m.length===c.length&&m.every((u,h)=>u===c[h]))return d.id}}const a={type:t.type};t.rideId&&(a.ride_id=t.rideId),t.tripRequestId&&(a.trip_request_id=t.tripRequestId);const{data:n,error:i}=await _.from("conversations").insert(a).select("id").single();if(i)throw i;const l=t.members.map(c=>({conversation_id:n.id,user_id:c.userId,role:c.role})),{error:o}=await _.from("conversation_members").insert(l);if(o)throw o;return n.id}catch(s){return console.error("Error creating/getting conversation:",s),null}}async function ww(t,s,r){return Hg({type:"RIDE_MATCH",rideId:t,members:[{userId:s,role:"DRIVER"},{userId:r,role:"RIDER"}]})}async function Nw(t,s){return Hg({type:"FRIENDS_DM",members:[{userId:t,role:"FRIEND"},{userId:s,role:"FRIEND"}]})}function _w(){const t=Xs(),{user:s}=X(),{userId:r,rideId:a,driverId:n}=t.state||{},[i,l]=x.useState(),[o,c]=x.useState(!0);return x.useEffect(()=>{(async()=>{if(!s){c(!1);return}if(r){const m=await Nw(s.id,r);m&&l(m)}else if(a&&n){const m=await ww(a,n,s.id);m&&l(m)}c(!1)})()},[s,r,a,n]),o?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{children:e.jsx(jw,{initialConversationId:i})})}const kw=(()=>{const t=document.createElement("canvas");return t.getContext&&t.getContext("2d")?t.toDataURL("image/webp").indexOf("data:image/webp")===0:!1})();async function Sw(t){return new Promise((s,r)=>{const a=new Image;a.onload=()=>{URL.revokeObjectURL(a.src),s(a)},a.onerror=n=>{URL.revokeObjectURL(a.src),r(new Error("Failed to load image. Please try a different photo."))},a.src=URL.createObjectURL(t)})}function Cw(t,s){const r=document.createElement("canvas"),a=r.getContext("2d");let n=t.width,i=t.height;switch(s>4&&s<9?(r.width=i,r.height=n):(r.width=n,r.height=i),s){case 2:a.transform(-1,0,0,1,n,0);break;case 3:a.transform(-1,0,0,-1,n,i);break;case 4:a.transform(1,0,0,-1,0,i);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,i,0);break;case 7:a.transform(0,-1,-1,0,i,n);break;case 8:a.transform(0,-1,1,0,0,n);break}return a.drawImage(t,0,0),r}async function Ew(t){return new Promise(s=>{const r=new FileReader;r.onload=a=>{var o;const n=new DataView((o=a.target)==null?void 0:o.result);if(n.getUint16(0,!1)!==65496){s(1);return}const i=n.byteLength;let l=2;for(;l<i;){if(n.getUint16(l+2,!1)<=8){s(1);return}const c=n.getUint16(l,!1);if(l+=2,c===65505){if(l+=2,n.getUint32(l,!1)!==1165519206){s(1);return}const d=n.getUint16(l+=6,!1)===18761;l+=n.getUint32(l+4,d);const m=n.getUint16(l,d);l+=2;for(let u=0;u<m;u++)if(n.getUint16(l+u*12,d)===274){s(n.getUint16(l+u*12+8,d));return}}else{if((c&65280)!==65280)break;l+=n.getUint16(l,!1)}}s(1)},r.onerror=()=>s(1),r.readAsArrayBuffer(t)})}function Rw(t,s,r,a){if(t<=r&&s<=a)return{width:t,height:s};const n=t/s;return t>s?{width:r,height:Math.round(r/n)}:{width:Math.round(a*n),height:a}}async function yo(t,s,r,a,n){return new Promise((i,l)=>{const o=document.createElement("canvas");o.width=s,o.height=r;const c=o.getContext("2d");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.drawImage(t,0,0,s,r),o.toBlob(d=>{d?i({blob:d,size:d.size}):l(new Error("Failed to compress image. Your browser may not support this image format."))},a==="webp"?"image/webp":"image/jpeg",n)})}async function Pw(t,s,r,a,n,i,l=.55){let o=.92,c,d;const m=await yo(t,s,r,a,o);if(c=m.blob,d=m.size,d<=n)return{blob:c,quality:o};let u=l,h=o;for(;h-u>.05;){o=(u+h)/2;const g=await yo(t,s,r,a,o);if(c=g.blob,d=g.size,d>i)h=o;else{if(d>n)return{blob:c,quality:o};u=o}}return{blob:(await yo(t,s,r,a,u)).blob,quality:u}}async function Vd(t,s){try{if(!t.type.startsWith("image/"))throw new Error("File must be an image");if(t.size>10*1024*1024)throw new Error("Image size must be less than 10MB");const r=await Ew(t);let a=await Sw(t),n;if(r>1){n=Cw(a,r);const h=new Image;await new Promise((f,g)=>{h.onload=f,h.onerror=()=>g(new Error("Failed to process image orientation")),h.src=n.toDataURL()}),a=h}const i=Rw(a.width,a.height,s.maxWidth,s.maxHeight),l=kw&&s.format==="webp"?"webp":"jpeg",{blob:o,quality:c}=await Pw(a,i.width,i.height,l,s.targetSize,s.maxSize,s.minQuality),d=l==="webp"?"webp":"jpg",m=new File([o],`image.${d}`,{type:`image/${l}`}),u=await new Promise((h,f)=>{const g=new FileReader;g.onload=()=>h(g.result),g.onerror=()=>f(new Error("Failed to read compressed image")),g.readAsDataURL(o)});return console.log(`Compressed to ${(o.size/1024).toFixed(1)}KB (${i.width}x${i.height}) at quality ${(c*100).toFixed(0)}%`),{file:m,dataUrl:u,width:i.width,height:i.height,size:o.size}}catch(r){throw console.error("Image compression error:",r),r instanceof Error?r:new Error("Failed to compress image. Please try a different photo.")}}async function Gg(t,s){return Vd(t,{maxWidth:s.width,maxHeight:s.height,targetSize:s.maxSize*.75,maxSize:s.maxSize,format:"webp",minQuality:.6})}async function Tw(t){const s=await Vd(t,{maxWidth:1024,maxHeight:1024,targetSize:204800,maxSize:307200,format:"webp"}),r=await Gg(t,{width:256,height:256,maxSize:40*1024});return{optimized:s,thumbnail:r}}async function Aw(t){const s=await Vd(t,{maxWidth:1600,maxHeight:1600,targetSize:614400,maxSize:921600,format:"webp"}),r=await Gg(t,{width:512,height:512,maxSize:80*1024});return{optimized:s,thumbnail:r}}const ma="user-media";async function Kg(t,s,r){try{r==null||r(10);const{optimized:a,thumbnail:n}=await Tw(s);r==null||r(60);const i=`users/${t}/profile.webp`,l=`users/${t}/profile_thumb.webp`;console.log("Uploading profile photo to path:",i);const{data:o,error:c}=await _.storage.from(ma).upload(i,a.file,{upsert:!0,contentType:"image/webp"});if(c)throw console.error("Profile photo upload error:",c),new Error(c.message||"Failed to upload profile photo");console.log("Profile photo uploaded successfully:",o),r==null||r(80);const{data:d,error:m}=await _.storage.from(ma).upload(l,n.file,{upsert:!0,contentType:"image/webp"});if(m)throw console.error("Profile thumbnail upload error:",m),new Error(m.message||"Failed to upload profile thumbnail");console.log("Profile thumbnail uploaded successfully:",d),r==null||r(90);const u=await nl(i),h=await nl(l);return console.log("Generated URLs:",{optimizedUrl:u,thumbnailUrl:h}),r==null||r(100),{optimizedPath:i,thumbnailPath:l,optimizedUrl:u,thumbnailUrl:h}}catch(a){throw console.error("Error uploading profile photo:",a),a}}async function Dw(t,s,r,a){try{a==null||a(10);const{optimized:n,thumbnail:i}=await Aw(r);a==null||a(60);const l=`vehicles/${t}/${s}/front.webp`,o=`vehicles/${t}/${s}/front_thumb.webp`;console.log("Uploading vehicle photo to path:",l,{userId:t,vehicleId:s});const{data:c,error:d}=await _.storage.from(ma).upload(l,n.file,{upsert:!0,contentType:"image/webp"});if(d)throw console.error("Vehicle photo upload error:",d),new Error(d.message||"Failed to upload vehicle photo");console.log("Vehicle photo uploaded successfully:",c),a==null||a(80);const{data:m,error:u}=await _.storage.from(ma).upload(o,i.file,{upsert:!0,contentType:"image/webp"});if(u)throw console.error("Vehicle thumbnail upload error:",u),new Error(u.message||"Failed to upload vehicle thumbnail");console.log("Vehicle thumbnail uploaded successfully:",m),a==null||a(90);const h=await nl(l),f=await nl(o);return console.log("Generated URLs:",{optimizedUrl:h,thumbnailUrl:f}),a==null||a(100),{optimizedPath:l,thumbnailPath:o,optimizedUrl:h,thumbnailUrl:f}}catch(n){throw console.error("Error uploading vehicle photo:",n),n}}async function nl(t){const{data:s}=_.storage.from(ma).getPublicUrl(t);return s.publicUrl}function Am(t){if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;const{data:s}=_.storage.from(ma).getPublicUrl(t);return s.publicUrl}async function $w(t){try{if(!("FaceDetector"in window))return console.log("Face Detection API not available, using fallback"),Dm(t);const r=await new window.FaceDetector().detect(t);return r&&r.length>0?{hasFace:!0,faceCount:r.length,confidence:.9,message:`Found ${r.length} face${r.length>1?"s":""} in the image`}:{hasFace:!1,faceCount:0,confidence:0,message:"No faces detected. Please upload a clear photo of your face."}}catch(s){return console.warn("Native face detection failed, using fallback:",s),Dm(t)}}function Dm(t){try{const s=document.createElement("canvas");s.width=t.width,s.height=t.height;const r=s.getContext("2d");if(!r)return{hasFace:!1,faceCount:0,confidence:0,message:"Unable to process image"};r.drawImage(t,0,0);const n=r.getImageData(0,0,s.width,s.height).data;let i=0,l=n.length/4;for(let c=0;c<n.length;c+=4){const d=n[c],m=n[c+1],u=n[c+2];d>95&&m>40&&u>20&&d>m&&d>u&&Math.abs(d-m)>15&&i++}const o=i/l*100;return o>5&&o<70?{hasFace:!0,faceCount:1,confidence:Math.min(o/100,.85),message:"Face detected in the image"}:{hasFace:!1,faceCount:0,confidence:0,message:"No clear face detected. Please upload a clearer photo of your face."}}catch(s){return console.error("Canvas face detection failed:",s),{hasFace:!1,faceCount:0,confidence:0,message:"Could not verify face detection. Please ensure your photo is clear."}}}async function Iw(t){try{if(!t.type.startsWith("image/"))return{hasFace:!1,faceCount:0,confidence:0,message:"Please select a valid image file"};const s=await t.arrayBuffer(),r=new Blob([s],{type:t.type}),a=await createImageBitmap(r).catch(i=>{throw console.error("Failed to create image bitmap:",i),new Error("Unable to process image. Please try a different photo.")}),n=await $w(a);return a.close(),n}catch(s){return console.error("Face detection error:",s),{hasFace:!1,faceCount:0,confidence:0,message:s instanceof Error?s.message:"Error processing image. Please try again."}}}async function Yg(t){try{if(t.size>10*1024*1024)return{valid:!1,message:"Image size must be less than 10MB",faceDetected:!1,error:"File size too large"};if(!t.type.startsWith("image/"))return{valid:!1,message:"Please select a valid image file (JPG, PNG, WebP)",faceDetected:!1,error:"Invalid file type"};try{const s=await Iw(t);return{valid:!0,message:s.hasFace?"Profile photo is valid and contains a face":"Photo uploaded (face detection inconclusive)",faceDetected:s.hasFace}}catch(s){return console.warn("Face detection failed, allowing upload anyway:",s),{valid:!0,message:"Photo uploaded successfully",faceDetected:!1}}}catch(s){console.error("Profile photo validation error:",s);const r=s instanceof Error?s.message:"Unable to validate photo";return{valid:!1,message:r,faceDetected:!1,error:r}}}function Lw(){const[t,s]=x.useState([]),[r,a]=x.useState(!0),[n,i]=x.useState(!1),[l,o]=x.useState(""),[c,d]=x.useState(!1),[m,u]=x.useState(""),[h,f]=x.useState(""),[g,j]=x.useState(!1);x.useEffect(()=>{j(da()),da()?w():a(!1)},[]);const w=async()=>{try{a(!0);const y=await Bg();s(y)}catch(y){u(y.message||"Failed to load passkeys")}finally{a(!1)}},v=async y=>{if(y.preventDefault(),!l.trim()){u("Please enter a device name");return}u(""),f(""),d(!0);try{await qg(l),f("Passkey registered successfully!"),i(!1),o(""),await w()}catch(b){u(b.message||"Failed to register passkey")}finally{d(!1)}},p=async y=>{if(confirm("Are you sure you want to remove this passkey?"))try{await zg(y),f("Passkey removed successfully"),await w()}catch(b){u(b.message||"Failed to remove passkey")}};return g?r?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(at,{className:"w-6 h-6 animate-spin text-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(kc,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Passkeys"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your passkeys for quick and secure sign-in"})]})]}),!n&&e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx(oa,{className:"w-4 h-4"}),"Add Passkey"]})]}),m&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-start gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:m})]}),h&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-start gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-green-800",children:h})]}),n&&e.jsxs("form",{onSubmit:v,className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Register New Passkey"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Device Name"}),e.jsx("input",{type:"text",value:l,onChange:y=>o(y.target.value),placeholder:"e.g., iPhone, MacBook, Work Laptop",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:c})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:c?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(at,{className:"w-4 h-4 animate-spin"}),"Registering..."]}):"Register Passkey"}),e.jsx("button",{type:"button",onClick:()=>{i(!1),o(""),u("")},disabled:c,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"})]})]}),t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(kc,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No passkeys registered"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Add a passkey to sign in quickly and securely without a password"})]}):e.jsx("div",{className:"space-y-3",children:t.map(y=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:y.device_name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Created ",new Date(y.created_at).toLocaleDateString()]}),y.last_used_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last used ",new Date(y.last_used_at).toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>p(y.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove passkey",children:e.jsx(Ns,{className:"w-4 h-4"})})]},y.id))}),e.jsxs("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"What are passkeys?"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:" Sign in with your fingerprint, face, or device PIN"}),e.jsx("li",{children:" More secure than passwords - protected by your device"}),e.jsx("li",{children:" Works across all your devices that support passkeys"}),e.jsx("li",{children:" No passwords to remember or type"})]})]})]}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Passkeys Not Supported"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your browser doesn't support passkeys. Please use a modern browser like Chrome, Safari, or Edge to use this feature."})]})]})})}function Mw(){const{profile:t}=X();if(!t)return null;const s=[{id:"profile_photo",label:"Profile Photo",completed:!!t.profile_photo_url||!!t.avatar_url,icon:Od,description:"Upload a clear photo of your face",link:"#profile-photo",benefit:"+25% trust score"},{id:"face_verified",label:"Face Verification",completed:!!t.profile_verified,icon:me,description:"Verify your identity with face detection",link:"#profile-photo",benefit:"+40% booking success"},{id:"phone",label:"Phone Number",completed:!!t.phone,icon:dt,description:"Add your contact phone number",link:"#edit-profile",benefit:"+15% visibility"},{id:"bio",label:"Bio",completed:!!t.bio&&t.bio.length>20,icon:kt,description:"Write a brief bio about yourself",link:"#edit-profile",benefit:"+20% match rate"},{id:"vehicle",label:"Vehicle Added",completed:t.total_rides_offered>0,icon:pe,description:"Add a vehicle to offer rides",link:"#vehicles",benefit:"Unlock driver features"}],r=s.filter(d=>d.completed).length,a=s.length,n=Math.round(r/a*100),i=n===100,o=n>=100?{level:"Complete",badge:"",color:"green"}:n>=75?{level:"Almost There",badge:"",color:"yellow"}:n>=50?{level:"Halfway",badge:"",color:"blue"}:{level:"Getting Started",badge:"",color:"gray"},c=n>=75?"78% better matches":n>=50?"45% better matches":"20% better matches";return i?e.jsx("div",{className:"bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 rounded-xl p-6 border-2 border-green-300 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full animate-pulse",children:e.jsx(bt,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-green-900",children:"Profile Complete!"}),e.jsx(Al,{className:"w-5 h-5 text-yellow-500"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Your profile is fully optimized for maximum matches and visibility!"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("div",{className:"px-3 py-1 bg-white rounded-full text-xs font-semibold text-green-700 border border-green-200",children:"100% Trust Builder"}),e.jsx("div",{className:"px-3 py-1 bg-white rounded-full text-xs font-semibold text-green-700 border border-green-200",children:"Premium Visibility"}),e.jsx("div",{className:"px-3 py-1 bg-white rounded-full text-xs font-semibold text-green-700 border border-green-200",children:"Top Match Priority"})]})]})]})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-5",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"w-20 h-20 transform -rotate-90",children:[e.jsx("circle",{cx:"40",cy:"40",r:"35",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),e.jsx("circle",{cx:"40",cy:"40",r:"35",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:`${2*Math.PI*35}`,strokeDashoffset:`${2*Math.PI*35*(1-n/100)}`,className:`text-${o.color}-500 transition-all duration-500`,strokeLinecap:"round"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:o.badge})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Boost Your Visibility"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[n,"%"]})]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-3",children:[o.level," - Complete your profile to get ",c]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Fe,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"font-semibold text-green-700",children:[r,"/",a," completed"]})]})]})]}),e.jsx("div",{className:"space-y-2 mb-5",children:s.filter(d=>!d.completed).slice(0,3).map(d=>e.jsxs("a",{href:d.link,className:"flex items-start gap-3 p-3 rounded-lg bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-300 transition-all group",children:[e.jsx("div",{className:"flex-shrink-0 p-2 rounded-full bg-gray-200 group-hover:bg-blue-100 transition-colors",children:e.jsx(ne,{className:"w-4 h-4 text-gray-500 group-hover:text-blue-600 transition-colors"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:d.label}),d.benefit&&e.jsx("span",{className:"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full",children:d.benefit})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-0.5",children:d.description})]}),e.jsx(ji,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-600 transition-colors flex-shrink-0 mt-1"})]},d.id))}),n>=50&&e.jsx("div",{className:"mb-4 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(bt,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-900",children:"Milestone Unlocked!"}),e.jsxs("p",{className:"text-xs text-yellow-800",children:["You're ",n>=75?"almost":"halfway"," there! Complete ",a-r," more ",a-r===1?"item":"items"," to reach 100%"]})]})]})}),e.jsxs("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Why Complete Your Profile?"}),e.jsxs("ul",{className:"space-y-1.5 text-xs text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-3 h-3 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"78% more ride matches"})," with a complete profile"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-3 h-3 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Higher trust score"})," means more booking requests"]})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"w-3 h-3 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Priority in search"})," results and recommendations"]})]})]})]})]})}function Ow(){const{profile:t}=X(),[s,r]=x.useState([]),[a,n]=x.useState(!0),[i,l]=x.useState(!1),[o,c]=x.useState(null),[d,m]=x.useState(""),[u,h]=x.useState(""),[f,g]=x.useState({name:"",phone:"",relationship:"",is_primary:!1});x.useEffect(()=>{t!=null&&t.id&&j()},[t==null?void 0:t.id]);const j=async()=>{try{n(!0);const{data:b,error:N}=await _.from("emergency_contacts").select("*").eq("user_id",t==null?void 0:t.id).order("is_primary",{ascending:!1}).order("created_at",{ascending:!0});if(N)throw N;r(b||[])}catch(b){console.error("Error loading contacts:",b),m("Failed to load emergency contacts")}finally{n(!1)}},w=async b=>{b.preventDefault(),m(""),h("");try{if(!f.name.trim()||!f.phone.trim()){m("Name and phone number are required");return}if(f.is_primary&&await _.from("emergency_contacts").update({is_primary:!1}).eq("user_id",t==null?void 0:t.id),o){const{error:N}=await _.from("emergency_contacts").update({name:f.name.trim(),phone:f.phone.trim(),relationship:f.relationship.trim(),is_primary:f.is_primary}).eq("id",o);if(N)throw N;h("Contact updated successfully")}else{const{error:N}=await _.from("emergency_contacts").insert({user_id:t==null?void 0:t.id,name:f.name.trim(),phone:f.phone.trim(),relationship:f.relationship.trim(),is_primary:f.is_primary});if(N)throw N;h("Contact added successfully")}g({name:"",phone:"",relationship:"",is_primary:!1}),l(!1),c(null),await j(),setTimeout(()=>h(""),3e3)}catch(N){m(N.message||"Failed to save contact")}},v=b=>{g({name:b.name,phone:b.phone,relationship:b.relationship,is_primary:b.is_primary}),c(b.id),l(!0)},p=async b=>{if(confirm("Are you sure you want to delete this emergency contact?"))try{const{error:N}=await _.from("emergency_contacts").delete().eq("id",b);if(N)throw N;h("Contact deleted successfully"),await j(),setTimeout(()=>h(""),3e3)}catch(N){m(N.message||"Failed to delete contact")}},y=()=>{l(!1),c(null),g({name:"",phone:"",relationship:"",is_primary:!1}),m("")};return a?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(dt,{className:"w-6 h-6"}),"Emergency Contacts"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Add trusted contacts who can be reached in case of emergency"})]}),!i&&e.jsxs("button",{onClick:()=>l(!0),className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(oa,{className:"w-4 h-4"}),"Add Contact"]})]}),d&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm flex items-start gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:d})]}),u&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm flex items-start gap-2",children:[e.jsx(ee,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:u})]}),i&&e.jsxs("form",{onSubmit:w,className:"mb-6 p-6 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:o?"Edit Contact":"Add New Contact"}),e.jsx("button",{type:"button",onClick:y,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ot,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:f.name,onChange:b=>g({...f,name:b.target.value}),placeholder:"John Doe",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Phone Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:f.phone,onChange:b=>g({...f,phone:b.target.value}),placeholder:"+44 1234 567890",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Relationship"}),e.jsxs("select",{value:f.relationship,onChange:b=>g({...f,relationship:b.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select relationship"}),e.jsx("option",{value:"spouse",children:"Spouse"}),e.jsx("option",{value:"partner",children:"Partner"}),e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"sibling",children:"Sibling"}),e.jsx("option",{value:"child",children:"Child"}),e.jsx("option",{value:"friend",children:"Friend"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"is_primary",checked:f.is_primary,onChange:b=>g({...f,is_primary:b.target.checked}),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"is_primary",className:"text-sm text-gray-700",children:"Set as primary emergency contact"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:y,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:o?"Update Contact":"Add Contact"})]})]})]}),s.length===0&&!i?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(Sc,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:"No emergency contacts added"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add emergency contacts to enhance your safety while carpooling"}),e.jsxs("button",{onClick:()=>l(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors inline-flex items-center gap-2",children:[e.jsx(oa,{className:"w-4 h-4"}),"Add First Contact"]})]}):e.jsx("div",{className:"space-y-3",children:s.map(b=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:"flex-1 min-w-0 w-full",children:e.jsx("div",{className:"flex items-start justify-between gap-3 mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-900 truncate",children:b.name}),b.is_primary&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:"Primary"})]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3"}),b.phone]}),b.relationship&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 capitalize",children:b.relationship})]})})}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>v(b),className:"flex-1 sm:flex-none px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors border border-blue-200 flex items-center justify-center gap-2",children:[e.jsx(qd,{className:"w-4 h-4"}),"Edit"]}),e.jsxs("button",{onClick:()=>p(b.id),className:"flex-1 sm:flex-none px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-red-200 flex items-center justify-center gap-2",children:[e.jsx(Ns,{className:"w-4 h-4"}),"Delete"]})]})]},b.id))}),s.length>0&&e.jsx("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-amber-800 flex items-start gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Your emergency contacts will be notified automatically if you trigger an emergency alert during a ride."})]})})]})}function Fw(){const{profile:t}=X(),[s,r]=x.useState(!0),[a,n]=x.useState(!1),[i,l]=x.useState(0),[o,c]=x.useState(!1),[d,m]=x.useState(!1);x.useEffect(()=>{t!=null&&t.id&&u()},[t==null?void 0:t.id]);const u=async()=>{try{r(!0);const[b,N]=await Promise.all([_.from("driver_licenses").select("id, status, expiry_date").eq("user_id",t==null?void 0:t.id).eq("status","verified").gte("expiry_date",new Date().toISOString().split("T")[0]).maybeSingle(),_.from("vehicle_insurance").select("id, status, expiry_date").eq("user_id",t==null?void 0:t.id).eq("status","active").gte("expiry_date",new Date().toISOString().split("T")[0]).maybeSingle()]);c(!!b.data),m(!!N.data),l((t==null?void 0:t.trust_score)||0)}catch(b){console.error("Error loading trust score data:",b)}finally{r(!1)}},h=async()=>{try{n(!0);const{data:b,error:N}=await _.rpc("refresh_my_trust_score");if(N)throw N;l(b||0),await u()}catch(b){console.error("Error refreshing trust score:",b)}finally{n(!1)}};if(!t)return null;const f=t.total_rides_offered+t.total_rides_taken,g=Math.floor((new Date().getTime()-new Date(t.created_at).getTime())/(1e3*60*60*24)),j=[{category:"Email Verification",earned:t.is_verified?10:0,possible:10,description:"Verified email address",status:t.is_verified?"complete":"missing"},{category:"Phone Verification",earned:t.phone?10:0,possible:10,description:"Phone number added",status:t.phone?"complete":"missing"},{category:"Profile Photo",earned:t.profile_verified?15:0,possible:15,description:"Face-verified profile photo",status:t.profile_verified?"complete":"missing"},{category:"Driver License",earned:o?20:0,possible:20,description:"Valid driver license verified",status:o?"complete":"missing"},{category:"Vehicle Insurance",earned:d?15:0,possible:15,description:"Active insurance on file",status:d?"complete":"missing"},{category:"Completed Rides",earned:Math.min(f,15),possible:15,description:`${f} rides completed (1 point each, max 15)`,status:f>=15?"complete":f>0?"partial":"missing"},{category:"Average Rating",earned:Math.round(t.average_rating*2),possible:10,description:`${t.average_rating.toFixed(1)} star rating (2 points per star)`,status:t.average_rating>=4.5?"complete":t.average_rating>0?"partial":"missing"},{category:"Account Age",earned:Math.min(Math.floor(g/30),5),possible:5,description:`${Math.floor(g/30)} months active (1 point per month, max 5)`,status:g>=150?"complete":g>0?"partial":"missing"}],w=j.reduce((b,N)=>b+N.earned,0);j.reduce((b,N)=>b+N.possible,0);const v=b=>b>=80?"text-green-600":b>=60?"text-blue-600":b>=40?"text-yellow-600":"text-red-600",p=b=>b>=80?"from-green-50 to-emerald-50 border-green-200":b>=60?"from-blue-50 to-indigo-50 border-blue-200":b>=40?"from-yellow-50 to-amber-50 border-yellow-200":"from-red-50 to-rose-50 border-red-200",y=b=>b==="complete"?"bg-green-100 text-green-800":b==="partial"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600";return s?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(me,{className:"w-6 h-6"}),"Trust Score"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Your community trust rating based on verifications and activity"})]}),e.jsxs("button",{onClick:h,disabled:a,className:"px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50",title:"Refresh trust score",children:[e.jsx(Oe,{className:`w-4 h-4 ${a?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:`p-6 rounded-xl border bg-gradient-to-r ${p(i)} mb-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:`text-5xl font-bold ${v(i)}`,children:i}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"out of 100 points"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w}),e.jsx("div",{className:"text-sm text-gray-600",children:"earned"})]})]}),e.jsx("div",{className:"relative w-full h-4 bg-white bg-opacity-50 rounded-full overflow-hidden",children:e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-500 ${i>=80?"bg-green-500":i>=60?"bg-blue-500":i>=40?"bg-yellow-500":"bg-red-500"}`,style:{width:`${i}%`}})}),e.jsxs("div",{className:"mt-4 flex items-start gap-2",children:[e.jsx(kj,{className:"w-4 h-4 text-gray-600 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-gray-700",children:[i>=80&&"Excellent! Your profile is highly trusted in the community.",i>=60&&i<80&&"Good work! Complete more verifications to increase your score.",i>=40&&i<60&&"You're building trust. Add more verifications to improve.",i<40&&"Get started by completing verifications and participating in rides."]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2 mb-3",children:[e.jsx(Fe,{className:"w-5 h-5"}),"Score Breakdown"]}),j.map((b,N)=>e.jsxs("div",{className:"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:`p-2 rounded-full ${b.status==="complete"?"bg-green-100":b.status==="partial"?"bg-blue-100":"bg-gray-100"}`,children:e.jsx(ee,{className:`w-4 h-4 ${b.status==="complete"?"text-green-600":b.status==="partial"?"text-blue-600":"text-gray-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.category}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${y(b.status)}`,children:[b.earned,"/",b.possible," pts"]})})]}),e.jsx("p",{className:"text-sm text-gray-600",children:b.description}),b.earned<b.possible&&e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`absolute top-0 left-0 h-full ${b.status==="complete"?"bg-green-500":b.status==="partial"?"bg-blue-500":"bg-gray-400"}`,style:{width:`${b.earned/b.possible*100}%`}})})})]})]},N))]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{children:"Why does trust score matter?"})," A higher trust score increases your visibility in search results, improves booking acceptance rates, and builds confidence with other users."]})})]})}function Uw(){const{profile:t}=X(),[s,r]=x.useState([]),[a,n]=x.useState(!0),[i,l]=x.useState("all");x.useEffect(()=>{t!=null&&t.id&&o()},[t==null?void 0:t.id,i]);const o=async()=>{try{n(!0);let f=_.from("reviews").select(`
          id,
          rating,
          comment,
          review_type,
          created_at,
          reviewer:reviewer_id (
            full_name,
            avatar_url,
            profile_photo_url
          )
        `).eq("reviewee_id",t==null?void 0:t.id).order("created_at",{ascending:!1});i!=="all"&&(f=f.eq("review_type",i));const{data:g,error:j}=await f;if(j)throw j;r(g||[])}catch(f){console.error("Error loading reviews:",f)}finally{n(!1)}};if(!t)return null;const c=s,d=s.length,m=t.average_rating||0,u=[5,4,3,2,1].map(f=>({stars:f,count:s.filter(g=>g.rating===f).length,percentage:d>0?s.filter(g=>g.rating===f).length/d*100:0})),h=f=>Array.from({length:5},(g,j)=>e.jsx(we,{className:`w-4 h-4 ${j<f?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},j));return a?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(wn,{className:"w-6 h-6"}),"Reviews & Ratings"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[d," ",d===1?"review":"reviews"," from the community"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>l("all"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${i==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All"}),e.jsxs("button",{onClick:()=>l("driver"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1 ${i==="driver"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(pe,{className:"w-4 h-4"}),"As Driver"]}),e.jsxs("button",{onClick:()=>l("passenger"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-1 ${i==="passenger"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(kt,{className:"w-4 h-4"}),"As Passenger"]})]})]}),d===0?e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[e.jsx(wn,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium text-gray-900 mb-2",children:"No reviews yet"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete rides to start receiving reviews from other users"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"text-5xl font-bold text-gray-900",children:m.toFixed(1)}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-1 mb-1",children:h(Math.round(m))}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Based on ",d," ",d===1?"review":"reviews"]})]})]})}),e.jsx("div",{className:"space-y-2",children:u.map(({stars:f,count:g,percentage:j})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 w-12",children:[f," star"]}),e.jsx("div",{className:"flex-1 h-3 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 transition-all duration-500",style:{width:`${j}%`}})}),e.jsx("span",{className:"text-sm text-gray-600 w-12 text-right",children:g})]},f))})]}),e.jsx("div",{className:"space-y-4",children:c.map(f=>{var g,j,w,v,p,y;return e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center overflow-hidden",children:(g=f.reviewer)!=null&&g.profile_photo_url||(j=f.reviewer)!=null&&j.avatar_url?e.jsx("img",{src:f.reviewer.profile_photo_url||f.reviewer.avatar_url,alt:f.reviewer.full_name,className:"w-12 h-12 object-cover"}):e.jsx("span",{className:"text-lg font-bold text-blue-600",children:((p=(v=(w=f.reviewer)==null?void 0:w.full_name)==null?void 0:v[0])==null?void 0:p.toUpperCase())||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:((y=f.reviewer)==null?void 0:y.full_name)||"Anonymous"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx(de,{className:"w-3 h-3"}),new Date(f.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e.jsx("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-700 rounded capitalize",children:f.review_type})]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:h(f.rating)})]}),f.comment&&e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed pl-15",children:f.comment})]},f.id)})})]})]})}function qw(){const{profile:t}=X(),[s,r]=x.useState({phone_visible:!0,email_visible:!1,profile_searchable:!0,allow_messages_from:"anyone"}),[a,n]=x.useState(!0),[i,l]=x.useState(!1),[o,c]=x.useState("");x.useEffect(()=>{t!=null&&t.id&&d()},[t==null?void 0:t.id]);const d=async()=>{try{n(!0);const{data:u,error:h}=await _.from("user_preferences").select("phone_visible, email_visible, profile_searchable, allow_messages_from").eq("user_id",t==null?void 0:t.id).maybeSingle();if(h)throw h;u&&r({phone_visible:u.phone_visible??!0,email_visible:u.email_visible??!1,profile_searchable:u.profile_searchable??!0,allow_messages_from:u.allow_messages_from||"anyone"})}catch(u){console.error("Error loading privacy settings:",u)}finally{n(!1)}},m=async(u,h)=>{try{l(!0);const{error:f}=await _.from("user_preferences").upsert({user_id:t==null?void 0:t.id,[u]:h},{onConflict:"user_id"});if(f)throw f;r(g=>({...g,[u]:h})),c("Privacy settings updated"),setTimeout(()=>c(""),2e3)}catch(f){console.error("Error updating privacy setting:",f)}finally{l(!1)}};return a?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ks,{className:"w-6 h-6"}),"Privacy Controls"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage who can see your information"})]}),i&&e.jsx("span",{className:"text-sm text-blue-600",children:"Saving..."})]}),o&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm",children:o}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(dt,{className:"w-5 h-5 text-gray-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Show Phone Number"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Allow other users to see your phone number on your profile"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.phone_visible,onChange:u=>m("phone_visible",u.target.checked),disabled:i}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start justify-between gap-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Jt,{className:"w-5 h-5 text-gray-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Show Email Address"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Display your email address on your public profile"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.email_visible,onChange:u=>m("email_visible",u.target.checked),disabled:i}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start justify-between gap-4 py-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Ye,{className:"w-5 h-5 text-gray-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Profile Searchable"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Allow your profile to appear in search results and ride matches"})]})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:s.profile_searchable,onChange:u=>m("profile_searchable",u.target.checked),disabled:i}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start justify-between gap-4 py-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx(Nt,{className:"w-5 h-5 text-gray-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Who Can Message You"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Control who can send you messages"})]})]}),e.jsxs("select",{value:s.allow_messages_from,onChange:u=>m("allow_messages_from",u.target.value),disabled:i,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 text-sm",children:[e.jsx("option",{value:"anyone",children:"Anyone"}),e.jsx("option",{value:"verified",children:"Verified Users Only"}),e.jsx("option",{value:"connections",children:"Connections Only"})]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-800",children:[e.jsx("strong",{children:"Note:"})," Some information may still be visible to users you've interacted with (e.g., ride partners, chat history). Changing privacy settings does not affect past interactions."]})})]})}function Bw(){const{profile:t}=X();if(!t)return null;const s=new Date(t.created_at),r=Math.floor((new Date().getTime()-s.getTime())/(1e3*60*60*24*30)),a=t.total_rides_offered+t.total_rides_taken,n=95,i=98,l=[{label:"Rides Offered",value:t.total_rides_offered,icon:pe,color:"blue",description:"As a driver"},{label:"Rides Taken",value:t.total_rides_taken,icon:re,color:"green",description:"As a passenger"},{label:"Average Rating",value:t.average_rating.toFixed(1),icon:we,color:"yellow",description:"Out of 5.0"},{label:"Total Trips",value:a,icon:Fe,color:"purple",description:"Combined rides"}],o=[{label:"Member Since",value:s.toLocaleDateString("en-US",{month:"short",year:"numeric"}),sublabel:`${r} months active`},{label:"Response Rate",value:`${n}%`,sublabel:"Replies to messages"},{label:"Completion Rate",value:`${i}%`,sublabel:"Completed bookings"}],c=d=>{const m={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",yellow:"bg-yellow-50 text-yellow-600",purple:"bg-purple-50 text-purple-600"};return m[d]||m.blue};return e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(bt,{className:"w-6 h-6 text-gray-900"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Your Statistics"})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:l.map((d,m)=>e.jsxs("div",{className:"p-4 rounded-xl border border-gray-200 hover:border-blue-300 transition-colors",children:[e.jsx("div",{className:`inline-flex p-2.5 rounded-lg mb-3 ${c(d.color)}`,children:e.jsx(d.icon,{className:"w-5 h-5"})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:d.value}),e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-0.5",children:d.label}),e.jsx("div",{className:"text-xs text-gray-500",children:d.description})]},m))}),e.jsx("div",{className:"grid md:grid-cols-3 gap-4 pt-6 border-t border-gray-200",children:o.map((d,m)=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-600"}),e.jsx("p",{className:"text-xs font-medium text-gray-600 uppercase tracking-wide",children:d.label})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:d.value}),e.jsx("p",{className:"text-xs text-gray-600",children:d.sublabel})]},m))}),a>=10&&e.jsx("div",{className:"mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(bt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-blue-900",children:"Active Rider Badge Earned!"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["You've completed ",a," rides. Keep up the great work!"]})]})]})})]})}function zw(){const{profile:t}=X(),[s,r]=x.useState(!0),[a,n]=x.useState(!1),[i,l]=x.useState(""),[o,c]=x.useState(""),[d,m]=x.useState(null),[u,h]=x.useState([]),[f,g]=x.useState(!1),[j,w]=x.useState(!1),[v,p]=x.useState({license_number:"",issue_date:"",expiry_date:"",issuing_country:"UK",license_class:"B"}),[y,b]=x.useState({policy_number:"",provider:"",issue_date:"",expiry_date:"",coverage_type:"comprehensive"}),N=x.useRef(null),k=x.useRef(null);x.useEffect(()=>{t!=null&&t.id&&E()},[t==null?void 0:t.id]);const E=async()=>{try{r(!0);const[D,F]=await Promise.all([_.from("driver_licenses").select("*").eq("user_id",t==null?void 0:t.id).maybeSingle(),_.from("vehicle_insurance").select("*").eq("user_id",t==null?void 0:t.id)]);if(D.error&&D.error.code!=="PGRST116")throw D.error;if(F.error)throw F.error;m(D.data),h(F.data||[])}catch(D){console.error("Error loading documents:",D),l("Failed to load documents")}finally{r(!1)}},C=async(D,F)=>{const B=D.name.split(".").pop(),O=`documents/${`${t==null?void 0:t.id}/${F}_${Date.now()}.${B}`}`,{error:$}=await _.storage.from("documents").upload(O,D,{cacheControl:"3600",upsert:!1});if($)throw $;return O},R=async D=>{var F,B;D.preventDefault(),l(""),c("");try{n(!0);const H={user_id:t==null?void 0:t.id,license_number:v.license_number,issue_date:v.issue_date,expiry_date:v.expiry_date,issuing_country:v.issuing_country,license_class:v.license_class,status:"pending"};if((B=(F=N.current)==null?void 0:F.files)!=null&&B[0]){const $=await C(N.current.files[0],"license");H.document_path=$}const{error:O}=await _.from("driver_licenses").upsert(H,{onConflict:"user_id"});if(O)throw O;c("Driver license submitted successfully"),g(!1),await E(),setTimeout(()=>c(""),3e3)}catch(H){l(H.message||"Failed to submit license")}finally{n(!1)}},T=async D=>{var F,B;D.preventDefault(),l(""),c("");try{n(!0);const H={user_id:t==null?void 0:t.id,policy_number:y.policy_number,provider:y.provider,issue_date:y.issue_date,expiry_date:y.expiry_date,coverage_type:y.coverage_type,status:"pending"};if((B=(F=k.current)==null?void 0:F.files)!=null&&B[0]){const $=await C(k.current.files[0],"insurance");H.document_path=$}const{error:O}=await _.from("vehicle_insurance").insert(H);if(O)throw O;c("Insurance submitted successfully"),w(!1),b({policy_number:"",provider:"",issue_date:"",expiry_date:"",coverage_type:"comprehensive"}),await E(),setTimeout(()=>c(""),3e3)}catch(H){l(H.message||"Failed to submit insurance")}finally{n(!1)}},M=D=>{const F={verified:{icon:ee,color:"green",label:"Verified"},active:{icon:ee,color:"green",label:"Active"},pending:{icon:ye,color:"yellow",label:"Pending Review"},rejected:{icon:Qe,color:"red",label:"Rejected"},expired:{icon:Qe,color:"red",label:"Expired"}},B=F[D]||F.pending,H=B.icon;return e.jsxs("span",{className:`px-2 py-1 bg-${B.color}-100 text-${B.color}-800 rounded text-xs font-medium flex items-center gap-1`,children:[e.jsx(H,{className:"w-3 h-3"}),B.label]})},I=D=>{const F=new Date(D),B=new Date,H=Math.floor((F.getTime()-B.getTime())/(1e3*60*60*24));return H<=30&&H>=0};return s?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(me,{className:"w-6 h-6 text-gray-900"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Document Verification"})]}),i&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm flex items-start gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:i})]}),o&&e.jsxs("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm flex items-start gap-2",children:[e.jsx(ee,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:o})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Driver's License"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload your valid driver's license"})]}),d&&M(d.status)]}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"License Number"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.license_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Class"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.license_class})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Expiry Date"}),e.jsx("p",{className:`font-medium ${I(d.expiry_date)?"text-amber-600":"text-gray-900"}`,children:new Date(d.expiry_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Country"}),e.jsx("p",{className:"font-medium text-gray-900",children:d.issuing_country})]})]}),d.status==="rejected"&&d.rejection_reason&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-800",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",d.rejection_reason]}),I(d.expiry_date)&&e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800 flex items-start gap-2",children:[e.jsx(de,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Your license is expiring soon. Please update it."})]}),e.jsx("button",{onClick:()=>g(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Update License "})]}):e.jsxs("button",{onClick:()=>g(!0),className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(sl,{className:"w-4 h-4"}),"Upload Driver's License"]})]}),e.jsxs("div",{className:"p-5 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Vehicle Insurance"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Upload your vehicle insurance documents"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-1",children:[e.jsx(sl,{className:"w-4 h-4"}),"Add Insurance"]})]}),u.length>0?e.jsx("div",{className:"space-y-3",children:u.map(D=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:D.provider}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Policy: ",D.policy_number]})]}),M(D.status)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Expiry"}),e.jsx("p",{className:`font-medium ${I(D.expiry_date)?"text-amber-600":"text-gray-900"}`,children:new Date(D.expiry_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Coverage"}),e.jsx("p",{className:"font-medium text-gray-900 capitalize",children:D.coverage_type})]})]}),I(D.expiry_date)&&e.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800",children:"Expiring soon - please renew"})]},D.id))}):e.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:"No insurance documents uploaded yet"})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Upload Driver's License"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["License Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:v.license_number,onChange:D=>p({...v,license_number:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Issue Date"}),e.jsx("input",{type:"date",value:v.issue_date,onChange:D=>p({...v,issue_date:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:v.expiry_date,onChange:D=>p({...v,expiry_date:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Country"}),e.jsx("input",{type:"text",value:v.issuing_country,onChange:D=>p({...v,issuing_country:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Class"}),e.jsx("input",{type:"text",value:v.license_class,onChange:D=>p({...v,license_class:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Document (Optional)"}),e.jsx("input",{ref:N,type:"file",accept:"image/*,.pdf",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Accepted: Images or PDF"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),disabled:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300",children:a?"Uploading...":"Submit"})]})]})]})}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Add Insurance"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Policy Number ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:y.policy_number,onChange:D=>b({...y,policy_number:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Insurance Provider ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:y.provider,onChange:D=>b({...y,provider:D.target.value}),placeholder:"e.g., Aviva, Admiral",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Issue Date"}),e.jsx("input",{type:"date",value:y.issue_date,onChange:D=>b({...y,issue_date:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Expiry Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"date",value:y.expiry_date,onChange:D=>b({...y,expiry_date:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coverage Type"}),e.jsxs("select",{value:y.coverage_type,onChange:D=>b({...y,coverage_type:D.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"comprehensive",children:"Comprehensive"}),e.jsx("option",{value:"third_party",children:"Third Party"}),e.jsx("option",{value:"third_party_fire_theft",children:"Third Party, Fire & Theft"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Document (Optional)"}),e.jsx("input",{ref:k,type:"file",accept:"image/*,.pdf",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Accepted: Images or PDF"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),disabled:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300",children:a?"Uploading...":"Submit"})]})]})]})})]})}function Vw(){const{profile:t}=X(),[s,r]=x.useState(!0),[a,n]=x.useState({totalDistance:0,totalRides:0,totalDriverRides:0,totalPassengerRides:0,carbonSaved:0,moneySaved:0,timeInRides:0,peopleConnected:0});x.useEffect(()=>{t!=null&&t.id&&i()},[t==null?void 0:t.id]);const i=async()=>{try{r(!0);const{data:l,error:o}=await _.from("rides").select("*, ride_bookings(*)").eq("driver_id",t==null?void 0:t.id).in("status",["completed","in-progress"]);if(o)throw o;const{data:c,error:d}=await _.from("ride_bookings").select("*, ride:rides(*)").eq("passenger_id",t==null?void 0:t.id).in("status",["completed","confirmed"]);if(d)throw d;let m=0,u=0;const h=new Set,f={};l&&l.forEach(v=>{v.estimated_distance&&(m+=Number(v.estimated_distance)),v.estimated_duration&&(u+=Number(v.estimated_duration));const p=`${v.origin}-${v.destination}`;f[p]||(f[p]={origin:v.origin,destination:v.destination,count:0}),f[p].count++,v.ride_bookings&&v.ride_bookings.forEach(y=>{h.add(y.passenger_id)})}),c&&c.forEach(v=>{const p=v.ride;if(p){p.estimated_distance&&(m+=Number(p.estimated_distance)),p.estimated_duration&&(u+=Number(p.estimated_duration)),h.add(p.driver_id);const y=`${p.origin}-${p.destination}`;f[y]||(f[y]={origin:p.origin,destination:p.destination,count:0}),f[y].count++}});let g;Object.keys(f).length>0&&(g=Object.values(f).sort((p,y)=>y.count-p.count)[0]);const j=m*.171,w=m*.15;n({totalDistance:Math.round(m),totalRides:((l==null?void 0:l.length)||0)+((c==null?void 0:c.length)||0),totalDriverRides:(l==null?void 0:l.length)||0,totalPassengerRides:(c==null?void 0:c.length)||0,carbonSaved:Math.round(j*10)/10,moneySaved:Math.round(w*100)/100,timeInRides:Math.round(u/60),peopleConnected:h.size,mostFrequentRoute:g})}catch(l){console.error("Error loading ride analytics:",l)}finally{r(!1)}};return s?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Fe,{className:"w-6 h-6 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Your Ride Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track your carpooling impact"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"text-xs font-medium text-blue-600",children:"Distance"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.totalDistance}),e.jsx("div",{className:"text-xs text-gray-600",children:"kilometers traveled"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ys,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-xs font-medium text-green-600",children:"Carbon"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.carbonSaved}),e.jsx("div",{className:"text-xs text-gray-600",children:"kg CO saved"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-amber-50 to-yellow-50 rounded-lg border border-amber-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(va,{className:"w-5 h-5 text-amber-600"}),e.jsx("span",{className:"text-xs font-medium text-amber-600",children:"Savings"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:["",a.moneySaved]}),e.jsx("div",{className:"text-xs text-gray-600",children:"estimated saved"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border border-purple-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-xs font-medium text-purple-600",children:"Community"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.peopleConnected}),e.jsx("div",{className:"text-xs text-gray-600",children:"people connected"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(de,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Total Rides"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a.totalRides})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(bt,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"As Driver"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a.totalDriverRides})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(re,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"As Passenger"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a.totalPassengerRides})]}),e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Time in Rides"})]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[a.timeInRides,"h"]})]})]}),e.jsx("div",{className:"p-5 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(ys,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-1",children:"Environmental Impact"}),e.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["By carpooling, you've saved ",e.jsxs("strong",{children:[a.carbonSaved," kg of CO"]})," from entering the atmosphere. That's equivalent to planting"," ",e.jsxs("strong",{children:[Math.round(a.carbonSaved/21)," trees"]})," and keeping them for one year!"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"px-3 py-1 bg-white rounded-full border border-green-300 text-green-800",children:" Carbon neutral contributor"}),e.jsx("span",{className:"px-3 py-1 bg-white rounded-full border border-green-300 text-green-800",children:" Reduced traffic congestion"}),e.jsx("span",{className:"px-3 py-1 bg-white rounded-full border border-green-300 text-green-800",children:" Community builder"})]})]})]})}),a.mostFrequentRoute&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),"Most Frequent Route"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900",children:a.mostFrequentRoute.origin}),e.jsx("span",{className:"text-gray-500",children:""}),e.jsx("span",{className:"font-medium text-gray-900",children:a.mostFrequentRoute.destination}),e.jsxs("span",{className:"ml-auto px-2 py-0.5 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:[a.mostFrequentRoute.count," times"]})]})]}),a.totalRides===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Fe,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No ride data yet"}),e.jsx("p",{className:"text-sm",children:"Complete rides to see your analytics"})]})]})}function Ww(){const{profile:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState([]),[l,o]=x.useState([]),[c,d]=x.useState(!0),[m,u]=x.useState(""),[h,f]=x.useState([]),[g,j]=x.useState(!1),[w,v]=x.useState("friends");x.useEffect(()=>{t!=null&&t.id&&(y(),p())},[t==null?void 0:t.id]);const p=()=>{const R=_.channel("friends").on("postgres_changes",{event:"*",schema:"public",table:"friends",filter:`user_id=eq.${t==null?void 0:t.id}`},()=>{y()}).on("postgres_changes",{event:"*",schema:"public",table:"friends",filter:`friend_id=eq.${t==null?void 0:t.id}`},()=>{y()}).subscribe();return()=>{_.removeChannel(R)}},y=async()=>{try{d(!0);const{data:R,error:T}=await _.from("friends").select(`
          *,
          friend:profiles!friends_friend_id_fkey(*)
        `).eq("user_id",t==null?void 0:t.id).eq("status","accepted");if(T)throw T;const{data:M,error:I}=await _.from("friends").select(`
          *,
          friend:profiles!friends_user_id_fkey(*)
        `).eq("friend_id",t==null?void 0:t.id).eq("status","pending");if(I)throw I;const{data:D,error:F}=await _.from("friends").select(`
          *,
          friend:profiles!friends_friend_id_fkey(*)
        `).eq("user_id",t==null?void 0:t.id).eq("status","pending");if(F)throw F;a(R||[]),i(M||[]),o(D||[])}catch(R){console.error("Error loading friends:",R)}finally{d(!1)}},b=async R=>{if(!R.trim()){f([]);return}try{j(!0);const{data:T,error:M}=await _.from("profiles").select("id, full_name, avatar_url, bio, average_rating, trust_score, profile_verified").ilike("full_name",`%${R}%`).neq("id",t==null?void 0:t.id).limit(10);if(M)throw M;const I=[...r.map(F=>F.friend_id),...n.map(F=>F.user_id),...l.map(F=>F.friend_id)],D=(T||[]).filter(F=>!I.includes(F.id));f(D)}catch(T){console.error("Error searching users:",T)}finally{j(!1)}},N=async R=>{try{const{error:T}=await _.from("friends").insert({user_id:t==null?void 0:t.id,friend_id:R,status:"pending"});if(T)throw T;await _.from("notifications").insert({user_id:R,type:"friend-request",title:"New Friend Request",message:`${t==null?void 0:t.full_name} wants to connect with you`,data:{userId:t==null?void 0:t.id}}),f(M=>M.filter(I=>I.id!==R)),await y()}catch(T){console.error("Error sending friend request:",T)}},k=async(R,T)=>{try{const{error:M}=await _.from("friends").update({status:"accepted"}).eq("id",R);if(M)throw M;const{error:I}=await _.from("friends").insert({user_id:t==null?void 0:t.id,friend_id:T,status:"accepted"});if(I)throw I;await _.from("notifications").insert({user_id:T,type:"friend-accepted",title:"Friend Request Accepted",message:`${t==null?void 0:t.full_name} accepted your friend request`,data:{userId:t==null?void 0:t.id}}),await y()}catch(M){console.error("Error accepting friend request:",M)}},E=async R=>{try{const{error:T}=await _.from("friends").delete().eq("id",R);if(T)throw T;await y()}catch(T){console.error("Error rejecting friend request:",T)}},C=async(R,T)=>{try{await _.from("friends").delete().eq("id",R),await _.from("friends").delete().eq("user_id",T).eq("friend_id",t==null?void 0:t.id),await y()}catch(M){console.error("Error removing friend:",M)}};return c?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(re,{className:"w-6 h-6 text-gray-900"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Friends & Connections"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>v("friends"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="friends"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Friends (",r.length,")"]}),e.jsxs("button",{onClick:()=>v("requests"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors relative ${w==="requests"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Requests (",n.length,")",n.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:n.length})]}),e.jsx("button",{onClick:()=>v("add"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w==="add"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Add Friends"})]})]}),e.jsxs("div",{className:"p-6",children:[w==="friends"&&e.jsx("div",{className:"space-y-3",children:r.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(re,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No friends yet"}),e.jsx("p",{className:"text-sm",children:"Add friends to ride together easily"})]}):r.map(R=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold flex-shrink-0",children:R.friend.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:R.friend.full_name}),R.friend.profile_verified&&e.jsx(me,{className:"w-4 h-4 text-blue-600"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[R.friend.average_rating&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-amber-500 fill-current"}),R.friend.average_rating.toFixed(1)]}),R.friend.trust_score&&e.jsxs("span",{children:["Trust: ",R.friend.trust_score,"/100"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s("/messages"),className:"p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors",title:"Message",children:e.jsx(wa,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>C(R.id,R.friend_id),className:"p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors",title:"Remove friend",children:e.jsx(ot,{className:"w-5 h-5"})})]})]},R.id))}),w==="requests"&&e.jsx("div",{className:"space-y-4",children:n.length===0&&l.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Bd,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No pending requests"})]}):e.jsxs(e.Fragment,{children:[n.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Received Requests"}),e.jsx("div",{className:"space-y-3",children:n.map(R=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold flex-shrink-0",children:R.friend.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:R.friend.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:R.friend.bio||"No bio"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(R.id,R.user_id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Accept"}),e.jsx("button",{onClick:()=>E(R.id),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Decline"})]})]},R.id))})]}),l.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Sent Requests"}),e.jsx("div",{className:"space-y-3",children:l.map(R=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-600 text-white rounded-full flex items-center justify-center text-lg font-bold flex-shrink-0",children:R.friend.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:R.friend.full_name}),e.jsx("p",{className:"text-sm text-gray-500",children:"Request pending..."})]}),e.jsx("button",{onClick:()=>E(R.id),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"})]},R.id))})]})]})}),w==="add"&&e.jsxs("div",{children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:m,onChange:R=>{u(R.target.value),b(R.target.value)},placeholder:"Search users by name...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):h.length>0?e.jsx("div",{className:"space-y-3",children:h.map(R=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-bold flex-shrink-0",children:R.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:R.full_name}),R.profile_verified&&e.jsx(me,{className:"w-4 h-4 text-blue-600"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[R.average_rating&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-amber-500 fill-current"}),R.average_rating.toFixed(1)]}),R.trust_score&&e.jsxs("span",{children:["Trust: ",R.trust_score,"/100"]})]})]}),e.jsxs("button",{onClick:()=>N(R.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center gap-2",children:[e.jsx(Sc,{className:"w-4 h-4"}),"Add Friend"]})]},R.id))}):m.trim()?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Mt,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Try a different search term"})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(Sc,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"Search for users"}),e.jsx("p",{className:"text-sm",children:"Enter a name to find friends"})]})]})]})]})}function Hw(){const{profile:t}=X(),[s,r]=x.useState([]),[a,n]=x.useState(!0),[i,l]=x.useState("all");x.useEffect(()=>{t!=null&&t.id&&o()},[t==null?void 0:t.id]);const o=async()=>{try{n(!0);const{data:g}=await _.from("rides").select("id").eq("driver_id",t==null?void 0:t.id).eq("status","completed"),{data:j}=await _.from("ride_bookings").select("id").eq("passenger_id",t==null?void 0:t.id).eq("status","completed"),{data:w}=await _.from("friends").select("id").eq("user_id",t==null?void 0:t.id).eq("status","accepted"),{data:v}=await _.from("reviews").select("rating").eq("reviewee_id",t==null?void 0:t.id),p=(g==null?void 0:g.length)||0,y=(j==null?void 0:j.length)||0,b=(w==null?void 0:w.length)||0,N=(v==null?void 0:v.filter(T=>T.rating===5).length)||0,k=(t==null?void 0:t.average_rating)||0,E=(t==null?void 0:t.trust_score)||0,C=p+y,R=[{id:"first_ride",name:"First Journey",description:"Complete your first ride",icon:"car",tier:"bronze",requirement:1,progress:C,unlocked:C>=1},{id:"ride_veteran",name:"Ride Veteran",description:"Complete 10 rides",icon:"trophy",tier:"silver",requirement:10,progress:C,unlocked:C>=10},{id:"centurion",name:"Centurion",description:"Complete 100 rides",icon:"crown",tier:"gold",requirement:100,progress:C,unlocked:C>=100},{id:"legendary",name:"Legendary Carpooler",description:"Complete 500 rides",icon:"zap",tier:"platinum",requirement:500,progress:C,unlocked:C>=500},{id:"social_butterfly",name:"Social Butterfly",description:"Connect with 10 friends",icon:"users",tier:"silver",requirement:10,progress:b,unlocked:b>=10},{id:"community_builder",name:"Community Builder",description:"Connect with 50 friends",icon:"heart",tier:"gold",requirement:50,progress:b,unlocked:b>=50},{id:"five_star_hero",name:"Five Star Hero",description:"Receive 25 five-star reviews",icon:"star",tier:"gold",requirement:25,progress:N,unlocked:N>=25},{id:"perfect_rating",name:"Perfect Rating",description:"Maintain a 5.0 average rating",icon:"target",tier:"platinum",requirement:5,progress:k,unlocked:k===5&&((v==null?void 0:v.length)||0)>=10},{id:"trusted_member",name:"Trusted Member",description:"Reach 90+ trust score",icon:"award",tier:"gold",requirement:90,progress:E,unlocked:E>=90},{id:"eco_warrior",name:"Eco Warrior",description:"Save 100kg of CO",icon:"leaf",tier:"silver",requirement:100,progress:Math.round(C*10*.171*10)/10,unlocked:C*10*.171>=100},{id:"driver_pro",name:"Driver Pro",description:"Offer 25 rides as driver",icon:"trending-up",tier:"silver",requirement:25,progress:p,unlocked:p>=25},{id:"passenger_regular",name:"Regular Passenger",description:"Take 25 rides as passenger",icon:"users",tier:"silver",requirement:25,progress:y,unlocked:y>=25}];r(R)}catch(g){console.error("Error loading achievements:",g)}finally{n(!1)}},c=g=>({car:bt,trophy:ss,crown:Dd,zap:bs,users:re,heart:$g,star:we,target:jn,award:bt,leaf:ys,"trending-up":Fe})[g]||bt,d=g=>({bronze:"from-orange-400 to-orange-600",silver:"from-gray-300 to-gray-500",gold:"from-yellow-400 to-yellow-600",platinum:"from-purple-400 to-purple-600"})[g]||"from-gray-400 to-gray-600",m=g=>({bronze:"bg-orange-100 text-orange-800 border-orange-300",silver:"bg-gray-100 text-gray-800 border-gray-300",gold:"bg-yellow-100 text-yellow-800 border-yellow-300",platinum:"bg-purple-100 text-purple-800 border-purple-300"})[g]||"bg-gray-100 text-gray-800",u=s.filter(g=>i==="unlocked"?g.unlocked:i==="locked"?!g.unlocked:!0),h=s.filter(g=>g.unlocked).length,f=s.length;return a?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-6 h-6 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Achievements & Badges"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[h," of ",f," unlocked"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(h/f*100),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Completed"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>l("all"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["All (",f,")"]}),e.jsxs("button",{onClick:()=>l("unlocked"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="unlocked"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Unlocked (",h,")"]}),e.jsxs("button",{onClick:()=>l("locked"),className:`flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${i==="locked"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Locked (",f-h,")"]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.map(g=>{const j=c(g.icon),w=Math.min(g.progress/g.requirement*100,100);return e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${g.unlocked?"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200 shadow-md":"bg-gray-50 border-gray-200 opacity-75"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center flex-shrink-0 ${g.unlocked?`bg-gradient-to-br ${d(g.tier)}`:"bg-gray-300"}`,children:e.jsx(j,{className:`w-8 h-8 ${g.unlocked?"text-white":"text-gray-500"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:`font-bold ${g.unlocked?"text-gray-900":"text-gray-600"}`,children:g.name}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded-full border ${m(g.tier)}`,children:g.tier.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:g.description}),!g.unlocked&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-1",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${w}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600 flex justify-between",children:[e.jsxs("span",{children:["Progress: ",g.progress.toFixed(1)," / ",g.requirement]}),e.jsxs("span",{children:[Math.round(w),"%"]})]})]}),g.unlocked&&e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full font-medium flex items-center gap-1",children:[e.jsx(ss,{className:"w-4 h-4"}),"Unlocked!"]})})]})]})},g.id)})}),u.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ss,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"font-medium",children:"No achievements found"}),e.jsx("p",{className:"text-sm",children:"Try a different filter"})]})]})]})}function Gw(){const{user:t}=X(),[s,r]=x.useState(null),[a,n]=x.useState([]),[i,l]=x.useState(!0);x.useEffect(()=>{t&&(o(),c())},[t]);const o=async()=>{try{const{data:u,error:h}=await _.from("reliability_scores").select("*").eq("user_id",t==null?void 0:t.id).maybeSingle();if(h)throw h;r(u)}catch(u){console.error("Error loading reliability data:",u)}finally{l(!1)}},c=async()=>{try{const{data:u,error:h}=await _.from("booking_restrictions").select("*").eq("user_id",t==null?void 0:t.id).eq("is_active",!0).order("created_at",{ascending:!1});if(h)throw h;n(u||[])}catch(u){console.error("Error loading restrictions:",u)}},d=u=>u>=90?"text-green-600 bg-green-100":u>=70?"text-blue-600 bg-blue-100":u>=50?"text-yellow-600 bg-yellow-100":"text-red-600 bg-red-100",m=u=>u>=90?"Excellent":u>=70?"Good":u>=50?"Fair":"Needs Improvement";return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-1 flex items-center gap-2",children:[e.jsx(me,{className:"w-6 h-6"}),"Reliability Score"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your reputation within the community"})]}),e.jsxs("div",{className:`px-4 py-2 rounded-lg font-bold ${d(s.reliability_score)}`,children:[s.reliability_score,"/100"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:m(s.reliability_score)}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.reliability_score,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full transition-all ${s.reliability_score>=90?"bg-green-600":s.reliability_score>=70?"bg-blue-600":s.reliability_score>=50?"bg-yellow-600":"bg-red-600"}`,style:{width:`${s.reliability_score}%`}})})]}),s.is_in_grace_period&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(bt,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-blue-900",children:"Grace Period Active"}),e.jsxs("div",{className:"text-sm text-blue-700 mt-1",children:["You have ",s.grace_rides_remaining," grace rides remaining with reduced penalties for cancellations."]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.total_rides}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Total Rides"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.completed_rides}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Completed"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.cancelled_rides}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Cancelled"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:s.last_minute_cancellations}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Last Minute"})]})]}),e.jsxs("div",{className:"mt-6 grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Completion Rate"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[(s.completion_ratio*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 rounded-lg",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Cancellation Rate"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[(s.cancellation_ratio*100).toFixed(1),"%"]})]})]})]}),s.warnings_count>0&&e.jsx("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-yellow-900",children:[s.warnings_count," Active Warning",s.warnings_count>1?"s":""]}),e.jsx("div",{className:"text-sm text-yellow-700 mt-1",children:"Please be mindful of cancellations. Frequent cancellations may result in temporary restrictions."})]})]})})]}),a.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-red-300",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600"}),"Active Restrictions"]}),e.jsx("div",{className:"space-y-3",children:a.map(u=>e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("div",{className:"font-semibold text-red-900 capitalize",children:u.restriction_type.replace(/_/g," ")}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:u.reason}),u.ends_at&&e.jsxs("div",{className:"text-sm text-red-600 mt-2",children:["Ends: ",new Date(u.ends_at).toLocaleDateString()]})]},u.starts_at))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"How to Improve Your Score"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:" Complete rides without cancelling"}),e.jsx("li",{children:" Avoid last-minute cancellations (within 2 hours)"}),e.jsx("li",{children:" Cancel only when absolutely necessary"}),e.jsx("li",{children:" Provide valid reasons for cancellations (medical/emergency)"}),e.jsx("li",{children:" Your score improves with each completed ride"})]})]})]}):e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:e.jsx("p",{className:"text-gray-600",children:"Reliability data not available"})})}function $m(t,s=30){if(!t)return!1;const r=new Date(t),a=new Date,n=Math.floor((r.getTime()-a.getTime())/(1e3*60*60*24));return n<=s&&n>=0}function ai(t){return t?new Date(t)<new Date:!1}function Kw(){const{profile:t,updateProfile:s}=X(),r=ie(),[a,n]=x.useState(!1),[i,l]=x.useState(!1),[o,c]=x.useState([]),[d,m]=x.useState(""),[u,h]=x.useState(null),[f,g]=x.useState(null),[j,w]=x.useState(!1),[v,p]=x.useState(null),[y,b]=x.useState(!1),N=x.useRef(null),k=x.useRef({}),E=x.useRef(null),[C,R]=x.useState(!1),[T,M]=x.useState(""),[I,D]=x.useState(""),[F,B]=x.useState(null),[H,O]=x.useState(null),[$,L]=x.useState({}),[V,S]=x.useState({}),[U,P]=x.useState({}),[A,W]=x.useState({full_name:"",phone:"",bio:"",whatsapp_number:"",preferred_contact_method:"both"}),[z,Y]=x.useState({auto_accept_rides:!1,smoking_policy:"no-smoking",pets_allowed:!1,music_preference:"any",conversation_level:"any",instant_booking_enabled:!1}),[Z,ae]=x.useState(!1),[le,qe]=x.useState(!1);x.useEffect(()=>{t&&(He(),ns(),W({full_name:t.full_name||"",phone:t.phone||"",bio:t.bio||"",whatsapp_number:t.whatsapp_number||"",preferred_contact_method:t.preferred_contact_method||"both"}))},[t]);const He=async()=>{try{const{data:q,error:J}=await _.from("vehicles").select("*").eq("user_id",t==null?void 0:t.id).eq("is_active",!0).order("created_at",{ascending:!1});if(J)throw J;const he=(q||[]).map(te=>(!te.image_url&&te.vehicle_front_photo_path&&(te.image_url=Am(te.vehicle_front_photo_path)),te));c(he)}catch(q){console.error("Error loading vehicles:",q)}},ns=async()=>{if(t!=null&&t.id)try{ae(!0);const{data:q,error:J}=await _.from("user_preferences").select("auto_accept_rides, smoking_policy, pets_allowed, music_preference, conversation_level, instant_booking_enabled").eq("user_id",t.id).maybeSingle();if(J)throw J;q&&Y({auto_accept_rides:q.auto_accept_rides??!1,smoking_policy:q.smoking_policy??"no-smoking",pets_allowed:q.pets_allowed??!1,music_preference:q.music_preference??"any",conversation_level:q.conversation_level??"any",instant_booking_enabled:q.instant_booking_enabled??!1})}catch(q){console.error("Error loading preferences:",q)}finally{ae(!1)}},Et=async(q,J)=>{if(t!=null&&t.id)try{qe(!0);const{error:he}=await _.from("user_preferences").upsert({user_id:t.id,[q]:J},{onConflict:"user_id"});if(he)throw he;Y(te=>({...te,[q]:J})),D("Preferences updated successfully"),setTimeout(()=>D(""),2e3)}catch(he){console.error("Error updating preference:",he),M("Failed to update preference"),setTimeout(()=>M(""),3e3)}finally{qe(!1)}},Xg=q=>{var he;const J=(he=q.target.files)==null?void 0:he[0];if(J){if(J.size>10*1024*1024){M("Image size must be less than 10MB");return}if(!J.type.startsWith("image/")){M("Please select an image file");return}h(J);const te=new FileReader;te.onloadend=()=>{g(te.result)},te.readAsDataURL(J)}},Zg=async q=>{if(!u)return null;try{w(!0);const J=u.name.split(".").pop(),te=`vehicles/${`${q}-${Date.now()}.${J}`}`,{error:nt}=await _.storage.from("vehicle-images").upload(te,u,{cacheControl:"3600",upsert:!1});if(nt)throw nt;const{data:{publicUrl:is}}=_.storage.from("vehicle-images").getPublicUrl(te);return is}catch(J){return console.error("Error uploading image:",J),null}finally{w(!1)}},ef=async q=>{q.preventDefault(),M(""),D(""),R(!0);try{if(!d.trim()){M("Please enter a vehicle number"),R(!1);return}const J=d.trim().toUpperCase(),he="https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/vehicle-lookup",{data:{session:te}}=await _.auth.getSession(),nt=await fetch(he,{method:"POST",headers:{Authorization:`Bearer ${te==null?void 0:te.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({registrationNumber:J})});if(!nt.ok)throw new Error("Failed to lookup vehicle details");const is=await nt.json();if(!is.success||!is.data)throw new Error("Vehicle not found");const fe=is.data,be={user_id:t==null?void 0:t.id,make:fe.make||"Unknown",model:fe.model||"Unknown",year:fe.year||new Date().getFullYear(),color:fe.color||"Unknown",license_plate:J,capacity:fe.capacity||4,is_active:!0};fe.fuel_type&&(be.fuel_type=fe.fuel_type),fe.vehicle_type&&(be.vehicle_type=fe.vehicle_type),fe.registration_year&&(be.registration_year=fe.registration_year),fe.engine_capacity&&(be.engine_capacity=fe.engine_capacity),fe.image_url&&(be.image_url=fe.image_url),fe.mot_status&&(be.mot_status=fe.mot_status),fe.mot_expiry_date&&(be.mot_expiry_date=fe.mot_expiry_date),fe.tax_status&&(be.tax_status=fe.tax_status),fe.tax_due_date&&(be.tax_due_date=fe.tax_due_date);const{data:Ot,error:Gd}=await _.from("vehicles").insert(be).select().single();if(Gd)throw Gd;if(u&&Ot){const Kd=await Zg(Ot.id);Kd&&await _.from("vehicles").update({image_url:Kd}).eq("id",Ot.id)}D(`Vehicle added successfully! ${fe.make} ${fe.model}`),m(""),h(null),g(null),n(!1),await He()}catch(J){M(J.message||"Failed to add vehicle")}finally{R(!1)}},tf=async q=>{q.preventDefault(),M(""),D(""),R(!0);try{const{error:J}=await s(A);J?M(J.message):(D("Profile updated successfully!"),l(!1),setTimeout(()=>D(""),3e3))}catch(J){M(J.message||"Failed to update profile")}finally{R(!1)}},sf=async(q,J)=>{M(""),D(""),p(q),w(!0),P(he=>({...he,[q]:null}));try{if(J.size>10*1024*1024){const be="Image size must be less than 10MB";M(be),P(Ot=>({...Ot,[q]:be}));return}if(!J.type.startsWith("image/")){const be="Please select an image file";M(be),P(Ot=>({...Ot,[q]:be}));return}if(!(t!=null&&t.id)){const be="Profile not found";M(be),P(Ot=>({...Ot,[q]:be}));return}const{optimizedPath:he,thumbnailPath:te,optimizedUrl:nt,thumbnailUrl:is}=await Dw(t.id,q,J,be=>{L(Ot=>({...Ot,[q]:be}))}),{error:fe}=await _.from("vehicles").update({vehicle_front_photo_path:he,vehicle_front_photo_thumb_path:te,vehicle_photo_url:nt,image_url:nt}).eq("id",q);if(fe)throw fe;D("Vehicle photo uploaded and optimized!"),S(be=>({...be,[q]:null})),L(be=>({...be,[q]:100})),await He(),setTimeout(()=>{D(""),L(be=>({...be,[q]:void 0}))},3e3)}catch(he){const te=he.message||"Failed to upload vehicle photo";M(te),P(nt=>({...nt,[q]:te}))}finally{p(null),w(!1)}},rf=async q=>{try{P(te=>({...te,[q]:null}));const J=o.find(te=>te.id===q);if(J!=null&&J.vehicle_front_photo_path)try{const{error:te}=await _.storage.from("user-media").remove([J.vehicle_front_photo_path,J.vehicle_front_photo_thumb_path||""].filter(Boolean));te&&console.error("Storage deletion error:",te)}catch(te){console.error("Failed to delete storage file:",te)}const{error:he}=await _.from("vehicles").update({image_url:null,vehicle_photo_url:null,vehicle_front_photo_path:null,vehicle_front_photo_thumb_path:null}).eq("id",q);if(he)throw he;D("Photo removed successfully"),B(null),S(te=>({...te,[q]:null})),await He(),setTimeout(()=>D(""),3e3)}catch(J){M(J.message||"Failed to remove photo"),P(he=>({...he,[q]:J.message})),console.error("Photo removal error:",J)}},af=async q=>{try{const J=o.find(te=>te.id===q);if(J!=null&&J.vehicle_front_photo_path)try{const{error:te}=await _.storage.from("user-media").remove([J.vehicle_front_photo_path,J.vehicle_front_photo_thumb_path||""].filter(Boolean));te&&console.error("Storage deletion error:",te)}catch(te){console.error("Failed to delete storage file:",te)}const{error:he}=await _.from("vehicles").update({is_active:!1}).eq("id",q);if(he)throw he;D("Vehicle deleted successfully"),O(null),await He(),setTimeout(()=>D(""),3e3)}catch(J){M(J.message||"Failed to delete vehicle"),console.error("Vehicle deletion error:",J)}},nf=async q=>{M(""),D(""),b(!0);try{const J=await Yg(q);if(!J.valid){M(J.message);return}if(!(t!=null&&t.id)){M("Profile not found");return}const{optimizedPath:he,thumbnailPath:te,optimizedUrl:nt,thumbnailUrl:is}=await Kg(t.id,q,be=>console.log(`Upload progress: ${be}%`)),{error:fe}=await s({profile_photo_path:he,profile_photo_thumb_path:te,profile_photo_url:nt,avatar_url:nt,profile_verified:!0});if(fe)throw fe;D("Profile photo uploaded and verified! Face detected successfully."),setTimeout(()=>D(""),3e3)}catch(J){M(J.message||"Failed to upload profile photo")}finally{b(!1)}};if(!t)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full"})});const Hd=t.profile_photo_url||t.avatar_url||(t.profile_photo_path?Am(t.profile_photo_path):"");return e.jsxs("div",{className:"space-y-6 max-w-6xl mx-auto px-4 py-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start gap-6 mb-6",children:[e.jsxs("div",{className:"relative w-24 h-24 flex-shrink-0",children:[e.jsx("div",{className:"w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center border-2 border-blue-200",children:Hd?e.jsx("img",{src:Hd,alt:t.full_name,className:"w-24 h-24 rounded-full object-cover"}):e.jsx("span",{className:"text-3xl font-bold text-blue-600",children:t.full_name.charAt(0).toUpperCase()})}),t.profile_verified&&e.jsx("div",{className:"absolute top-0 right-0 p-1 bg-green-500 text-white rounded-full shadow-lg",title:"Face verified",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("input",{type:"file",accept:"image/*",ref:E,onChange:q=>{var he;const J=(he=q.target.files)==null?void 0:he[0];J&&(nf(J),q.target.value="")},className:"hidden"}),e.jsx("button",{onClick:()=>{var q;return(q=E.current)==null?void 0:q.click()},disabled:y,className:"absolute bottom-0 right-0 p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:bg-blue-300 shadow-lg",title:"Upload profile photo (must contain face)",children:y?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(ia,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.full_name}),t.profile_verified&&e.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Face Verified"]}),t.is_verified&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:"Verified"})]}),y&&e.jsx("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg text-sm text-blue-700",children:"Detecting face in photo... This may take a moment."}),!t.profile_verified&&e.jsxs("div",{className:"mb-3 p-3 bg-amber-50 border border-amber-200 rounded-lg flex items-start gap-2 text-sm text-amber-800",children:[e.jsx(ne,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Upload a clear face photo to get verified. This improves trust and safety in the community."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4 text-sm md:text-base text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 text-yellow-400 fill-current"}),t.average_rating.toFixed(1)," rating"]}),e.jsx("span",{className:"hidden md:inline",children:""}),e.jsxs("span",{children:[t.total_rides_offered," rides offered"]}),e.jsx("span",{className:"hidden md:inline",children:""}),e.jsxs("span",{children:[t.total_rides_taken," rides taken"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>l(!0),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(qd,{className:"w-4 h-4"}),"Edit Profile"]}),e.jsxs("button",{onClick:()=>r("/security"),className:"w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Fg,{className:"w-4 h-4"}),"Security"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),"Email"]}),e.jsx("p",{className:"text-gray-900",children:t.email})]}),t.phone&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(dt,{className:"w-4 h-4"}),"Phone"]}),e.jsx("p",{className:"text-gray-900",children:t.phone})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:[e.jsx(de,{className:"w-4 h-4"}),"Member Since"]}),e.jsx("p",{className:"text-gray-900",children:new Date(t.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})})]}),t.bio&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700 mb-2",children:"About"}),e.jsx("p",{className:"text-gray-900",children:t.bio})]})]})]}),e.jsx(Mw,{}),e.jsx(Bw,{}),e.jsx(Vw,{}),e.jsx(Gw,{}),e.jsx(Fw,{}),e.jsx(zw,{}),e.jsx(Lw,{}),e.jsx(Ow,{}),e.jsx(qw,{}),e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(pe,{className:"w-6 h-6"}),"My Vehicles"]}),e.jsxs("button",{onClick:()=>n(!a),className:"w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(oa,{className:"w-4 h-4"}),"Add Vehicle"]})]}),T&&e.jsx("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm",children:T}),I&&e.jsx("div",{className:"mb-4 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm",children:I}),a&&e.jsxs("form",{onSubmit:ef,className:"mb-6 p-6 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Add New Vehicle"}),e.jsx("button",{type:"button",onClick:()=>{n(!1),m(""),h(null),g(null),M("")},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ot,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Number (License Plate)"}),e.jsx("input",{type:"text",value:d,onChange:q=>m(q.target.value),placeholder:"e.g., ABC-1234",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:C}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your vehicle's license plate number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vehicle Photo (Optional)"}),e.jsx("input",{ref:N,type:"file",accept:"image/*",onChange:Xg,className:"hidden",disabled:C}),e.jsx("div",{className:"flex flex-col gap-3",children:f?e.jsxs("div",{className:"relative w-full h-48 rounded-lg overflow-hidden border-2 border-gray-300",children:[e.jsx("img",{src:f,alt:"Vehicle preview",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{h(null),g(null),N.current&&(N.current.value="")},className:"absolute top-2 right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(ot,{className:"w-4 h-4"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var q;return(q=N.current)==null?void 0:q.click()},className:"w-full px-4 py-8 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors flex flex-col items-center gap-2 text-gray-600 hover:text-blue-600",disabled:C,children:[e.jsx(sl,{className:"w-8 h-8"}),e.jsx("span",{className:"text-sm font-medium",children:"Upload Vehicle Photo"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Any image up to 10MB (auto-optimized)"})]})})]}),e.jsx("button",{type:"submit",disabled:C||j,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:C?j?"Uploading image...":"Adding...":"Add Vehicle"})]})]}),o.length===0&&!a?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(pe,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"font-medium mb-2",children:"No vehicles added yet"}),e.jsx("p",{className:"text-sm",children:"Add a vehicle to start offering rides"})]}):e.jsx("div",{className:"space-y-4",children:o.map(q=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4 p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors",children:[e.jsxs("div",{className:"relative w-full sm:w-32 h-48 sm:h-24 flex-shrink-0",children:[V[q.id]||q.image_url?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:V[q.id]||q.image_url,alt:`${q.make} ${q.model}`,className:"w-full h-full object-cover rounded-lg"}),$[q.id]!==void 0&&$[q.id]<100&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-40 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-sm font-medium",children:[$[q.id],"%"]})})]}):e.jsx("div",{className:"w-full h-full bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-12 h-12 sm:w-8 sm:h-8 text-blue-600"})}),e.jsx("input",{type:"file",accept:"image/*",ref:J=>k.current[q.id]=J,onChange:J=>{var te;const he=(te=J.target.files)==null?void 0:te[0];if(he){const nt=URL.createObjectURL(he);S(is=>({...is,[q.id]:nt})),sf(q.id,he),J.target.value=""}},className:"hidden"}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2",children:[(q.image_url||V[q.id])&&e.jsx("button",{onClick:()=>B(q.id),disabled:v===q.id,className:"p-1.5 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors disabled:bg-red-300 shadow-lg",title:"Remove photo",children:e.jsx(ot,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{var J;return(J=k.current[q.id])==null?void 0:J.click()},disabled:v===q.id,className:"p-1.5 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:bg-blue-300 shadow-lg",title:q.image_url?"Change image":"Upload image",children:v===q.id?e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Od,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0 w-full",children:[e.jsxs("p",{className:"font-semibold text-gray-900 text-lg truncate",children:[q.make," ",q.model]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:q.license_plate}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[q.mot_status&&e.jsxs("span",{className:`text-xs px-2 py-1 rounded flex items-center gap-1 font-medium ${q.mot_status.toLowerCase()==="valid"||q.mot_status.toLowerCase()==="not valid"?ai(q.mot_expiry_date)?"bg-red-100 text-red-700":$m(q.mot_expiry_date)?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"}`,children:[q.mot_status.toLowerCase()==="valid"&&!ai(q.mot_expiry_date)?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(ne,{className:"w-3 h-3"}),"MOT: ",q.mot_status,q.mot_expiry_date&&` (${new Date(q.mot_expiry_date).toLocaleDateString("en-GB")})`]}),q.tax_status&&e.jsxs("span",{className:`text-xs px-2 py-1 rounded flex items-center gap-1 font-medium ${q.tax_status.toLowerCase()==="taxed"?ai(q.tax_due_date)?"bg-red-100 text-red-700":$m(q.tax_due_date)?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700":q.tax_status.toLowerCase()==="sorn"?"bg-gray-100 text-gray-700":"bg-red-100 text-red-700"}`,children:[q.tax_status.toLowerCase()==="taxed"&&!ai(q.tax_due_date)?e.jsx(ee,{className:"w-3 h-3"}):e.jsx(me,{className:"w-3 h-3"}),"TAX: ",q.tax_status,q.tax_due_date&&` (${new Date(q.tax_due_date).toLocaleDateString("en-GB")})`]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[q.color&&e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full border border-gray-300",style:{backgroundColor:q.color.toLowerCase()}}),q.color]}),e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:[q.capacity," seats"]}),q.fuel_type&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded capitalize",children:q.fuel_type}),q.year&&e.jsx("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:q.year}),q.engine_capacity&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded",children:[q.engine_capacity,"cc"]})]})]}),e.jsx("button",{onClick:()=>O(q.id),className:"w-full sm:w-auto px-4 py-2 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors border border-red-200",children:"Delete Vehicle"})]}),(t==null?void 0:t.email)==="admin@carpoolnetwork.co.uk"&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg text-xs font-mono space-y-1",children:[e.jsx("div",{className:"font-semibold text-gray-700 mb-2",children:"Debug Info (Admin Only)"}),e.jsxs("div",{className:"text-gray-600",children:[e.jsxs("div",{children:["ID: ",q.id]}),e.jsxs("div",{children:["Path: ",q.vehicle_front_photo_path||"None"]}),e.jsxs("div",{children:["URL: ",q.image_url?" Set":" None"]}),e.jsxs("div",{children:["Upload: ",$[q.id]?`${$[q.id]}%`:"Idle"]}),U[q.id]&&e.jsxs("div",{className:"text-red-600 mt-1",children:["Error: ",U[q.id]]})]})]})]})]},q.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Ride Preferences"}),le&&e.jsx("span",{className:"text-sm text-blue-600",children:"Saving..."})]}),Z?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Auto-accept ride requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Automatically accept matching ride requests"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:z.auto_accept_rides,onChange:q=>Et("auto_accept_rides",q.target.checked),disabled:le}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Instant booking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Allow passengers to book without approval"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:z.instant_booking_enabled,onChange:q=>Et("instant_booking_enabled",q.target.checked),disabled:le}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"No smoking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Smoking is not allowed in your vehicle"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:z.smoking_policy==="no-smoking",onChange:q=>Et("smoking_policy",q.target.checked?"no-smoking":"smoking-allowed"),disabled:le}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Pets allowed"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Allow passengers to bring pets"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:z.pets_allowed,onChange:q=>Et("pets_allowed",q.target.checked),disabled:le}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Music allowed"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Passengers can request music during the ride"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer flex-shrink-0",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:z.music_preference!=="no-music",onChange:q=>Et("music_preference",q.target.checked?"any":"no-music"),disabled:le}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600 peer-disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4 py-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Conversation level"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Prefer chatty or quiet rides"})]}),e.jsxs("select",{value:z.conversation_level,onChange:q=>Et("conversation_level",q.target.value),disabled:le,className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50",children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"quiet",children:"Quiet"}),e.jsx("option",{value:"moderate",children:"Moderate"}),e.jsx("option",{value:"chatty",children:"Chatty"})]})]})]})]}),e.jsx(Uw,{}),e.jsx(Ww,{}),e.jsx(Hw,{}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Edit Profile"}),e.jsx("button",{onClick:()=>{l(!1),M(""),W({full_name:(t==null?void 0:t.full_name)||"",phone:(t==null?void 0:t.phone)||"",bio:(t==null?void 0:t.bio)||"",whatsapp_number:(t==null?void 0:t.whatsapp_number)||"",preferred_contact_method:(t==null?void 0:t.preferred_contact_method)||"both"})},className:"text-gray-400 hover:text-gray-600",children:e.jsx(ot,{className:"w-5 h-5"})})]}),T&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm flex items-start gap-2",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:T})]}),e.jsxs("form",{onSubmit:tf,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Full Name"}),e.jsx("input",{type:"text",value:A.full_name,onChange:q=>W({...A,full_name:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:A.phone,onChange:q=>W({...A,phone:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+44 1234 567890",disabled:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),e.jsx("textarea",{value:A.bio,onChange:q=>W({...A,bio:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4,placeholder:"Tell us about yourself...",disabled:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WhatsApp Number (Optional)"}),e.jsx("input",{type:"tel",value:A.whatsapp_number,onChange:q=>W({...A,whatsapp_number:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+44 1234 567890",disabled:C}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Other users can contact you via WhatsApp if provided"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Contact Method"}),e.jsxs("select",{value:A.preferred_contact_method,onChange:q=>W({...A,preferred_contact_method:q.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:C,children:[e.jsx("option",{value:"both",children:"Both (In-app & WhatsApp)"}),e.jsx("option",{value:"in_app",children:"In-app Messages Only"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp Only"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{l(!1),M(""),W({full_name:(t==null?void 0:t.full_name)||"",phone:(t==null?void 0:t.phone)||"",bio:(t==null?void 0:t.bio)||"",whatsapp_number:(t==null?void 0:t.whatsapp_number)||"",preferred_contact_method:(t==null?void 0:t.preferred_contact_method)||"both"})},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:C,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:C,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:C?"Saving...":"Save Changes"})]})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Remove Photo?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will remove the photo from this vehicle. The vehicle will remain."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>B(null),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>rf(F),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Remove"})]})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-sm w-full",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Delete Vehicle?"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will permanently delete this vehicle. This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>O(null),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"button",onClick:()=>af(H),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete"})]})]})})]})}function Yw(){const{profile:t}=X(),[s,r]=x.useState(!1),[a,n]=x.useState(!1),[i,l]=x.useState(!0);x.useEffect(()=>{t!=null&&t.id&&o()},[t==null?void 0:t.id]);const o=async()=>{try{const[h,f]=await Promise.all([_.from("driver_licenses").select("id, status").eq("user_id",t==null?void 0:t.id).eq("status","verified").maybeSingle(),_.from("vehicle_insurance").select("id, status").eq("user_id",t==null?void 0:t.id).eq("status","active").maybeSingle()]);r(!!h.data),n(!!f.data)}catch(h){console.error("Error checking documents:",h)}finally{l(!1)}};if(!t)return null;const c=[{id:"email",label:"Email Verified",icon:Jt,verified:t.is_verified||!1,description:"Email address confirmed",actionLabel:"Verify Email",actionLink:"/verify-email"},{id:"phone",label:"Phone Verified",icon:dt,verified:!!t.phone,description:"Phone number added",actionLabel:"Add Phone",actionLink:"#edit-profile"},{id:"face",label:"Face Verified",icon:ia,verified:!!t.profile_verified,description:"Identity verified with face photo",actionLabel:"Upload Photo",actionLink:"#profile-photo"},{id:"license",label:"Driver License",icon:Yt,verified:s,description:"Driver license verified",actionLabel:"Upload License",actionLink:"#documents"},{id:"insurance",label:"Insurance",icon:me,verified:a,description:"Vehicle insurance on file",actionLabel:"Upload Insurance",actionLink:"#documents"}],d=c.filter(h=>h.verified).length,m=c.length,u=Math.round(d/m*100);return i?e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})}):e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(me,{className:"w-6 h-6"}),"Verification Status"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Increase trust by verifying your identity"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-3xl font-bold ${u>=80?"text-green-600":u>=50?"text-yellow-600":"text-red-600"}`,children:u}),e.jsx("div",{className:"text-xs text-gray-600 font-medium",children:"Trust Score"})]})]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:c.map(h=>e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-all ${h.verified?"bg-green-50 border-green-200":"bg-gray-50 border-gray-200 hover:border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`p-2 rounded-full ${h.verified?"bg-green-100":"bg-gray-200"}`,children:h.verified?e.jsx(ee,{className:"w-5 h-5 text-green-600"}):e.jsx(Qe,{className:"w-5 h-5 text-gray-400"})}),h.verified&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded",children:"Verified"})]}),e.jsx("h4",{className:`font-semibold mb-1 ${h.verified?"text-green-900":"text-gray-900"}`,children:h.label}),e.jsx("p",{className:`text-xs mb-3 ${h.verified?"text-green-700":"text-gray-600"}`,children:h.description}),!h.verified&&h.actionLabel&&e.jsxs("a",{href:h.actionLink,className:"text-xs font-medium text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[h.actionLabel," "]})]},h.id))}),e.jsx("div",{className:`p-4 rounded-lg border ${u>=80?"bg-green-50 border-green-200":u>=50?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:`w-5 h-5 flex-shrink-0 ${u>=80?"text-green-600":u>=50?"text-yellow-600":"text-red-600"}`}),e.jsxs("div",{children:[e.jsxs("p",{className:`text-sm font-medium ${u>=80?"text-green-900":u>=50?"text-yellow-900":"text-red-900"}`,children:[u>=80&&"Excellent! Your profile is highly trusted.",u>=50&&u<80&&"Good progress! Complete more verifications to increase trust.",u<50&&"Start verifying your profile to build trust with other users."]}),e.jsxs("p",{className:`text-xs mt-1 ${u>=80?"text-green-700":u>=50?"text-yellow-700":"text-red-700"}`,children:[d," of ",m," verifications complete"]})]})]})})]})}function Jw(){const{userId:t}=_l(),s=ie(),{user:r}=X(),[a,n]=x.useState(null),[i,l]=x.useState([]),[o,c]=x.useState(null),[d,m]=x.useState(!0),[u,h]=x.useState("all"),[f,g]=x.useState(null);x.useEffect(()=>{if(t){if(t===(r==null?void 0:r.id)){s("/profile");return}j()}},[t,r]);const j=async()=>{if(t)try{m(!0),g(null);const{data:b,error:N}=await _.from("profiles").select("id, full_name, avatar_url, bio, created_at, photo_verified, id_verified, phone_verified, email_verified, preferred_contact_method").eq("id",t).maybeSingle();if(N)throw N;if(!b){g("User not found"),m(!1);return}n(b);const{data:k}=await _.from("reviews").select(`
          id,
          rating,
          comment,
          created_at,
          reviewer:reviewer_id(id, full_name, avatar_url)
        `).eq("reviewee_id",t).order("created_at",{ascending:!1}).limit(20);l(k||[]);const{data:E}=await _.from("rides").select("id",{count:"exact",head:!0}).eq("driver_id",t),{data:C}=await _.from("bookings").select("id",{count:"exact",head:!0}).eq("passenger_id",t).eq("status","confirmed"),R=(k||[]).map(I=>I.rating),T=R.length>0?R.reduce((I,D)=>I+D,0)/R.length:0,{data:M}=await _.from("profiles").select("reliability_score").eq("id",t).maybeSingle();c({ridesOffered:(E==null?void 0:E.length)||0,ridesTaken:(C==null?void 0:C.length)||0,averageRating:T,totalReviews:(k==null?void 0:k.length)||0,responseRate:95,reliabilityScore:(M==null?void 0:M.reliability_score)||0})}catch(b){console.error("Error loading profile:",b),g("Failed to load profile")}finally{m(!1)}},w=()=>{s("/messages",{state:{userId:t}})},v=async()=>{const b=`${window.location.origin}/user/${t}`;try{await navigator.clipboard.writeText(b),alert("Profile link copied to clipboard!")}catch(N){console.error("Failed to copy link:",N)}},p=()=>{alert("Report functionality coming soon")};if(d)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading profile..."})]})});if(f||!a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Profile Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:f||"The user you are looking for does not exist."}),e.jsx("button",{onClick:()=>s(-1),className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"Go Back"})]})});const y=u==="all"?i:i.filter(b=>b.ride_type===u);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white border-b sticky top-0 z-10",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsxs("button",{onClick:()=>s(-1),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back"]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx(rl,{user:a,size:"2xl",verified:a.photo_verified}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.full_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Member since ",new Date(a.created_at).toLocaleDateString("en-US",{month:"long",year:"numeric"})]})]})]})}),e.jsx(Yw,{photoVerified:a.photo_verified,idVerified:a.id_verified,phoneVerified:a.phone_verified,emailVerified:a.email_verified}),o&&o.averageRating>0&&e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(b=>e.jsx(we,{className:`w-5 h-5 ${b<=o.averageRating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},b))}),e.jsx("span",{className:"text-lg font-semibold text-gray-900",children:o.averageRating.toFixed(1)}),e.jsxs("span",{className:"text-sm text-gray-600",children:["(",o.totalReviews," ",o.totalReviews===1?"review":"reviews",")"]})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsxs("button",{onClick:w,className:"flex-1 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 font-semibold",children:[e.jsx(wa,{className:"w-5 h-5"}),"Message"]}),e.jsx("button",{onClick:v,className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Share profile",children:e.jsx(Dj,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:p,className:"px-4 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",title:"Report user",children:e.jsx(Gs,{className:"w-5 h-5 text-gray-600"})})]})]}),o&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.ridesOffered}),e.jsx("p",{className:"text-sm text-gray-600",children:"Rides Offered"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.ridesTaken}),e.jsx("p",{className:"text-sm text-gray-600",children:"Rides Taken"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.averageRating.toFixed(1)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Average Rating"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[o.reliabilityScore,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Reliability"})]})]}),a.bio&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 mb-3",children:"About"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:a.bio})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Reviews"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${u==="all"?"bg-green-100 text-green-700":"text-gray-600 hover:bg-gray-100"}`,children:"All"}),e.jsx("button",{onClick:()=>h("driver"),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${u==="driver"?"bg-green-100 text-green-700":"text-gray-600 hover:bg-gray-100"}`,children:"As Driver"}),e.jsx("button",{onClick:()=>h("passenger"),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors ${u==="passenger"?"bg-green-100 text-green-700":"text-gray-600 hover:bg-gray-100"}`,children:"As Passenger"})]})]}),y.length===0?e.jsx("p",{className:"text-gray-600 text-center py-8",children:"No reviews yet"}):e.jsx("div",{className:"space-y-4",children:y.map(b=>e.jsx("div",{className:"border-b border-gray-200 pb-4 last:border-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(rl,{user:b.reviewer,size:"sm"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:b.reviewer.full_name}),e.jsx("span",{className:"text-sm text-gray-500",children:new Date(b.created_at).toLocaleDateString()})]}),e.jsx("div",{className:"flex items-center gap-1 mb-2",children:[1,2,3,4,5].map(N=>e.jsx(we,{className:`w-4 h-4 ${N<=b.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},N))}),b.comment&&e.jsx("p",{className:"text-gray-700",children:b.comment})]})]})},b.id))})]})]})]})}function Qw(){const{user:t}=X(),[s,r]=x.useState(null),[a,n]=x.useState(!0),[i,l]=x.useState(!1),[o,c]=x.useState(!1),[d,m]=x.useState(""),[u,h]=x.useState(""),[f,g]=x.useState(""),[j,w]=x.useState([]),[v,p]=x.useState(!1),[y,b]=x.useState(""),[N,k]=x.useState(""),[E,C]=x.useState(!1);x.useEffect(()=>{R()},[t]);const R=async()=>{if(t)try{const{data:$,error:L}=await _.from("two_factor_auth").select("enabled, verified_at, last_used_at").eq("user_id",t.id).maybeSingle();if(L&&L.code!=="PGRST116")throw L;r($||{enabled:!1,verified_at:null,last_used_at:null})}catch($){console.error("Error fetching 2FA status:",$)}finally{n(!1)}},T=()=>{const $="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let L="";for(let V=0;V<32;V++)L+=$.charAt(Math.floor(Math.random()*$.length));return L},M=async()=>{b(""),C(!0);try{const $=T();h($);const L="CarpoolNetwork",V=(t==null?void 0:t.email)||"",S=`otpauth://totp/${encodeURIComponent(L)}:${encodeURIComponent(V)}?secret=${$}&issuer=${encodeURIComponent(L)}`,U=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(S)}`;m(U);const{error:P}=await _.from("two_factor_auth").upsert({user_id:t==null?void 0:t.id,secret:$,enabled:!1},{onConflict:"user_id"});if(P)throw P;l(!0)}catch($){console.error("Error starting 2FA setup:",$),b("Failed to start 2FA setup. Please try again.")}finally{C(!1)}},I=async()=>{var $;if(!f||f.length!==6){b("Please enter a valid 6-digit code");return}b(""),k(""),C(!0);try{if(!(await(await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/verify-2fa",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${($=(await _.auth.getSession()).data.session)==null?void 0:$.access_token}`},body:JSON.stringify({code:f,secret:u})})).json()).valid){b("Invalid verification code. Please try again.");return}const S=F(),U=await Promise.all(S.map(async W=>({user_id:t==null?void 0:t.id,code_hash:await B(W)}))),{error:P}=await _.from("two_factor_recovery_codes").insert(U);if(P)throw P;const{error:A}=await _.from("two_factor_auth").update({enabled:!0,verified_at:new Date().toISOString(),backup_codes_generated_at:new Date().toISOString()}).eq("user_id",t==null?void 0:t.id);if(A)throw A;await _.from("two_factor_audit_log").insert({user_id:t==null?void 0:t.id,action:"enabled"}),w(S.map((W,z)=>({id:`${z}`,code:W,used:!1}))),c(!0),l(!1),k("Two-factor authentication enabled successfully!"),R()}catch(L){console.error("Error enabling 2FA:",L),b("Failed to enable 2FA. Please try again.")}finally{C(!1)}},D=async()=>{if(confirm("Are you sure you want to disable two-factor authentication? This will make your account less secure.")){C(!0),b("");try{const{error:$}=await _.from("two_factor_recovery_codes").delete().eq("user_id",t==null?void 0:t.id);if($)throw $;const{error:L}=await _.from("two_factor_auth").update({enabled:!1,secret:null,verified_at:null}).eq("user_id",t==null?void 0:t.id);if(L)throw L;await _.from("two_factor_audit_log").insert({user_id:t==null?void 0:t.id,action:"disabled"}),k("Two-factor authentication has been disabled."),R()}catch($){console.error("Error disabling 2FA:",$),b("Failed to disable 2FA. Please try again.")}finally{C(!1)}}},F=()=>{const $=[];for(let L=0;L<8;L++){let V="";for(let S=0;S<8;S++)V+=Math.floor(Math.random()*10);$.push(V)}return $},B=async $=>{const V=new TextEncoder().encode($+(t==null?void 0:t.id)),S=await crypto.subtle.digest("SHA-256",V);return Array.from(new Uint8Array(S)).map(P=>P.toString(16).padStart(2,"0")).join("")},H=()=>{const $=j.map(L=>L.code).join(`
`);navigator.clipboard.writeText($),p(!0),setTimeout(()=>p(!1),2e3)},O=()=>{const $=j.map(U=>U.code).join(`
`),L=new Blob([`Carpool Network Recovery Codes
Generated: ${new Date().toLocaleString()}

${$}

Store these codes in a safe place. Each code can only be used once.`],{type:"text/plain"}),V=URL.createObjectURL(L),S=document.createElement("a");S.href=V,S.download="carpool-recovery-codes.txt",document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(V)};return a?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 rounded-lg ${s!=null&&s.enabled?"bg-green-100":"bg-gray-100"}`,children:e.jsx(me,{className:`w-6 h-6 ${s!=null&&s.enabled?"text-green-600":"text-gray-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add an extra layer of security to your account"})]})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${s!=null&&s.enabled?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s!=null&&s.enabled?e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Ks,{className:"w-3 h-3"}),e.jsx("span",{children:"Enabled"})]}):e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx(Ij,{className:"w-3 h-3"}),e.jsx("span",{children:"Disabled"})]})})]}),y&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center space-x-2 text-red-800",children:[e.jsx(ne,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:y})]}),N&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center space-x-2 text-green-800",children:[e.jsx(Pr,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:N})]}),!(s!=null&&s.enabled)&&!i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Why enable 2FA?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Pr,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Protects your account even if your password is compromised"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Pr,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Prevents unauthorized access to your rides and messages"})]}),e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx(Pr,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Compatible with Google Authenticator, Authy, and other TOTP apps"})]})]})]}),e.jsx("button",{onClick:M,disabled:E,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",children:E?"Setting up...":"Enable Two-Factor Authentication"})]}),(s==null?void 0:s.enabled)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-green-800",children:"Your account is protected with two-factor authentication."}),s.last_used_at&&e.jsxs("p",{className:"text-xs text-green-700 mt-2",children:["Last used: ",new Date(s.last_used_at).toLocaleString()]})]}),e.jsx("button",{onClick:D,disabled:E,className:"w-full px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50",children:E?"Disabling...":"Disable Two-Factor Authentication"})]})]}),i&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Set Up Two-Factor Authentication"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.)"}),d&&e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:d,alt:"2FA QR Code",className:"border border-gray-300 rounded-lg"})}),e.jsxs("div",{className:"bg-gray-50 border border-gray-300 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:"Or enter this code manually:"}),e.jsx("p",{className:"text-sm font-mono text-gray-900 break-all",children:u})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enter the 6-digit code from your app"}),e.jsx("input",{type:"text",value:f,onChange:$=>g($.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-2xl font-mono tracking-widest"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>{l(!1),g(""),h("")},disabled:E,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:E||f.length!==6,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",children:E?"Verifying...":"Verify & Enable"})]})]})]}),o&&j.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ig,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Recovery Codes"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-yellow-800 font-medium mb-2",children:"Important: Save these codes now!"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Store these recovery codes in a safe place. Each code can only be used once to access your account if you lose your authenticator device."})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded-lg p-4 mb-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 font-mono text-sm",children:j.map($=>e.jsx("div",{className:"text-gray-900",children:$.code},$.id))})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:H,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2",children:[v?e.jsx(Pr,{className:"w-4 h-4"}):e.jsx(Tg,{className:"w-4 h-4"}),e.jsx("span",{children:v?"Copied!":"Copy Codes"})]}),e.jsxs("button",{onClick:O,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx(ja,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]})]}),e.jsx("button",{onClick:()=>c(!1),className:"w-full mt-3 px-4 py-2 text-gray-600 hover:text-gray-900 text-sm font-medium",children:"I've saved my recovery codes"})]})]})}function Xw(){const t=ie(),{profile:s}=X(),[r,a]=x.useState(!1),[n,i]=x.useState(""),[l,o]=x.useState(""),[c,d]=x.useState(!1),[m,u]=x.useState({currentPassword:"",newPassword:"",confirmPassword:""}),h=async g=>{if(g.preventDefault(),i(""),o(""),m.newPassword!==m.confirmPassword){i("New passwords do not match");return}if(m.newPassword.length<8){i("Password must be at least 8 characters long");return}try{a(!0);const{error:j}=await _.auth.updateUser({password:m.newPassword});if(j)throw j;o("Password updated successfully"),u({currentPassword:"",newPassword:"",confirmPassword:""}),setTimeout(()=>o(""),3e3)}catch(j){i(j.message||"Failed to update password")}finally{a(!1)}},f=async()=>{try{a(!0),i("");const{error:g}=await _.rpc("delete_user_account",{user_id:s==null?void 0:s.id});if(g)throw g;await _.auth.signOut(),t("/")}catch(g){i(g.message||"Failed to delete account"),d(!1)}finally{a(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 py-8",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("button",{onClick:()=>t("/profile"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Profile"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8"}),"Security Settings"]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your account security and privacy"})]}),n&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800 text-sm flex items-start gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:n})]}),l&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800 text-sm flex items-start gap-2",children:[e.jsx(ee,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:l})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ks,{className:"w-6 h-6 text-gray-900"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Change Password"})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:m.newPassword,onChange:g=>u({...m,newPassword:g.target.value}),placeholder:"Enter new password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,minLength:8,disabled:r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Must be at least 8 characters long"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirm New Password ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"password",value:m.confirmPassword,onChange:g=>u({...m,confirmPassword:g.target.value}),placeholder:"Confirm new password",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,disabled:r})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed",children:r?"Updating...":"Update Password"})]})]}),e.jsx(Qw,{}),e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ig,{className:"w-6 h-6 text-gray-900"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Active Sessions"})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Current Device"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active now"})]}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded",children:"Active"})]})})}),e.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"You're currently signed in on this device. Sign out to end your session."})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 md:p-8 border border-red-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Ns,{className:"w-6 h-6 text-red-600"}),e.jsx("h2",{className:"text-xl font-bold text-red-900",children:"Delete Account"})]}),e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm text-red-800 mb-2",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone."]}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1 ml-4 list-disc",children:[e.jsx("li",{children:"All your profile data will be permanently deleted"}),e.jsx("li",{children:"Your ride history will be removed"}),e.jsx("li",{children:"You will lose access to all messages and bookings"}),e.jsx("li",{children:"This cannot be reversed"})]})]}),e.jsx("button",{onClick:()=>d(!0),className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete My Account"})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:e.jsx(Ce,{className:"w-6 h-6 text-red-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Delete Account?"})]}),e.jsx("p",{className:"text-gray-700 mb-6",children:"Are you absolutely sure you want to delete your account? This action is permanent and cannot be undone. All your data will be lost forever."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>d(!1),disabled:r,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:f,disabled:r,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-300",children:r?"Deleting...":"Delete Account"})]})]})})]})}function Zw(){const{user:t,profile:s}=X(),[r,a]=x.useState(null),[n,i]=x.useState(!0),[l,o]=x.useState("month");x.useEffect(()=>{t&&c()},[t,l]);const c=async()=>{i(!0);try{const v=d(l),{data:p,error:y}=await _.from("rides").select("*").eq("driver_id",t==null?void 0:t.id).gte("created_at",v.toISOString());if(y)throw y;const{data:b,error:N}=await _.from("ride_bookings").select("*, rides(*)").eq("rider_id",t==null?void 0:t.id).gte("created_at",v.toISOString());if(N)throw N;const k=[...p||[],...(b==null?void 0:b.map(H=>H.rides))||[]],E=k.reduce((H,O)=>H+m(O),0),C=u(E,k.length),R=h(E),T={};k.forEach(H=>{if(H!=null&&H.origin&&(H!=null&&H.destination)){const O=`${H.origin}-${H.destination}`;T[O]=(T[O]||0)+1}});const M=Object.keys(T).sort((H,O)=>T[O]-T[H])[0],I=M?{origin:M.split("-")[0],destination:M.split("-")[1],count:T[M]}:null,D=f(k),F=g(k),B=j(k);a({totalRides:k.length,totalDistance:E,totalCO2Saved:C,totalMoneySaved:R,avgRideDistance:k.length>0?E/k.length:0,mostCommonRoute:I,peakHours:D,monthlyTrends:F,ridesByDayOfWeek:B})}catch(v){console.error("Error fetching analytics:",v)}finally{i(!1)}},d=v=>{const p=new Date;switch(v){case"week":return new Date(p.getTime()-7*24*60*60*1e3);case"month":return new Date(p.getTime()-30*24*60*60*1e3);case"year":return new Date(p.getTime()-365*24*60*60*1e3);case"all":default:return new Date(0)}},m=v=>{if(!(v!=null&&v.origin_lat)||!(v!=null&&v.destination_lat))return 0;const p=6371,y=(v.destination_lat-v.origin_lat)*Math.PI/180,b=(v.destination_lng-v.origin_lng)*Math.PI/180,N=Math.sin(y/2)*Math.sin(y/2)+Math.cos(v.origin_lat*Math.PI/180)*Math.cos(v.destination_lat*Math.PI/180)*Math.sin(b/2)*Math.sin(b/2),k=2*Math.atan2(Math.sqrt(N),Math.sqrt(1-N));return p*k},u=(v,p)=>v*.171*.5,h=v=>v*.15,f=v=>{const p={};return v.forEach(y=>{if(y!=null&&y.departure_time){const b=new Date(y.departure_time).getHours();p[b]=(p[b]||0)+1}}),Object.entries(p).map(([y,b])=>({hour:parseInt(y),count:b})).sort((y,b)=>b.count-y.count).slice(0,5)},g=v=>{const p={};return v.forEach(y=>{if(y!=null&&y.created_at){const b=new Date(y.created_at),N=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;p[N]||(p[N]={rides:0,distance:0}),p[N].rides+=1,p[N].distance+=m(y)}}),Object.entries(p).map(([y,b])=>({month:y,rides:b.rides,distance:Math.round(b.distance)})).sort((y,b)=>y.month.localeCompare(b.month)).slice(-6)},j=v=>{const p=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y={};return v.forEach(b=>{if(b!=null&&b.departure_time){const N=new Date(b.departure_time).getDay();y[N]=(y[N]||0)+1}}),p.map((b,N)=>({day:b,count:y[N]||0}))},w=v=>v>=1e3?`${(v/1e3).toFixed(2)} tonnes`:`${v.toFixed(2)} kg`;return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Advanced Analytics"}),e.jsxs("select",{value:l,onChange:v=>o(v.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"}),e.jsx("option",{value:"year",children:"Last Year"}),e.jsx("option",{value:"all",children:"All Time"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ys,{className:"w-8 h-8 opacity-80"}),e.jsx(ca,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-green-100 text-sm mb-1",children:"CO Saved"}),e.jsx("p",{className:"text-3xl font-bold",children:w(r.totalCO2Saved)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(va,{className:"w-8 h-8 opacity-80"}),e.jsx(Fe,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-blue-100 text-sm mb-1",children:"Money Saved"}),e.jsxs("p",{className:"text-3xl font-bold",children:["",r.totalMoneySaved.toFixed(2)]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(xe,{className:"w-8 h-8 opacity-80"}),e.jsx(Me,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-orange-100 text-sm mb-1",children:"Total Distance"}),e.jsxs("p",{className:"text-3xl font-bold",children:[r.totalDistance.toFixed(0)," km"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-8 h-8 opacity-80"}),e.jsx(re,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-purple-100 text-sm mb-1",children:"Total Rides"}),e.jsx("p",{className:"text-3xl font-bold",children:r.totalRides})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ye,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Peak Travel Hours"})]}),r.peakHours.length>0?e.jsx("div",{className:"space-y-3",children:r.peakHours.map(({hour:v,count:p})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-700",children:[v.toString().padStart(2,"0"),":00 - ",(v+1).toString().padStart(2,"0"),":00"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${p/r.peakHours[0].count*100}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-8 text-right",children:p})]})]},v))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(xe,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Most Common Route"})]}),r.mostCommonRoute?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 font-medium",children:r.mostCommonRoute.origin})]}),e.jsx("div",{className:"ml-1.5 w-0.5 h-6 bg-gray-300"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-gray-900 font-medium",children:r.mostCommonRoute.destination})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.mostCommonRoute.count}),e.jsx("p",{className:"text-sm text-gray-600",children:"rides"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"This is your most frequent route! Consider finding regular carpool partners for this journey."})})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No data available"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(de,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rides by Day of Week"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:r.ridesByDayOfWeek.map(({day:v,count:p})=>{const y=Math.max(...r.ridesByDayOfWeek.map(N=>N.count),1),b=p/y*100;return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-full h-32 bg-gray-100 rounded-lg flex items-end justify-center p-1",children:e.jsx("div",{className:"w-full bg-blue-600 rounded-t",style:{height:`${b}%`}})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:v.slice(0,3)}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:p})]},v)})})]}),r.monthlyTrends.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Tn,{className:"w-5 h-5 text-gray-700"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Monthly Trends"})]}),e.jsx("div",{className:"space-y-3",children:r.monthlyTrends.map(({month:v,rides:p,distance:y})=>e.jsxs("div",{className:"border-b border-gray-100 pb-3 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:new Date(v+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[p," rides"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${y/Math.max(...r.monthlyTrends.map(b=>b.distance),1)*100}%`}})}),e.jsxs("span",{className:"text-xs text-gray-600 w-16 text-right",children:[y," km"]})]})]},v))})]}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-blue-50 border border-green-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-3 bg-green-500 rounded-full",children:e.jsx(ys,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Environmental Impact"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["By carpooling, you've saved ",e.jsx("strong",{children:w(r.totalCO2Saved)})," of CO emissions. That's equivalent to planting approximately"," ",e.jsx("strong",{children:Math.round(r.totalCO2Saved/20)})," trees!"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg. Distance/Ride"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[r.avgRideDistance.toFixed(1)," km"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Savings"}),e.jsxs("p",{className:"text-xl font-bold text-green-600",children:["",r.totalMoneySaved.toFixed(2)]})]})]})]})]})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No analytics data available"})]})}function eN(){const t=ie();return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-between h-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>t("/profile"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"My Analytics"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your carpool journey insights"})]})]})})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx(Zw,{})})]})}function tN({origin:t,destination:s,departureTime:r,onRouteSelect:a,onGasStationsUpdate:n}){const i=x.useRef(null),l=x.useRef(null),o=x.useRef(null),c=x.useRef([]),d=x.useRef([]),[m,u]=x.useState([]),[h,f]=x.useState(0),[g,j]=x.useState(!0),[w,v]=x.useState(null),[p,y]=x.useState(!0),[b,N]=x.useState([]),[k,E]=x.useState(!1),[C,R]=x.useState("mi"),[T,M]=x.useState(!1);x.useEffect(()=>(I(),()=>{D()}),[]),x.useEffect(()=>{T&&l.current&&t&&s&&F()},[T,t.lat,t.lng,s.lat,s.lng,r]),x.useEffect(()=>{m.length>0&&h>=0&&L()},[h,m]);const I=async()=>{var z,Y;if(!(!i.current||l.current))try{const Z="YOUR_GOOGLE_MAPS_API_KEY";if(typeof google>"u"||!google.maps){const qe=document.createElement("script");qe.src=`https://maps.googleapis.com/maps/api/js?key=${Z}&libraries=places,geometry`,qe.async=!0,qe.defer=!0,document.head.appendChild(qe),await new Promise((ns,Et)=>{qe.onload=ns,qe.onerror=()=>Et(new Error("Failed to load Google Maps")),setTimeout(()=>Et(new Error("Google Maps loading timeout")),15e3)});let He=0;for(;!((Y=(z=google==null?void 0:google.maps)==null?void 0:z.geometry)!=null&&Y.encoding)&&He<30;)await new Promise(ns=>setTimeout(ns,100)),He++}const ae=new google.maps.Map(i.current,{zoom:10,center:t,mapTypeControl:!0,fullscreenControl:!0,streetViewControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});l.current=ae;const le=new google.maps.TrafficLayer;le.setMap(ae),o.current=le,M(!0),j(!1)}catch(Z){console.error("Map initialization error:",Z),v(Z.message||"Failed to initialize map. Please refresh the page."),j(!1)}},D=()=>{c.current.forEach(z=>z.setMap(null)),c.current=[],d.current.forEach(({polyline:z})=>z.setMap(null)),d.current=[]},F=async()=>{if(l.current){j(!0),v(null),D();try{const z=await Wt.getMultipleRouteOptions(t,s);if(z.length===0)throw new Error("No routes found");u(z),f(0),B(z,0),H(),O()}catch(z){console.error("Route loading error:",z),v("Failed to load routes. Please try again.")}finally{j(!1)}}},B=(z,Y)=>{var Z,ae;!l.current||!((ae=(Z=google==null?void 0:google.maps)==null?void 0:Z.geometry)!=null&&ae.encoding)||(d.current.forEach(({polyline:le})=>le.setMap(null)),d.current=[],z.forEach((le,qe)=>{const He=qe===Y;try{const ns=google.maps.geometry.encoding.decodePath(le.polyline),Et=new google.maps.Polyline({path:ns,geodesic:!0,strokeColor:He?"#2563EB":"#9CA3AF",strokeOpacity:He?.9:.5,strokeWeight:He?6:4,map:l.current,zIndex:He?100:50});Et.addListener("click",()=>{$(qe)}),d.current.push({option:le,polyline:Et,isSelected:He})}catch(ns){console.error("Error rendering route polyline:",ns)}}))},H=()=>{if(!l.current)return;const z=new google.maps.Marker({position:t,map:l.current,title:t.name,label:{text:"A",color:"white",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:"#10B981",fillOpacity:1,strokeColor:"white",strokeWeight:2}}),Y=new google.maps.Marker({position:s,map:l.current,title:s.name,label:{text:"B",color:"white",fontWeight:"bold"},icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:"#EF4444",fillOpacity:1,strokeColor:"white",strokeWeight:2}});c.current.push(z,Y)},O=()=>{if(!l.current)return;const z=new google.maps.LatLngBounds;z.extend(t),z.extend(s),l.current.fitBounds(z,{top:50,right:50,bottom:50,left:50})},$=z=>{z===h||!m[z]||(f(z),B(m,z),a&&a(m[z]))},L=async()=>{if(m[h]){E(!0);try{const z=m[h],Y=(t.lat+s.lat)/2,Z=(t.lng+s.lng)/2,ae=await Wt.searchNearbyPlaces(Y,Z,"gas_station",5e3);N(ae.slice(0,5)),n&&n(ae.slice(0,5))}catch(z){console.error("Error loading gas stations:",z)}finally{E(!1)}}},V=()=>{if(!o.current||!l.current)return;const z=!p;o.current.setMap(z?l.current:null),y(z)},S=(z,Y)=>{if(!r)return null;const Z=r.getHours();let ae="Light",le="bg-green-100 text-green-700";return Z>=7&&Z<=9||Z>=17&&Z<=19?(ae="Heavy",le="bg-red-100 text-red-700"):(Z>=6&&Z<7||Z>9&&Z<17||Z>19&&Z<22)&&(ae="Moderate",le="bg-yellow-100 text-yellow-700"),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${le}`,children:[ae," Traffic"]})},U=(z,Y)=>{const Z=[];z.optimizationType==="FASTEST"&&Z.push("Quickest"),z.optimizationType==="SHORTEST"&&Z.push("Shortest Distance"),z.optimizationType==="ECO_FRIENDLY"&&Z.push("Fuel Efficient");const ae=Y.reduce((le,qe)=>qe.durationValue<le.durationValue?qe:le);if(z===ae&&Y.length>1){const le=Math.round((Y.reduce((qe,He)=>qe+He.durationValue,0)/Y.length-z.durationValue)/60);le>0&&Z.push(`Saves ${le} min`)}return Z},P=z=>{if(z.length===0)return-1;if(z.length===1)return 0;const Y=z.map(Z=>{let ae=0;return ae+=(1-Z.durationValue/Math.max(...z.map(le=>le.durationValue)))*45,ae+=(1-Z.distanceValue/Math.max(...z.map(le=>le.distanceValue)))*10,Z.optimizationType==="FASTEST"&&(ae+=20),Z.optimizationType==="ECO_FRIENDLY"&&(ae+=10),Z.optimizationType==="BALANCED"&&(ae+=15),ae});return Y.indexOf(Math.max(...Y))};if(w)return e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-red-700 font-medium mb-3",children:w}),e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2 mx-auto",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Retry"]})]});const A=P(m),W=z=>{const Y=parseFloat(z);return cw(Y,C)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Aj,{className:"w-5 h-5 text-blue-600"}),"Multi-Route Navigation"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>R("mi"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${C==="mi"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"mi"}),e.jsx("button",{onClick:()=>R("km"),className:`px-3 py-1 rounded text-sm font-medium transition-colors ${C==="km"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"km"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:i,className:"w-full h-[400px] rounded-xl overflow-hidden border border-gray-200"}),g&&e.jsxs("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex flex-col items-center justify-center rounded-xl",children:[e.jsx(at,{className:"w-12 h-12 text-blue-600 animate-spin mb-3"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading routes..."})]}),!g&&l.current&&e.jsxs("button",{onClick:V,className:`absolute top-4 right-4 px-3 py-2 rounded-lg shadow-lg font-medium flex items-center gap-2 transition-colors text-sm z-10 ${p?"bg-blue-600 text-white hover:bg-blue-700":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:p?"Hide Traffic":"Show Traffic"})]})]}),m.length>0&&e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"space-y-2",children:m.map((z,Y)=>{const Z=Y===h,ae=Y===A,le=U(z,m);return e.jsxs("button",{onClick:()=>$(Y),className:`w-full p-4 rounded-xl border-2 text-left transition-all ${Z?"border-blue-600 bg-blue-50 shadow-md":"border-gray-200 hover:border-blue-300 bg-white hover:shadow"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h5",{className:"font-bold text-gray-900",children:z.name}),ae&&e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full font-semibold flex items-center gap-1",children:[e.jsx(bs,{className:"w-3 h-3"}),"Recommended"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:z.description})]}),e.jsxs("div",{className:"flex gap-2",children:[z.optimizationType==="ECO_FRIENDLY"&&e.jsx(ys,{className:"w-5 h-5 text-green-600 flex-shrink-0"}),z.optimizationType==="FASTEST"&&e.jsx(bs,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),z.optimizationType==="SHORTEST"&&e.jsx(ca,{className:"w-5 h-5 text-purple-600 flex-shrink-0"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:z.duration}),e.jsx("span",{className:"text-lg text-gray-600",children:W(z.distance.replace(" km",""))}),S()]}),le.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:le.map((qe,He)=>e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded-md",children:qe},He))}),ae&&e.jsx("p",{className:"text-xs text-blue-700 mt-2 pt-2 border-t border-blue-200",children:"Recommended because it offers the best balance of speed and efficiency"})]},`${z.name}-${Y}`)})})})]})}function sN({origin:t,destination:s,departureTime:r,distance:a,duration:n,onRouteSelect:i}){const[l,o]=x.useState(null),[c,d]=x.useState(null),[m,u]=x.useState([]),[h,f]=x.useState([]),[g,j]=x.useState(""),[w,v]=x.useState(!0);x.useEffect(()=>{p()},[t.lat,t.lng,s.lat,s.lng]);const p=async()=>{v(!0);try{const[k,E,C,R]=await Promise.all([Wt.getWeatherForecast(s.lat,s.lng,r),Wt.getAirQuality(s.lat,s.lng),Wt.getPollenData(s.lat,s.lng),Wt.getMultipleRouteOptions(t,s)]);o(k),d(E),u(C),f(R),R.length>0&&j(R[0].name)}catch(k){console.error("Error loading insights:",k)}finally{v(!1)}},y=k=>{j(k.name),i&&i(k)},N=(()=>{if(!r)return null;const k=r.getHours();return k>=7&&k<=9?{message:"Rush hour traffic expected. Consider leaving 30 minutes earlier or later.",type:"warning"}:k>=17&&k<=19?{message:"Evening rush hour. Expect delays. Alternative: Leave after 19:30.",type:"warning"}:k>=22||k<=5?{message:"Quiet roads at this time. Great time for travel!",type:"success"}:{message:"Good time to travel with moderate traffic.",type:"info"}})();return w?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Trip Insights"}),e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 space-y-6",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-blue-600"}),"Trip Insights & Route Options"]}),h.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Choose Your Route"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.map(k=>e.jsxs("button",{onClick:()=>y(k),className:`p-4 rounded-lg border-2 text-left transition-all ${g===k.name?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-blue-300 bg-white"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-900",children:k.name}),e.jsx("p",{className:"text-sm text-gray-600",children:k.description})]}),k.optimizationType==="ECO_FRIENDLY"&&e.jsx(ys,{className:"w-5 h-5 text-green-600"}),k.optimizationType==="FASTEST"&&e.jsx(ye,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsx("span",{className:"text-gray-700",children:e.jsx("span",{className:"font-medium",children:k.distance})}),e.jsx("span",{className:"text-gray-700",children:e.jsx("span",{className:"font-medium",children:k.duration})})]}),k.fuelEfficiency&&e.jsxs("div",{className:"mt-2 text-xs text-green-600 flex items-center gap-1",children:[e.jsx(ys,{className:"w-3 h-3"}),"Fuel efficient route"]})]},k.name))})]}),N&&e.jsxs("div",{className:`p-4 rounded-lg flex items-start gap-3 ${N.type==="warning"?"bg-amber-50 border border-amber-200":N.type==="success"?"bg-green-50 border border-green-200":"bg-blue-50 border border-blue-200"}`,children:[e.jsx(Ce,{className:`w-5 h-5 flex-shrink-0 ${N.type==="warning"?"text-amber-600":N.type==="success"?"text-green-600":"text-blue-600"}`}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-1",children:"Departure Time Recommendation"}),e.jsx("p",{className:"text-sm text-gray-700",children:N.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(An,{className:"w-5 h-5 text-blue-600"}),e.jsxs("h4",{className:"font-medium text-gray-900",children:["Weather ",r?"Forecast":"Conditions"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Temperature"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[l.temperature,"C"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Condition"}),e.jsx("span",{className:"font-semibold text-gray-900",children:l.condition})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ag,{className:"w-4 h-4"}),l.humidity,"%"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Nn,{className:"w-4 h-4"}),l.windSpeed," km/h"]})]}),l.forecast&&l.forecast.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"5-Day Forecast"}),e.jsx("div",{className:"space-y-1",children:l.forecast.slice(0,3).map((k,E)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:k.date}),e.jsxs("span",{children:[k.temperature,"C - ",k.condition]})]},E))})]})]})]}),c&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx($j,{className:"w-5 h-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Air Quality"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"AQI"}),e.jsx("span",{className:"font-bold px-3 py-1 rounded-full text-white text-sm",style:{backgroundColor:c.color},children:c.aqi})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Category"}),e.jsx("span",{className:"font-semibold text-gray-900",children:c.category})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Main Pollutant"}),e.jsx("span",{className:"font-semibold text-gray-900",children:c.dominantPollutant.toUpperCase()})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 pt-2 border-t border-green-200",children:c.healthRecommendations})]})]})]}),m.length>0&&e.jsxs("div",{className:"p-4 bg-purple-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(wj,{className:"w-5 h-5 text-purple-600"}),e.jsx("h4",{className:"font-medium text-gray-900",children:"Pollen Levels"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:m.map((k,E)=>e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:k.plantType}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:k.index}),e.jsx("p",{className:"text-xs text-gray-600",children:k.category})]},E))}),m[0]&&e.jsx("p",{className:"text-xs text-gray-600 mt-3 pt-3 border-t border-purple-200",children:m[0].description})]})]})}function rN({rideId:t,isDriver:s}){const[r,a]=x.useState(null),[n,i]=x.useState(!0),[l,o]=x.useState(0);x.useEffect(()=>{d(),c()},[t]);const c=()=>{const j=_.channel(`ride-${t}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rides",filter:`id=eq.${t}`},w=>{a(v=>v?{...v,...w.new}:null)}).on("postgres_changes",{event:"*",schema:"public",table:"ride_bookings",filter:`ride_id=eq.${t}`},()=>{d()}).subscribe();return()=>{_.removeChannel(j)}},d=async()=>{try{i(!0);const{data:j,error:w}=await _.from("rides").select(`
          *,
          bookings:ride_bookings(
            *,
            passenger:profiles!ride_bookings_passenger_id_fkey(
              full_name,
              avatar_url
            )
          )
        `).eq("id",t).single();if(w)throw w;a(j),j.status==="active"?o(0):j.status==="in-progress"?o(1):j.status==="completed"&&o(2)}catch(j){console.error("Error loading ride status:",j)}finally{i(!1)}},m=async j=>{try{const{error:w}=await _.from("rides").update({status:j}).eq("id",t);if(w)throw w;await d()}catch(w){console.error("Error updating ride status:",w)}};if(n)return e.jsx("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})});if(!r)return null;const u=r.bookings.filter(j=>j.status==="confirmed"),h=new Date(r.departure_time).getTime()-new Date().getTime(),f=Math.floor(h/(1e3*60*60)),g=[{label:"Waiting for departure",description:"Ride scheduled",icon:ye},{label:"Ride in progress",description:"Currently traveling",icon:Qt},{label:"Ride completed",description:"Journey finished",icon:ee}];return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-6",children:"Ride Status"}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center justify-between",children:g.map((j,w)=>{const v=j.icon,p=w===l,y=w<l;return e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mb-2 ${y?"bg-green-500":p?"bg-blue-600":"bg-gray-200"}`,children:e.jsx(v,{className:`w-6 h-6 ${y||p?"text-white":"text-gray-500"}`})}),e.jsx("p",{className:`text-xs font-medium text-center ${y||p?"text-gray-900":"text-gray-500"}`,children:j.label}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:j.description})]}),w<g.length-1&&e.jsx("div",{className:`h-0.5 w-full mt-6 -ml-1/2 ${w<l?"bg-green-500":"bg-gray-200"}`})]},w)})})}),r.status==="active"&&e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-blue-900",children:f>0?`Departing in ${f} hours`:"Departing soon"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:new Date(r.departure_time).toLocaleString()})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-full flex-shrink-0",children:e.jsx(vj,{className:"w-4 h-4 text-green-600 fill-current"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"From"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.origin})]})]}),e.jsx("div",{className:"ml-6 border-l-2 border-dashed border-gray-300 h-8"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full flex-shrink-0",children:e.jsx(xe,{className:"w-4 h-4 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-600",children:"To"}),e.jsx("p",{className:"font-medium text-gray-900",children:r.destination})]})]})]}),u.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(re,{className:"w-5 h-5 text-gray-700"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:["Passengers (",u.length,"/",r.total_seats,")"]})]}),e.jsx("div",{className:"space-y-2",children:u.map((j,w)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-medium",children:j.passenger.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:j.passenger.full_name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[j.pickup_location,"  ",j.dropoff_location]})]}),j.pickup_order&&e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:["Stop #",j.pickup_order]})]},j.id))})]}),s&&r.status==="active"&&e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:()=>m("in-progress"),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Start Ride"})}),s&&r.status==="in-progress"&&e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{onClick:()=>m("completed"),className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Complete Ride"})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${r.status==="active"?"bg-blue-100 text-blue-800":r.status==="in-progress"?"bg-amber-100 text-amber-800":r.status==="completed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[r.status==="active"&&"Scheduled",r.status==="in-progress"&&"In Progress",r.status==="completed"&&"Completed",r.status==="cancelled"&&"Cancelled"]})})]})}function aN(){const{rideId:t}=_l(),{user:s,isEmailVerified:r}=X(),a=ie(),[n,i]=x.useState(null),[l,o]=x.useState(null),[c,d]=x.useState(!0),[m,u]=x.useState(!1),[h,f]=x.useState(!1),[g,j]=x.useState([]),[w,v]=x.useState(!1),[p,y]=x.useState(1),[b,N]=x.useState(null),[k,E]=x.useState(null);x.useEffect(()=>{t&&(R(),C())},[t]);const C=async()=>{if(!(!s||!t))try{const{data:O,error:$}=await _.from("ride_bookings").select("id, status, seats_requested, created_at").eq("ride_id",t).eq("passenger_id",s.id).maybeSingle();if($)throw $;o(O)}catch(O){console.error("Error checking booking:",O)}},R=async()=>{E(null);try{if(!t)throw new Error("Ride ID is missing");const{data:O,error:$}=await _.from("rides").select(`
          *,
          driver:profiles!rides_driver_id_fkey(*),
          vehicle:vehicles(*)
        `).eq("id",t).maybeSingle();if($)throw $;if(!O){E("Ride not found or no longer available");return}O.available_seats===0&&O.status==="active"&&O.driver_id!==(s==null?void 0:s.id)&&E("This ride is fully booked"),i(O)}catch(O){console.error("Error loading ride:",O),E(O.message||"Failed to load ride details")}finally{d(!1)}},T=O=>{j(O)},M=O=>{N(O)},I=async(O=1)=>{if(!(!s||!n)){if(!r){alert("Please verify your email address before booking rides.");return}u(!0),v(!1);try{const{data:$,error:L}=await _.rpc("request_booking",{p_ride_id:n.id,p_pickup_location:n.origin,p_pickup_lat:n.origin_lat,p_pickup_lng:n.origin_lng,p_dropoff_location:n.destination,p_dropoff_lat:n.destination_lat,p_dropoff_lng:n.destination_lng,p_seats_requested:O});if(L){const V=L.message.toLowerCase();V.includes("not enough seats")?alert("Sorry, not enough seats available. Please try a different number of seats or refresh the page."):V.includes("not active")?alert("This ride is no longer active."):V.includes("already requested")||L.code==="23505"?alert("You have already requested this ride."):alert(`Failed to request ride: ${L.message}`),await R()}else{const{data:V}=await _.from("profiles").select("total_bookings").eq("id",s.id).single();V&&await _.from("profiles").update({total_bookings:(V.total_bookings||0)+1}).eq("id",s.id),alert("Ride request sent successfully!"),await Promise.all([R(),C()])}}catch($){console.error("Booking error:",$),alert("Failed to request ride. Please try again."),await R()}finally{u(!1)}}},D=async()=>{if(!l)return;const O=prompt("Please provide a reason for cancellation (optional):");if(O!==null&&confirm("Are you sure you want to cancel this booking?")){f(!0);try{const{error:$}=await _.rpc("cancel_booking",{p_booking_id:l.id,p_reason:O||"No reason provided"});if($)throw $;alert("Booking cancelled successfully!"),await Promise.all([R(),C()])}catch($){console.error("Error cancelling booking:",$),alert("Failed to cancel booking. Please try again.")}finally{f(!1)}}},F=()=>{n!=null&&n.driver&&(n!=null&&n.id)&&a("/messages",{state:{rideId:n.id,driverId:n.driver.id}})},B=O=>{const $=new Date(O);return{date:$.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"}),time:$.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}};if(c)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading ride details..."})]});if(k||!n)return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>a("/find-rides"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Search"]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:k||"Ride Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This ride may have been cancelled, deleted, or the link is incorrect."}),e.jsx("button",{onClick:()=>a("/find-rides"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"Browse Available Rides"})]})]});const H=B(n.departure_time);return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsxs("button",{onClick:()=>a("/find-rides"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),"Back to Search"]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:[n.origin,"  ",n.destination]}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),H.date]}),e.jsx("span",{className:"flex items-center gap-1",children:e.jsx("span",{className:"font-semibold",children:H.time})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:n.available_seats}),e.jsx("div",{className:"text-sm text-gray-600",children:"seats available"})]})]})}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(rl,{user:n.driver,size:"xl",rating:n.driver.average_rating,onClick:()=>a(al(n.driver.id,s==null?void 0:s.id))}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 cursor-pointer hover:text-green-600 transition-colors",onClick:()=>a(al(n.driver.id,s==null?void 0:s.id)),title:"Click to view profile",children:n.driver.full_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("span",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"font-semibold",children:n.driver.average_rating.toFixed(1)})]}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsxs("span",{className:"text-gray-600",children:[n.driver.total_rides_offered," rides completed"]})]}),n.driver.bio&&e.jsx("p",{className:"mt-2 text-gray-600 text-sm",children:n.driver.bio})]}),n.driver.id!==(s==null?void 0:s.id)&&e.jsxs("div",{className:"flex gap-2",children:[(n.driver.preferred_contact_method==="in_app"||n.driver.preferred_contact_method==="both"||!n.driver.preferred_contact_method)&&e.jsxs("button",{onClick:F,className:"px-4 py-2 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors flex items-center gap-2",children:[e.jsx(wa,{className:"w-4 h-4"}),"Message"]}),n.driver.whatsapp_number&&(n.driver.preferred_contact_method==="whatsapp"||n.driver.preferred_contact_method==="both"||!n.driver.preferred_contact_method)&&e.jsxs("button",{onClick:()=>{const O=n.driver.whatsapp_number.replace(/[^0-9]/g,"");window.open(`https://wa.me/${O}`,"_blank")},className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4"}),"WhatsApp"]})]})]})}),n.vehicle&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Vehicle Information"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.vehicle.year," ",n.vehicle.make," ",n.vehicle.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Color:"}),e.jsx("span",{className:"ml-2 font-medium",children:n.vehicle.color})]}),n.vehicle.fuel_type&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Fuel Type:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:n.vehicle.fuel_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Capacity:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[n.vehicle.capacity-1," passengers"]}),e.jsxs("span",{className:"text-gray-500 text-sm ml-1",children:["(offering ",n.total_seats," seats for this ride)"]})]})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),"Route Information & Live Map"]}),e.jsx(tN,{origin:{lat:n.origin_lat,lng:n.origin_lng,name:n.origin},destination:{lat:n.destination_lat,lng:n.destination_lng,name:n.destination},departureTime:new Date(n.departure_time),onRouteSelect:M,onGasStationsUpdate:T})]}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx(rN,{rideId:n.id,isDriver:n.driver.id===(s==null?void 0:s.id)})}),l&&(l.status==="confirmed"||l.status==="active")&&(n.status==="in-progress"||n.status==="active")&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-blue-600"}),"Live Ride Tracking"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:e.jsx("p",{className:"text-sm text-gray-700",children:"The driver has started this ride. You can view real-time tracking and trip progress here."})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Tracking active - Updates every 30 seconds"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Driver: ",e.jsx("span",{className:"font-medium",children:n.driver.full_name})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Your booking: ",l.seats_requested," seat",l.seats_requested>1?"s":""]})]})]}),e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx(sN,{origin:{lat:n.origin_lat,lng:n.origin_lng},destination:{lat:n.destination_lat,lng:n.destination_lng},departureTime:new Date(n.departure_time),distance:n.estimated_distance||void 0,duration:n.estimated_duration||void 0})}),g.length>0&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-blue-600"}),"Gas Stations Along Route"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:b?`Stations near ${b.name}`:"Stations near your route"}),e.jsx("div",{className:"space-y-2",children:g.map((O,$)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:O.name}),e.jsx("p",{className:"text-sm text-gray-600",children:O.address}),O.openNow!==void 0&&e.jsx("span",{className:`text-xs font-medium ${O.openNow?"text-green-600":"text-red-600"}`,children:O.openNow?"Open now":"Closed"})]}),O.rating&&e.jsxs("div",{className:"flex items-center gap-1 ml-4",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm font-medium",children:O.rating.toFixed(1)})]})]},O.placeId||$))})]}),n.notes&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Additional Notes"}),e.jsx("p",{className:"text-gray-600",children:n.notes})]}),n.driver.id!==(s==null?void 0:s.id)&&e.jsx("div",{className:"p-6 bg-gray-50",children:n.available_seats===0&&(!l||l.status==="cancelled")?e.jsxs("div",{className:"bg-amber-50 border-2 border-amber-300 rounded-xl p-6 text-center",children:[e.jsx("h3",{className:"font-bold text-amber-900 text-lg mb-2",children:"Fully Booked"}),e.jsx("p",{className:"text-amber-800 mb-4",children:"This ride has no available seats. Check back later or search for other rides."}),e.jsx("button",{onClick:()=>a("/find-rides"),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold",children:"Browse Other Rides"})]}):l&&l.status!=="cancelled"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border-2 border-green-500 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 text-xl",children:""})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Booking Confirmed"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",e.jsx("span",{className:`font-medium ${l.status==="confirmed"?"text-green-600":l.status==="pending"?"text-yellow-600":"text-gray-600"}`,children:l.status})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-3",children:[e.jsxs("span",{children:["Seats: ",l.seats_requested]}),e.jsxs("span",{children:["Booked: ",new Date(l.created_at).toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>a(`/bookings/${l.id}`),className:"w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors mb-2",children:"View Booking Details"})]}),(l.status==="pending"||l.status==="confirmed")&&e.jsx("button",{onClick:D,disabled:h,className:"w-full bg-red-600 text-white py-3 rounded-xl font-semibold hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Cancelling...":"Cancel Booking"})]}):l&&l.status==="cancelled"?e.jsxs("div",{className:"bg-white border-2 border-red-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-red-600 text-xl",children:""})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Booking Cancelled"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You cancelled this booking"})]})]}),e.jsx("button",{onClick:()=>v(!0),disabled:m||n.available_seats===0,className:"w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed mt-3",children:m?"Sending Request...":n.available_seats===0?"No Seats Available":"Request Again"})]}):e.jsx("button",{onClick:()=>v(!0),disabled:m||n.available_seats===0,className:"w-full bg-blue-600 text-white py-4 rounded-xl font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Sending Request...":n.available_seats===0?"No Seats Available":"Request This Ride"})})]}),w&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Select Number of Seats"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"How many seats do you need?"}),!r&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-sm mb-4 bg-amber-50 px-3 py-2 rounded-lg",children:[e.jsx(Ce,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Verify your email to book rides"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3 mb-6",children:[...Array(Math.min(n.available_seats,8))].map((O,$)=>e.jsx("button",{onClick:()=>y($+1),className:`py-3 px-4 rounded-lg font-semibold transition-all ${p===$+1?"bg-blue-600 text-white ring-2 ring-blue-400":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:$+1},$+1))}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Selected:"})," ",p," seat",p>1?"s":""]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Available:"})," ",n.available_seats," seat",n.available_seats>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>I(p),disabled:!r,className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:r?"Confirm Request":"Verify Email First"})]})]})})]})}function nN({origin:t,destination:s,waypoints:r=[],showWeather:a=!0,showAirQuality:n=!0}){const i=x.useRef(null),l=x.useRef(null),o=x.useRef(null),[c,d]=x.useState(null),[m,u]=x.useState(null),[h,f]=x.useState(null),[g,j]=x.useState(!0),[w,v]=x.useState(!0);x.useEffect(()=>{p()},[t,s,r]);const p=async()=>{var k,E;if(i.current)try{if(typeof google>"u"||!google.maps){const I=document.createElement("script");I.src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places,geometry",I.async=!0,I.defer=!0,document.head.appendChild(I),await new Promise((F,B)=>{I.onload=F,I.onerror=()=>B(new Error("Failed to load Google Maps")),setTimeout(()=>B(new Error("Google Maps loading timeout")),15e3)});let D=0;for(;!((E=(k=google==null?void 0:google.maps)==null?void 0:k.geometry)!=null&&E.encoding)&&D<30;)await new Promise(F=>setTimeout(F,100)),D++}const C=new google.maps.Map(i.current,{zoom:10,center:t,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});l.current=C;const R=new google.maps.TrafficLayer;R.setMap(C),o.current=R,new google.maps.Marker({position:t,map:C,title:t.name,label:"A",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}}),new google.maps.Marker({position:s,map:C,title:s.name,label:"B",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}}),r.forEach((I,D)=>{new google.maps.Marker({position:I,map:C,title:I.name,label:String.fromCharCode(67+D)})});const T=await Wt.getDirections(t,s,r.map(I=>({location:new google.maps.LatLng(I.lat,I.lng),stopover:!0})));f({distance:T.distance,duration:T.duration}),new google.maps.Polyline({path:[t,s],geodesic:!0,strokeColor:"#3B82F6",strokeOpacity:.8,strokeWeight:5,map:C});const M=new google.maps.LatLngBounds;if(M.extend(t),M.extend(s),r.forEach(I=>M.extend(I)),C.fitBounds(M),a){const I=await Wt.getWeather(t.lat,t.lng);d(I)}if(n){const I=await Wt.getAirQuality(t.lat,t.lng);u(I)}j(!1)}catch(C){console.error("Error initializing map:",C),j(!1)}},y=k=>k<=50?"text-green-600 bg-green-50":k<=100?"text-yellow-600 bg-yellow-50":k<=150?"text-orange-600 bg-orange-50":k<=200?"text-red-600 bg-red-50":"text-purple-600 bg-purple-50",b=k=>k<=50?"Good":k<=100?"Moderate":k<=150?"Unhealthy for Sensitive":k<=200?"Unhealthy":"Very Unhealthy";x.useEffect(()=>{o.current&&l.current&&o.current.setMap(w?l.current:null)},[w]);const N=()=>{v(!w)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{ref:i,className:"w-full h-96 rounded-xl overflow-hidden"}),g&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center rounded-xl",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}),!g&&e.jsxs("button",{onClick:N,className:`absolute top-4 right-4 px-3 py-2 rounded-lg shadow-lg font-medium flex items-center gap-2 transition-colors text-sm z-10 ${w?"bg-blue-600 text-white hover:bg-blue-700":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"}`,children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:w?"Hide Traffic":"Show Traffic"}),e.jsx("span",{className:"sm:hidden",children:w?"Hide":"Show"})]})]}),h&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Distance"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:h.distance})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Duration"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:h.duration})]})]})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a&&c&&c.condition!=="Unavailable"&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(An,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Weather at Origin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Temperature"}),e.jsxs("span",{className:"font-semibold",children:[c.temperature,"C"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Condition"}),e.jsx("span",{className:"font-semibold",children:c.condition})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ag,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{className:"text-sm",children:[c.humidity,"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Nn,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{className:"text-sm",children:[c.windSpeed," km/h"]})]})]})]})]}),n&&m&&m.category!=="Unavailable"&&e.jsxs("div",{className:`border rounded-xl p-4 ${y(m.aqi)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("h3",{className:"font-semibold",children:"Air Quality"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"AQI"}),e.jsx("span",{className:"font-bold text-2xl",children:m.aqi})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{className:"font-semibold",children:b(m.aqi)})]}),m.dominantPollutant!=="Unknown"&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Pollutant:"})," ",m.dominantPollutant]})]})]})]})]})}function iN({bookingId:t,revieweeName:s,onSubmitted:r}){const[a,n]=x.useState(5),[i,l]=x.useState(5),[o,c]=x.useState(5),[d,m]=x.useState(5),[u,h]=x.useState(5),[f,g]=x.useState(5),[j,w]=x.useState(""),[v,p]=x.useState(!0),[y,b]=x.useState(!1),N=async E=>{E.preventDefault(),b(!0);try{const{data:C,error:R}=await _.rpc("submit_detailed_review",{p_booking_id:t,p_overall_rating:a,p_punctuality_rating:i,p_cleanliness_rating:o,p_communication_rating:d,p_safety_rating:u,p_comfort_rating:f,p_review_text:j||null,p_would_ride_again:v});if(R)throw R;if(C&&C.length>0){const T=C[0];if(T.success){let M="Review submitted successfully!";T.achievements_unlocked&&T.achievements_unlocked.length>0&&(M+=`

Achievements unlocked:`,T.achievements_unlocked.forEach(I=>{M+=`
- ${I}`})),alert(M),r&&r()}else alert(T.message||"Failed to submit review")}}catch(C){console.error("Error submitting review:",C),alert(C.message||"Failed to submit review")}finally{b(!1)}},k=({label:E,value:C,onChange:R})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:E}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(T=>e.jsx("button",{type:"button",onClick:()=>R(T),className:"focus:outline-none",children:e.jsx(we,{className:`w-8 h-8 transition-colors ${T<=C?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},T))})]});return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:["Rate Your Experience with ",s]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx(k,{label:"Overall Rating",value:a,onChange:n}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(k,{label:"Punctuality",value:i,onChange:l}),e.jsx(k,{label:"Communication",value:d,onChange:m}),e.jsx(k,{label:"Safety",value:u,onChange:h}),e.jsx(k,{label:"Comfort",value:f,onChange:g}),e.jsx(k,{label:"Cleanliness",value:o,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Written Review (Optional)"}),e.jsx("textarea",{value:j,onChange:E=>w(E.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Share your experience..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Would you ride with them again?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>p(!0),className:`flex-1 py-3 px-4 rounded-lg border-2 transition-colors flex items-center justify-center gap-2 ${v?"border-green-500 bg-green-50 text-green-700":"border-gray-300 text-gray-600"}`,children:[e.jsx(wn,{className:"w-5 h-5"}),"Yes"]}),e.jsxs("button",{type:"button",onClick:()=>p(!1),className:`flex-1 py-3 px-4 rounded-lg border-2 transition-colors flex items-center justify-center gap-2 ${v?"border-gray-300 text-gray-600":"border-red-500 bg-red-50 text-red-700"}`,children:[e.jsx(Ug,{className:"w-5 h-5"}),"No"]})]})]}),e.jsxs("button",{type:"submit",disabled:y,className:"w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(Tl,{className:"w-5 h-5"}),y?"Submitting...":"Submit Review"]})]})]})}function lN(){const{bookingId:t}=_l(),s=ie(),{user:r}=X(),[a,n]=x.useState(null),[i,l]=x.useState(!0),[o,c]=x.useState(null),[d,m]=x.useState(!1),[u,h]=x.useState(!1),[f,g]=x.useState(null),[j,w]=x.useState(!1),[v,p]=x.useState(!1);x.useEffect(()=>{t&&r?(b(),y()):r||(g("Please sign in to view booking details"),l(!1))},[t,r]);const y=async()=>{if(!(!t||!r))try{const{data:B,error:H}=await _.from("ride_reviews_detailed").select("id").eq("booking_id",t).eq("reviewer_id",r.id).maybeSingle();!H&&B&&w(!0)}catch(B){console.error("Error checking review status:",B)}},b=async()=>{try{const{data:B,error:H}=await _.from("ride_bookings").select(`
          *,
          ride:rides(
            *,
            driver:profiles!rides_driver_id_fkey(*),
            vehicle:vehicles(*)
          )
        `).eq("id",t).maybeSingle();if(H)throw H;if(!B){console.error("Booking not found"),g("Booking not found"),l(!1);return}n(B),g(null),B!=null&&B.ride&&N(B.ride.origin_lat,B.ride.origin_lng)}catch(B){console.error("Error loading booking:",B),console.error("Error details:",B==null?void 0:B.message,B==null?void 0:B.details),g((B==null?void 0:B.message)||"Failed to load booking details"),l(!1)}},N=async(B,H)=>{try{const $=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${B}&longitude=${H}&current=temperature_2m,weather_code,wind_speed_10m`)).json();c($.current)}catch(O){console.error("Error loading weather:",O)}},k=async()=>{const B=prompt("Please provide a reason for cancellation (optional):");if(B!==null&&confirm("Are you sure you want to cancel this booking? This may affect your reliability score.")){m(!0);try{const{data:H,error:O}=await _.rpc("cancel_booking_with_impact",{p_booking_id:t,p_reason:B||"No reason provided"});if(O)throw O;if(H&&H.length>0){const $=H[0];if($.success){let L="Booking cancelled successfully!";$.reliability_impact>0&&(L+=`

Reliability Impact: -${$.reliability_impact} points`,L+=`
New Reliability Score: ${$.new_reliability_score}/100`),$.warning_issued&&(L+=`

 Warning: Frequent cancellations may result in booking restrictions.`),$.restriction_applied&&(L+=`

 Your booking privileges have been temporarily restricted due to reliability concerns.`),alert(L)}else{alert($.message||"Failed to cancel booking"),m(!1);return}}s("/my-rides")}catch(H){console.error("Error cancelling booking:",H);const O=H.message||"Failed to cancel booking. Please try again.";O.includes("already cancelled")?alert("This booking is already cancelled."):alert(O)}finally{m(!1)}}},E=()=>{h(!0),navigator.geolocation&&navigator.geolocation.getCurrentPosition(B=>{const H=`EMERGENCY: I need help!

Booking ID: ${t}
Driver: ${a==null?void 0:a.ride.driver.full_name}
My Location: https://www.google.com/maps?q=${B.coords.latitude},${B.coords.longitude}

This is an automated emergency alert.`;alert(`SOS Activated!

`+H+`

In a real emergency:
1. Call emergency services (911)
2. Contact driver
3. Share your live location with trusted contacts`),h(!1)},B=>{console.error("Location error:",B),alert("Could not get your location. Please call emergency services immediately if you need help."),h(!1)})},C=()=>{if(a){const B=`https://www.google.com/maps/dir/?api=1&origin=${a.ride.origin_lat},${a.ride.origin_lng}&destination=${a.ride.destination_lat},${a.ride.destination_lng}`;window.open(B,"_blank")}},R=()=>{a!=null&&a.ride.driver.phone?window.location.href=`tel:${a.ride.driver.phone}`:alert("Driver phone number not available")},T=async()=>{a!=null&&a.ride&&s("/messages",{state:{rideId:a.ride.id,driverId:a.ride.driver.id}})},M=B=>new Date(B).toLocaleString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),I=()=>{if(!a)return"";const B=new Date,O=new Date(a.ride.departure_time).getTime()-B.getTime(),$=Math.floor(O/(1e3*60*60)),L=Math.floor(O%(1e3*60*60)/(1e3*60));return $<0?"Departed":$===0?`${L} minutes`:`${$}h ${L}m`};if(i)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})});if(f)return e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-red-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Error Loading Booking"}),e.jsx("p",{className:"text-gray-600 mb-4",children:f}),e.jsx("button",{onClick:()=>s("/my-rides"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Back to My Rides"})]})});if(!a)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-600",children:"Booking not found"}),e.jsx("button",{onClick:()=>s("/my-rides"),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Back to My Rides"})]});const D=a.status==="pending"||a.status==="confirmed",F=new Date(a.ride.departure_time)>new Date;return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Your Booking"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Trip details and information"})]}),e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-medium ${a.status==="confirmed"?"bg-green-100 text-green-800":a.status==="pending"?"bg-yellow-100 text-yellow-800":a.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:a.status})]}),F&&a.status==="confirmed"&&e.jsx("div",{className:"bg-gradient-to-r from-red-500 to-red-600 rounded-xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsx("h3",{className:"text-xl font-bold",children:"Emergency SOS"})]}),e.jsx("p",{className:"text-red-100 text-sm",children:"Press this button in case of emergency. Your location will be shared."})]}),e.jsx("button",{onClick:E,disabled:u,className:"bg-white text-red-600 px-8 py-4 rounded-xl font-bold text-lg hover:bg-red-50 transition-colors disabled:opacity-50 shadow-lg",children:u?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin w-5 h-5 border-3 border-red-600 border-t-transparent rounded-full"}),e.jsx("span",{children:"ACTIVATING..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-6 h-6"}),e.jsx("span",{children:"SOS"})]})})]})}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ye,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Time Until Departure"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:I()})]})]})}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(re,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Seats Booked"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:a.seats_requested})]})]})}),o&&e.jsx("div",{className:"bg-sky-50 border border-sky-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-sky-100 rounded-lg",children:e.jsx(An,{className:"w-5 h-5 text-sky-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Weather at Origin"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[o.temperature_2m,"C"]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),"Trip Route"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Pick-up Location"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.pickup_location})]}),e.jsxs("div",{className:"border-l-2 border-blue-200 pl-4 ml-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Drop-off Location"}),e.jsx("p",{className:"font-medium text-gray-900",children:a.dropoff_location})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Departure Time"}),e.jsx("p",{className:"font-medium text-gray-900",children:M(a.ride.departure_time)})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Driver Information"]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center text-2xl font-bold text-blue-600",children:a.ride.driver.full_name.charAt(0)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-lg text-gray-900",children:a.ride.driver.full_name}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"}),a.ride.driver.average_rating.toFixed(1)]}),e.jsxs("span",{children:[a.ride.driver.total_rides," rides"]})]}),a.ride.driver.bio&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a.ride.driver.bio})]})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap mt-4",children:[a.ride.driver.phone&&e.jsxs("button",{onClick:R,className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(dt,{className:"w-4 h-4"}),"Call Driver"]}),(a.ride.driver.preferred_contact_method==="in_app"||a.ride.driver.preferred_contact_method==="both"||!a.ride.driver.preferred_contact_method)&&e.jsxs("button",{onClick:T,className:"flex items-center justify-center gap-2 px-4 py-3 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 transition-colors",children:[e.jsx(wa,{className:"w-4 h-4"}),"Message"]}),a.ride.driver.whatsapp_number&&(a.ride.driver.preferred_contact_method==="whatsapp"||a.ride.driver.preferred_contact_method==="both"||!a.ride.driver.preferred_contact_method)&&e.jsxs("button",{onClick:()=>{const B=a.ride.driver.whatsapp_number.replace(/[^0-9]/g,"");window.open(`https://wa.me/${B}`,"_blank")},className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:[e.jsx(dt,{className:"w-4 h-4"}),"WhatsApp"]})]})]}),a.ride.vehicle&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-600"}),"Vehicle Information"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Model:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[a.ride.vehicle.year," ",a.ride.vehicle.make," ",a.ride.vehicle.model]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Color:"}),e.jsx("span",{className:"ml-2 font-medium",children:a.ride.vehicle.color})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"License Plate:"}),e.jsx("span",{className:"ml-2 font-medium font-mono",children:a.ride.vehicle.license_plate})]})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600"}),"Route Map"]}),e.jsx(nN,{origin:{lat:a.ride.origin_lat,lng:a.ride.origin_lng,name:a.ride.origin},destination:{lat:a.ride.destination_lat,lng:a.ride.destination_lng,name:a.ride.destination}}),e.jsxs("button",{onClick:C,className:"w-full mt-4 flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Qt,{className:"w-4 h-4"}),"Open in Google Maps"]})]}),e.jsxs("div",{className:"p-6 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Booking Summary"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Seats"}),e.jsx("span",{className:"font-medium",children:a.seats_requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Price per seat"}),e.jsxs("span",{className:"font-medium",children:["$",a.ride.price_per_seat]})]}),e.jsxs("div",{className:"border-t border-gray-300 pt-2 mt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Total Cost"}),e.jsxs("span",{className:"text-blue-600",children:["$",a.ride.price_per_seat*a.seats_requested]})]})]})]})]}),(a.status==="active"||a.status==="in-progress")&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5 text-blue-600"}),"Ride in Progress"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Live tracking active"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Your driver has started the ride. Location updates are being tracked for safety."}),e.jsxs("div",{className:"text-sm text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Driver:"})," ",a.ride.driver.full_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Your seats:"})," ",a.seats_requested]})]})]}),a.status==="completed"&&!j&&!v&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-500"}),"How was your ride?"]}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Help other passengers by sharing your experience with ",a.ride.driver.full_name,"."]}),e.jsx("button",{onClick:()=>p(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Leave a Review"})]}),a.status==="completed"&&v&&!j&&e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsx(iN,{bookingId:a.id,revieweeName:a.ride.driver.full_name,onSubmitted:()=>{w(!0),p(!1),alert("Thank you for your review!")}})}),a.status==="completed"&&j&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-green-600 fill-current"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Review Submitted"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Thank you for sharing your feedback!"})]})]})}),D&&F&&e.jsxs("div",{className:"bg-white rounded-xl border border-red-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-5 h-5 text-red-600"}),"Cancel Booking"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"You can cancel this booking. Note: Cancellations within 24 hours of departure may affect your reliability score."}),e.jsx("button",{onClick:k,disabled:d,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Cancelling...":"Cancel Booking"})]})]})}function oN(){return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(Yt,{className:"w-8 h-8 text-red-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Terms of Service"})]}),e.jsxs("div",{className:"prose prose-blue max-w-none space-y-6 text-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Last Updated: ",new Date().toLocaleDateString()]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"1. Acceptance of Terms"}),e.jsx("p",{children:"By accessing and using Carpool Network (carpoolnetwork.co.uk), you accept and agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use the service."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"2. Service Description"}),e.jsx("p",{children:"Our platform connects drivers and passengers for carpooling purposes. We are solely a technology platform that facilitates connections between users. We are not a transportation provider, taxi service, or payment processor. All arrangements between drivers and passengers, including any cost contributions, are made privately between users."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"3. User Requirements"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"For All Users:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Must be at least 18 years of age"}),e.jsx("li",{children:"Must provide accurate and complete information"}),e.jsx("li",{children:"Must maintain account security"}),e.jsx("li",{children:"Must not share account credentials"})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"For Drivers:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Must hold a valid UK full driving license or international license (within 12 months of UK arrival)"}),e.jsx("li",{children:"License must be verified and not banned or suspended"}),e.jsx("li",{children:"Must have appropriate vehicle insurance as required by UK law"}),e.jsx("li",{children:"Vehicle must be roadworthy and meet MOT/tax requirements"}),e.jsx("li",{children:"Must comply with all UK traffic laws and regulations"}),e.jsx("li",{children:"Responsible for ensuring insurance covers intended usage"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"4. License Verification"}),e.jsx("p",{children:"All drivers must provide valid driving license details for verification purposes:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Valid UK full driving license or international license"}),e.jsx("li",{children:"For international licenses: must be within 12 months of UK arrival"}),e.jsx("li",{children:"License must not be banned, suspended, or expired"})]}),e.jsx("p",{className:"mt-3",children:"We reserve the right to verify licenses with DVLA and suspend accounts with invalid or banned licenses."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"5. Private Arrangements"}),e.jsx("p",{children:"Important: The platform does not handle, process, or facilitate any payments."}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"All cost-sharing arrangements are private between driver and passengers"}),e.jsx("li",{children:"Users must arrange payment methods directly with each other"}),e.jsx("li",{children:"Platform is not involved in any financial transactions"}),e.jsx("li",{children:"Platform is not responsible for payment disputes"}),e.jsx("li",{children:"Any cost contributions must comply with UK ridesharing laws"}),e.jsx("li",{children:"Drivers must ensure they do not operate as a commercial taxi service"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"6. Safety and Conduct"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Users must treat each other with respect"}),e.jsx("li",{children:"No harassment, discrimination, or inappropriate behavior"}),e.jsx("li",{children:"Report safety concerns immediately"}),e.jsx("li",{children:"Emergency contacts should be provided and kept current"}),e.jsx("li",{children:"Users may be removed for violations"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"7. Cancellation Policy"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Users should provide reasonable notice for cancellations"}),e.jsx("li",{children:"Repeated last-minute cancellations may result in account restrictions"}),e.jsx("li",{children:"Any cost-related matters are between users only"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"8. Liability"}),e.jsx("p",{children:"The platform acts only as an intermediary:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"We are not responsible for user actions or behavior"}),e.jsx("li",{children:"We are not liable for accidents, injuries, or property damage"}),e.jsx("li",{children:"Users engage in ridesharing at their own risk"}),e.jsx("li",{children:"Driver insurance is primary coverage for incidents"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"9. Account Termination"}),e.jsx("p",{children:"We reserve the right to suspend or terminate accounts for:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Violation of terms"}),e.jsx("li",{children:"Fraudulent activity"}),e.jsx("li",{children:"Safety concerns"}),e.jsx("li",{children:"Invalid or expired licenses"}),e.jsx("li",{children:"Misuse of platform"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"10. Changes to Terms"}),e.jsx("p",{children:"We may update these terms periodically. Continued use of the service constitutes acceptance of modified terms."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"11. Contact Information"}),e.jsx("p",{children:"For questions about these terms, please contact us at support@carpoolnetwork.co.uk or through the platform's support system."})]})]})]})})})}function cN(){return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx(me,{className:"w-8 h-8 text-red-600"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Privacy Policy"})]}),e.jsxs("div",{className:"prose prose-blue max-w-none space-y-6 text-gray-700",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Last Updated: ",new Date().toLocaleDateString()]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"1. Introduction"}),e.jsx("p",{children:"This Privacy Policy explains how Carpool Network (carpoolnetwork.co.uk) collects, uses, discloses, and safeguards your information when you use our carpooling platform. We are committed to protecting your privacy and complying with UK GDPR and Data Protection Act 2018."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"2. Information We Collect"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"Personal Information:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Name, email address, phone number"}),e.jsx("li",{children:"Date of birth (for age verification)"}),e.jsx("li",{children:"Profile photo"}),e.jsx("li",{children:"Emergency contact information"})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"Driver Information:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Driving license number and details"}),e.jsx("li",{children:"License verification status"}),e.jsx("li",{children:"International arrival date (if applicable)"}),e.jsx("li",{children:"Vehicle information (make, model, registration)"})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"Usage Information:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Ride history (origins, destinations, times)"}),e.jsx("li",{children:"Messages between users"}),e.jsx("li",{children:"Reviews and ratings"}),e.jsx("li",{children:"Location data for ride matching"})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mt-4 mb-2",children:"Technical Information:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"IP address and device information"}),e.jsx("li",{children:"Browser type and version"}),e.jsx("li",{children:"Usage analytics"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"3. How We Use Your Information"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"To provide and maintain the connection platform"}),e.jsx("li",{children:"To verify driver licenses with DVLA"}),e.jsx("li",{children:"To check license ban status"}),e.jsx("li",{children:"To facilitate ride matching and connections"}),e.jsx("li",{children:"To enable communication between users"}),e.jsx("li",{children:"To ensure safety and security"}),e.jsx("li",{children:"To improve our service"}),e.jsx("li",{children:"To comply with legal obligations"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"4. Legal Basis for Processing (UK GDPR)"}),e.jsx("p",{children:"We process your data based on:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Contract:"})," To provide ridesharing services"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legal Obligation:"})," To verify licenses and comply with transport regulations"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Legitimate Interest:"})," To ensure safety and prevent fraud"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Consent:"})," For optional features like location tracking"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"5. Information Sharing"}),e.jsx("p",{children:"We share information with:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Other Users:"})," Profile info, ratings, and ride details for matched connections"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"DVLA:"})," License verification queries"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Law Enforcement:"})," When required by law or for safety"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service Providers:"})," Cloud hosting, analytics (with appropriate safeguards)"]})]}),e.jsx("p",{className:"mt-3",children:"We do not sell your personal information to third parties. We do not process any payments or financial transactions."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"6. Data Security"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"License numbers are encrypted in storage"}),e.jsx("li",{children:"Secure transmission using HTTPS"}),e.jsx("li",{children:"Regular security audits"}),e.jsx("li",{children:"Access controls and authentication"}),e.jsx("li",{children:"However, no method is 100% secure"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"7. Data Retention"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Active account data: Retained while account is active"}),e.jsx("li",{children:"Ride history: 7 years (for legal/insurance purposes)"}),e.jsx("li",{children:"Messages: 2 years after last activity"}),e.jsx("li",{children:"License verification: Until license expires or account closes"}),e.jsx("li",{children:"Deleted accounts: Anonymized after 30 days, except where legally required"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"8. Your Rights (UK GDPR)"}),e.jsx("p",{children:"You have the right to:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Access:"})," Request copies of your personal data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Rectification:"})," Correct inaccurate information"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erasure:"})," Request deletion (subject to legal requirements)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Restriction:"})," Limit processing of your data"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Portability:"})," Receive your data in machine-readable format"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Object:"})," Object to processing based on legitimate interests"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Withdraw Consent:"})," For consent-based processing"]})]}),e.jsx("p",{className:"mt-3",children:"To exercise these rights, contact us at privacy@carpoolnetwork.co.uk or through the platform."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"9. Cookies and Tracking"}),e.jsx("p",{children:"We use essential cookies for:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Authentication and security"}),e.jsx("li",{children:"Session management"}),e.jsx("li",{children:"User preferences"})]}),e.jsx("p",{className:"mt-3",children:"You can control cookies through browser settings."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"10. International Transfers"}),e.jsx("p",{children:"Your data is primarily stored in UK/EU servers. Any international transfers comply with UK GDPR requirements including appropriate safeguards."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"11. Children's Privacy"}),e.jsx("p",{children:"Our service is not intended for users under 18. We do not knowingly collect data from children."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"12. Changes to Privacy Policy"}),e.jsx("p",{children:"We may update this policy periodically. Material changes will be notified via email or platform notification."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"13. Contact Us"}),e.jsx("p",{children:"For privacy concerns or to exercise your rights:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"Use the platform's support system"}),e.jsx("li",{children:"You also have the right to lodge a complaint with the ICO (Information Commissioner's Office)"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"14. DVLA License Verification"}),e.jsx("p",{children:"By using this service as a driver, you consent to us verifying your driving license with DVLA, including:"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[e.jsx("li",{children:"License validity checks"}),e.jsx("li",{children:"Ban and suspension status"}),e.jsx("li",{children:"Endorsement and penalty points"}),e.jsx("li",{children:"Regular automated checks for ongoing verification"})]})]})]})]})})})}function dN({onClose:t}){const{user:s}=X(),[r,a]=x.useState("vehicle"),[n,i]=x.useState({}),[l,o]=x.useState(!0),[c,d]=x.useState(!1),[m,u]=x.useState(!1);x.useEffect(()=>{h()},[s]);const h=async()=>{if(!s)return;const{data:w}=await _.from("user_preferences").select("*").eq("user_id",s.id).maybeSingle();w&&i(w),o(!1)},f=async()=>{if(!s)return;d(!0);const{error:w}=await _.from("user_preferences").upsert({user_id:s.id,...n,updated_at:new Date().toISOString()});w||(u(!0),setTimeout(()=>u(!1),2e3)),d(!1)},g=(w,v)=>{i(p=>({...p,[w]:v}))},j=[{id:"vehicle",label:"Vehicle & Comfort",icon:pe},{id:"policies",label:"Ride Policies",icon:me},{id:"screening",label:"Passenger Requirements",icon:re},{id:"safety",label:"Safety & Communication",icon:me},{id:"pricing",label:"Pricing & Payments",icon:va},{id:"templates",label:"Recurring & Templates",icon:de}];return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:"Loading..."}):e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[e.jsxs("div",{className:"border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Driver Preferences"}),e.jsxs("div",{className:"flex gap-3",children:[m&&e.jsxs("span",{className:"flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"Saved successfully"]}),e.jsxs("button",{onClick:f,disabled:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:[e.jsx(Ud,{className:"w-4 h-4"}),c?"Saving...":"Save Changes"]})]})]}),e.jsx("div",{className:"flex overflow-x-auto",children:j.map(w=>{const v=w.icon;return e.jsxs("button",{onClick:()=>a(w.id),className:`flex items-center gap-2 px-6 py-3 border-b-2 transition-colors whitespace-nowrap ${r===w.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:[e.jsx(v,{className:"w-5 h-5"}),w.label]},w.id)})})]}),e.jsxs("div",{className:"p-6",children:[r==="vehicle"&&e.jsx(uN,{preferences:n,updatePreference:g}),r==="policies"&&e.jsx(mN,{preferences:n,updatePreference:g}),r==="screening"&&e.jsx(hN,{preferences:n,updatePreference:g}),r==="safety"&&e.jsx(xN,{preferences:n,updatePreference:g}),r==="pricing"&&e.jsx(gN,{preferences:n,updatePreference:g}),r==="templates"&&e.jsx(fN,{})]})]})})}function uN({preferences:t,updatePreference:s}){var r,a;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ej,{className:"w-5 h-5 text-blue-600"}),"Entertainment & Atmosphere"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Music Preference"}),e.jsxs("select",{value:t.music_preference||"moderate",onChange:n=>s("music_preference",n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"No music"}),e.jsx("option",{value:"quiet",children:"Quiet background music"}),e.jsx("option",{value:"moderate",children:"Moderate volume"}),e.jsx("option",{value:"loud",children:"Loud music"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Music Genres (multiple)"}),e.jsx("input",{type:"text",placeholder:"Pop, Rock, Jazz, Classical...",value:((r=t.music_genres_preferred)==null?void 0:r.join(", "))||"",onChange:n=>s("music_genres_preferred",n.target.value.split(",").map(i=>i.trim())),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Conversation Level"}),e.jsxs("select",{value:t.conversation_level||"moderate",onChange:n=>s("conversation_level",n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"quiet",children:"Quiet - Minimal conversation"}),e.jsx("option",{value:"moderate",children:"Moderate - Friendly chat"}),e.jsx("option",{value:"chatty",children:"Chatty - Love to talk"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Temperature Preference"}),e.jsxs("select",{value:t.temperature_preference||"moderate",onChange:n=>s("temperature_preference",n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"cold",children:"Cold (16-18C)"}),e.jsx("option",{value:"cool",children:"Cool (19-21C)"}),e.jsx("option",{value:"moderate",children:"Moderate (22-24C)"}),e.jsx("option",{value:"warm",children:"Warm (25C+)"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Nn,{className:"w-5 h-5 text-blue-600"}),"Vehicle Amenities"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.ac_heating_available||!1,onChange:n=>s("ac_heating_available",n.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nn,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"AC/Heating"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.phone_charging_available||!1,onChange:n=>s("phone_charging_available",n.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pj,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Phone Charging"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.wifi_available||!1,onChange:n=>s("wifi_available",n.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lj,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"WiFi Hotspot"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:t.wheelchair_accessible||!1,onChange:n=>s("wheelchair_accessible",n.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fj,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Wheelchair Accessible"})]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Child Seats Available"}),e.jsx("input",{type:"number",min:"0",max:"5",value:t.child_seats_available||0,onChange:n=>s("child_seats_available",parseInt(n.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(tl,{className:"w-5 h-5 text-blue-600"}),"Luggage & Storage"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Luggage Policy"}),e.jsxs("select",{value:t.luggage_policy||"medium-allowed",onChange:n=>s("luggage_policy",n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"No luggage"}),e.jsx("option",{value:"small-bags-only",children:"Small bags only (backpack, purse)"}),e.jsx("option",{value:"medium-allowed",children:"Medium allowed (carry-on size)"}),e.jsx("option",{value:"large-allowed",children:"Large allowed (suitcases)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Luggage Space Description"}),e.jsx("textarea",{value:t.luggage_space_description||"",onChange:n=>s("luggage_space_description",n.target.value),placeholder:"Describe your trunk space, special storage options...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Special Equipment (comma-separated)"}),e.jsx("input",{type:"text",value:((a=t.special_equipment)==null?void 0:a.join(", "))||"",onChange:n=>s("special_equipment",n.target.value.split(",").map(i=>i.trim())),placeholder:"Bike rack, roof storage, ski rack...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}function mN({preferences:t,updatePreference:s}){return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Basic Policies"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(bj,{className:"w-4 h-4 inline mr-2"}),"Smoking Policy"]}),e.jsxs("select",{value:t.smoking_policy||"no-smoking",onChange:r=>s("smoking_policy",r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"no-smoking",children:"No smoking"}),e.jsx("option",{value:"outside-only",children:"Outside stops only"}),e.jsx("option",{value:"allowed",children:"Smoking allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Food & Drinks Policy"}),e.jsxs("select",{value:t.food_drinks_allowed||"snacks-ok",onChange:r=>s("food_drinks_allowed",r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"none",children:"No food or drinks"}),e.jsx("option",{value:"drinks-only",children:"Drinks in sealed containers only"}),e.jsx("option",{value:"snacks-ok",children:"Snacks and drinks OK"}),e.jsx("option",{value:"meals-ok",children:"Meals allowed"})]})]})]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:[e.jsx(jj,{className:"w-5 h-5 inline mr-2"}),"Pet Policy"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.pets_allowed||!1,onChange:r=>s("pets_allowed",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Allow pets"})]}),t.pets_allowed&&e.jsxs("div",{className:"ml-8 p-4 bg-gray-50 rounded-lg space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure pet policy details:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Allowed Pet Types"}),e.jsx("input",{type:"text",placeholder:"Dogs, Cats, Small pets...",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Size Limit"}),e.jsxs("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg",children:[e.jsx("option",{children:"Small only (under 10kg)"}),e.jsx("option",{children:"Medium (under 25kg)"}),e.jsx("option",{children:"Large (any size)"})]})]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Carrier required"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Group & Stop Policies"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Stops Allowed"}),e.jsx("input",{type:"number",min:"1",max:"10",value:t.max_stops_allowed||3,onChange:r=>s("max_stops_allowed",parseInt(r.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Detour Time (minutes)"}),e.jsx("input",{type:"number",min:"0",max:"60",value:t.max_detour_minutes||15,onChange:r=>s("max_detour_minutes",parseInt(r.target.value)),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.allow_groups||!1,onChange:r=>s("allow_groups",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Allow group bookings"})]}),t.allow_groups&&e.jsxs("div",{className:"ml-8",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Maximum Group Size"}),e.jsx("input",{type:"number",min:"2",max:"10",value:t.max_group_size||4,onChange:r=>s("max_group_size",parseInt(r.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]})]})]})]})]})}function hN({preferences:t,updatePreference:s}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-blue-800",children:"Set requirements for who can book your rides. These filters help you maintain control and safety."})}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Instant Booking"}),e.jsxs("label",{className:"flex items-start gap-3 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[e.jsx("input",{type:"checkbox",checked:t.instant_booking_enabled||!1,onChange:r=>s("instant_booking_enabled",r.target.checked),className:"w-5 h-5 text-green-600 rounded focus:ring-green-500 mt-1"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Enable Instant Booking"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Passengers meeting your requirements can book instantly without approval. Get more bookings faster!"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Rating & Verification Requirements"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Passenger Rating"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:t.minimum_passenger_rating||0,onChange:r=>s("minimum_passenger_rating",parseFloat(r.target.value)),className:"flex-1"}),e.jsxs("span",{className:"text-lg font-semibold text-gray-900 w-12 text-center",children:[(t.minimum_passenger_rating||0).toFixed(1)," ",e.jsx(we,{className:"w-4 h-4 inline text-yellow-500"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Set to 0 to accept new users without ratings"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.require_passenger_verification||!1,onChange:r=>s("require_passenger_verification",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require verified passengers only"})]}),e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.require_passenger_profile_photo||!1,onChange:r=>s("require_passenger_profile_photo",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Require profile photo"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Demographic Preferences"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Gender Preference"}),e.jsxs("select",{value:t.gender_preference||"any",onChange:r=>s("gender_preference",r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"any",children:"Any gender"}),e.jsx("option",{value:"same",children:"Same gender only"}),e.jsx("option",{value:"male",children:"Male only"}),e.jsx("option",{value:"female",children:"Female only"})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-3 mb-3",children:[e.jsx("input",{type:"checkbox",checked:t.same_gender_only||!1,onChange:r=>s("same_gender_only",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Same gender passengers only"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Age"}),e.jsx("input",{type:"number",min:"0",max:"100",value:t.age_restriction_min||"",onChange:r=>s("age_restriction_min",r.target.value?parseInt(r.target.value):null),placeholder:"No minimum",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Age"}),e.jsx("input",{type:"number",min:"0",max:"120",value:t.age_restriction_max||"",onChange:r=>s("age_restriction_max",r.target.value?parseInt(r.target.value):null),placeholder:"No maximum",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:t.allow_minors_with_guardian||!1,onChange:r=>s("allow_minors_with_guardian",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Allow minors if accompanied by guardian"})]})})]})]})]})}function xN({preferences:t,updatePreference:s}){return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Safety Features"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.share_live_location_automatically||!1,onChange:r=>s("share_live_location_automatically",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Share live location automatically"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Passengers can track your location in real-time during the ride"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.emergency_contact_auto_notify||!1,onChange:r=>s("emergency_contact_auto_notify",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Auto-notify emergency contact when ride starts"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Your emergency contact will receive a notification with ride details"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.require_photo_verification_at_pickup||!1,onChange:r=>s("require_photo_verification_at_pickup",r.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"Require photo verification at pickup"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Passenger must verify their identity with a photo before ride starts"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Communication Preferences"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Preferred Communication Channels"}),e.jsxs("select",{value:t.communication_preference||"in-app-only",onChange:r=>s("communication_preference",r.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"in-app-only",children:"In-app messaging only"}),e.jsx("option",{value:"phone-ok",children:"Phone calls OK"}),e.jsx("option",{value:"whatsapp-ok",children:"WhatsApp OK"}),e.jsx("option",{value:"any",children:"Any method"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Choose how passengers can contact you about rides"})]})]})]})}function gN({preferences:t,updatePreference:s}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"Payment features coming soon! Set your default pricing strategy and accepted payment methods."})}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Pricing Strategy"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Pricing Model"}),e.jsxs("select",{className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{children:"Per kilometer"}),e.jsx("option",{children:"Fixed price"}),e.jsx("option",{children:"Negotiable"}),e.jsx("option",{children:"Cost sharing (split fuel)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Price"}),e.jsx("input",{type:"number",placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price per KM"}),e.jsx("input",{type:"number",placeholder:"0.00",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Payment Methods"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Cash"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Bank Transfer"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"PayPal"})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",className:"w-5 h-5 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"In-app payment (coming soon)"})]})]})]})]})}function fN(){return e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Recurring Ride Templates"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Save your frequently posted rides as templates for quick posting"}),e.jsx("button",{className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Create Your First Template"})]})})}class ni{static async calculateDetailedCompatibility(s,r,a){const{data:n}=await _.from("user_preferences").select("*").eq("user_id",s).maybeSingle(),{data:i}=await _.from("user_preferences").select("*").eq("user_id",r).maybeSingle();if(!n||!i)return{overall:50,breakdown:{},blockingIssues:["missing_preferences"],isCompatible:!1,matchDetails:[]};let l=100;const o={},c=[],d=[],{data:m}=await _.from("blocked_users_preferences").select("*").or(`user_id.eq.${s},user_id.eq.${r}`).or(`blocked_user_id.eq.${s},blocked_user_id.eq.${r}`).maybeSingle();m&&(c.push("users_blocked"),l=0,d.push({category:"Block",reason:"One user has blocked the other",impact:"negative"})),i.search_smoking_filter==="no-smoking-only"&&n.smoking_policy!=="no-smoking"?(c.push("smoking_incompatible"),l-=30,o.smoking=-30,d.push({category:"Smoking",reason:"Passenger requires no-smoking vehicle",impact:"negative"})):n.smoking_policy==="no-smoking"&&(o.smoking=10,d.push({category:"Smoking",reason:"Non-smoking vehicle matches preference",impact:"positive"})),i.service_animal&&!n.pets_allowed?(c.push("service_animal_not_allowed"),l-=40,o.pets=-40,d.push({category:"Pets",reason:"Service animal cannot be accommodated",impact:"negative"})):n.pets_allowed&&(o.pets=5,d.push({category:"Pets",reason:"Pet-friendly vehicle",impact:"positive"})),i.search_require_wheelchair&&!n.wheelchair_accessible?(c.push("wheelchair_not_accessible"),l-=40,o.accessibility=-40,d.push({category:"Accessibility",reason:"Wheelchair accessibility required but not available",impact:"negative"})):n.wheelchair_accessible&&(o.accessibility=15,d.push({category:"Accessibility",reason:"Wheelchair accessible vehicle",impact:"positive"})),n.music_preference===i.search_music_filter||i.search_music_filter==="any"?(o.music=10,d.push({category:"Music",reason:"Music preferences align",impact:"positive"})):(l-=5,o.music=-5,d.push({category:"Music",reason:"Different music preferences",impact:"negative"})),n.conversation_level===i.conversation_level?(o.conversation=10,d.push({category:"Conversation",reason:"Conversation preferences match perfectly",impact:"positive"})):(l-=5,o.conversation=-5),n.temperature_preference===i.temperature_preference?(o.temperature=5,d.push({category:"Temperature",reason:"Temperature preferences match",impact:"positive"})):(l-=3,o.temperature=-3);let u=0;i.search_require_ac&&n.ac_heating_available?(u+=5,d.push({category:"Amenities",reason:"Air conditioning available",impact:"positive"})):i.search_require_ac&&!n.ac_heating_available&&(c.push("ac_required"),l-=20),i.search_require_charging&&n.phone_charging_available&&(u+=5,d.push({category:"Amenities",reason:"Phone charging available",impact:"positive"})),i.search_require_wifi&&n.wifi_available&&(u+=5,d.push({category:"Amenities",reason:"WiFi available",impact:"positive"})),u>0&&(o.amenities=u);let h=0;return n.share_live_location_automatically&&(h+=5,d.push({category:"Safety",reason:"Driver shares live location automatically",impact:"positive"})),n.require_photo_verification_at_pickup&&(h+=5,d.push({category:"Safety",reason:"Photo verification at pickup for security",impact:"positive"})),h>0&&(o.safety=h),l=Math.max(0,Math.min(100,l)),{overall:l,breakdown:o,blockingIssues:c,isCompatible:l>=50&&c.length===0,matchDetails:d}}static async getFilteredRidesWithMatching(s,r={}){let a=_.from("rides").select(`
        *,
        driver:profiles!rides_driver_id_fkey(
          id,
          full_name,
          avatar_url,
          average_rating,
          is_verified,
          total_rides_offered
        ),
        vehicle:vehicles!rides_vehicle_id_fkey(
          make,
          model,
          year,
          color
        )
      `).eq("status","active").gt("available_seats",0).neq("driver_id",s);const{data:n,error:i}=await a;if(i||!n)return console.error("Error fetching rides:",i),[];const{data:l}=await _.from("blocked_users_preferences").select("blocked_user_id").eq("user_id",s),o=(l==null?void 0:l.map(h=>h.blocked_user_id))||[],{data:c}=await _.from("preferred_drivers").select("preferred_driver_id").eq("user_id",s),d=(c==null?void 0:c.map(h=>h.preferred_driver_id))||[];let u=(await Promise.all(n.filter(h=>!o.includes(h.driver_id)).map(async h=>{const f=await this.calculateDetailedCompatibility(h.driver_id,s,h.id),{data:g}=await _.from("user_preferences").select("*").eq("user_id",h.driver_id).maybeSingle();return{...h,compatibilityScore:f.overall,compatibilityDetails:f,isPreferredDriver:d.includes(h.driver_id),isInstantBookable:(g==null?void 0:g.instant_booking_enabled)||!1,matchPercentage:f.overall,driverProfile:h.driver,driverPreferences:g}}))).filter(h=>{var f,g;return!(r.requireVerified&&!((f=h.driverProfile)!=null&&f.is_verified)||r.minRating&&((g=h.driverProfile)==null?void 0:g.average_rating)<r.minRating||r.instantBookingOnly&&!h.isInstantBookable||r.friendsOnly&&!h.isPreferredDriver||!h.compatibilityDetails.isCompatible)});switch(r.priorityAlgorithm){case"highest-rated":u.sort((h,f)=>{var g,j;return(((g=f.driverProfile)==null?void 0:g.average_rating)||0)-(((j=h.driverProfile)==null?void 0:j.average_rating)||0)});break;case"comfort":u.sort((h,f)=>f.compatibilityScore-h.compatibilityScore);break;case"fastest":u.sort((h,f)=>new Date(h.departure_time).getTime()-new Date(f.departure_time).getTime());break;default:u.sort((h,f)=>h.isPreferredDriver&&!f.isPreferredDriver?-1:!h.isPreferredDriver&&f.isPreferredDriver?1:f.compatibilityScore-h.compatibilityScore)}return u}static async saveSearchFilter(s,r,a){const{error:n}=await _.from("passenger_search_filters").insert({user_id:s,filter_name:r,filter_settings:a,is_default:!1});return!n}static async getSavedFilters(s){const{data:r,error:a}=await _.from("passenger_search_filters").select("*").eq("user_id",s).order("use_count",{ascending:!1});return r||[]}static async updateFilterUsage(s){await _.rpc("increment",{table_name:"passenger_search_filters",row_id:s,column_name:"use_count"}),await _.from("passenger_search_filters").update({last_used_at:new Date().toISOString()}).eq("id",s)}static async trackSearch(s,r,a,n){await _.from("search_history_analytics").insert({user_id:s,search_parameters:r,results_shown:a,result_clicked:n,booking_completed:!1})}static async getPreferenceProfiles(s,r){const{data:a}=await _.from("preference_profiles").select("*").eq("user_id",s).in("profile_type",[r,"both"]).order("use_count",{ascending:!1});return a||[]}static async createDefaultProfiles(s){const r=[{user_id:s,profile_name:"Budget Traveler",profile_type:"passenger",profile_category:"budget",preferences:{search_priority_algorithm:"cheapest",search_min_driver_rating:3,search_carpooling_ok:!0,flexible_price_percentage:30},is_system_default:!0},{user_id:s,profile_name:"Comfort Seeker",profile_type:"passenger",profile_category:"comfort",preferences:{search_priority_algorithm:"comfort",search_min_driver_rating:4.5,search_require_ac:!0,search_require_charging:!0,search_music_filter:"quiet-only"},is_system_default:!0},{user_id:s,profile_name:"Safety First",profile_type:"passenger",profile_category:"safety",preferences:{search_priority_algorithm:"highest-rated",search_min_driver_rating:4.8,search_require_verified_driver:!0,search_friends_only:!1,search_instant_booking_only:!1},is_system_default:!0}];await _.from("preference_profiles").insert(r)}static getRecommendedFilterAdjustments(s,r){const a=[];return r===0?(s.minRating&&s.minRating>4&&a.push({suggestion:`Lowering minimum rating from ${s.minRating} to 4.0`,impact:"Would show approximately 40% more rides"}),s.requireVerified&&a.push({suggestion:"Removing verified driver requirement",impact:"Would show 3x more rides"}),s.instantBookingOnly&&a.push({suggestion:"Allowing manual approval rides",impact:"Would show 5x more rides"})):r<5&&(a.push({suggestion:"Increasing flexible price percentage by 10%",impact:"Would show 2-3 more options"}),s.maxDetourMinutes&&s.maxDetourMinutes<20&&a.push({suggestion:"Increasing max detour time to 20 minutes",impact:"Would open up more route options"})),a}}function pN({onFiltersChange:t,onSearch:s,matchCount:r=0}){const{user:a}=X(),[n,i]=x.useState({}),[l,o]=x.useState([]),[c,d]=x.useState(new Set(["quick"])),[m,u]=x.useState(!1),[h,f]=x.useState(""),[g,j]=x.useState([]);x.useEffect(()=>{w(),v()},[a]),x.useEffect(()=>{t(n)},[n]);const w=async()=>{if(!a)return;const C=await ni.getSavedFilters(a.id);o(C)},v=async()=>{const C=ni.getRecommendedFilterAdjustments(n,r);j(C)},p=(C,R)=>{i(T=>({...T,[C]:R}))},y=C=>{d(R=>{const T=new Set(R);return T.has(C)?T.delete(C):T.add(C),T})},b=async()=>{!a||!h||(await ni.saveSearchFilter(a.id,h,n),u(!1),f(""),w())},N=C=>{i(C.filter_settings),ni.updateFilterUsage(C.id)},k=()=>{i({})},E=C=>{switch(C){case"cheapest":i({priorityAlgorithm:"cheapest",minRating:3,carpoolingOk:!0});break;case"fastest":i({priorityAlgorithm:"fastest",minRating:4,instantBookingOnly:!0});break;case"safest":i({priorityAlgorithm:"highest-rated",minRating:4.8,requireVerified:!0});break;case"comfort":i({priorityAlgorithm:"comfort",minRating:4.5,requireAC:!0,requireCharging:!0,musicFilter:"quiet-only"});break}};return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[e.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Find Your Perfect Ride"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r," rides match your preferences"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u(!0),className:"px-4 py-2 text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 flex items-center gap-2",children:[e.jsx(Ud,{className:"w-4 h-4"}),"Save Filters"]}),e.jsxs("button",{onClick:k,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4"}),"Clear All"]})]})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(ii,{title:"Quick Filters",icon:Al,expanded:c.has("quick"),onToggle:()=>y("quick"),children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(li,{label:"Cheapest",icon:va,onClick:()=>E("cheapest"),active:n.priorityAlgorithm==="cheapest"}),e.jsx(li,{label:"Fastest",icon:ye,onClick:()=>E("fastest"),active:n.priorityAlgorithm==="fastest"}),e.jsx(li,{label:"Safest",icon:me,onClick:()=>E("safest"),active:n.priorityAlgorithm==="highest-rated"}),e.jsx(li,{label:"Most Comfortable",icon:we,onClick:()=>E("comfort"),active:n.priorityAlgorithm==="comfort"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Price"}),e.jsx("input",{type:"number",value:n.maxPrice||"",onChange:C=>p("maxPrice",C.target.value?parseFloat(C.target.value):void 0),placeholder:"No limit",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Rating"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:n.minRating||0,onChange:C=>p("minRating",parseFloat(C.target.value)),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900 w-12 text-center",children:[(n.minRating||0).toFixed(1)," ",e.jsx(we,{className:"w-3 h-3 inline text-yellow-500"})]})]})]}),e.jsx("div",{className:"flex items-center gap-4 pt-6",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.requireVerified||!1,onChange:C=>p("requireVerified",C.target.checked),className:"w-5 h-5 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Verified only"})]})})]})]}),l.length>0&&e.jsx(ii,{title:"Saved Filters",icon:$g,expanded:c.has("saved"),onToggle:()=>y("saved"),children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:l.slice(0,6).map(C=>e.jsxs("button",{onClick:()=>N(C),className:"p-3 text-left border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors",children:[e.jsx("div",{className:"font-medium text-gray-900",children:C.filter_name}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Used ",C.use_count," times"]})]},C.id))})}),e.jsx(ii,{title:"Driver Requirements",icon:re,expanded:c.has("driver"),onToggle:()=>y("driver"),children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.requireVerified||!1,onChange:C=>p("requireVerified",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Verified drivers"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.instantBookingOnly||!1,onChange:C=>p("instantBookingOnly",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Instant booking"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.friendsOnly||!1,onChange:C=>p("friendsOnly",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Friends only"})]})]})})}),e.jsxs(ii,{title:"Ride Experience",icon:we,expanded:c.has("experience"),onToggle:()=>y("experience"),children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Smoking Preference"}),e.jsxs("select",{value:n.smokingFilter||"any",onChange:C=>p("smokingFilter",C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"no-smoking-only",children:"No smoking only"}),e.jsx("option",{value:"outside-only-ok",children:"Outside breaks OK"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Music Preference"}),e.jsxs("select",{value:n.musicFilter||"any",onChange:C=>p("musicFilter",C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"quiet-only",children:"Quiet only"}),e.jsx("option",{value:"moderate-max",children:"Moderate max"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pets Policy"}),e.jsxs("select",{value:n.petsFilter||"any",onChange:C=>p("petsFilter",C.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"any",children:"Any"}),e.jsx("option",{value:"no-pets",children:"No pets"}),e.jsx("option",{value:"pets-ok-only",children:"Pets OK only"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 mt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.requireAC||!1,onChange:C=>p("requireAC",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx(Nn,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm text-gray-700",children:"A/C Required"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.requireCharging||!1,onChange:C=>p("requireCharging",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Phone Charging"})]}),e.jsxs("label",{className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:n.requireWiFi||!1,onChange:C=>p("requireWiFi",C.target.checked),className:"w-4 h-4 text-blue-600 rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"WiFi"})]})]})]}),g.length>0&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Smart Suggestions"}),e.jsx("ul",{className:"space-y-2",children:g.map((C,R)=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-700",children:C.suggestion}),e.jsxs("span",{className:"text-blue-600 ml-2",children:[" ",C.impact]})]},R))})]})]})}),e.jsxs("button",{onClick:s,className:"w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold flex items-center justify-center gap-2",children:[e.jsx(Ld,{className:"w-5 h-5"}),"Search with Filters (",r," matches)"]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Save Filter Profile"}),e.jsx("input",{type:"text",value:h,onChange:C=>f(C.target.value),placeholder:"e.g., Daily Commute, Weekend Trips...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4",autoFocus:!0}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>u(!1),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:b,disabled:!h,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Save"})]})]})})]})}function ii({title:t,icon:s,expanded:r,onToggle:a,children:n}){return e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:a,className:"w-full flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:t})]}),r?e.jsx(wi,{className:"w-5 h-5 text-gray-600"}):e.jsx(Ya,{className:"w-5 h-5 text-gray-600"})]}),r&&e.jsx("div",{className:"p-4 border-t border-gray-200",children:n})]})}function li({label:t,icon:s,onClick:r,active:a}){return e.jsxs("button",{onClick:r,className:`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all ${a?"border-blue-600 bg-blue-50 text-blue-600":"border-gray-200 hover:border-gray-300 text-gray-700"}`,children:[e.jsx(s,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:t})]})}function yN(){const t=ie(),[s,r]=x.useState("passenger");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>t(-1),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>r("passenger"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${s==="passenger"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Mt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Passenger Filters"})]}),e.jsxs("button",{onClick:()=>r("driver"),className:`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${s==="driver"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Driver Preferences"})]})]}),e.jsx("div",{className:"w-20"})]})})}),e.jsxs("div",{className:"py-8",children:[s==="driver"&&e.jsx(dN,{}),s==="passenger"&&e.jsx("div",{className:"max-w-4xl mx-auto px-4",children:e.jsx(pN,{onFiltersChange:a=>console.log("Filters changed:",a),onSearch:()=>console.log("Search clicked"),matchCount:0})})]})]})}function bN(){const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState([]),[i,l]=x.useState(""),[o,c]=x.useState(!0),[d,m]=x.useState(!1),[u,h]=x.useState(""),[f,g]=x.useState("");x.useEffect(()=>{if(!s){r("/");return}j()},[s,r]);const j=async()=>{const{data:p,error:y}=await _.from("beta_allowlist").select("*").order("added_at",{ascending:!1});y?(h("Failed to load allowlist"),console.error(y)):n(p||[]),c(!1)},w=async p=>{if(p.preventDefault(),!i.trim())return;m(!0),h(""),g("");const{error:y}=await _.from("beta_allowlist").insert({email:i.toLowerCase().trim(),added_by:t==null?void 0:t.email});y?y.code==="23505"?h("This email is already in the allowlist"):h("Failed to add email: "+y.message):(g(`${i} added to allowlist`),l(""),j()),m(!1)},v=async p=>{if(!confirm(`Remove ${p} from the allowlist?`))return;const{error:y}=await _.from("beta_allowlist").delete().eq("email",p);y?h("Failed to remove email: "+y.message):(g(`${p} removed from allowlist`),j())};return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>r("/admin"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Dashboard"})]}),e.jsxs(Ie,{to:"/admin",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(la,{className:"w-4 h-4"}),"Admin Dashboard"]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(me,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Beta Access Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage who can sign up during private beta"})]})]}),u&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:u}),f&&e.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg",children:f}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Email to Allowlist"}),e.jsxs("form",{onSubmit:w,className:"flex gap-3",children:[e.jsx("input",{type:"email",value:i,onChange:p=>l(p.target.value),placeholder:"user@example.com",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0}),e.jsxs("button",{type:"submit",disabled:d,className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(oa,{className:"w-5 h-5"}),d?"Adding...":"Add"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-gray-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Allowlist"})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[a.length," emails"]})]}),o?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):a.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No emails in allowlist yet. Add emails above to allow signups."}):e.jsx("div",{className:"divide-y divide-gray-100",children:a.map(p=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:p.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Added ",new Date(p.added_at).toLocaleDateString(),p.added_by&&` by ${p.added_by}`]})]}),e.jsx("button",{onClick:()=>v(p.email),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Remove from allowlist",children:e.jsx(Ns,{className:"w-5 h-5"})})]},p.email))})]})]})]}):null}function vN(){const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[o,c]=x.useState("");x.useEffect(()=>{if(!s){r("/");return}d()},[s,r]);const d=async()=>{const{data:h,error:f}=await _.from("bug_reports").select(`
        id,
        text,
        page,
        created_at,
        user:profiles!bug_reports_user_id_fkey(id, full_name, email)
      `).order("created_at",{ascending:!1});f?(c("Failed to load feedback"),console.error(f)):n(h||[]),l(!1)},m=async h=>{if(!confirm("Delete this feedback?"))return;const{error:f}=await _.from("bug_reports").delete().eq("id",h);f?c("Failed to delete feedback"):d()},u=h=>new Date(h).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>r("/admin"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Dashboard"})]}),e.jsxs(Ie,{to:"/admin",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(la,{className:"w-4 h-4"}),"Admin Dashboard"]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center",children:e.jsx(Nt,{className:"w-6 h-6 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Feedback"}),e.jsx("p",{className:"text-gray-600",children:"Bug reports and suggestions from users"})]})]}),o&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:o}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"All Feedback"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[a.length," reports"]})]}),i?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading..."}):a.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No feedback received yet."}):e.jsx("div",{className:"divide-y divide-gray-100",children:a.map(h=>e.jsx("div",{className:"p-6 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:h.text}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mt-3 text-sm text-gray-500",children:[h.user&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(kt,{className:"w-4 h-4"}),h.user.full_name," (",h.user.email,")"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),u(h.created_at)]}),h.page&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Id,{className:"w-4 h-4"}),h.page]})]})]}),e.jsx("button",{onClick:()=>m(h.id),className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors flex-shrink-0",title:"Delete feedback",children:e.jsx(Ns,{className:"w-5 h-5"})})]})},h.id))})]})]})]}):null}function jN(){const{user:t,session:s,isAdmin:r}=X(),a=ie(),[n,i]=x.useState([]),[l,o]=x.useState(!1),[c,d]=x.useState(!1),[m,u]=x.useState(null),h=x.useRef(null);x.useEffect(()=>{if(!r){a("/");return}},[r,a]);const f=(L,V)=>{i(S=>S.map(U=>U.name===L?{...U,...V}:U))},g=()=>new Promise(L=>{if(typeof google<"u"&&google.maps){L(!0);return}let V=0;const S=50,U=setInterval(()=>{V++,typeof google<"u"&&google.maps?(clearInterval(U),L(!0)):V>=S&&(clearInterval(U),L(!1))},100)}),j=async()=>{o(!0),i([{name:"Supabase Session",status:"pending",category:"auth"},{name:"Database Connection",status:"pending",category:"database"},{name:"Database Read (profiles)",status:"pending",category:"database"},{name:"Database Write Test",status:"pending",category:"database"},{name:"Database Statistics",status:"pending",category:"database"},{name:"Storage Buckets",status:"pending",category:"storage"},{name:"Realtime Subscription",status:"pending",category:"realtime"},{name:"Edge Function (gemini-proxy)",status:"pending",category:"functions"},{name:"Edge Function (vehicle-lookup)",status:"pending",category:"functions"},{name:"Google Maps Script",status:"pending",category:"maps"},{name:"Places Autocomplete",status:"pending",category:"maps"}]),await w(),await v(),await p(),await y(),await b(),await N(),await k(),await E(),await C(),await R(),await T(),o(!1)},w=async()=>{const L="Supabase Session";f(L,{status:"running"});const V=Date.now();try{const{data:S,error:U}=await _.auth.getSession();if(U)throw U;if(!S.session)throw new Error("No active session");const P=S.session.expires_at,A=P?new Date(P*1e3).toLocaleString():"Unknown",W=P?Math.round((P*1e3-Date.now())/6e4):0;f(L,{status:"pass",details:`User: ${S.session.user.email}, Expires in ${W} minutes`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},v=async()=>{const L="Database Connection";f(L,{status:"running"});const V=Date.now();try{const{error:S}=await _.from("profiles").select("id").limit(1);if(S)throw S;f(L,{status:"pass",details:"Connected to https://uqofmsreosfjflmgurzb.supabase.co",duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},p=async()=>{const L="Database Read (profiles)";f(L,{status:"running"});const V=Date.now();try{const{data:S,error:U,count:P}=await _.from("profiles").select("id",{count:"exact",head:!1}).limit(1);if(U)throw U;f(L,{status:"pass",details:`Read successful, total profiles: ${P??"unknown"}`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},y=async()=>{const L="Database Write Test";f(L,{status:"running"});const V=Date.now();try{const S=`[DIAGNOSTIC TEST] ${new Date().toISOString()}`,{data:U,error:P}=await _.from("bug_reports").insert({user_id:t==null?void 0:t.id,text:S,page:"/admin/diagnostics"}).select("id").single();if(P)throw P;const{error:A}=await _.from("bug_reports").delete().eq("id",U.id);A?f(L,{status:"warn",details:`Write OK, cleanup failed: ${A.message}`,duration:Date.now()-V}):f(L,{status:"pass",details:"Insert and delete operations successful",duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},b=async()=>{const L="Database Statistics";f(L,{status:"running"});const V=Date.now();try{const[S,U,P,A,W,z]=await Promise.all([_.from("profiles").select("id",{count:"exact",head:!0}),_.from("rides").select("id",{count:"exact",head:!0}),_.from("bookings").select("id",{count:"exact",head:!0}),_.from("messages").select("id",{count:"exact",head:!0}),_.from("vehicles").select("id",{count:"exact",head:!0}),_.from("bug_reports").select("id",{count:"exact",head:!0})]),Y={profiles:S.count||0,rides:U.count||0,bookings:P.count||0,messages:A.count||0,vehicles:W.count||0,bug_reports:z.count||0};u(Y),f(L,{status:"pass",details:`Users: ${Y.profiles}, Rides: ${Y.rides}, Bookings: ${Y.bookings}`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},N=async()=>{const L="Storage Buckets";f(L,{status:"running"});const V=Date.now();try{const{data:S,error:U}=await _.storage.listBuckets();if(U)throw U;const P=(S==null?void 0:S.map(A=>A.name).join(", "))||"none";f(L,{status:S&&S.length>0?"pass":"warn",details:`Buckets: ${P}`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},k=async()=>{const L="Realtime Subscription";f(L,{status:"running"});const V=Date.now();return new Promise(S=>{const U=setTimeout(()=>{h.current&&_.removeChannel(h.current),f(L,{status:"fail",error:"Subscription timeout (5s) - channel may not be enabled",duration:Date.now()-V}),S()},5e3),P=_.channel("diagnostics-test").on("presence",{event:"sync"},()=>{clearTimeout(U),_.removeChannel(P),f(L,{status:"pass",details:"Realtime connection established via presence",duration:Date.now()-V}),S()}).subscribe(A=>{A==="SUBSCRIBED"&&P.track({user_id:t==null?void 0:t.id,online_at:new Date().toISOString()}),A==="CHANNEL_ERROR"&&(clearTimeout(U),_.removeChannel(P),f(L,{status:"fail",error:"Channel subscription error",duration:Date.now()-V}),S())});h.current=P})},E=async()=>{const L="Edge Function (gemini-proxy)";f(L,{status:"running"});const V=Date.now();try{if(!(s!=null&&s.access_token))throw new Error("No access token available");const S=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/gemini-proxy",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({contents:[{role:"user",parts:[{text:'Reply with only the word "OK"'}]}],generationConfig:{maxOutputTokens:10}})});if(!S.ok){const P=await S.json().catch(()=>({}));throw new Error(P.error||`HTTP ${S.status}`)}const U=await S.json();if(!U.text)throw new Error("No text in response");f(L,{status:"pass",details:`AI responded: "${U.text.substring(0,30)}${U.text.length>30?"...":""}"`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},C=async()=>{const L="Edge Function (vehicle-lookup)";f(L,{status:"running"});const V=Date.now();try{if(!(s!=null&&s.access_token))throw new Error("No access token available");const S=await fetch("https://uqofmsreosfjflmgurzb.supabase.co/functions/v1/vehicle-lookup",{method:"POST",headers:{Authorization:`Bearer ${s.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({registrationNumber:"TEST123"})}),U=S.status===200||S.status===400||S.status===404;f(L,{status:U?"pass":"fail",details:U?"Function reachable and responding":`HTTP ${S.status}`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},R=async()=>{const L="Google Maps Script";f(L,{status:"running"});const V=Date.now();try{if(!await g())throw new Error("Google Maps script not loaded after 5s");const U=google.maps.version||"unknown",P=typeof google.maps.places<"u",A=typeof google.maps.Geocoder<"u";f(L,{status:"pass",details:`Version: ${U}, Places: ${P?"Yes":"No"}, Geocoder: ${A?"Yes":"No"}`,duration:Date.now()-V})}catch(S){f(L,{status:"fail",error:S instanceof Error?S.message:"Unknown error",duration:Date.now()-V})}},T=async()=>{var S;const L="Places Autocomplete";f(L,{status:"running"});const V=Date.now();try{if(!await g()||!((S=google.maps)!=null&&S.places))throw new Error("Google Maps Places library not loaded");const P=document.createElement("div");P.style.display="none",document.body.appendChild(P);const A=document.createElement("input");if(P.appendChild(A),!new google.maps.places.Autocomplete(A,{componentRestrictions:{country:"gb"},fields:["place_id","formatted_address"]}))throw new Error("Failed to create Autocomplete instance");document.body.removeChild(P),f(L,{status:"pass",details:"Autocomplete instance created successfully (UK restricted)",duration:Date.now()-V})}catch(U){f(L,{status:"fail",error:U instanceof Error?U.message:"Unknown error",duration:Date.now()-V})}},M=()=>{const L=new Date().toISOString(),V=n.filter(W=>W.status==="pass").length,S=n.filter(W=>W.status==="fail").length,U=n.filter(W=>W.status==="warn").length;let P=`Carpool Network Diagnostics Report
`;return P+=`Generated: ${L}
`,P+=`User: ${t==null?void 0:t.email}
`,P+=`Environment: production
`,P+=`
Summary: ${V} PASS, ${U} WARN, ${S} FAIL
`,P+=`${"=".repeat(50)}

`,["auth","database","storage","realtime","functions","maps"].forEach(W=>{const z=n.filter(Y=>Y.category===W);z.length>0&&(P+=`[${W.toUpperCase()}]
`,z.forEach(Y=>{const Z=Y.status==="pass"?"[PASS]":Y.status==="warn"?"[WARN]":Y.status==="fail"?"[FAIL]":"[----]";P+=`  ${Z} ${Y.name}
`,Y.duration&&(P+=`         Duration: ${Y.duration}ms
`),Y.details&&(P+=`         Details: ${Y.details}
`),Y.error&&(P+=`         Error: ${Y.error}
`)}),P+=`
`)}),m&&(P+=`[DATABASE STATISTICS]
`,P+=`  Users: ${m.profiles}
`,P+=`  Rides: ${m.rides}
`,P+=`  Bookings: ${m.bookings}
`,P+=`  Messages: ${m.messages}
`,P+=`  Vehicles: ${m.vehicles}
`,P+=`  Bug Reports: ${m.bug_reports}

`),P+=`${"=".repeat(50)}
`,P+=`Supabase URL: https://uqofmsreosfjflmgurzb.supabase.co
`,P+=`Google Maps API: Configured
`,P+=`Beta Mode: true
`,P},I=async()=>{const L=M();await navigator.clipboard.writeText(L),d(!0),setTimeout(()=>d(!1),2e3)},D=L=>{switch(L){case"pass":return e.jsx(ee,{className:"w-5 h-5 text-green-500"});case"warn":return e.jsx(ee,{className:"w-5 h-5 text-yellow-500"});case"fail":return e.jsx(Qe,{className:"w-5 h-5 text-red-500"});case"running":return e.jsx(at,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return e.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-gray-300"})}},F=L=>L.includes("Session")?e.jsx(kt,{className:"w-4 h-4"}):L.includes("Database")||L.includes("Statistics")?e.jsx($d,{className:"w-4 h-4"}):L.includes("Storage")?e.jsx(_j,{className:"w-4 h-4"}):L.includes("Realtime")?e.jsx(bs,{className:"w-4 h-4"}):L.includes("Edge")||L.includes("Function")?e.jsx(An,{className:"w-4 h-4"}):L.includes("Maps")||L.includes("Places")?e.jsx(xe,{className:"w-4 h-4"}):L.includes("vehicle")?e.jsx(pe,{className:"w-4 h-4"}):e.jsx(Me,{className:"w-4 h-4"}),B=L=>({auth:"border-l-blue-500",database:"border-l-green-500",storage:"border-l-orange-500",realtime:"border-l-yellow-500",functions:"border-l-teal-500",maps:"border-l-red-500"})[L]||"border-l-gray-500";if(!r)return null;const H=n.filter(L=>L.status==="pass").length,O=n.filter(L=>L.status==="fail").length,$=n.filter(L=>L.status==="warn").length;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>a("/admin"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Dashboard"})]}),e.jsxs(Ie,{to:"/admin",className:"flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium",children:[e.jsx(la,{className:"w-4 h-4"}),"Admin Dashboard"]})]})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center",children:e.jsx(Me,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"System Diagnostics"}),e.jsx("p",{className:"text-gray-600",children:"Comprehensive health checks for all system components"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[n.length>0&&e.jsxs("button",{onClick:I,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors flex items-center gap-2",children:[e.jsx(Tg,{className:"w-4 h-4"}),c?"Copied!":"Copy Report"]}),e.jsx("button",{onClick:j,disabled:l,className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-4 h-4 animate-spin"}),"Running..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),"Run All Tests"]})})]})]}),n.length>0&&e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(ee,{className:"w-5 h-5 text-green-500"}),e.jsxs("span",{className:"font-medium text-green-700",children:[H," Pass"]})]}),$>0&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(ee,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("span",{className:"font-medium text-yellow-700",children:[$," Warn"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Qe,{className:"w-5 h-5 text-red-500"}),e.jsxs("span",{className:"font-medium text-red-700",children:[O," Fail"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Test Results"}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-blue-500"})," Auth",e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500 ml-2"})," Database",e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500 ml-2"})," Storage",e.jsx("span",{className:"w-3 h-3 rounded-full bg-teal-500 ml-2"})," Functions",e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500 ml-2"})," Maps"]})]}),n.length===0?e.jsxs("div",{className:"p-12 text-center text-gray-500",children:[e.jsx(Me,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium text-gray-600",children:"No tests run yet"}),e.jsx("p",{className:"text-sm mt-1",children:'Click "Run All Tests" to start diagnostics'})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:n.map(L=>e.jsx("div",{className:`px-6 py-4 border-l-4 ${B(L.category)} ${L.status==="fail"?"bg-red-50":L.status==="warn"?"bg-yellow-50":""}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[D(L.status),e.jsx("div",{className:"flex items-center gap-2 text-gray-500",children:F(L.name)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-medium text-gray-900",children:L.name}),L.duration&&e.jsxs("span",{className:"text-xs text-gray-400",children:[L.duration,"ms"]})]}),L.details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:L.details}),L.error&&e.jsx("p",{className:"text-sm text-red-600 mt-1 font-mono bg-red-100 px-2 py-1 rounded",children:L.error})]})]})},L.name))})]}),m&&e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Tn,{className:"w-5 h-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Database Statistics"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[{label:"Users",value:m.profiles,icon:kt},{label:"Rides",value:m.rides,icon:pe},{label:"Bookings",value:m.bookings,icon:Og},{label:"Messages",value:m.messages,icon:Me},{label:"Vehicles",value:m.vehicles,icon:pe},{label:"Feedback",value:m.bug_reports,icon:Me}].map(L=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx(L.icon,{className:"w-5 h-5 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:L.value}),e.jsx("p",{className:"text-sm text-gray-500",children:L.label})]},L.label))})]}),e.jsxs("div",{className:"mt-6 bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Environment Configuration"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Supabase URL"}),e.jsx("p",{className:"font-mono text-gray-900 bg-gray-50 px-3 py-2 rounded truncate",children:"https://uqofmsreosfjflmgurzb.supabase.co"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Google Maps API"}),e.jsx("p",{className:"font-mono text-gray-900 bg-gray-50 px-3 py-2 rounded",children:"Configured"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Environment"}),e.jsxs("p",{className:"font-mono text-gray-900 bg-gray-50 px-3 py-2 rounded",children:["production"," ","(Beta)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 block mb-1",children:"Admin Email"}),e.jsx("p",{className:"font-mono text-gray-900 bg-gray-50 px-3 py-2 rounded",children:ADMIN_EMAIL})]})]})]})]})]})]})}function wN(){const[t,s]=x.useState([]),[r,a]=x.useState([]),[n,i]=x.useState(!0),[l,o]=x.useState("all"),[c,d]=x.useState({name:"",type:"profanity",action:"flag"});x.useEffect(()=>{m()},[l]);const m=async()=>{i(!0);try{let w=_.from("content_moderation_queue").select("*").order("created_at",{ascending:!1}).limit(50);l!=="all"&&(w=w.eq("status",l));const{data:v}=await w,{data:p}=await _.from("automated_content_filters").select("*").order("hit_count",{ascending:!1});v&&s(v),p&&a(p)}catch(w){console.error("Error fetching moderation data:",w)}finally{i(!1)}},u=async(w,v)=>{var p;try{const{error:y}=await _.from("content_moderation_queue").update({status:v,reviewed_at:new Date().toISOString(),reviewed_by:(p=(await _.auth.getUser()).data.user)==null?void 0:p.id}).eq("id",w);y||m()}catch(y){console.error("Error updating moderation item:",y)}},h=async(w,v)=>{await _.from("automated_content_filters").update({active:!v}).eq("id",w),m()},f=async()=>{c.name&&(await _.from("automated_content_filters").insert({filter_name:c.name,filter_type:c.type,action:c.action,active:!0,patterns:[]}),d({name:"",type:"profanity",action:"flag"}),m())},g=w=>({critical:"bg-red-100 text-red-800 border-red-200",high:"bg-orange-100 text-orange-800 border-orange-200",medium:"bg-yellow-100 text-yellow-800 border-yellow-200",low:"bg-blue-100 text-blue-800 border-blue-200"})[w]||"bg-gray-100 text-gray-800 border-gray-200",j=w=>{switch(w){case"profile":return e.jsx(kt,{className:"w-5 h-5"});case"review":return e.jsx(Nt,{className:"w-5 h-5"});case"photo":return e.jsx(Od,{className:"w-5 h-5"});case"message":return e.jsx(Nt,{className:"w-5 h-5"});default:return e.jsx(Gs,{className:"w-5 h-5"})}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Oe,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Content Moderation"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage reported content"})]}),e.jsxs("button",{onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-red-500 to-red-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Gs,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Pending Review"})]}),e.jsx("p",{className:"text-3xl font-bold",children:t.filter(w=>w.status==="pending").length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Under Review"})]}),e.jsx("p",{className:"text-3xl font-bold",children:t.filter(w=>w.status==="reviewing").length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Approved"})]}),e.jsx("p",{className:"text-3xl font-bold",children:t.filter(w=>w.status==="approved").length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Active Filters"})]}),e.jsx("p",{className:"text-3xl font-bold",children:r.filter(w=>w.active).length})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Moderation Queue"}),e.jsxs("select",{value:l,onChange:w=>o(w.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Items"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"reviewing",children:"Under Review"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsx("div",{className:"space-y-3",children:t.length>0?t.map(w=>e.jsxs("div",{className:`p-4 rounded-lg border ${g(w.severity)}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:"p-2 bg-white rounded-lg",children:j(w.content_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold capitalize",children:w.content_type}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-white",children:w.severity}),e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-white",children:w.status})]}),e.jsxs("p",{className:"text-sm mb-2",children:["Reason: ",w.reason]}),e.jsx("p",{className:"text-xs opacity-75",children:new Date(w.created_at).toLocaleString()})]})]})}),(w.status==="pending"||w.status==="reviewing")&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u(w.id,"approved"),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 text-sm",children:[e.jsx(ee,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>u(w.id,"rejected"),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 flex items-center gap-2 text-sm",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Reject"]}),e.jsxs("button",{onClick:()=>u(w.id,"escalated"),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 flex items-center gap-2 text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Escalate"]})]})]},w.id)):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No items in moderation queue"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Automated Filters"}),e.jsx("div",{className:"space-y-2",children:r.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:w.filter_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Type: ",w.filter_type," | Action: ",w.action," | Hits: ",w.hit_count]})]}),e.jsx("button",{onClick:()=>h(w.id,w.active),className:`px-4 py-2 rounded-lg text-sm font-medium ${w.active?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:w.active?"Active":"Inactive"})]},w.id))})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Filter"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Name"}),e.jsx("input",{type:"text",value:c.name,onChange:w=>d({...c,name:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Profanity Filter"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter Type"}),e.jsxs("select",{value:c.type,onChange:w=>d({...c,type:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"profanity",children:"Profanity"}),e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"harassment",children:"Harassment"}),e.jsx("option",{value:"illegal",children:"Illegal Content"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Action"}),e.jsxs("select",{value:c.action,onChange:w=>d({...c,action:w.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"flag",children:"Flag for Review"}),e.jsx("option",{value:"block",children:"Block Content"}),e.jsx("option",{value:"auto_remove",children:"Auto Remove"}),e.jsx("option",{value:"shadow_ban",children:"Shadow Ban"})]})]}),e.jsx("button",{onClick:f,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create Filter"})]})]})]})]})}function NN(){const[t,s]=x.useState([]),[r,a]=x.useState([]),[n,i]=x.useState(!0),[l,o]=x.useState("admin"),[c,d]=x.useState(""),[m,u]=x.useState({start:new Date(Date.now()-7*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),[h,f]=x.useState("all");x.useEffect(()=>{g()},[l,m,h]);const g=async()=>{i(!0);try{if(l==="admin"){let p=_.from("admin_audit_log").select("*").gte("created_at",`${m.start}T00:00:00`).lte("created_at",`${m.end}T23:59:59`).order("created_at",{ascending:!1}).limit(100);h!=="all"&&(p=p.eq("action_type",h));const{data:y}=await p;y&&s(y)}else{const{data:p}=await _.from("data_access_log").select("*").gte("created_at",`${m.start}T00:00:00`).lte("created_at",`${m.end}T23:59:59`).order("created_at",{ascending:!1}).limit(100);p&&a(p)}}catch(p){console.error("Error fetching logs:",p)}finally{i(!1)}},j=()=>{const p=l==="admin"?t:r,y=[l==="admin"?["Timestamp","Admin ID","Action","Resource Type","Resource ID","IP Address"].join(","):["Timestamp","User ID","Resource Type","Resource ID","Reason","IP Address"].join(","),...p.map(E=>l==="admin"?[new Date(E.created_at).toISOString(),E.admin_id,E.action_type,E.resource_type,E.resource_id||"",E.ip_address||""].join(","):[new Date(E.created_at).toISOString(),E.user_id,E.resource_type,E.resource_id||"",E.access_reason||"",E.ip_address||""].join(","))].join(`
`),b=new Blob([y],{type:"text/csv"}),N=window.URL.createObjectURL(b),k=document.createElement("a");k.href=N,k.download=`${l}-logs-${m.start}-to-${m.end}.csv`,k.click()},w=l==="admin"?t.filter(p=>p.action_type.toLowerCase().includes(c.toLowerCase())||p.resource_type.toLowerCase().includes(c.toLowerCase())):r.filter(p=>p.resource_type.toLowerCase().includes(c.toLowerCase())),v=p=>p.includes("delete")||p.includes("remove")?"text-red-600 bg-red-50":p.includes("create")||p.includes("add")?"text-green-600 bg-green-50":p.includes("update")||p.includes("modify")?"text-blue-600 bg-blue-50":"text-gray-600 bg-gray-50";return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Oe,{className:"w-8 h-8 animate-spin text-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Audit Log Viewer"}),e.jsx("p",{className:"text-gray-600",children:"Complete audit trail of all administrative actions"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(ja,{className:"w-4 h-4"}),"Export"]}),e.jsxs("button",{onClick:g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Admin Actions"})]}),e.jsx("p",{className:"text-3xl font-bold",children:t.length}),e.jsx("p",{className:"text-sm opacity-75 mt-1",children:"In selected period"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ye,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm opacity-90",children:"Data Access"})]}),e.jsx("p",{className:"text-3xl font-bold",children:r.length}),e.jsx("p",{className:"text-sm opacity-75 mt-1",children:"Access logs recorded"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o("admin"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${l==="admin"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(me,{className:"w-4 h-4 inline mr-2"}),"Admin Actions"]}),e.jsxs("button",{onClick:()=>o("access"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${l==="access"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ye,{className:"w-4 h-4 inline mr-2"}),"Data Access"]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:c,onChange:p=>d(p.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-600"}),e.jsx("input",{type:"date",value:m.start,onChange:p=>u({...m,start:p.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("span",{className:"text-gray-600",children:"to"}),e.jsx("input",{type:"date",value:m.end,onChange:p=>u({...m,end:p.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),l==="admin"&&e.jsxs("select",{value:h,onChange:p=>f(p.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"all",children:"All Actions"}),e.jsx("option",{value:"create",children:"Create"}),e.jsx("option",{value:"update",children:"Update"}),e.jsx("option",{value:"delete",children:"Delete"}),e.jsx("option",{value:"approve",children:"Approve"}),e.jsx("option",{value:"reject",children:"Reject"})]})]}),e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:w.length>0?w.map(p=>e.jsx("div",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:l==="admin"?e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${v(p.action_type)}`,children:p.action_type}),e.jsx("span",{className:"text-sm text-gray-600",children:p.resource_type})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Admin ID:"})," ",p.admin_id.substring(0,8),"..."]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"IP:"})," ",p.ip_address||"N/A"]}),p.resource_id&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Resource ID:"})," ",p.resource_id.substring(0,8),"..."]}),p.changes&&Object.keys(p.changes).length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Changes:"}),e.jsx("pre",{className:"text-xs bg-gray-50 p-2 rounded mt-1 overflow-x-auto",children:JSON.stringify(p.changes,null,2)})]})]})]}),e.jsx("div",{className:"text-right text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),new Date(p.created_at).toLocaleString()]})})]}):e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-purple-50 text-purple-600",children:p.resource_type})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"User ID:"})," ",p.user_id.substring(0,8),"..."]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"IP:"})," ",p.ip_address||"N/A"]}),p.access_reason&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",p.access_reason]})]})]}),e.jsx("div",{className:"text-right text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),new Date(p.created_at).toLocaleString()]})})]})},p.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Yt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No logs found for the selected criteria"})]})})]})]})}function _N(){const[t,s]=x.useState(null),[r,a]=x.useState({start:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),n=[{id:"executive",name:"Executive Summary",description:"High-level overview of platform performance, KPIs, and trends",icon:e.jsx(Fe,{className:"w-6 h-6"}),type:"executive"},{id:"financial",name:"Financial Report",description:"Detailed financial analysis including revenue, payouts, and transactions",icon:e.jsx(va,{className:"w-6 h-6"}),type:"financial"},{id:"user-analytics",name:"User Analytics",description:"User growth, retention, behavior patterns, and demographics",icon:e.jsx(re,{className:"w-6 h-6"}),type:"user"},{id:"ride-performance",name:"Ride Performance",description:"Ride metrics, completion rates, cancellations, and efficiency",icon:e.jsx(pe,{className:"w-6 h-6"}),type:"ride"},{id:"geographic",name:"Geographic Analysis",description:"Regional performance, demand/supply analysis, and coverage maps",icon:e.jsx(Pj,{className:"w-6 h-6"}),type:"geographic"},{id:"operational",name:"Operational Metrics",description:"System health, performance, uptime, and operational efficiency",icon:e.jsx(Me,{className:"w-6 h-6"}),type:"operational"}],i=async c=>{var d;s(c);try{let m={};const u=r.start,h=r.end;switch(c){case"executive":const{data:g}=await _.from("business_metrics_daily").select("*").gte("date",u).lte("date",h),{data:j}=await _.from("active_users_snapshot").select("*").order("snapshot_time",{ascending:!1}).limit(1).maybeSingle();m={title:"Executive Summary Report",period:`${u} to ${h}`,metrics:g,activeUsers:j};break;case"financial":const{data:w}=await _.rpc("get_financial_summary",{start_date:u,end_date:h}),{data:v}=await _.from("transactions").select("*").gte("created_at",u).lte("created_at",h);m={title:"Financial Report",period:`${u} to ${h}`,summary:w,transactions:v};break;case"user":const{data:p}=await _.from("user_behavior_analytics").select("*").gte("analysis_date",u).lte("analysis_date",h),{data:y}=await _.from("growth_metrics").select("*").gte("date",u).lte("date",h);m={title:"User Analytics Report",period:`${u} to ${h}`,userBehavior:p,growthMetrics:y};break;case"ride":const{data:b}=await _.from("ride_analytics").select("*").gte("created_at",u).lte("created_at",h);m={title:"Ride Performance Report",period:`${u} to ${h}`,analytics:b};break;case"geographic":const{data:N}=await _.from("geographic_analytics").select("*").gte("date",u).lte("date",h);m={title:"Geographic Analysis Report",period:`${u} to ${h}`,geographic:N};break;case"operational":const{data:k}=await _.from("system_health_metrics").select("*").gte("timestamp",u).lte("timestamp",h),{data:E}=await _.from("service_uptime_tracking").select("*");m={title:"Operational Metrics Report",period:`${u} to ${h}`,systemHealth:k,serviceUptime:E};break}await _.from("financial_reports").insert({report_type:c,report_period:`${u} to ${h}`,start_date:u,end_date:h,data:m,generated_by:(d=(await _.auth.getUser()).data.user)==null?void 0:d.id});const f=l(m);o(f,`${c}-report-${u}-${h}.csv`)}catch(m){console.error("Error generating report:",m)}finally{s(null)}},l=c=>[`Report: ${c.title}`,`Period: ${c.period}`,`Generated: ${new Date().toISOString()}`,"","Summary Data:",JSON.stringify(c,null,2)].join(`
`),o=(c,d)=>{const m=new Blob([c],{type:"text/csv"}),u=window.URL.createObjectURL(m),h=document.createElement("a");h.href=u,h.download=d,h.click()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Advanced Reporting"}),e.jsx("p",{className:"text-gray-600",children:"Generate comprehensive reports and analytics"})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Report Period:"}),e.jsx("input",{type:"date",value:r.start,onChange:c=>a({...r,start:c.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsx("span",{className:"text-gray-600",children:"to"}),e.jsx("input",{type:"date",value:r.end,onChange:c=>a({...r,end:c.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6 hover:border-blue-300 hover:shadow-md transition-all",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center text-blue-600 mb-4",children:c.icon}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:c.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:c.description}),e.jsx("button",{onClick:()=>i(c.type),disabled:t===c.type,className:`w-full px-4 py-2 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${t===c.type?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:t===c.type?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ja,{className:"w-4 h-4"}),"Generate Report"]})})]},c.id))})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center text-white flex-shrink-0",children:e.jsx(Yt,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Report Features"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Customizable date ranges for any reporting period"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Export to CSV format for further analysis"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Historical report storage and retrieval"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Automated scheduling available for regular reports"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full"}),"Comprehensive data aggregation from multiple sources"]})]})]})]})})]})}function kN(){const[t,s]=x.useState({maintenanceMode:!1,signupsEnabled:!0,ridesEnabled:!0,paymentsEnabled:!1,verificationRequired:!0,minTrustScore:50,maxCancellationRate:20,platformFeePercentage:10}),[r,a]=x.useState(!1),[n,i]=x.useState(!1),l=async()=>{a(!0);try{await new Promise(o=>setTimeout(o,1e3)),i(!0),setTimeout(()=>i(!1),3e3)}catch(o){console.error("Error saving settings:",o)}finally{a(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Platform Settings"}),e.jsx("p",{className:"text-gray-600",children:"Configure platform-wide settings and preferences"})]}),e.jsx("button",{onClick:l,disabled:r,className:`px-6 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${n?"bg-green-600 text-white":r?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),"Saved"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ud,{className:"w-4 h-4"}),r?"Saving...":"Save Changes"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(bs,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Platform Status"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Maintenance Mode"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Disable platform access for maintenance"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.maintenanceMode,onChange:o=>s({...t,maintenanceMode:o.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"New Signups"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Allow new user registrations"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.signupsEnabled,onChange:o=>s({...t,signupsEnabled:o.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Ride Posting"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Allow users to post new rides"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.ridesEnabled,onChange:o=>s({...t,ridesEnabled:o.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Payment Processing"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enable payment transactions"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.paymentsEnabled,onChange:o=>s({...t,paymentsEnabled:o.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(me,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Security & Trust"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Verification Required"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Require ID verification for drivers"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.verificationRequired,onChange:o=>s({...t,verificationRequired:o.target.checked}),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-900 mb-2",children:"Minimum Trust Score"}),e.jsx("input",{type:"number",value:t.minTrustScore,onChange:o=>s({...t,minTrustScore:parseInt(o.target.value)}),min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Minimum trust score required to post rides (0-100)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-900 mb-2",children:"Max Cancellation Rate (%)"}),e.jsx("input",{type:"number",value:t.maxCancellationRate,onChange:o=>s({...t,maxCancellationRate:parseInt(o.target.value)}),min:"0",max:"100",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Maximum allowed cancellation rate before restrictions"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($d,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Business Settings"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block font-medium text-gray-900 mb-2",children:"Platform Fee (%)"}),e.jsx("input",{type:"number",value:t.platformFeePercentage,onChange:o=>s({...t,platformFeePercentage:parseInt(o.target.value)}),min:"0",max:"50",step:"0.5",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Percentage fee charged on each ride"})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ad,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Notifications"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-purple-900",children:"Configure notification preferences and channels in the Communication Center"})})})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-6 h-6 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-1",children:"Important Notice"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Changes to these settings take effect immediately. Use caution when modifying platform-wide settings as they affect all users. Consider notifying users before enabling maintenance mode or disabling critical features."})]})]})})]})}function SN(){var b;const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState(null),[i,l]=x.useState([]),[o,c]=x.useState(!0),[d,m]=x.useState(!1),[u,h]=x.useState("overview");x.useEffect(()=>{if(!s){r("/");return}f()},[s,r]);const f=async()=>{m(!0);try{const[N,k,E,C,R,T,M,I,D]=await Promise.all([_.from("profiles").select("id",{count:"exact",head:!0}),_.from("rides").select("id",{count:"exact",head:!0}),_.from("bookings").select("id",{count:"exact",head:!0}),_.from("bookings").select("id",{count:"exact",head:!0}).eq("status","pending"),_.from("bug_reports").select("id",{count:"exact",head:!0}),_.from("rides").select("id",{count:"exact",head:!0}).gte("departure_time",new Date().toISOString()),_.from("profiles").select("id",{count:"exact",head:!0}).gte("created_at",new Date(Date.now()-6048e5).toISOString()),_.from("driver_licenses").select("id",{count:"exact",head:!0}).eq("verified",!1),_.from("vehicle_insurance").select("id",{count:"exact",head:!0}).eq("status","pending")]);n({totalUsers:N.count||0,totalRides:k.count||0,totalBookings:E.count||0,pendingBookings:C.count||0,feedbackCount:R.count||0,activeRides:T.count||0,recentSignups:M.count||0,pendingVerifications:(I.count||0)+(D.count||0)});const F=[],{data:B}=await _.from("profiles").select("full_name, email, created_at").order("created_at",{ascending:!1}).limit(3);B==null||B.forEach($=>{F.push({type:"user",description:`New user: ${$.full_name||"Unknown"}`,timestamp:$.created_at,details:$.email})});const{data:H}=await _.from("rides").select("origin, destination, departure_time, created_at").order("created_at",{ascending:!1}).limit(3);H==null||H.forEach($=>{F.push({type:"ride",description:"New ride posted",timestamp:$.created_at,details:`${$.origin} to ${$.destination}`})});const{data:O}=await _.from("bug_reports").select("text, created_at").order("created_at",{ascending:!1}).limit(2);O==null||O.forEach($=>{F.push({type:"feedback",description:"New feedback received",timestamp:$.created_at,details:$.text.substring(0,50)+($.text.length>50?"...":"")})}),F.sort(($,L)=>new Date(L.timestamp).getTime()-new Date($.timestamp).getTime()),l(F.slice(0,8))}catch(N){console.error("Error fetching dashboard data:",N)}finally{c(!1),m(!1)}},g=N=>{const k=Date.now()-new Date(N).getTime(),E=Math.floor(k/6e4),C=Math.floor(k/36e5),R=Math.floor(k/864e5);return E<60?`${E}m ago`:C<24?`${C}h ago`:`${R}d ago`},j=N=>{switch(N){case"user":return e.jsx(re,{className:"w-4 h-4 text-blue-500"});case"ride":return e.jsx(pe,{className:"w-4 h-4 text-green-500"});case"booking":return e.jsx(de,{className:"w-4 h-4 text-orange-500"});case"feedback":return e.jsx(Nt,{className:"w-4 h-4 text-teal-500"})}};if(!s)return null;const w=[{label:"Total Users",value:(a==null?void 0:a.totalUsers)||0,icon:re,color:"blue",link:"/admin/users"},{label:"Active Rides",value:(a==null?void 0:a.activeRides)||0,icon:pe,color:"green",subtext:`${(a==null?void 0:a.totalRides)||0} total`},{label:"Verifications",value:(a==null?void 0:a.pendingVerifications)||0,icon:ee,color:"orange",link:"/admin/verifications",highlight:((a==null?void 0:a.pendingVerifications)||0)>0},{label:"Feedback",value:(a==null?void 0:a.feedbackCount)||0,icon:Nt,color:"teal",link:"/admin/feedback"},{label:"New This Week",value:(a==null?void 0:a.recentSignups)||0,icon:Fe,color:"green"}],v={blue:"bg-blue-50 text-blue-600 border-blue-100",green:"bg-green-50 text-green-600 border-green-100",orange:"bg-orange-50 text-orange-600 border-orange-100",teal:"bg-teal-50 text-teal-600 border-teal-100"},p=[{id:"overview",label:"Overview",icon:la},{id:"moderation",label:"Content Moderation",icon:Gs},{id:"audit",label:"Audit Logs",icon:Ye},{id:"reports",label:"Advanced Reports",icon:Yt},{id:"settings",label:"Settings",icon:Fg}],y=()=>{switch(u){case"moderation":return e.jsx(wN,{});case"audit":return e.jsx(NN,{});case"reports":return e.jsx(_N,{});case"settings":return e.jsx(kN,{});default:return null}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/"),className:"p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(la,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsxs("p",{className:"text-gray-500",children:["Welcome back, ",(b=t==null?void 0:t.email)==null?void 0:b.split("@")[0]]})]})]}),e.jsxs("button",{onClick:f,disabled:d,className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Oe,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto",children:p.map(N=>e.jsxs("button",{onClick:()=>h(N.id),className:`flex items-center gap-2 px-4 py-3 border-b-2 transition-colors whitespace-nowrap ${u===N.id?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:[e.jsx(N.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:N.label})]},N.id))})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:o&&u==="overview"?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"})}):u!=="overview"?e.jsx("div",{className:"py-4",children:y()}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8",children:w.map(N=>e.jsxs("div",{className:`bg-white rounded-xl p-4 border shadow-sm hover:shadow-md transition-all ${N.link?"cursor-pointer":""} ${N.highlight?"ring-2 ring-orange-400 ring-offset-2":""}`,onClick:()=>N.link&&r(N.link),children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center mb-3 ${v[N.color]}`,children:e.jsx(N.icon,{className:"w-5 h-5"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:N.value}),e.jsx("p",{className:"text-sm text-gray-500",children:N.label}),N.subtext&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:N.subtext}),N.highlight&&N.value>0&&e.jsx("p",{className:"text-xs text-orange-600 font-medium mt-1",children:"Needs attention"})]},N.label))}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Activity"}),e.jsx(ye,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:i.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No recent activity"}):i.map((N,k)=>e.jsxs("div",{className:"px-6 py-4 flex items-center gap-4 hover:bg-gray-50",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center",children:j(N.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 truncate",children:N.description}),N.details&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:N.details})]}),e.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:g(N.timestamp)})]},k))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ie,{to:"/admin/verifications",className:`flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group ${((a==null?void 0:a.pendingVerifications)||0)>0?"bg-orange-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-5 h-5 text-orange-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Verification Queue"}),((a==null?void 0:a.pendingVerifications)||0)>0&&e.jsx("span",{className:"px-2 py-0.5 bg-orange-500 text-white text-xs font-bold rounded-full",children:a==null?void 0:a.pendingVerifications})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/analytics",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Tn,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Advanced Analytics"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/activity",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(bs,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Live Activity Monitor"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/diagnostics",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Me,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"System Diagnostics"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/feedback",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Nt,{className:"w-5 h-5 text-teal-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"User Feedback"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/users",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Bd,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"User Management"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/bulk-operations",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(tl,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Bulk Operations"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]}),e.jsxs(Ie,{to:"/admin/performance",className:"flex items-center justify-between p-3 rounded-lg hover:bg-gray-50 transition-colors group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Dg,{className:"w-5 h-5 text-indigo-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Performance Monitor"})]}),e.jsx(Ss,{className:"w-5 h-5 text-gray-400 group-hover:text-gray-600"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ne,{className:"w-6 h-6"}),e.jsx("h3",{className:"font-semibold",children:"System Status"})]}),e.jsx("p",{className:"text-blue-100 text-sm mb-4",children:"Run diagnostics to check all system components and integrations."}),e.jsxs(Ie,{to:"/admin/diagnostics",className:"inline-flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-colors",children:[e.jsx(Me,{className:"w-4 h-4"}),"Run Health Check"]})]})]})]})]})})]})}function CN(){const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[o,c]=x.useState(""),[d,m]=x.useState(null),[u,h]=x.useState("created_at"),[f,g]=x.useState("desc");x.useEffect(()=>{if(!s){r("/");return}j()},[s,r,u,f]);const j=async()=>{l(!0);const{data:y,error:b}=await _.from("profiles").select("*").order(u,{ascending:f==="asc"});if(b){console.error("Error fetching users:",b),l(!1);return}const N=await Promise.all((y||[]).map(async k=>{const[E,C]=await Promise.all([_.from("rides").select("id",{count:"exact",head:!0}).eq("driver_id",k.id),_.from("bookings").select("id",{count:"exact",head:!0}).eq("passenger_id",k.id)]);return{...k,ride_count:E.count||0,booking_count:C.count||0}}));n(N),l(!1)},w=a.filter(y=>{var N,k,E;const b=o.toLowerCase();return((N=y.full_name)==null?void 0:N.toLowerCase().includes(b))||((k=y.email)==null?void 0:k.toLowerCase().includes(b))||((E=y.phone)==null?void 0:E.includes(b))}),v=y=>{u===y?g(f==="asc"?"desc":"asc"):(h(y),g("desc"))},p=y=>new Date(y).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-6xl mx-auto px-4 py-4",children:e.jsxs("button",{onClick:()=>r("/admin"),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{children:"Back to Dashboard"})]})})}),e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsxs("p",{className:"text-gray-600",children:[a.length," registered users"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 mb-6",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:y=>c(y.target.value),placeholder:"Search by name, email, or phone...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>v("full_name"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["User",u==="full_name"&&(f==="asc"?e.jsx(wi,{className:"w-4 h-4"}):e.jsx(Ya,{className:"w-4 h-4"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>v("email"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Contact",u==="email"&&(f==="asc"?e.jsx(wi,{className:"w-4 h-4"}):e.jsx(Ya,{className:"w-4 h-4"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activity"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>v("created_at"),children:e.jsxs("div",{className:"flex items-center gap-1",children:["Joined",u==="created_at"&&(f==="asc"?e.jsx(wi,{className:"w-4 h-4"}):e.jsx(Ya,{className:"w-4 h-4"}))]})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:i?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),"Loading users..."]})}):w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:o?"No users match your search":"No users found"})}):w.map(y=>{var b,N;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer",onClick:()=>m(d===y.id?null:y.id),children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-medium",children:((N=(b=y.full_name)==null?void 0:b.charAt(0))==null?void 0:N.toUpperCase())||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:y.full_name||"No name"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",y.id.substring(0,8),"..."]})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Jt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:y.email})]}),y.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 mt-1",children:[e.jsx(dt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:y.phone})]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(pe,{className:"w-4 h-4 text-green-500"}),e.jsxs("span",{children:[y.ride_count," rides"]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-500"}),e.jsxs("span",{children:[y.booking_count," bookings"]})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:p(y.created_at)})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:y.license_verified?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:[e.jsx(me,{className:"w-3 h-3"}),"Verified"]}):e.jsx("span",{className:"inline-flex items-center px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded-full",children:"Unverified"})})})]},y.id),d===y.id&&e.jsx("tr",{className:"bg-gray-50",children:e.jsx("td",{colSpan:5,className:"px-6 py-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Bio"}),e.jsx("p",{className:"text-sm text-gray-600",children:y.bio||"No bio provided"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Account Details"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:["User ID: ",e.jsx("span",{className:"font-mono text-xs",children:y.id})]}),e.jsxs("p",{children:["Email: ",y.email]}),e.jsxs("p",{children:["Phone: ",y.phone||"Not provided"]}),e.jsxs("p",{children:["Joined: ",new Date(y.created_at).toLocaleString()]})]})]})]})})},`${y.id}-expanded`)]})})})]})})]})]})]}):null}function EN(){const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[o,c]=x.useState(!1),[d,m]=x.useState(null);x.useEffect(()=>{if(!s){r("/");return}u()},[s,r]);const u=async()=>{c(!0);try{const{data:g,error:j}=await _.from("bug_reports").select("*").order("created_at",{ascending:!1});if(j)throw j;n(g||[])}catch(g){console.error("Error fetching bug reports:",g)}finally{l(!1),c(!1)}},h=async g=>{if(confirm("Delete this bug report?")){m(g);try{const{error:j}=await _.from("bug_reports").delete().eq("id",g);if(j)throw j;n(w=>w.filter(v=>v.id!==g))}catch(j){console.error("Error deleting bug report:",j)}finally{m(null)}}},f=g=>new Date(g).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/admin"),className:"p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(bn,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Bug Reports"}),e.jsxs("p",{className:"text-gray-500",children:[a.length," reports"]})]})]}),e.jsxs("button",{onClick:u,disabled:o,className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(Oe,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"Refresh"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[i?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"w-12 h-12 border-4 border-red-600 border-t-transparent rounded-full animate-spin"})}):a.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(bn,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No bug reports"}),e.jsx("p",{className:"text-gray-500",children:"No problems have been reported yet."})]}):e.jsx("div",{className:"space-y-4",children:a.map(g=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm",children:[e.jsx(Id,{className:"w-3 h-3"}),g.page||"/"]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ye,{className:"w-3 h-3"}),f(g.created_at)]})]}),e.jsx("p",{className:"text-gray-900 whitespace-pre-wrap",children:g.text}),e.jsxs("div",{className:"mt-3 text-xs text-gray-400",children:["ID: ",g.id.slice(0,8),"..."]})]}),e.jsx("button",{onClick:()=>h(g.id),disabled:d===g.id,className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete report",children:d===g.id?e.jsx("div",{className:"w-5 h-5 border-2 border-red-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Ns,{className:"w-5 h-5"})})]})},g.id))}),a.length>0&&e.jsxs("div",{className:"mt-8 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Admin-only access"}),e.jsx("p",{children:"Bug reports are only visible to and can only be created by the admin account."})]})]})]})]}):null}function RN(){const{user:t,isAdmin:s}=X(),r=ie(),[a,n]=x.useState([]),[i,l]=x.useState([]),[o,c]=x.useState(!0),[d,m]=x.useState("all"),[u,h]=x.useState(null),[f,g]=x.useState(!1),[j,w]=x.useState(""),[v,p]=x.useState(!1);x.useEffect(()=>{if(!s){r("/");return}y()},[s,r]);const y=async()=>{c(!0);try{const[M,I]=await Promise.all([_.from("driver_licenses").select(`
            *,
            profiles!driver_licenses_user_id_fkey (
              full_name,
              email,
              profile_photo_url
            )
          `).eq("verified",!1).order("created_at",{ascending:!1}),_.from("vehicle_insurance").select(`
            *,
            profiles!vehicle_insurance_user_id_fkey (
              full_name,
              email
            ),
            vehicles!vehicle_insurance_vehicle_id_fkey (
              make,
              model,
              registration
            )
          `).eq("status","pending").order("created_at",{ascending:!1})]);if(M.error)throw M.error;if(I.error)throw I.error;n(M.data||[]),l(I.data||[])}catch(M){console.error("Error fetching pending verifications:",M)}finally{c(!1)}},b=async M=>{p(!0);try{const{error:I}=await _.from("driver_licenses").update({verified:!0,verified_at:new Date().toISOString(),verification_method:"manual"}).eq("id",M);if(I)throw I;const{error:D}=await _.from("license_verification_attempts").insert({license_id:M,attempt_type:"manual_review",status:"success"});D&&console.error("Error logging verification attempt:",D),n(F=>F.filter(B=>B.id!==M)),g(!1),h(null)}catch(I){console.error("Error approving license:",I),alert("Failed to approve license verification")}finally{p(!1)}},N=async M=>{if(!j.trim()){alert("Please provide a rejection reason");return}p(!0);try{const{error:I}=await _.from("license_verification_attempts").insert({license_id:M,attempt_type:"manual_review",status:"failed",error_message:j});if(I)throw I;n(D=>D.filter(F=>F.id!==M)),g(!1),h(null),w("")}catch(I){console.error("Error rejecting license:",I),alert("Failed to reject license verification")}finally{p(!1)}},k=async M=>{p(!0);try{const{error:I}=await _.from("vehicle_insurance").update({status:"active",updated_at:new Date().toISOString()}).eq("id",M);if(I)throw I;l(D=>D.filter(F=>F.id!==M)),g(!1),h(null)}catch(I){console.error("Error approving insurance:",I),alert("Failed to approve insurance verification")}finally{p(!1)}},E=async M=>{if(!j.trim()){alert("Please provide a rejection reason");return}p(!0);try{const{error:I}=await _.from("vehicle_insurance").update({status:"rejected",rejection_reason:j,updated_at:new Date().toISOString()}).eq("id",M);if(I)throw I;l(D=>D.filter(F=>F.id!==M)),g(!1),h(null),w("")}catch(I){console.error("Error rejecting insurance:",I),alert("Failed to reject insurance verification")}finally{p(!1)}},C=(M,I)=>{h({...M,type:I}),g(!0),w("")},R=()=>{g(!1),h(null),w("")},T=a.length+i.length;return o?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>r("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Verification Queue"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[T," pending verification",T!==1?"s":""]})]})]}),e.jsx(me,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex space-x-2 mb-6 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>m("all"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="all"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["All (",T,")"]}),e.jsxs("button",{onClick:()=>m("licenses"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="licenses"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["Driver Licenses (",a.length,")"]}),e.jsxs("button",{onClick:()=>m("insurance"),className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${d==="insurance"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:["Vehicle Insurance (",i.length,")"]})]}),T===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[e.jsx(ee,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"All caught up!"}),e.jsx("p",{className:"text-gray-600",children:"No pending verifications at the moment."})]}):e.jsxs("div",{className:"space-y-4",children:[(d==="all"||d==="licenses")&&a.map(M=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(Yt,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Driver License Verification"}),e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full",children:"Pending"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:M.profiles.full_name}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:M.profiles.email})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Yt,{className:"w-4 h-4"}),e.jsxs("span",{children:["License: ",M.license_number]}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{className:"capitalize",children:M.license_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{children:["Expires: ",new Date(M.expiry_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Submitted: ",new Date(M.created_at).toLocaleString()]})]})]})]})]}),e.jsxs("button",{onClick:()=>C(M,"license"),className:"ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Review"})]})]})},M.id)),(d==="all"||d==="insurance")&&i.map(M=>e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(pe,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Vehicle Insurance Verification"}),e.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded-full",children:"Pending"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:M.profiles.full_name}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:M.profiles.email})]}),M.vehicles&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsxs("span",{children:[M.vehicles.make," ",M.vehicles.model," - ",M.vehicles.registration]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsxs("span",{children:["Policy: ",M.policy_number]}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:M.provider})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{children:["Expires: ",new Date(M.expiry_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Submitted: ",new Date(M.created_at).toLocaleString()]})]})]})]})]}),e.jsxs("button",{onClick:()=>C(M,"insurance"),className:"ml-4 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Review"})]})]})},M.id))]})]}),f&&u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:u.type==="license"?"Driver License Verification":"Insurance Verification"}),e.jsx("button",{onClick:R,className:"text-gray-400 hover:text-gray-600",disabled:v,children:e.jsx(Qe,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"p-6 space-y-6",children:u.type==="license"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User"}),e.jsx("p",{className:"text-gray-900",children:u.profiles.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.profiles.email})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"License Number"}),e.jsx("p",{className:"text-gray-900 font-mono",children:u.license_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"License Type"}),e.jsx("p",{className:"text-gray-900 capitalize",children:u.license_type.replace("_"," ")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Country of Issue"}),e.jsx("p",{className:"text-gray-900",children:u.country_of_issue})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Issue Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(u.issue_date).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(u.expiry_date).toLocaleDateString()}),new Date(u.expiry_date)<new Date&&e.jsxs("p",{className:"text-red-600 text-sm mt-1 flex items-center space-x-1",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"License has expired"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason (if rejecting)"}),e.jsx("textarea",{value:j,onChange:M=>w(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Provide a detailed reason for rejection...",disabled:v})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"User"}),e.jsx("p",{className:"text-gray-900",children:u.profiles.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:u.profiles.email})]}),u.vehicles&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vehicle"}),e.jsxs("p",{className:"text-gray-900",children:[u.vehicles.make," ",u.vehicles.model]}),e.jsx("p",{className:"text-sm text-gray-600",children:u.vehicles.registration})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Policy Number"}),e.jsx("p",{className:"text-gray-900 font-mono",children:u.policy_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provider"}),e.jsx("p",{className:"text-gray-900",children:u.provider})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Coverage Type"}),e.jsx("p",{className:"text-gray-900 capitalize",children:u.coverage_type.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expiry Date"}),e.jsx("p",{className:"text-gray-900",children:new Date(u.expiry_date).toLocaleDateString()}),new Date(u.expiry_date)<new Date&&e.jsxs("p",{className:"text-red-600 text-sm mt-1 flex items-center space-x-1",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Insurance has expired"})]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rejection Reason (if rejecting)"}),e.jsx("textarea",{value:j,onChange:M=>w(M.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",rows:3,placeholder:"Provide a detailed reason for rejection...",disabled:v})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-4",children:[e.jsx("button",{onClick:R,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:v,children:"Cancel"}),e.jsxs("button",{onClick:()=>u.type==="license"?N(u.id):E(u.id),className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",disabled:v,children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:v?"Rejecting...":"Reject"})]}),e.jsxs("button",{onClick:()=>u.type==="license"?b(u.id):k(u.id),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2",disabled:v,children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:v?"Approving...":"Approve"})]})]})]})})]})}function PN(){const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState(!0);x.useState(null);const[l,o]=x.useState("all"),[c,d]=x.useState("all"),[m,u]=x.useState(""),[h,f]=x.useState(!1);x.useEffect(()=>{if(!t){s("/");return}g()},[t,l,c]);const g=async()=>{i(!0);try{let N=_.from("safety_reports").select("*").order("priority",{ascending:!1}).order("created_at",{ascending:!1});l!=="all"&&(N=N.eq("status",l)),c!=="all"&&(N=N.eq("severity",c));const{data:k,error:E}=await N;if(E)throw E;a(k||[])}catch(N){console.error("Error loading reports:",N)}finally{i(!1)}},j=async(N,k)=>{var E,C;try{const{error:R}=await _.from("safety_reports").update({status:k,updated_at:new Date().toISOString()}).eq("id",N);if(R)throw R;await _.from("safety_actions_log").insert({action_type:"status_changed",action_description:`Report status changed to ${k}`,report_id:N,performed_by:(E=(await _.auth.getUser()).data.user)==null?void 0:E.id,performed_by_name:"Admin",details:{old_status:(C=r.find(T=>T.id===N))==null?void 0:C.status,new_status:k}}),g(),alert("Report status updated successfully")}catch(R){console.error("Error updating report:",R),alert("Failed to update report status")}},w=N=>{switch(N){case"critical":return"bg-red-100 text-red-800 border-red-300";case"high":return"bg-orange-100 text-orange-800 border-orange-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"low":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},v=N=>{switch(N){case"resolved":return"bg-green-100 text-green-800";case"investigating":return"bg-blue-100 text-blue-800";case"under_review":return"bg-yellow-100 text-yellow-800";case"dismissed":return"bg-gray-100 text-gray-800";case"escalated":return"bg-red-100 text-red-800";default:return"bg-orange-100 text-orange-800"}},p=N=>{switch(N){case"harassment":return e.jsx(Ce,{className:"w-5 h-5"});case"unsafe_driving":return e.jsx(me,{className:"w-5 h-5"});case"violence":return e.jsx(ne,{className:"w-5 h-5"});default:return e.jsx(Gs,{className:"w-5 h-5"})}},y=r.filter(N=>{var k,E,C;return((k=N.title)==null?void 0:k.toLowerCase().includes(m.toLowerCase()))||((E=N.description)==null?void 0:E.toLowerCase().includes(m.toLowerCase()))||((C=N.reported_user_name)==null?void 0:C.toLowerCase().includes(m.toLowerCase()))}),b={total:r.length,pending:r.filter(N=>N.status==="pending").length,investigating:r.filter(N=>N.status==="investigating"||N.status==="under_review").length,critical:r.filter(N=>N.severity==="critical").length};return n?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Safety Reports"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage and review safety incidents"})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Reports"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:b.total})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Gs,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-1",children:b.pending})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Investigating"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:b.investigating})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Mt,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Critical"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-1",children:b.critical})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-red-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search reports...",value:m,onChange:N=>u(N.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("button",{onClick:()=>f(!h),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ld,{className:"w-5 h-5"}),"Filters",e.jsx(Ya,{className:`w-4 h-4 transition-transform ${h?"rotate-180":""}`})]})]}),h&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:l,onChange:N=>o(N.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"investigating",children:"Investigating"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"dismissed",children:"Dismissed"}),e.jsx("option",{value:"escalated",children:"Escalated"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Severity"}),e.jsxs("select",{value:c,onChange:N=>d(N.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Severity"}),e.jsx("option",{value:"critical",children:"Critical"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(me,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No reports found"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Try adjusting your filters"})]}):y.map(N=>{var k,E,C;return e.jsxs("div",{className:`bg-white rounded-xl border-2 p-6 hover:shadow-lg transition-all cursor-pointer ${N.severity==="critical"?"border-red-300 bg-red-50":N.severity==="high"?"border-orange-300":"border-gray-200"}`,onClick:()=>s(`/admin/safety/report/${N.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`p-3 rounded-full ${w(N.severity)}`,children:p(N.category||N.incident_type)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:N.title||`Report #${N.id.slice(0,8)}`}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${w(N.severity)}`,children:((k=N.severity)==null?void 0:k.toUpperCase())||"MEDIUM"}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${v(N.status)}`,children:((C=(E=N.status)==null?void 0:E.replace("_"," "))==null?void 0:C.toUpperCase())||"PENDING"})]}),e.jsx("p",{className:"text-gray-700 mb-3 line-clamp-2",children:N.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(kt,{className:"w-4 h-4"}),"Reported: ",N.reported_user_name||"Unknown User"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),new Date(N.created_at).toLocaleDateString()]}),N.incident_location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),N.incident_location]}),e.jsxs("span",{className:"flex items-center gap-1 font-medium text-blue-600",children:["Priority: ",N.priority||0]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:R=>{R.stopPropagation(),s(`/admin/safety/report/${N.id}`)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"View Details",children:e.jsx(Ye,{className:"w-5 h-5 text-gray-600"})})})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:R=>{R.stopPropagation(),j(N.id,"investigating")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Start Investigation"}),e.jsx("button",{onClick:R=>{R.stopPropagation(),j(N.id,"resolved")},className:"px-4 py-2 border border-green-600 text-green-600 rounded-lg hover:bg-green-50 transition-colors text-sm font-medium",children:"Mark Resolved"}),e.jsx("button",{onClick:R=>{R.stopPropagation(),j(N.id,"dismissed")},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Dismiss"})]})]},N.id)})})]})}function TN(){var L,V,S,U;const{reportId:t}=_l(),s=ie(),{user:r,isAdmin:a}=X(),[n,i]=x.useState(null),[l,o]=x.useState(null),[c,d]=x.useState(!0),[m,u]=x.useState(!1),[h,f]=x.useState(!1),[g,j]=x.useState(!1),[w,v]=x.useState(""),[p,y]=x.useState(""),[b,N]=x.useState("7"),[k,E]=x.useState("temporary"),[C,R]=x.useState(""),[T,M]=x.useState("1");x.useEffect(()=>{if(!a){s("/admin");return}t&&I()},[t,a]);const I=async()=>{try{const{data:P,error:A}=await _.from("safety_reports").select("*").eq("id",t).single();if(A)throw A;if(i(P),P.reported_user_id){const[W,z,Y,Z]=await Promise.all([_.from("safety_reports").select("id",{count:"exact",head:!0}).eq("reported_user_id",P.reported_user_id),_.from("safety_warnings").select("id",{count:"exact",head:!0}).eq("user_id",P.reported_user_id).eq("acknowledged",!1),_.from("user_suspensions").select("id",{count:"exact",head:!0}).eq("user_id",P.reported_user_id).eq("is_active",!0),_.from("safety_reports").select("*").eq("reported_user_id",P.reported_user_id).neq("id",t).order("created_at",{ascending:!1}).limit(5)]);o({total_reports_against:W.count||0,active_warnings:z.count||0,suspensions:Y.count||0,previous_incidents:Z.data||[]})}}catch(P){console.error("Error loading report:",P)}finally{d(!1)}},D=async P=>{try{const{error:A}=await _.from("safety_reports").update({status:P,updated_at:new Date().toISOString()}).eq("id",t);if(A)throw A;await _.from("safety_actions_log").insert({action_type:"status_changed",action_description:`Report status changed to ${P}`,report_id:t,performed_by:r==null?void 0:r.id,performed_by_name:"Admin"}),I(),alert("Report status updated")}catch(A){console.error("Error updating status:",A),alert("Failed to update status")}},F=async()=>{if(!w.trim()){alert("Please provide resolution notes");return}try{const{error:P}=await _.from("safety_reports").update({status:"resolved",resolution_notes:w,resolved_by:r==null?void 0:r.id,resolved_at:new Date().toISOString()}).eq("id",t);if(P)throw P;await _.from("safety_actions_log").insert({action_type:"report_reviewed",action_description:"Report resolved with notes",report_id:t,performed_by:r==null?void 0:r.id,performed_by_name:"Admin",details:{resolution_notes:w}}),alert("Report resolved successfully"),I(),v("")}catch(P){console.error("Error resolving report:",P),alert("Failed to resolve report")}},B=async()=>{if(!p.trim()){alert("Please provide a suspension reason");return}try{const P=k==="permanent"?null:new Date(Date.now()+parseInt(b)*24*60*60*1e3).toISOString(),{data:A,error:W}=await _.from("user_suspensions").insert({user_id:n==null?void 0:n.reported_user_id,suspension_type:k,reason:p,admin_notes:`Related to report ${t}`,end_date:P,report_ids:[t],suspended_by:r==null?void 0:r.id}).select().single();if(W)throw W;await _.from("safety_actions_log").insert({action_type:"user_suspended",action_description:`User suspended for ${b} days`,report_id:t,user_id:n==null?void 0:n.reported_user_id,suspension_id:A.id,performed_by:r==null?void 0:r.id,performed_by_name:"Admin"}),alert("User suspended successfully"),u(!1),I()}catch(P){console.error("Error suspending user:",P),alert("Failed to suspend user")}},H=async()=>{if(!C.trim()){alert("Please provide a warning message");return}try{const{error:P}=await _.from("safety_warnings").insert({user_id:n==null?void 0:n.reported_user_id,warning_level:parseInt(T),warning_type:(n==null?void 0:n.category)||"general",message:C,report_id:t,issued_by:r==null?void 0:r.id});if(P)throw P;await _.from("safety_actions_log").insert({action_type:"user_warned",action_description:`Level ${T} warning issued`,report_id:t,user_id:n==null?void 0:n.reported_user_id,performed_by:r==null?void 0:r.id,performed_by_name:"Admin"}),alert("Warning issued successfully"),f(!1),I()}catch(P){console.error("Error issuing warning:",P),alert("Failed to issue warning")}},O=async()=>{try{const P=`INC-${new Date().getFullYear()}-${Math.floor(Math.random()*999999).toString().padStart(6,"0")}`,{error:A}=await _.from("safety_incidents").insert({incident_number:P,title:(n==null?void 0:n.title)||"Safety Incident",description:(n==null?void 0:n.description)||"",severity:(n==null?void 0:n.severity)||"medium",category:(n==null?void 0:n.category)||"other",reported_user_id:n==null?void 0:n.reported_user_id,related_report_ids:[t],investigator_id:r==null?void 0:r.id,investigation_started_at:new Date().toISOString()});if(A)throw A;await _.from("safety_actions_log").insert({action_type:"incident_created",action_description:`Created incident ${P}`,report_id:t,performed_by:r==null?void 0:r.id,performed_by_name:"Admin"}),alert("Incident created successfully"),j(!1),D("investigating")}catch(P){console.error("Error creating incident:",P),alert("Failed to create incident")}};if(c)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})});if(!n)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-600",children:"Report not found"})});const $=P=>{switch(P){case"critical":return"bg-red-100 text-red-800 border-red-300";case"high":return"bg-orange-100 text-orange-800 border-orange-300";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"low":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin/safety"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Safety Report Details"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Report ID: ",n.id.slice(0,8)]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-bold border-2 ${$(n.severity)}`,children:(L=n.severity)==null?void 0:L.toUpperCase()}),e.jsx("span",{className:"px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:(S=(V=n.status)==null?void 0:V.replace("_"," "))==null?void 0:S.toUpperCase()})]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:["Priority: ",n.priority]})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:n.title||"Untitled Report"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(kt,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Reported User"}),e.jsx("p",{className:"font-medium",children:n.reported_user_name||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Submitted"}),e.jsx("p",{className:"font-medium",children:new Date(n.created_at).toLocaleString()})]})]}),n.incident_location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Location"}),e.jsx("p",{className:"font-medium",children:n.incident_location})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Gs,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),e.jsx("p",{className:"font-medium capitalize",children:((U=n.category)==null?void 0:U.replace("_"," "))||"General"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:n.description})]}),n.resolution_notes&&e.jsxs("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-green-900 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Resolution Notes"]}),e.jsx("p",{className:"text-green-800",children:n.resolution_notes}),n.resolved_at&&e.jsxs("p",{className:"text-sm text-green-600 mt-2",children:["Resolved on ",new Date(n.resolved_at).toLocaleString()]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Actions"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>f(!0),className:"flex items-center justify-center gap-2 px-4 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Issue Warning"]}),e.jsxs("button",{onClick:()=>u(!0),className:"flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:[e.jsx(Pg,{className:"w-5 h-5"}),"Suspend User"]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center justify-center gap-2 px-4 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:[e.jsx(Gs,{className:"w-5 h-5"}),"Create Incident"]}),e.jsxs("button",{onClick:()=>D("investigating"),className:"flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(Nt,{className:"w-5 h-5"}),"Start Investigation"]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Resolve Report"}),e.jsx("textarea",{value:w,onChange:P=>v(P.target.value),placeholder:"Enter resolution notes...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:4}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsx("button",{onClick:F,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium",children:"Resolve Report"}),e.jsx("button",{onClick:()=>D("dismissed"),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Dismiss"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Reporter Information"}),e.jsx("div",{className:"space-y-3",children:n.reporter_anonymous?e.jsx("p",{className:"text-gray-600 italic",children:"Anonymous Report"}):e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Reporter"}),e.jsx("p",{className:"font-medium",children:n.reporter_name||"System"})]})})})]}),l&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"User History"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total Reports Against"}),e.jsx("span",{className:"font-bold text-red-600",children:l.total_reports_against})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Active Warnings"}),e.jsx("span",{className:"font-bold text-orange-600",children:l.active_warnings})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Suspensions"}),e.jsx("span",{className:"font-bold text-red-600",children:l.suspensions})]})]}),l.previous_incidents.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-2",children:"Previous Incidents"}),e.jsx("div",{className:"space-y-2",children:l.previous_incidents.map(P=>e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-gray-700",children:P.title||"Incident"}),e.jsx("p",{className:"text-gray-500 text-xs",children:new Date(P.created_at).toLocaleDateString()})]},P.id))})]})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Suspend User"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Suspension Type"}),e.jsxs("select",{value:k,onChange:P=>E(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"temporary",children:"Temporary"}),e.jsx("option",{value:"permanent",children:"Permanent"}),e.jsx("option",{value:"pending_review",children:"Pending Review"})]})]}),k==="temporary"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (days)"}),e.jsx("input",{type:"number",value:b,onChange:P=>N(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),e.jsx("textarea",{value:p,onChange:P=>y(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",rows:4,placeholder:"Explain the reason for suspension..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:B,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium",children:"Suspend User"}),e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"})]})]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Issue Warning"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warning Level"}),e.jsxs("select",{value:T,onChange:P=>M(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"1",children:"Level 1 - Minor"}),e.jsx("option",{value:"2",children:"Level 2 - Serious"}),e.jsx("option",{value:"3",children:"Level 3 - Final Warning"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Warning Message"}),e.jsx("textarea",{value:C,onChange:P=>R(P.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",rows:4,placeholder:"Enter warning message for user..."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:H,className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium",children:"Issue Warning"}),e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"})]})]})}),g&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Create Safety Incident"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"This will create a formal incident record and start an investigation. The report will be linked to the incident."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:O,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium",children:"Create Incident"}),e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"})]})]})})]})}function AN(){const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState(null),[n,i]=x.useState([]),[l,o]=x.useState([]),[c,d]=x.useState([]),[m,u]=x.useState(!0);x.useEffect(()=>{if(!t){s("/admin");return}h()},[t]);const h=async()=>{try{const g=new Date(Date.now()-6048e5).toISOString(),j=new Date(Date.now()-14*24*60*60*1e3).toISOString(),[w,v,p,y,b,N,k,E,C,R]=await Promise.all([_.from("safety_reports").select("id",{count:"exact",head:!0}),_.from("safety_reports").select("id",{count:"exact",head:!0}).eq("status","pending"),_.from("safety_reports").select("id",{count:"exact",head:!0}).eq("status","resolved"),_.from("safety_reports").select("id",{count:"exact",head:!0}).eq("severity","critical"),_.from("user_suspensions").select("id",{count:"exact",head:!0}).eq("is_active",!0),_.from("safety_warnings").select("id",{count:"exact",head:!0}),_.from("safety_reports").select("id",{count:"exact",head:!0}).gte("created_at",g),_.from("safety_reports").select("id",{count:"exact",head:!0}).gte("created_at",j).lt("created_at",g),_.from("safety_reports").select("severity").then(({data:D})=>{const F={};return D==null||D.forEach(B=>{F[B.severity]=(F[B.severity]||0)+1}),Object.entries(F).map(([B,H])=>({severity:B,count:H}))}),_.from("safety_reports").select("category").then(({data:D})=>{const F={};return D==null||D.forEach(B=>{const H=B.category||"other";F[H]=(F[H]||0)+1}),Object.entries(F).map(([B,H])=>({category:B,count:H}))})]);a({total_reports:w.count||0,pending_reports:v.count||0,resolved_reports:p.count||0,critical_reports:y.count||0,active_suspensions:b.count||0,total_warnings:N.count||0,avg_resolution_time:0,reports_this_week:k.count||0,reports_last_week:E.count||0}),i(C),o(R);const M=Array.from({length:7},(D,F)=>new Date(Date.now()-F*24*60*60*1e3).toISOString().split("T")[0]).reverse().map(async D=>{const F=new Date(new Date(D).getTime()+864e5).toISOString().split("T")[0],{count:B}=await _.from("safety_reports").select("id",{count:"exact",head:!0}).gte("created_at",D).lt("created_at",F);return{date:D,count:B||0}}),I=await Promise.all(M);d(I)}catch(g){console.error("Error loading metrics:",g)}finally{u(!1)}};if(m)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})});const f=r?(r.reports_this_week-r.reports_last_week)/(r.reports_last_week||1)*100:0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Safety Metrics"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive safety and moderation analytics"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Reports"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:(r==null?void 0:r.total_reports)||0}),e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[f>=0?e.jsx(Fe,{className:"w-4 h-4 text-red-600"}):e.jsx(ca,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:`text-sm font-medium ${f>=0?"text-red-600":"text-green-600"}`,children:[Math.abs(f).toFixed(1),"% vs last week"]})]})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Tn,{className:"w-6 h-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 mt-1",children:(r==null?void 0:r.pending_reports)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Awaiting review"})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Critical"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 mt-1",children:(r==null?void 0:r.critical_reports)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"High priority"})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(Ce,{className:"w-6 h-6 text-red-600"})})]})}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Active Suspensions"}),e.jsx("p",{className:"text-3xl font-bold text-purple-600 mt-1",children:(r==null?void 0:r.active_suspensions)||0}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Currently banned"})]}),e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx(Pg,{className:"w-6 h-6 text-purple-600"})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"7-Day Trend"]}),e.jsx("div",{className:"flex items-end justify-between gap-2 h-48",children:c.map((g,j)=>{const w=Math.max(...c.map(p=>p.count),1),v=g.count/w*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex items-end justify-center",style:{height:"180px"},children:e.jsx("div",{className:"w-full bg-blue-500 rounded-t-lg transition-all hover:bg-blue-600 cursor-pointer relative group",style:{height:`${v}%`,minHeight:g.count>0?"10px":"0"},children:e.jsx("span",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-sm font-medium text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",children:g.count})})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:new Date(g.date).toLocaleDateString("en-US",{weekday:"short"})})]},j)})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Reports by Severity"}),e.jsx("div",{className:"space-y-4",children:n.map(g=>{const j=n.reduce((y,b)=>y+(b.count||0),0),w=j>0?(g.count||0)/j*100:0,v={critical:{bg:"bg-red-500",text:"text-red-600"},high:{bg:"bg-orange-500",text:"text-orange-600"},medium:{bg:"bg-yellow-500",text:"text-yellow-600"},low:{bg:"bg-blue-500",text:"text-blue-600"}},p=v[g.severity]||v.low;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:`font-medium capitalize ${p.text}`,children:g.severity}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.count," (",w.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${p.bg}`,style:{width:`${w}%`}})})]},g.severity)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Reports by Category"}),e.jsx("div",{className:"space-y-3",children:l.slice(0,6).map(g=>{var v;const j=l.reduce((p,y)=>p+(y.count||0),0),w=j>0?(g.count||0)/j*100:0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-700 capitalize text-sm",children:(v=g.category)==null?void 0:v.replace("_"," ")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-blue-500",style:{width:`${w}%`}})}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-12 text-right",children:g.count})]})]},g.category)})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Resolved Reports"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(r==null?void 0:r.resolved_reports)||0})]})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-700",children:"Total Warnings"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:(r==null?void 0:r.total_warnings)||0})]})]})}),e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"This Week"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:(r==null?void 0:r.reports_this_week)||0})]})]})})]})]})}function DN(){const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState(!0),[n,i]=x.useState("30d"),[l,o]=x.useState(!1),[c,d]=x.useState([]),[m,u]=x.useState([]),[h,f]=x.useState([]),[g,j]=x.useState([]),[w,v]=x.useState([]),[p,y]=x.useState([]),[b,N]=x.useState(null),[k,E]=x.useState(null);x.useEffect(()=>{if(!t){s("/admin");return}C()},[t,n]);const C=async()=>{a(!0);try{const I=parseInt(n.replace("d","")),[D,F,B,H,O,$,L]=await Promise.all([_.rpc("get_user_growth",{period_days:I}),_.rpc("get_peak_times"),_.rpc("get_booking_funnel",{period_days:I}),_.from("popular_routes").select("*"),_.rpc("get_geographic_distribution"),_.from("ride_completion_stats").select("*").single(),_.from("booking_success_metrics").select("*").single()]);D.data&&d(D.data.map(V=>({label:new Date(V.date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:V.new_users}))),F.data&&u(F.data.map(V=>({label:`${V.hour_of_day}:00`,value:V.ride_count}))),B.data&&f(B.data),H.data&&j(H.data),O.data&&v(O.data),$.data&&N($.data),L.data&&E(L.data),l&&await R(I)}catch(I){console.error("Error loading analytics:",I)}finally{a(!1)}},R=async I=>{const D=new Date,F=new Date(D.getTime()-I*24*60*60*1e3),B=F,H=new Date(B.getTime()-I*24*60*60*1e3),{data:O}=await _.rpc("get_period_comparison",{current_start:F.toISOString().split("T")[0],current_end:D.toISOString().split("T")[0],previous_start:H.toISOString().split("T")[0],previous_end:B.toISOString().split("T")[0]});O&&y(O)},T=(I,D)=>{if(!I||I.length===0)return;const F=Object.keys(I[0]),B=[F.join(","),...I.map(L=>F.map(V=>L[V]).join(","))].join(`
`),H=new Blob([B],{type:"text/csv"}),O=window.URL.createObjectURL(H),$=document.createElement("a");$.href=O,$.download=`${D}-${new Date().toISOString().split("T")[0]}.csv`,$.click()},M=[{label:"Ride Completion Rate",value:`${(b==null?void 0:b.completion_rate)||0}%`,change:5.2,icon:e.jsx(ee,{className:"w-6 h-6"}),color:"bg-green-100 text-green-600"},{label:"Booking Confirmation Rate",value:`${(k==null?void 0:k.confirmation_rate)||0}%`,change:3.1,icon:e.jsx(Me,{className:"w-6 h-6"}),color:"bg-blue-100 text-blue-600"},{label:"Total Rides",value:(b==null?void 0:b.total_rides)||0,change:-2.4,icon:e.jsx(pe,{className:"w-6 h-6"}),color:"bg-orange-100 text-orange-600"},{label:"User Growth",value:c.length>0?c[c.length-1].value:0,change:8.7,icon:e.jsx(re,{className:"w-6 h-6"}),color:"bg-purple-100 text-purple-600"}];return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Advanced Analytics"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive platform insights and metrics"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:()=>T(g,"popular-routes"),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(ja,{className:"w-5 h-5"}),"Export Data"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Time Range:"}),e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d"].map(I=>e.jsx("button",{onClick:()=>i(I),className:`px-4 py-2 rounded-lg font-medium transition-colors ${n===I?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:I==="7d"?"7 Days":I==="30d"?"30 Days":"90 Days"},I))})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:I=>{o(I.target.checked),I.target.checked&&R(parseInt(n.replace("d","")))},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Enable Period Comparison"})]})]})}),e.jsx("div",{className:"grid md:grid-cols-4 gap-4",children:M.map((I,D)=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:`p-3 rounded-lg ${I.color}`,children:I.icon}),I.change!==void 0&&e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${I.change>=0?"text-green-600":"text-red-600"}`,children:[I.change>=0?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(ca,{className:"w-4 h-4"}),Math.abs(I.change),"%"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:I.label}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:I.value})]},D))}),l&&p.length>0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Tn,{className:"w-5 h-5"}),"Period-over-Period Comparison"]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:p.map((I,D)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:I.metric}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.current_value}),e.jsx("span",{className:"text-sm text-gray-500",children:"current"})]}),e.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:I.previous_value}),e.jsx("span",{className:"text-sm text-gray-500",children:"previous"})]}),e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${I.change_percentage>=0?"text-green-600":"text-red-600"}`,children:[I.change_percentage>=0?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(ca,{className:"w-4 h-4"}),Math.abs(I.change_percentage).toFixed(1),"%"]})]},D))})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"User Growth Trend"]}),e.jsx("button",{onClick:()=>T(c,"user-growth"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Export"})]}),e.jsx("div",{className:"flex items-end justify-between gap-2 h-64",children:c.slice(-14).map((I,D)=>{const F=Math.max(...c.map(H=>H.value)),B=F>0?I.value/F*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex items-end justify-center",style:{height:"230px"},children:e.jsx("div",{className:"w-full bg-blue-500 rounded-t-lg transition-all hover:bg-blue-600 cursor-pointer relative group",style:{height:`${B}%`,minHeight:I.value>0?"8px":"0"},children:e.jsx("span",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:I.value})})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2 -rotate-45 origin-top-left",children:I.label})]},D)})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Peak Ride Times"]}),e.jsx("button",{onClick:()=>T(m,"peak-times"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Export"})]}),e.jsx("div",{className:"flex items-end justify-between gap-1 h-64",children:m.map((I,D)=>{const F=Math.max(...m.map(H=>H.value)),B=F>0?I.value/F*100:0;return e.jsxs("div",{className:"flex-1 flex flex-col items-center",children:[e.jsx("div",{className:"w-full flex items-end justify-center",style:{height:"230px"},children:e.jsx("div",{className:"w-full bg-orange-500 rounded-t-lg transition-all hover:bg-orange-600 cursor-pointer relative group",style:{height:`${B}%`,minHeight:I.value>0?"8px":"0"},children:e.jsx("span",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-medium text-gray-700 opacity-0 group-hover:opacity-100 transition-opacity",children:I.value})})}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:I.label.split(":")[0]})]},D)})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Booking Conversion Funnel"]}),e.jsx("button",{onClick:()=>T(h,"booking-funnel"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Export"})]}),e.jsx("div",{className:"space-y-4",children:h.map((I,D)=>{const F=["bg-blue-500","bg-green-500","bg-orange-500","bg-purple-500"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:I.stage}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl font-bold text-gray-900",children:I.count}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["(",I.percentage,"%)"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${F[D%F.length]} transition-all`,style:{width:`${I.percentage}%`}})})]},D)})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Popular Routes"]}),e.jsx("button",{onClick:()=>T(g,"popular-routes"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Export"})]}),e.jsx("div",{className:"space-y-3",children:g.slice(0,10).map((I,D)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-gray-900 text-sm",children:[I.origin,"  ",I.destination]}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[I.unique_drivers," drivers  Avg ",I.avg_seats," seats"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-blue-600",children:I.ride_count}),e.jsx("p",{className:"text-xs text-gray-500",children:"rides"})]})]},D))})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Geographic Distribution"]}),e.jsx("button",{onClick:()=>T(w,"geo-distribution"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"Export"})]}),e.jsx("div",{className:"space-y-3",children:w.slice(0,10).map((I,D)=>{const F=Math.max(...w.map(H=>H.ride_count)),B=F>0?I.ride_count/F*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:I.location}),e.jsx("span",{className:"text-sm font-bold text-gray-900",children:I.ride_count})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-blue-500",style:{width:`${B}%`}})})]},D)})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-green-900 mb-4 flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Ride Statistics (Last 30 Days)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Completed"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(b==null?void 0:b.completed_rides)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Cancelled"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(b==null?void 0:b.cancelled_rides)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(b==null?void 0:b.active_rides)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Scheduled"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:(b==null?void 0:b.scheduled_rides)||0})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-semibold text-blue-900 mb-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Booking Statistics (Last 30 Days)"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Confirmed"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(k==null?void 0:k.confirmed_bookings)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(k==null?void 0:k.pending_bookings)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Cancelled"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(k==null?void 0:k.cancelled_bookings)||0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:(k==null?void 0:k.total_bookings)||0})]})]})]})]})]})}function $N(){const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState([]),[l,o]=x.useState({active_users:0,online_drivers:0,ongoing_rides:0,pending_bookings:0,active_alerts:0,recent_activities:0}),[c,d]=x.useState(!0),[m,u]=x.useState(!1),[h,f]=x.useState(!0),[g,j]=x.useState("all"),[w,v]=x.useState("all"),[p,y]=x.useState(""),[b,N]=x.useState(!0),k=x.useRef(null),E=x.useRef(null),C=x.useRef(null);x.useEffect(()=>{if(!t){s("/admin");return}R(),D();const P=setInterval(()=>{b&&!m&&I()},1e4);return()=>{clearInterval(P),F()}},[t,m,b]);const R=async()=>{d(!0);try{await Promise.all([T(),M(),I()])}catch(P){console.error("Error loading data:",P)}finally{d(!1)}},T=async()=>{const{data:P,error:A}=await _.from("activity_logs").select("*").order("created_at",{ascending:!1}).limit(100);P&&!A&&a(P)},M=async()=>{const{data:P,error:A}=await _.from("critical_alerts").select("*").eq("status","active").order("created_at",{ascending:!1});P&&!A&&i(P)},I=async()=>{const{data:P,error:A}=await _.rpc("get_live_metrics");P&&!A&&P.length>0&&o(P[0])},D=()=>{k.current=_.channel("activity_logs_channel").on("postgres_changes",{event:"INSERT",schema:"public",table:"activity_logs"},P=>{if(!m){const A=P.new;a(W=>[A,...W.slice(0,99)]),h&&(A.severity==="critical"||A.severity==="error")&&B(),I()}}).subscribe(),E.current=_.channel("critical_alerts_channel").on("postgres_changes",{event:"*",schema:"public",table:"critical_alerts"},P=>{if(P.eventType==="INSERT"){const A=P.new;i(W=>[A,...W]),h&&B()}else P.eventType==="UPDATE"?i(A=>A.map(W=>W.id===P.new.id?P.new:W)):P.eventType==="DELETE"&&i(A=>A.filter(W=>W.id!==P.old.id));I()}).subscribe()},F=()=>{k.current&&_.removeChannel(k.current),E.current&&_.removeChannel(E.current)},B=()=>{C.current&&C.current.play().catch(()=>{})},H=async P=>{const{error:A}=await _.rpc("acknowledge_alert",{p_alert_id:P});A||i(W=>W.map(z=>z.id===P?{...z,status:"acknowledged"}:z))},O=async P=>{const{error:A}=await _.rpc("resolve_alert",{p_alert_id:P});A||i(W=>W.filter(z=>z.id!==P))},$=()=>{const P=["Timestamp,Type,Severity,Actor,Action,Description",...L.map(Y=>`${Y.created_at},${Y.activity_type},${Y.severity},${Y.actor_name||"System"},${Y.action},"${Y.description}"`)].join(`
`),A=new Blob([P],{type:"text/csv"}),W=window.URL.createObjectURL(A),z=document.createElement("a");z.href=W,z.download=`activity-log-${new Date().toISOString()}.csv`,z.click()},L=r.filter(P=>{var Y;const A=g==="all"||P.activity_type===g,W=w==="all"||P.severity===w,z=!p||P.description.toLowerCase().includes(p.toLowerCase())||P.action.toLowerCase().includes(p.toLowerCase())||((Y=P.actor_name)==null?void 0:Y.toLowerCase().includes(p.toLowerCase()));return A&&W&&z}),V=P=>{switch(P){case"critical":return"bg-red-100 text-red-800 border-red-200";case"error":return"bg-orange-100 text-orange-800 border-orange-200";case"warning":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},S=P=>{switch(P){case"user":return e.jsx(re,{className:"w-4 h-4"});case"ride":return e.jsx(pe,{className:"w-4 h-4"});case"booking":return e.jsx(ee,{className:"w-4 h-4"});case"security":return e.jsx(Ce,{className:"w-4 h-4"});case"system":return e.jsx(Me,{className:"w-4 h-4"});default:return e.jsx(Me,{className:"w-4 h-4"})}},U=P=>{const A=Math.floor((new Date().getTime()-new Date(P).getTime())/1e3);return A<60?`${A}s ago`:A<3600?`${Math.floor(A/60)}m ago`:A<86400?`${Math.floor(A/3600)}h ago`:`${Math.floor(A/86400)}d ago`};return c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsx("audio",{ref:C,src:"data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGS56+OdTgwOUKXh8bllHgU2jdXyzn0vBSh+zPDckjwKElyx6OyrWBQLRp3e8r1nIQYsgc/y2Ik2CBZgsunlm08MDlGl4fG5ZiAFNo/W8tCAMAUrfsrv3I4+ChFbs+jtrVoVDEae3vK8aCAFLIDP8tiKNQcVYbHo5JxPDA5RpuHxuWYgBTaO1vLOf2YgBS6Az/LYizcHE19Z6+SbTgwPUajh8bdnFApGnNzzwW0hBSyA0O+dTwxQvr+"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(bs,{className:"w-8 h-8 text-blue-600"}),"Live Activity Monitor"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time platform operations and events"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>f(!h),className:`p-2 rounded-lg transition-colors ${h?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600"}`,title:h?"Disable sound":"Enable sound",children:h?e.jsx(Ad,{className:"w-5 h-5"}):e.jsx(yj,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:()=>u(!m),className:`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-colors ${m?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:[m?e.jsx(Fd,{className:"w-5 h-5"}):e.jsx(Mg,{className:"w-5 h-5"}),m?"Resume":"Pause"]}),e.jsx("button",{onClick:R,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Oe,{className:"w-5 h-5"})}),e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(ja,{className:"w-5 h-5"}),"Export"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(re,{className:"w-6 h-6 text-blue-600"}),b&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Active Users"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:l.active_users}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Last 15 min"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(pe,{className:"w-6 h-6 text-green-600"}),b&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Online Drivers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:l.online_drivers}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Active now"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Me,{className:"w-6 h-6 text-orange-600"}),b&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-orange-700 mb-1",children:"Ongoing Rides"}),e.jsx("p",{className:"text-2xl font-bold text-orange-900",children:l.ongoing_rides}),e.jsx("p",{className:"text-xs text-orange-600 mt-1",children:"In progress"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ye,{className:"w-6 h-6 text-purple-600"}),b&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Pending Bookings"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:l.pending_bookings}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"Awaiting action"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-red-100 border border-red-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ce,{className:"w-6 h-6 text-red-600"}),l.active_alerts>0&&e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-red-700 mb-1",children:"Active Alerts"}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:l.active_alerts}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Needs attention"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Fe,{className:"w-6 h-6 text-gray-600"}),b&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-1",children:"Recent Activities"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.recent_activities}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Last hour"})]})]}),n.length>0&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ne,{className:"w-6 h-6 text-red-600"}),e.jsxs("h2",{className:"text-xl font-bold text-red-900",children:["Critical Alerts (",n.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:n.map(P=>e.jsx("div",{className:"bg-white border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${P.severity==="critical"?"bg-red-600 text-white":P.severity==="error"?"bg-orange-500 text-white":"bg-yellow-500 text-white"}`,children:P.severity.toUpperCase()}),e.jsx("span",{className:"text-sm text-gray-500",children:P.alert_type}),e.jsx("span",{className:"text-sm text-gray-500",children:""}),e.jsx("span",{className:"text-sm text-gray-500",children:U(P.created_at)})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:P.title}),e.jsx("p",{className:"text-gray-700 text-sm",children:P.description})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[P.status==="active"&&e.jsx("button",{onClick:()=>H(P.id),className:"px-3 py-1 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-sm font-medium",children:"Acknowledge"}),e.jsx("button",{onClick:()=>O(P.id),className:"px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm font-medium",children:"Resolve"})]})]})},P.id))})]}),e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ld,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:"Filters:"})]}),e.jsxs("select",{value:g,onChange:P=>j(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"user",children:"Users"}),e.jsx("option",{value:"ride",children:"Rides"}),e.jsx("option",{value:"booking",children:"Bookings"}),e.jsx("option",{value:"security",children:"Security"}),e.jsx("option",{value:"system",children:"System"})]}),e.jsxs("select",{value:w,onChange:P=>v(P.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"critical",children:"Critical"})]}),e.jsx("div",{className:"flex-1 min-w-[300px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:P=>y(P.target.value),placeholder:"Search activities...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:P=>N(P.target.checked),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Auto-refresh (10s)"})]})]})}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"Activity Feed",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",L.length," events)"]})]})}),e.jsx("div",{className:"divide-y divide-gray-200 max-h-[600px] overflow-y-auto",children:L.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Me,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No activities match your filters"})]}):L.map(P=>e.jsx("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${V(P.severity)}`,children:S(P.activity_type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:P.action}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${V(P.severity)}`,children:P.severity}),e.jsx("span",{className:"text-sm text-gray-500",children:""}),e.jsx("span",{className:"text-sm text-gray-500",children:P.activity_type})]}),e.jsx("p",{className:"text-gray-700 text-sm mb-2",children:P.description}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),P.actor_name||"System"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),U(P.created_at)]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"View details",children:e.jsx(Ye,{className:"w-4 h-4 text-gray-600"})})})]})},P.id))})]})]})}function IN(){const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState([]),[n,i]=x.useState(!0),[l,o]=x.useState("new"),[c,d]=x.useState("users"),[m,u]=x.useState(""),[h,f]=x.useState(""),[g,j]=x.useState([]),[w,v]=x.useState([]),[p,y]=x.useState(!1),[b,N]=x.useState(!1),[k,E]=x.useState(""),[C,R]=x.useState(""),[T,M]=x.useState("info");x.useEffect(()=>{if(!t){s("/admin");return}I()},[t]);const I=async()=>{i(!0);try{const{data:A,error:W}=await _.from("bulk_operations").select("*").order("created_at",{ascending:!1}).limit(50);A&&!W&&a(A)}catch(A){console.error("Error loading operations:",A)}finally{i(!1)}},D=async()=>{i(!0);try{let A;switch(c){case"users":A=_.from("profiles").select("id, full_name, email, status, created_at").limit(100);break;case"rides":A=_.from("rides").select("id, origin, destination, status, departure_time, driver_id").limit(100);break;case"bookings":A=_.from("ride_bookings").select("id, ride_id, passenger_id, status, seats_requested").limit(100);break;default:return}h&&(c==="users"?A=A.or(`full_name.ilike.%${h}%,email.ilike.%${h}%`):c==="rides"&&(A=A.or(`origin.ilike.%${h}%,destination.ilike.%${h}%`)));const{data:W,error:z}=await A;W&&!z&&v(W)}catch(A){console.error("Error loading preview:",A)}finally{i(!1)}};x.useEffect(()=>{l==="new"&&D()},[c,h,l]);const F=()=>{g.length===w.length?j([]):j(w.map(A=>A.id))},B=A=>{j(W=>W.includes(A)?W.filter(z=>z!==A):[...W,A])},H=()=>{if(g.length===0){alert("Please select at least one item");return}if(!m){alert("Please select an action");return}if(c==="notifications"&&(!k||!C)){alert("Please enter notification title and message");return}y(!0)},O=async()=>{if(confirm(`Are you sure you want to execute this operation on ${g.length} items?`)){N(!0);try{let A="",W="";switch(c){case"users":A=`Bulk User ${m}`,W=`${m} action on ${g.length} users`;break;case"rides":A=`Bulk Ride ${m}`,W=`${m} action on ${g.length} rides`;break;case"bookings":A=`Bulk Booking ${m}`,W=`${m} action on ${g.length} bookings`;break;case"notifications":A="Bulk Notification",W=`Send notification to ${g.length} users`;break}const{data:z,error:Y}=await _.rpc("create_bulk_operation",{p_operation_type:c,p_operation_name:A,p_description:W,p_target_ids:g,p_parameters:{}});if(Y)throw Y;const Z=z;let ae;switch(c){case"users":({error:ae}=await _.rpc("execute_bulk_user_action",{p_operation_id:Z,p_action:m,p_parameters:{}}));break;case"rides":({error:ae}=await _.rpc("execute_bulk_ride_action",{p_operation_id:Z,p_action:m,p_parameters:{}}));break;case"bookings":({error:ae}=await _.rpc("execute_bulk_booking_action",{p_operation_id:Z,p_action:m,p_parameters:{}}));break;case"notifications":({error:ae}=await _.rpc("send_bulk_notifications",{p_operation_id:Z,p_title:k,p_message:C,p_notification_type:T}));break}if(ae)throw ae;alert("Bulk operation completed successfully!"),y(!1),j([]),u(""),E(""),R(""),I()}catch(A){console.error("Error executing operation:",A),alert(`Error: ${A.message}`)}finally{N(!1)}}},$=()=>{const A=["Type,Action,Status,Target Count,Success,Failed,Created,Completed",...r.map(Z=>`${Z.operation_type},${Z.operation_name},${Z.status},${Z.target_count},${Z.success_count},${Z.failed_count},${Z.created_at},${Z.completed_at||"N/A"}`)].join(`
`),W=new Blob([A],{type:"text/csv"}),z=window.URL.createObjectURL(W),Y=document.createElement("a");Y.href=z,Y.download=`bulk-operations-${new Date().toISOString()}.csv`,Y.click()},L=A=>{switch(A){case"completed":return"bg-green-100 text-green-800 border-green-200";case"failed":return"bg-red-100 text-red-800 border-red-200";case"running":return"bg-blue-100 text-blue-800 border-blue-200";case"partially_completed":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"cancelled":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},V=A=>{switch(A){case"completed":return e.jsx(ee,{className:"w-4 h-4"});case"failed":return e.jsx(Qe,{className:"w-4 h-4"});case"running":return e.jsx(ye,{className:"w-4 h-4 animate-spin"});case"partially_completed":return e.jsx(Ce,{className:"w-4 h-4"});default:return e.jsx(ye,{className:"w-4 h-4"})}},S=()=>[{value:"activate",label:"Activate Users",icon:e.jsx(ee,{className:"w-4 h-4"})},{value:"deactivate",label:"Deactivate Users",icon:e.jsx(Qe,{className:"w-4 h-4"})},{value:"suspend",label:"Suspend Users",icon:e.jsx(Ban,{className:"w-4 h-4"})},{value:"verify",label:"Verify Users",icon:e.jsx(me,{className:"w-4 h-4"})},{value:"unverify",label:"Unverify Users",icon:e.jsx(me,{className:"w-4 h-4"})},{value:"reset_trust_score",label:"Reset Trust Score",icon:e.jsx(Oe,{className:"w-4 h-4"})}],U=()=>[{value:"cancel",label:"Cancel Rides",icon:e.jsx(Qe,{className:"w-4 h-4"})},{value:"complete",label:"Complete Rides",icon:e.jsx(ee,{className:"w-4 h-4"})},{value:"flag_review",label:"Flag for Review",icon:e.jsx(Ce,{className:"w-4 h-4"})}],P=()=>[{value:"cancel",label:"Cancel Bookings",icon:e.jsx(Qe,{className:"w-4 h-4"})},{value:"confirm",label:"Confirm Bookings",icon:e.jsx(ee,{className:"w-4 h-4"})},{value:"complete",label:"Complete Bookings",icon:e.jsx(ee,{className:"w-4 h-4"})}];return n&&r.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(tl,{className:"w-8 h-8 text-blue-600"}),"Bulk Operations"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Efficient mass management of users, rides, and data"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:$,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:[e.jsx(ja,{className:"w-5 h-5"}),"Export History"]}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Oe,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>o("new"),className:`px-6 py-3 font-medium transition-colors border-b-2 ${l==="new"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-5 h-5"}),"New Operation"]})}),e.jsx("button",{onClick:()=>o("history"),className:`px-6 py-3 font-medium transition-colors border-b-2 ${l==="history"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Operation History (",r.length,")"]})})]}),l==="new"?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>d("users"),className:`p-6 rounded-xl border-2 transition-all ${c==="users"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(re,{className:`w-8 h-8 mb-3 ${c==="users"?"text-blue-600":"text-gray-600"}`}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"User Operations"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage users in bulk"})]}),e.jsxs("button",{onClick:()=>d("rides"),className:`p-6 rounded-xl border-2 transition-all ${c==="rides"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(pe,{className:`w-8 h-8 mb-3 ${c==="rides"?"text-blue-600":"text-gray-600"}`}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ride Operations"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage rides in bulk"})]}),e.jsxs("button",{onClick:()=>d("bookings"),className:`p-6 rounded-xl border-2 transition-all ${c==="bookings"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(de,{className:`w-8 h-8 mb-3 ${c==="bookings"?"text-blue-600":"text-gray-600"}`}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Booking Operations"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage bookings in bulk"})]}),e.jsxs("button",{onClick:()=>d("notifications"),className:`p-6 rounded-xl border-2 transition-all ${c==="notifications"?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Ad,{className:`w-8 h-8 mb-3 ${c==="notifications"?"text-blue-600":"text-gray-600"}`}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Send Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Message multiple users"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Configure Operation"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.length," of ",w.length," selected"]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Action"}),e.jsxs("select",{value:m,onChange:A=>u(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose an action..."}),c==="users"&&S().map(A=>e.jsx("option",{value:A.value,children:A.label},A.value)),c==="rides"&&U().map(A=>e.jsx("option",{value:A.value,children:A.label},A.value)),c==="bookings"&&P().map(A=>e.jsx("option",{value:A.value,children:A.label},A.value))]})]}),c==="notifications"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Title"}),e.jsx("input",{type:"text",value:k,onChange:A=>E(A.target.value),placeholder:"Enter notification title",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Message"}),e.jsx("textarea",{value:C,onChange:A=>R(A.target.value),placeholder:"Enter notification message",rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notification Type"}),e.jsxs("select",{value:T,onChange:A=>M(A.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"success",children:"Success"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Mt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:h,onChange:A=>f(A.target.value),placeholder:`Search ${c}...`,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("button",{onClick:F,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:g.length===w.length?"Deselect All":"Select All"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing ",w.length," items"]})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg max-h-96 overflow-y-auto",children:w.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(tl,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No items found"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:w.map(A=>e.jsxs("label",{className:"flex items-center gap-3 p-4 hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.includes(A.id),onChange:()=>B(A.id),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[c==="users"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium text-gray-900",children:A.full_name}),e.jsx("p",{className:"text-sm text-gray-600",children:A.email}),e.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded-full text-xs ${A.status==="active"?"bg-green-100 text-green-800":A.status==="inactive"?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"}`,children:A.status})]}),c==="rides"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[A.origin,"  ",A.destination]}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(A.departure_time).toLocaleString()}),e.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded-full text-xs ${A.status==="active"?"bg-green-100 text-green-800":A.status==="completed"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:A.status})]}),c==="bookings"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["Booking #",A.id.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[A.seats_requested," seat(s)"]}),e.jsx("span",{className:`inline-block mt-1 px-2 py-0.5 rounded-full text-xs ${A.status==="confirmed"?"bg-green-100 text-green-800":A.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:A.status})]})]})]},A.id))})}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{j([]),u("")},className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Clear Selection"}),e.jsxs("button",{onClick:H,disabled:g.length===0||!m,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ye,{className:"w-5 h-5"}),"Preview & Execute"]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Yt,{className:"w-5 h-5"}),"Operation History"]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:r.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Yt,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No operations found"})]}):r.map(A=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:A.operation_name}),e.jsxs("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium border ${L(A.status)}`,children:[V(A.status),A.status]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:A.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Total: ",e.jsx("span",{className:"font-medium text-gray-900",children:A.target_count})]}),e.jsxs("span",{className:"text-green-600",children:["Success: ",e.jsx("span",{className:"font-medium",children:A.success_count})]}),e.jsxs("span",{className:"text-red-600",children:["Failed: ",e.jsx("span",{className:"font-medium",children:A.failed_count})]}),e.jsxs("span",{className:"text-gray-600",children:["Progress: ",e.jsxs("span",{className:"font-medium text-gray-900",children:[A.target_count>0?Math.round(A.processed_count/A.target_count*100):0,"%"]})]})]})]}),e.jsxs("div",{className:"text-right text-sm text-gray-600",children:[e.jsx("p",{children:new Date(A.created_at).toLocaleString()}),A.completed_at&&e.jsxs("p",{className:"text-xs mt-1",children:["Completed: ",new Date(A.completed_at).toLocaleString()]})]})]})},A.id))})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Confirm Bulk Operation"})}),e.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Warning"}),e.jsxs("p",{className:"text-sm text-yellow-800 mt-1",children:["This operation will affect ",g.length," items and cannot be easily undone. Please review carefully before proceeding."]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Operation Type:"}),e.jsx("span",{className:"font-medium text-gray-900",children:c})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Action:"}),e.jsx("span",{className:"font-medium text-gray-900",children:m})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Target Items:"}),e.jsx("span",{className:"font-medium text-gray-900",children:g.length})]}),c==="notifications"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Title:"}),e.jsx("span",{className:"font-medium text-gray-900",children:k})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-2 mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Message:"}),e.jsx("p",{className:"text-sm text-gray-900",children:C})]})]})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>y(!1),disabled:b,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:b,className:"flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-5 h-5 animate-spin"}),"Executing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fd,{className:"w-5 h-5"}),"Execute Operation"]})})]})]})})]})}let LN=class{constructor(){this.metricsBuffer=[],this.flushInterval=3e4,this.maxBufferSize=50,this.startAutoFlush(),this.setupPerformanceObserver()}track(s){this.metricsBuffer.push(s),this.metricsBuffer.length>=this.maxBufferSize&&this.flush()}async flush(){if(this.metricsBuffer.length===0)return;const s=[...this.metricsBuffer];this.metricsBuffer=[];try{for(const r of s)await _.rpc("track_performance_metric",{p_metric_type:r.metricType,p_metric_name:r.metricName,p_value:r.value,p_unit:r.unit||"ms",p_endpoint:r.endpoint||null,p_metadata:r.metadata||{}})}catch(r){console.error("Failed to flush performance metrics:",r)}}startAutoFlush(){setInterval(()=>this.flush(),this.flushInterval)}setupPerformanceObserver(){if(!(typeof window>"u"||!window.PerformanceObserver))try{new PerformanceObserver(r=>{for(const a of r.getEntries()){if(a.entryType==="navigation"){const n=a;this.track({metricType:"page_load",metricName:"dom_content_loaded",value:n.domContentLoadedEventEnd-n.domContentLoadedEventStart,endpoint:window.location.pathname}),this.track({metricType:"page_load",metricName:"full_page_load",value:n.loadEventEnd-n.loadEventStart,endpoint:window.location.pathname})}if(a.entryType==="resource"){const n=a;n.duration>1e3&&this.track({metricType:"network_latency",metricName:"slow_resource",value:n.duration,endpoint:n.name,metadata:{initiatorType:n.initiatorType,transferSize:n.transferSize}})}a.entryType==="measure"&&this.track({metricType:"render_time",metricName:a.name,value:a.duration,endpoint:window.location.pathname})}}).observe({entryTypes:["navigation","resource","measure"]})}catch(s){console.error("Failed to setup performance observer:",s)}}trackRender(s,r){this.track({metricType:"render_time",metricName:s,value:r,endpoint:window.location.pathname})}trackApiCall(s,r,a){this.track({metricType:"api_call",metricName:a?"api_success":"api_error",value:r,endpoint:s,metadata:{success:a}})}trackDatabaseQuery(s,r,a){this.track({metricType:"database_query",metricName:s,value:r,metadata:{rowCount:a}})}async getSystemHealth(){try{const{data:s,error:r}=await _.rpc("get_system_health");if(r)throw r;return s&&s.length>0?s[0]:null}catch(s){return console.error("Failed to get system health:",s),null}}};const MN=new LN;function ON(){var C,R;const{isAdmin:t}=X(),s=ie(),[r,a]=x.useState(null),[n,i]=x.useState([]),[l,o]=x.useState(!0),[c,d]=x.useState("1h");x.useEffect(()=>{if(!t){s("/admin");return}m();const T=setInterval(m,3e4);return()=>clearInterval(T)},[t,c]);const m=async()=>{o(!0);try{const T=await MN.getSystemHealth();a(T);const M=u(),{data:I}=await _.from("performance_metrics").select("*").gte("created_at",M).order("created_at",{ascending:!1}).limit(100);I&&i(I)}catch(T){console.error("Failed to load performance data:",T)}finally{o(!1)}},u=()=>{const T=new Date;switch(c){case"1h":return new Date(T.getTime()-60*60*1e3).toISOString();case"6h":return new Date(T.getTime()-6*60*60*1e3).toISOString();case"24h":return new Date(T.getTime()-24*60*60*1e3).toISOString();case"7d":return new Date(T.getTime()-7*24*60*60*1e3).toISOString();default:return new Date(T.getTime()-60*60*1e3).toISOString()}},h=T=>n.filter(M=>M.metric_type===T),f=T=>T.length===0?0:T.reduce((M,I)=>M+I,0)/T.length,g=T=>{switch(T){case"healthy":return"bg-green-100 text-green-800 border-green-200";case"degraded":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"unhealthy":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},j=T=>{switch(T){case"healthy":return e.jsx(ee,{className:"w-5 h-5 text-green-600"});case"degraded":return e.jsx(ne,{className:"w-5 h-5 text-yellow-600"});case"unhealthy":return e.jsx(ne,{className:"w-5 h-5 text-red-600"});default:return e.jsx(Me,{className:"w-5 h-5 text-gray-600"})}},w=h("page_load"),v=h("api_call"),p=h("database_query"),y=h("render_time"),b=f(w.map(T=>T.value)),N=f(v.map(T=>T.value)),k=f(p.map(T=>T.value)),E=f(y.map(T=>T.value));return l&&!r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full"})}):e.jsxs("div",{className:"space-y-6 pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s("/admin"),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Dg,{className:"w-8 h-8 text-blue-600"}),"Performance Monitor"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time system performance and health metrics"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:c,onChange:T=>d(T.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"1h",children:"Last Hour"}),e.jsx("option",{value:"6h",children:"Last 6 Hours"}),e.jsx("option",{value:"24h",children:"Last 24 Hours"}),e.jsx("option",{value:"7d",children:"Last 7 Days"})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh",children:e.jsx(Oe,{className:"w-5 h-5"})})]})]}),r&&e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Overall Status"}),j(r.overall_status)]}),e.jsx("div",{className:`px-3 py-2 rounded-lg border font-medium ${g(r.overall_status)}`,children:r.overall_status.toUpperCase()})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Database Status"}),e.jsx($d,{className:"w-5 h-5 text-blue-600"})]}),e.jsx("div",{className:`px-3 py-2 rounded-lg border font-medium ${g(r.database_status)}`,children:r.database_status.toUpperCase()})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Recent Errors"}),e.jsx(ne,{className:`w-5 h-5 ${r.recent_errors>10?"text-red-600":"text-gray-400"}`})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:r.recent_errors}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"in the last hour"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Avg Response Time"}),e.jsx(ye,{className:"w-5 h-5 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[((C=r==null?void 0:r.avg_response_time_ms)==null?void 0:C.toFixed(0))||0,e.jsx("span",{className:"text-lg text-gray-600 ml-1",children:"ms"})]}),r&&r.avg_response_time_ms<200?e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-green-600",children:[e.jsx(ca,{className:"w-4 h-4"}),e.jsx("span",{children:"Excellent"})]}):e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-yellow-600",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Could be better"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Cache Hit Rate"}),e.jsx(bs,{className:"w-5 h-5 text-green-600"})]}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[((R=r==null?void 0:r.cache_hit_rate)==null?void 0:R.toFixed(1))||0,e.jsx("span",{className:"text-lg text-gray-600 ml-1",children:"%"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Cache efficiency"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Active Users"}),e.jsx(Me,{className:"w-5 h-5 text-purple-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:(r==null?void 0:r.active_users)||0}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"in the last hour"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"API Calls"}),e.jsx(Og,{className:"w-5 h-5 text-orange-600"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:v.length}),e.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Avg: ",N.toFixed(0),"ms"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600"}),"Performance Metrics"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Page Load Time"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[b.toFixed(0),"ms"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(b/3e3*100,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"API Response Time"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[N.toFixed(0),"ms"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${Math.min(N/1e3*100,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Database Query Time"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[k.toFixed(0),"ms"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${Math.min(k/500*100,100)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Component Render Time"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[E.toFixed(0),"ms"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:`${Math.min(E/100*100,100)}%`}})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recent Metrics"}),e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:n.slice(0,20).map((T,M)=>e.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:T.metric_name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:T.endpoint||T.metric_type})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[T.value.toFixed(0)," ",T.unit]}),e.jsx("p",{className:"text-xs text-gray-600",children:new Date(T.created_at).toLocaleTimeString()})]})]},M))})]})]})]})}class Cr{static async postRide(s,r){try{let a=r.vehicleId;if(!a){const{data:l}=await _.from("vehicles").select("id").eq("user_id",s).eq("is_active",!0).limit(1).maybeSingle();if(!l)return{success:!1,message:"You need to add a vehicle first. Please go to your profile to add a vehicle."};a=l.id}const{data:n,error:i}=await _.from("rides").insert({driver_id:s,vehicle_id:a,origin:r.origin,origin_lat:r.originLat,origin_lng:r.originLng,destination:r.destination,destination_lat:r.destinationLat,destination_lng:r.destinationLng,departure_time:r.departureTime,available_seats:r.availableSeats,total_seats:r.availableSeats,notes:r.notes,status:"active"}).select().single();if(i)throw i;return{success:!0,message:`Ride posted successfully! Your ride from ${r.origin} to ${r.destination} is now available for booking.`,data:n}}catch(a){return console.error("Error posting ride:",a),{success:!1,message:"Failed to post ride. Please try again."}}}static async bookRide(s,r){try{const{data:a,error:n}=await _.from("rides").select("available_seats, driver_id").eq("id",r.rideId).single();if(n||!a)return{success:!1,message:"Ride not found."};if(a.driver_id===s)return{success:!1,message:"You cannot book your own ride."};const i=r.seatsRequested||1;if(a.available_seats<i)return{success:!1,message:`Not enough seats available. Only ${a.available_seats} seat(s) remaining.`};const{data:l,error:o}=await _.from("ride_bookings").insert({ride_id:r.rideId,passenger_id:s,pickup_location:r.pickupLocation,pickup_lat:r.pickupLat,pickup_lng:r.pickupLng,dropoff_location:r.dropoffLocation,dropoff_lat:r.dropoffLat,dropoff_lng:r.dropoffLng,seats_requested:i,status:"pending"}).select().single();if(o)throw o;return{success:!0,message:`Booking request sent! Your booking ID is ${l.id}. The driver will review your request soon.`,data:l}}catch(a){return console.error("Error booking ride:",a),{success:!1,message:"Failed to book ride. Please try again."}}}static async cancelRide(s,r,a){try{const{data:n,error:i}=await _.from("rides").select("*").eq("id",r).eq("driver_id",s).single();if(i||!n)return{success:!1,message:"Ride not found or you do not have permission to cancel it."};if(n.status==="cancelled")return{success:!1,message:"This ride is already cancelled."};const{error:l}=await _.from("rides").update({status:"cancelled"}).eq("id",r);if(l)throw l;return await _.from("ride_bookings").update({status:"cancelled",cancellation_reason:a||"Ride cancelled by driver"}).eq("ride_id",r),{success:!0,message:"Ride cancelled successfully. All bookings have been notified."}}catch(n){return console.error("Error cancelling ride:",n),{success:!1,message:"Failed to cancel ride. Please try again."}}}static async cancelBooking(s,r,a){try{const{error:n}=await _.rpc("cancel_booking",{p_booking_id:r,p_reason:a||"Cancelled by passenger"});if(n){if(n.message.includes("already cancelled"))return{success:!1,message:"This booking is already cancelled."};if(n.message.includes("not found"))return{success:!1,message:"Booking not found or you do not have permission to cancel it."};throw n}return{success:!0,message:"Booking cancelled successfully."}}catch(n){return console.error("Error cancelling booking:",n),{success:!1,message:n.message||"Failed to cancel booking. Please try again."}}}static async updateProfile(s,r){try{const{data:a,error:n}=await _.from("profiles").update({...r,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(n)throw n;return{success:!0,message:"Profile updated successfully!",data:a}}catch(a){return console.error("Error updating profile:",a),{success:!1,message:"Failed to update profile. Please try again."}}}static async addVehicle(s,r){try{const{data:a,error:n}=await _.from("vehicles").insert({user_id:s,...r,is_active:!0}).select().single();if(n)throw n;return{success:!0,message:`Vehicle ${r.make} ${r.model} added successfully!`,data:a}}catch(a){return console.error("Error adding vehicle:",a),{success:!1,message:"Failed to add vehicle. Please try again."}}}static async updateVehicle(s,r,a){try{const{data:n,error:i}=await _.from("vehicles").update({...a,updated_at:new Date().toISOString()}).eq("id",r).eq("user_id",s).select().single();if(i)throw i;return{success:!0,message:"Vehicle updated successfully!",data:n}}catch(n){return console.error("Error updating vehicle:",n),{success:!1,message:"Failed to update vehicle. Please try again."}}}static async updatePreferences(s,r){try{const{data:a}=await _.from("user_preferences").select("*").eq("user_id",s).maybeSingle();let n,i;if(a){const l=await _.from("user_preferences").update({...r,updated_at:new Date().toISOString()}).eq("user_id",s).select().single();n=l.data,i=l.error}else{const l=await _.from("user_preferences").insert({user_id:s,...r}).select().single();n=l.data,i=l.error}if(i)throw i;return{success:!0,message:"Preferences updated successfully!",data:n}}catch(a){return console.error("Error updating preferences:",a),{success:!1,message:"Failed to update preferences. Please try again."}}}}const FN="https://uqofmsreosfjflmgurzb.supabase.co",UN=`${FN}/functions/v1/gemini-proxy`;class bo{static async fetchUserBookings(s){const{data:r,error:a}=await _.from("ride_bookings").select(`
        *,
        ride:rides(
          origin,
          destination,
          departure_time,
          driver:profiles!rides_driver_id_fkey(full_name)
        )
      `).eq("passenger_id",s).order("created_at",{ascending:!1});return a?(console.error("Error fetching bookings:",a),[]):r||[]}static async fetchUserOfferedRides(s){const{data:r,error:a}=await _.from("rides").select("*").eq("driver_id",s).order("departure_time",{ascending:!1});return a?(console.error("Error fetching rides:",a),[]):r||[]}static formatBookingContext(s){if(s.length===0)return"The user has no bookings yet.";const r=s.filter(l=>l.status==="pending"),a=s.filter(l=>l.status==="confirmed"),n=s.filter(l=>l.status==="cancelled");let i=`The user has ${s.length} total booking(s):

`;return r.length>0&&(i+=`PENDING REQUESTS (${r.length}):
`,r.forEach((l,o)=>{i+=`${o+1}. Booking ID: ${l.id}
`,i+=`   Route: ${l.ride.origin}  ${l.ride.destination}
`,i+=`   Pickup: ${l.pickup_location}
`,i+=`   Dropoff: ${l.dropoff_location}
`,i+=`   Seats: ${l.seats_requested}
`,i+=`   Driver: ${l.ride.driver.full_name}
`,i+=`   Departure: ${new Date(l.ride.departure_time).toLocaleString()}
`,i+=`   Requested: ${new Date(l.created_at).toLocaleString()}

`})),a.length>0&&(i+=`CONFIRMED BOOKINGS (${a.length}):
`,a.forEach((l,o)=>{i+=`${o+1}. Booking ID: ${l.id}
`,i+=`   Route: ${l.ride.origin}  ${l.ride.destination}
`,i+=`   Pickup: ${l.pickup_location}
`,i+=`   Dropoff: ${l.dropoff_location}
`,i+=`   Seats: ${l.seats_requested}
`,i+=`   Driver: ${l.ride.driver.full_name}
`,i+=`   Departure: ${new Date(l.ride.departure_time).toLocaleString()}

`})),n.length>0&&(i+=`CANCELLED BOOKINGS (${n.length}):
`,n.forEach((l,o)=>{i+=`${o+1}. Route: ${l.ride.origin}  ${l.ride.destination}
`,i+=`   Cancelled on: ${new Date(l.created_at).toLocaleString()}

`})),i}static formatRideContext(s){if(s.length===0)return"The user has not offered any rides yet.";const r=s.filter(i=>i.status==="active"&&new Date(i.departure_time)>new Date),a=s.filter(i=>new Date(i.departure_time)<=new Date);let n=`The user has offered ${s.length} ride(s):

`;return r.length>0&&(n+=`ACTIVE RIDES (${r.length}):
`,r.forEach((i,l)=>{n+=`${l+1}. Ride ID: ${i.id}
`,n+=`   Route: ${i.origin}  ${i.destination}
`,n+=`   Departure: ${new Date(i.departure_time).toLocaleString()}
`,n+=`   Available Seats: ${i.available_seats}

`})),a.length>0&&(n+=`PAST RIDES (${a.length}):
`,a.forEach((i,l)=>{n+=`${l+1}. ${i.origin}  ${i.destination} on ${new Date(i.departure_time).toLocaleDateString()}
`})),n}static getSystemPrompt(s,r,a,n){const i=new Date,l=i.toISOString().split("T")[0],o=i.toISOString(),c=a||n?`

REAL-TIME TRIP CONDITIONS:
${a||""}
${n||""}
`:"";return`You are a helpful AI assistant for a carpooling platform called Carpool Network (carpoolnetwork.co.uk). Your role is to help users manage their rides and bookings with real-time insights.

CURRENT DATE AND TIME: ${o} (${l})

CURRENT USER'S BOOKINGS:
${s}

CURRENT USER'S OFFERED RIDES:
${r}
${c}

Your capabilities:
1. Show users their current bookings and rides
2. Help users understand booking statuses (pending, confirmed, cancelled)
3. PERFORM ACTIONS: You can actually execute actions for users by responding with special action codes
4. POST RIDES: You can post rides if user provides: origin, destination, date/time, seats available
5. ADD VEHICLES: You can add vehicles if user provides: make, model, year, color, license plate, capacity
6. CANCEL bookings and rides
7. UPDATE user profile and preferences
8. Answer questions about the platform features
9. Explain platform policies and safety features
10. Provide real-time weather and traffic insights for trips
11. Suggest optimal departure times based on traffic patterns
12. Estimate trip costs and fuel consumption
13. Warn about adverse weather or air quality conditions

IMPORTANT - ACTION EXECUTION:
When a user asks you to perform an action, you can execute it by including a special action code in your response.
Available actions:

[ACTION:POST_RIDE:origin,originLat,originLng,destination,destinationLat,destinationLng,departureTime,availableSeats,notes] - Post a new ride
[ACTION:CANCEL_BOOKING:booking_id:reason] - Cancel a booking
[ACTION:CANCEL_RIDE:ride_id:reason] - Cancel a ride they're offering
[ACTION:UPDATE_PROFILE:field1=value1,field2=value2] - Update profile fields
[ACTION:UPDATE_PREFERENCES:field1=value1,field2=value2] - Update ride preferences
[ACTION:ADD_VEHICLE:make,model,year,color,license_plate,capacity,fuel_type,vehicle_type] - Add a vehicle

Examples:
- User: "Post a ride from London to Manchester tomorrow at 9am with 3 seats"  Include [ACTION:POST_RIDE:London,51.5074,-0.1278,Manchester,53.4808,-2.2426,2025-11-18T09:00:00,3,]
- User: "Cancel my booking abc-123"  Include [ACTION:CANCEL_BOOKING:abc-123:User requested] in response
- User: "Update my phone to 07123456789"  Include [ACTION:UPDATE_PROFILE:phone=07123456789]
- User: "Set my music preference to quiet"  Include [ACTION:UPDATE_PREFERENCES:music_preference=quiet]
- User: "Add my car, a 2020 red Toyota Corolla"  Include [ACTION:ADD_VEHICLE:Toyota,Corolla,2020,red,ABC123,4,petrol,sedan]

When including actions:
1. Put the action code on its own line
2. Explain what you're doing in natural language before/after the action
3. The action will be executed automatically
4. Always confirm what was done after the action
5. For POST_RIDE, you MUST get coordinates for origin and destination (use your knowledge or ask user for specific locations)
6. For POST_RIDE, dates should be in ISO 8601 format (YYYY-MM-DDTHH:mm:ss)
7. If user doesn't have a vehicle, inform them they need to add one first or suggest using ADD_VEHICLE action

When discussing trips:
- Consider weather conditions (temperature, rain, wind)
- Factor in traffic patterns and rush hours
- Provide cost estimates based on distance
- Suggest best departure times to avoid delays
- Warn about poor air quality or severe weather

When discussing cancellations:
- Pending requests can be cancelled anytime
- Confirmed bookings can be cancelled, but last-minute cancellations affect reliability score
- Be clear and helpful about the cancellation process

Important guidelines for POSTING RIDES:
- BEFORE posting a ride, you MUST collect ALL required information:
  * Origin location (city/town name)
  * Destination location (city/town name)
  * Departure date and time (be specific - "tomorrow 9am" needs to be converted to full ISO date)
  * Number of available seats
  * Optional: Notes about the trip
- You MUST use realistic coordinates for UK locations. Common examples:
  * London: 51.5074, -0.1278
  * Manchester: 53.4808, -2.2426
  * Birmingham: 52.4862, -1.8904
  * Leeds: 53.8008, -1.5491
  * Glasgow: 55.8642, -4.2518
  * Edinburgh: 55.9533, -3.1883
  * Liverpool: 53.4084, -2.9916
  * Bristol: 51.4545, -2.5879
- If user hasn't provided ALL information, ask for missing details
- ONLY execute POST_RIDE action when you have ALL required information
- Check if user has a vehicle first - if they don't, inform them to add one via Profile page or ask if they want you to add one
- Dates must be in future and in ISO format: YYYY-MM-DDTHH:mm:ss
- "Tomorrow at 9am" = calculate tomorrow's date + 09:00:00
- "Next Monday at 2pm" = calculate next Monday's date + 14:00:00

Important guidelines for general usage:
- Always use the booking/ride data provided above to give accurate, personalized responses
- Use real-time weather and traffic data when available
- If a user asks about trip conditions, provide detailed insights
- If a user wants to cancel, provide the booking ID and ask for confirmation
- Be conversational, friendly, and helpful
- Format responses clearly with proper spacing and bullet points when listing items
- Use proper date/time formatting when showing times
- Proactively mention weather warnings or traffic delays for upcoming trips
- When taking actions, be transparent about what you're doing
- NEVER claim to have done something unless you've included the action code

Remember: You can see their data AND real-time conditions, so be specific and reference actual booking IDs, routes, dates, weather, and traffic.`}static async chat(s,r,a,n,i){try{const{data:{session:l}}=await _.auth.getSession();if(!(l!=null&&l.access_token))return"Please sign in to use the AI assistant.";const[o,c]=await Promise.all([this.fetchUserBookings(a),this.fetchUserOfferedRides(a)]),d=this.formatBookingContext(o),m=this.formatRideContext(c),h=[{role:"user",parts:[{text:this.getSystemPrompt(d,m,n,i)}]},...r.map(j=>({role:j.role==="assistant"?"model":"user",parts:[{text:j.content}]})),{role:"user",parts:[{text:s}]}],f=await fetch(UN,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l.access_token}`},body:JSON.stringify({contents:h,model:"gemini-2.0-flash",generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}})});if(!f.ok){const j=await f.json().catch(()=>({}));if(console.error("Gemini proxy error:",f.status,j),f.status===401)return"Your session has expired. Please sign in again.";throw new Error(`API request failed: ${f.status}`)}const g=await f.json();if(!g.text)throw new Error("Invalid response format from Gemini proxy");return g.text}catch(l){return console.error("Error calling Gemini proxy:",l),"Sorry, I encountered an error processing your request. Please try again."}}static async cancelBooking(s,r,a){try{const{error:n}=await _.rpc("cancel_booking",{p_booking_id:s,p_reason:a||"Cancelled by passenger"});if(n){if(n.message.includes("already cancelled"))return{success:!1,message:"This booking is already cancelled."};if(n.message.includes("not found"))return{success:!1,message:"Booking not found or you do not have permission to cancel it."};throw n}return{success:!0,message:"Booking cancelled successfully."}}catch(n){return console.error("Error cancelling booking:",n),{success:!1,message:"An error occurred while cancelling. Please try again."}}}static async parseAndExecuteActions(s,r){const a=/\[ACTION:([A-Z_]+):([^\]]+)\]/g;let n=s,i=0;const l=[...s.matchAll(a)];for(const o of l){const[c,d,m]=o,u=m.split(":");try{let h;switch(d){case"CANCEL_BOOKING":{const[f,g]=u;h=await Cr.cancelBooking(r,f,g);break}case"CANCEL_RIDE":{const[f,g]=u;h=await Cr.cancelRide(r,f,g);break}case"UPDATE_PROFILE":{const f={};u[0].split(",").forEach(g=>{const[j,w]=g.split("=");f[j.trim()]=w.trim()}),h=await Cr.updateProfile(r,f);break}case"UPDATE_PREFERENCES":{const f={};u[0].split(",").forEach(g=>{const[j,w]=g.split("=");let v=w.trim();v==="true"&&(v=!0),v==="false"&&(v=!1),isNaN(Number(v))||(v=Number(v)),f[j.trim()]=v}),h=await Cr.updatePreferences(r,f);break}case"POST_RIDE":{const[f,g,j,w,v,p,y,b,N]=u[0].split(",");h=await Cr.postRide(r,{origin:f.trim(),originLat:parseFloat(g.trim()),originLng:parseFloat(j.trim()),destination:w.trim(),destinationLat:parseFloat(v.trim()),destinationLng:parseFloat(p.trim()),departureTime:y.trim(),availableSeats:parseInt(b.trim()),notes:(N==null?void 0:N.trim())||void 0});break}case"ADD_VEHICLE":{const[f,g,j,w,v,p,y,b]=u[0].split(",");h=await Cr.addVehicle(r,{make:f.trim(),model:g.trim(),year:parseInt(j.trim()),color:w.trim(),license_plate:v.trim(),capacity:parseInt(p.trim()),fuel_type:(y==null?void 0:y.trim())||void 0,vehicle_type:(b==null?void 0:b.trim())||void 0});break}default:console.log(`Unknown action type: ${d}`);continue}h&&(n=n.replace(c,`

 ${h.message}
`),i++)}catch(h){console.error(`Error executing action ${d}:`,h),n=n.replace(c,`

 Failed to execute action. Please try again.
`)}}return{modifiedResponse:n,actionsExecuted:i}}}function qN(){const{user:t}=X(),[s,r]=x.useState(!1),[a,n]=x.useState([{id:"1",role:"assistant",content:`Hi! I'm your AI assistant for Carpool Network. I can help you:

 View your bookings and rides
 Cancel bookings or rides
 Update your profile
 Change your preferences
 Answer any questions

Just tell me what you'd like to do!`,timestamp:new Date}]),[i,l]=x.useState(""),[o,c]=x.useState(!1),[d,m]=x.useState(null),[u,h]=x.useState(Date.now().toString()),f=x.useRef(null),g=ie(),j=()=>{var k;(k=f.current)==null||k.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{j()},[a]),x.useEffect(()=>{t&&s&&w()},[t,s]);const w=async()=>{if(t)try{const{data:k,error:E}=await _.from("ai_chat_history").select("*").eq("user_id",t.id).eq("session_id",u).order("created_at",{ascending:!0});if(E)throw E;if(k&&k.length>0){const C=k.map(R=>({id:R.id,role:R.role,content:R.message,timestamp:new Date(R.created_at)}));n(C)}}catch(k){console.error("Error loading chat history:",k)}},v=async k=>{if(t)try{await _.from("ai_chat_history").insert({user_id:t.id,message:k.content,role:k.role,session_id:u})}catch(E){console.error("Error saving chat message:",E)}},p=async()=>{if(t)try{await _.from("ai_chat_history").delete().eq("user_id",t.id).eq("session_id",u),n([{id:"1",role:"assistant",content:"Chat history cleared. How can I help you today?",timestamp:new Date}]),h(Date.now().toString())}catch(k){console.error("Error clearing chat history:",k)}},y=async k=>{if(!t){m("Please sign in to use the AI assistant.");return}const E=k||i.trim();if(!E)return;const C={id:Date.now().toString(),role:"user",content:E,timestamp:new Date};n(R=>[...R,C]),l(""),c(!0),m(null),await v(C);try{const R=a.map(F=>({role:F.role,content:F.content}));let T=await bo.chat(E,R,t.id);const{modifiedResponse:M,actionsExecuted:I}=await bo.parseAndExecuteActions(T,t.id);I>0&&(T=M);const D={id:(Date.now()+1).toString(),role:"assistant",content:T,timestamp:new Date};if(n(F=>[...F,D]),await v(D),T.includes("Booking ID:")){const F=T.match(/Booking ID: ([a-f0-9-]+)/i);if(F){const B=F[1];E.toLowerCase().includes("cancel")&&setTimeout(()=>{const H=`Would you like me to cancel booking ${B}? Reply "yes" to confirm.`,O={id:(Date.now()+2).toString(),role:"assistant",content:H,timestamp:new Date};n($=>[...$,O])},500)}}if(E.toLowerCase()==="yes"&&a.length>0){const F=a[a.length-1];if(F.role==="assistant"&&F.content.includes("cancel booking")){const B=F.content.match(/booking ([a-f0-9-]+)/i);B&&await b(B[1])}}}catch(R){console.error("Error getting AI response:",R),m("Failed to get response. Please try again.")}finally{c(!1)}},b=async k=>{if(t){c(!0);try{const E=await bo.cancelBooking(k,t.id),C={id:Date.now().toString(),role:"assistant",content:E.message,timestamp:new Date};n(R=>[...R,C])}catch(E){console.error("Error cancelling booking:",E);const C={id:Date.now().toString(),role:"assistant",content:"Sorry, I encountered an error cancelling your booking. Please try again or visit the My Rides page.",timestamp:new Date};n(R=>[...R,C])}finally{c(!1)}}},N=[{label:"Show my bookings",action:()=>y("Show me all my current bookings")},{label:"View my rides",action:()=>y("Show me the rides I'm offering")},{label:"Find a ride",action:()=>{g("/find-rides"),r(!1)}}];return e.jsxs(e.Fragment,{children:[!s&&e.jsxs("button",{onClick:()=>r(!0),className:"fixed bottom-[100px] md:bottom-6 right-4 md:right-6 z-[90] p-3 md:p-4 bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-full shadow-2xl hover:shadow-blue-500/50 hover:scale-110 transition-all duration-300 group","aria-label":"Open AI chat",style:{pointerEvents:"auto"},children:[e.jsx(wa,{className:"w-5 h-5 md:w-6 md:h-6"}),e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white animate-pulse"})]}),s&&e.jsxs("div",{className:"fixed bottom-[100px] md:bottom-6 right-4 md:right-6 z-[90] w-96 max-w-[calc(100vw-2rem)] h-[500px] max-h-[calc(100vh-15rem)] md:h-[600px] md:max-h-[calc(100vh-2rem)] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(po,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"AI Assistant"}),e.jsx("p",{className:"text-xs text-blue-100",children:"Powered by Gemini"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:p,disabled:!t,className:"p-1 hover:bg-white/10 rounded-lg transition-colors disabled:opacity-50",title:"Clear chat history",children:e.jsx(Ns,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>r(!1),className:"p-1 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(ot,{className:"w-5 h-5"})})]})]}),!t&&e.jsxs("div",{className:"p-4 bg-yellow-50 border-b border-yellow-100 flex items-start gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Please sign in to use the AI assistant with your booking data."})]}),d&&e.jsxs("div",{className:"p-4 bg-red-50 border-b border-red-100 flex items-start gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800",children:d})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:[a.map(k=>e.jsxs("div",{className:`flex gap-2 ${k.role==="assistant"?"justify-start":"justify-end"}`,children:[k.role==="assistant"&&e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(po,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:`max-w-[75%] rounded-2xl px-4 py-2 ${k.role==="assistant"?"bg-white text-gray-900 shadow-sm":"bg-blue-600 text-white"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:k.content}),e.jsx("span",{className:"text-xs opacity-60 mt-1 block",children:k.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),k.role==="user"&&e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(kt,{className:"w-5 h-5 text-white"})})]},k.id)),o&&e.jsxs("div",{className:"flex gap-2 justify-start",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(po,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"bg-white rounded-2xl px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})]}),e.jsx("div",{ref:f})]}),e.jsxs("div",{className:"p-4 bg-white border-t border-gray-200",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:N.map((k,E)=>e.jsx("button",{onClick:k.action,disabled:!t,className:"px-3 py-1.5 bg-blue-50 text-blue-700 rounded-full text-xs font-medium hover:bg-blue-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:k.label},E))}),e.jsxs("form",{onSubmit:k=>{k.preventDefault(),y()},className:"flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:k=>l(k.target.value),placeholder:"Ask about your bookings...",disabled:!t||o,className:"flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-sm disabled:bg-gray-100 disabled:text-gray-600 disabled:cursor-not-allowed"}),e.jsx("button",{type:"submit",disabled:!i.trim()||!t||o,className:"p-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Tl,{className:"w-5 h-5"})})]})]})]})]})}function BN(){return null}function zN(){const{user:t}=X(),[s,r]=x.useState(!1),[a,n]=x.useState(""),[i,l]=x.useState(!1),[o,c]=x.useState(!1),[d,m]=x.useState(""),[u,h]=x.useState(!1);if(x.useEffect(()=>{localStorage.getItem("bug-report-tooltip-seen")||(h(!0),setTimeout(()=>{h(!1),localStorage.setItem("bug-report-tooltip-seen","true")},5e3))},[]),!t)return null;const f=async g=>{if(g.preventDefault(),!!a.trim()){l(!0),m("");try{const{error:j}=await _.from("bug_reports").insert([{text:a.trim(),page:window.location.pathname}]);if(j)throw j;c(!0),n(""),setTimeout(()=>{c(!1),r(!1)},2e3)}catch{m("Failed to submit feedback. Please try again.")}finally{l(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed bottom-[180px] md:bottom-24 right-4 md:right-6 z-[85]",children:[e.jsx("button",{onClick:()=>r(!0),onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),r(!0))},className:"bg-red-600 text-white p-3 md:p-4 rounded-full shadow-lg hover:bg-red-700 transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 animate-pulse",title:"Report a problem","aria-label":"Report a problem or bug",tabIndex:0,style:{pointerEvents:"auto"},children:e.jsx(bn,{className:"w-5 h-5 md:w-6 md:h-6"})}),u&&e.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-gray-900 text-white text-sm rounded-lg px-3 py-2 shadow-lg animate-fade-in",children:["Found a bug? Click here to report it!",e.jsx("div",{className:"absolute -bottom-1 right-4 w-2 h-2 bg-gray-900 transform rotate-45"})]})]}),s&&e.jsx("div",{className:"fixed inset-0 z-[95] flex items-center justify-center p-4 bg-black/50",style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Report a Problem"}),e.jsx("button",{onClick:()=>r(!1),className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ot,{className:"w-5 h-5 text-gray-500"})})]}),o?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ee,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Thank you!"}),e.jsx("p",{className:"text-gray-600",children:"Your feedback has been submitted."})]}):e.jsxs("form",{onSubmit:f,className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Describe the problem"}),e.jsx("textarea",{value:a,onChange:g=>n(g.target.value),placeholder:"Describe what went wrong, steps to reproduce, expected behavior...",rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none",required:!0})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Page: ",window.location.pathname]}),d&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),d]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:i||!a.trim(),className:"flex-1 px-4 py-3 bg-red-600 text-white rounded-xl font-medium hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:[e.jsx(Tl,{className:"w-4 h-4"}),i?"Submitting...":"Submit Report"]})]})]})]})})]})}function VN(){const{user:t,profile:s}=X(),r=ie(),[a,n]=x.useState(!1),[i,l]=x.useState(!1);if(x.useEffect(()=>{localStorage.getItem("profile-picture-banner-dismissed")==="true"&&n(!0)},[]),!t||!s||s.avatar_url||a)return null;const o=()=>{n(!0),localStorage.setItem("profile-picture-banner-dismissed","true")},c=()=>{r("/profile")},d=async m=>{var h;const u=(h=m.target.files)==null?void 0:h[0];if(!(!u||!t)){if(!u.type.startsWith("image/")){alert("Please select an image file");return}if(u.size>10*1024*1024){alert("File size must be less than 10MB");return}l(!0);try{console.log("Starting profile photo upload...");const f=await Yg(u);if(console.log("Validation result:",f),!f.valid){const p=f.error||f.message||"Invalid profile photo";console.error("Validation failed:",p),alert(p),l(!1);return}console.log("Uploading profile photo to storage...");const{optimizedPath:g,thumbnailPath:j,optimizedUrl:w}=await Kg(t.id,u,p=>console.log(`Upload progress: ${p}%`));console.log("Upload successful:",{optimizedPath:g,thumbnailPath:j,optimizedUrl:w}),console.log("Updating profile in database...");const{error:v}=await _.from("profiles").update({avatar_url:w,profile_photo_path:g,profile_photo_thumb_path:j}).eq("id",t.id);if(v)throw console.error("Database update error:",v),new Error(`Failed to update profile: ${v.message}`);console.log("Profile updated successfully"),o(),window.location.reload()}catch(f){console.error("Error uploading profile picture:",f);const g=f.message||f.toString()||"Failed to upload profile picture. Please try again.";alert(`Upload failed: ${g}`)}finally{l(!1)}}};return e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg border-b-4 border-blue-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx(ia,{className:"w-6 h-6"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-1 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Complete Your Profile"]}),e.jsx("p",{className:"text-sm text-blue-100 mb-3",children:"Please upload a profile picture to build trust with the community and enhance your carpooling experience."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white text-blue-700 rounded-lg font-medium hover:bg-blue-50 transition-colors cursor-pointer",children:[e.jsx(sl,{className:"w-4 h-4"}),i?"Uploading...":"Upload Now",e.jsx("input",{type:"file",accept:"image/*",onChange:d,disabled:i,className:"hidden"})]}),e.jsx("button",{onClick:c,className:"px-4 py-2 bg-blue-800 text-white rounded-lg font-medium hover:bg-blue-900 transition-colors",children:"Go to Profile"})]})]}),e.jsx("button",{onClick:o,className:"flex-shrink-0 p-1 hover:bg-white/10 rounded-full transition-colors","aria-label":"Dismiss",children:e.jsx(ot,{className:"w-5 h-5"})})]})})]})})})}function WN(){const{profile:t}=X(),s=ie(),[r,a]=x.useState(!1);return!t||r||!(!t.profile_photo_path&&!t.avatar_url&&!t.profile_photo_url)?null:e.jsx("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-3",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ne,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Complete your profile to start using all features"}),e.jsx("p",{className:"text-xs text-amber-700 mt-0.5",children:"Add a profile picture to post rides, request rides, and book trips"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("button",{onClick:()=>s("/profile"),className:"px-4 py-2 bg-amber-600 text-white text-sm font-medium rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2",children:[e.jsx(ia,{className:"w-4 h-4"}),"Complete Setup"]}),e.jsx("button",{onClick:()=>a(!0),className:"p-2 text-amber-600 hover:text-amber-700 transition-colors","aria-label":"Dismiss",children:e.jsx(ot,{className:"w-4 h-4"})})]})]})})}function Rt({children:t}){var c;const{user:s,profile:r,signOut:a,isAdmin:n}=X(),i=async()=>{try{await a()}catch(d){console.error("Sign out error:",d)}localStorage.clear(),sessionStorage.clear(),window.location.replace("/signin")},l=[{to:"/",icon:Md,label:"Home"},{to:"/find-rides",icon:Mt,label:"Find Rides"},{to:"/post-ride",icon:Tj,label:"Post Ride"},{to:"/request-ride",icon:xe,label:"Request Ride"},{to:"/my-rides",icon:de,label:"My Rides"},{to:"/messages",icon:Nt,label:"Messages"},{to:"/profile",icon:kt,label:"Profile"}],o=[{to:"/admin",icon:la,label:"Dashboard"},{to:"/admin/diagnostics",icon:Me,label:"Diagnostics"},{to:"/admin/users",icon:Bd,label:"Users"},{to:"/admin/feedback",icon:wa,label:"Feedback"},{to:"/admin/bugs",icon:bn,label:"Bug Reports"}];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[e.jsx(BN,{}),e.jsx(VN,{}),e.jsx(WN,{}),e.jsx("header",{className:"bg-white border-b border-gray-200 sticky z-50 top-0",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx(zd,{size:"sm"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right hidden sm:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:r==null?void 0:r.full_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[" ",((c=r==null?void 0:r.average_rating)==null?void 0:c.toFixed(1))||"0.0"]})]}),e.jsx("button",{onClick:i,className:"p-2 text-gray-600 hover:text-red-600 transition-colors",title:"Sign Out",children:e.jsx(Cj,{className:"w-5 h-5"})})]})]})})}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("nav",{className:"w-64 bg-white border-r border-gray-200 hidden md:block",children:e.jsxs("div",{className:"p-4 space-y-1",children:[l.map(d=>e.jsxs(io,{to:d.to,className:({isActive:m})=>`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${m?"bg-blue-50 text-blue-600 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(d.icon,{className:"w-5 h-5"}),e.jsx("span",{children:d.label})]},d.to)),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-4 mt-4 border-t border-gray-200",children:e.jsx("p",{className:"px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Admin"})}),o.map(d=>e.jsxs(io,{to:d.to,className:({isActive:m})=>`flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${m?"bg-orange-50 text-orange-600 font-medium":"text-gray-700 hover:bg-gray-50"}`,children:[e.jsx(d.icon,{className:"w-5 h-5"}),e.jsx("span",{children:d.label})]},d.to))]})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"max-w-7xl mx-auto p-6 pb-28 md:pb-6",children:t})})]}),e.jsx(qN,{}),e.jsx(zN,{}),e.jsx("nav",{className:"md:hidden bg-white border-t border-gray-200 fixed bottom-0 left-0 right-0 z-50",children:e.jsx("div",{className:"grid grid-cols-7 gap-1 p-2",children:l.map(d=>e.jsxs(io,{to:d.to,className:({isActive:m})=>`flex flex-col items-center gap-1 py-2 rounded-lg transition-colors ${m?"text-blue-600":"text-gray-600"}`,children:[e.jsx(d.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs",children:d.label})]},d.to))})})]})}function Jg({rank:t,size:s="md"}){const r={sm:"w-8 h-8 text-xs",md:"w-12 h-12 text-sm",lg:"w-16 h-16 text-lg"},a={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return t===1?e.jsx("div",{className:`${r[s]} rounded-full bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center shadow-lg`,children:e.jsx(Dd,{className:`${a[s]} text-white`})}):t===2?e.jsx("div",{className:`${r[s]} rounded-full bg-gradient-to-br from-gray-300 to-gray-500 flex items-center justify-center shadow-lg`,children:e.jsx(Lg,{className:`${a[s]} text-white`})}):t===3?e.jsx("div",{className:`${r[s]} rounded-full bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center shadow-lg`,children:e.jsx(bt,{className:`${a[s]} text-white`})}):e.jsxs("div",{className:`${r[s]} rounded-full bg-gray-200 flex items-center justify-center font-bold text-gray-700`,children:["#",t]})}function Wd({entry:t,formatScore:s,isCurrentUser:r}){var a,n,i,l,o;return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-lg transition-all ${r?"bg-gradient-to-r from-blue-50 to-purple-50 border-2 border-blue-400":"bg-gray-50 hover:bg-gray-100 border border-gray-200"}`,children:[e.jsx(Jg,{rank:t.rank,size:"md"}),e.jsx("div",{className:"flex-shrink-0",children:(a=t.profile)!=null&&a.avatar_url?e.jsx("img",{src:t.profile.avatar_url,alt:t.profile.full_name,className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center text-white font-bold text-lg border-2 border-white shadow",children:((i=(n=t.profile)==null?void 0:n.full_name)==null?void 0:i.charAt(0))||"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`font-semibold truncate ${r?"text-blue-900":"text-gray-900"}`,children:((l=t.profile)==null?void 0:l.full_name)||"Anonymous"}),r&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-600 text-white text-xs rounded-full font-medium",children:"You"})]}),((o=t.profile)==null?void 0:o.city)&&e.jsxs("p",{className:"text-xs text-gray-600 flex items-center gap-1 mt-0.5",children:[e.jsx(xe,{className:"w-3 h-3"}),t.profile.city]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-xl font-bold ${r?"text-blue-700":"text-gray-900"}`,children:s(t.score)}),t.rank<=10&&e.jsxs("div",{className:"flex items-center gap-1 text-yellow-600 text-xs",children:[e.jsx(we,{className:"w-3 h-3 fill-current"}),e.jsx("span",{className:"font-medium",children:"Top 10"})]})]})]})}function HN({category:t,period:s}){const{user:r}=X(),[a,n]=x.useState([]),[i,l]=x.useState(null),[o,c]=x.useState(!0);x.useEffect(()=>{d()},[t,s]);const d=async()=>{c(!0);try{const{data:u,error:h}=await _.from("leaderboard_cache").select(`
          user_id,
          rank,
          score,
          profiles:user_id (
            full_name,
            avatar_url,
            city
          )
        `).eq("category",t).eq("period",s).is("region",null).order("rank",{ascending:!0}).limit(50);if(h)throw h;const f=(u==null?void 0:u.map(g=>({user_id:g.user_id,rank:g.rank,score:g.score,profile:Array.isArray(g.profiles)?g.profiles[0]:g.profiles})))||[];if(n(f),r){const g=f.find(j=>j.user_id===r.id);if(g)l(g);else{const{data:j}=await _.from("leaderboard_cache").select("user_id, rank, score").eq("user_id",r.id).eq("category",t).eq("period",s).is("region",null).maybeSingle();j&&l(j)}}}catch(u){console.error("Error loading leaderboard:",u)}finally{c(!1)}},m=u=>t==="co2"?`${u.toFixed(1)}kg`:t==="distance"?`${u.toFixed(0)}km`:t==="trust_score"?u.toFixed(1):u.toString();return o?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(u=>e.jsxs("div",{className:"animate-pulse flex gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]},u))}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ss,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No leaderboard data available yet."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Be the first to climb the rankings!"})]}):e.jsxs("div",{children:[i&&i.rank>10&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border-2 border-blue-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Jg,{rank:i.rank}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Your Ranking"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",i.rank," - ",m(i.score)]})]})]}),e.jsx(Fe,{className:"w-6 h-6 text-blue-600"})]})}),e.jsx("div",{className:"space-y-2",children:a.map(u=>e.jsx(Wd,{entry:u,formatScore:m,isCurrentUser:u.user_id===(r==null?void 0:r.id)},u.user_id))})]})}function GN({category:t,period:s}){const{user:r,profile:a}=X(),[n,i]=x.useState([]),[l,o]=x.useState(!0),[c,d]=x.useState(""),[m,u]=x.useState([]);x.useEffect(()=>{h()},[]),x.useEffect(()=>{c&&f()},[t,s,c]);const h=async()=>{try{const{data:j,error:w}=await _.from("profiles").select("city").not("city","is",null);if(w)throw w;const v=[...new Set(j==null?void 0:j.map(p=>p.city).filter(Boolean))];u(v.sort()),a!=null&&a.city?d(a.city):v.length>0&&d(v[0])}catch(j){console.error("Error loading regions:",j)}},f=async()=>{o(!0);try{const{data:j,error:w}=await _.from("leaderboard_cache").select(`
          user_id,
          rank,
          score,
          region,
          profiles:user_id (
            full_name,
            avatar_url,
            city
          )
        `).eq("category",t).eq("period",s).eq("region",c).order("rank",{ascending:!0}).limit(20);if(w)throw w;const v=(j==null?void 0:j.map(p=>({user_id:p.user_id,rank:p.rank,score:p.score,region:p.region||"",profile:Array.isArray(p.profiles)?p.profiles[0]:p.profiles})))||[];i(v)}catch(j){console.error("Error loading regional leaderboard:",j)}finally{o(!1)}},g=j=>t==="co2"?`${j.toFixed(1)}kg`:t==="distance"?`${j.toFixed(0)}km`:t==="trust_score"?j.toFixed(1):j.toString();return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),"Select Region"]}),e.jsx("select",{value:c,onChange:j=>d(j.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:m.map(j=>e.jsx("option",{value:j,children:j},j))})]}),l?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(j=>e.jsxs("div",{className:"animate-pulse flex gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]},j))}):n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ss,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-600",children:["No rankings for ",c," yet."]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Be the first to represent your region!"})]}):e.jsx("div",{className:"space-y-2",children:n.map(j=>e.jsx(Wd,{entry:j,formatScore:g,isCurrentUser:j.user_id===(r==null?void 0:r.id)},j.user_id))})]})}function KN({category:t,period:s}){const{user:r}=X(),[a,n]=x.useState([]),[i,l]=x.useState(!0);x.useEffect(()=>{r&&o()},[t,s,r]);const o=async()=>{if(r){l(!0);try{const{data:d,error:m}=await _.from("friends").select("user_id, friend_id").or(`user_id.eq.${r.id},friend_id.eq.${r.id}`).eq("status","accepted");if(m)throw m;const u=(d==null?void 0:d.map(j=>j.user_id===r.id?j.friend_id:j.user_id))||[];u.push(r.id);const{data:h,error:f}=await _.from("leaderboard_cache").select(`
          user_id,
          rank,
          score,
          profiles:user_id (
            full_name,
            avatar_url,
            city
          )
        `).in("user_id",u).eq("category",t).eq("period",s).is("region",null).order("rank",{ascending:!0});if(f)throw f;const g=(h==null?void 0:h.map(j=>({user_id:j.user_id,rank:j.rank,score:j.score,profile:Array.isArray(j.profiles)?j.profiles[0]:j.profiles})))||[];n(g)}catch(d){console.error("Error loading friend leaderboard:",d)}finally{l(!1)}}},c=d=>t==="co2"?`${d.toFixed(1)}kg`:t==="distance"?`${d.toFixed(0)}km`:t==="trust_score"?d.toFixed(1):d.toString();return i?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(d=>e.jsxs("div",{className:"animate-pulse flex gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]},d))}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No friend rankings available."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Add friends to compare your progress!"})]}):e.jsx("div",{className:"space-y-2",children:a.map((d,m)=>e.jsx(Wd,{entry:{...d,rank:m+1},formatScore:c,isCurrentUser:d.user_id===(r==null?void 0:r.id)},d.user_id))})}function YN(){var d,m;const[t,s]=x.useState("global"),[r,a]=x.useState("rides"),[n,i]=x.useState("month"),l=[{id:"global",label:"Global",icon:Nj},{id:"regional",label:"Regional",icon:xe},{id:"friends",label:"Friends",icon:re}],o=[{id:"rides",label:"Most Rides",icon:Fe},{id:"co2",label:"Eco Warriors",icon:ss},{id:"trust_score",label:"Trust Score",icon:bt},{id:"distance",label:"Distance",icon:Lg}],c=[{id:"week",label:"This Week"},{id:"month",label:"This Month"},{id:"all_time",label:"All Time"}];return e.jsx(Rt,{children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg",children:e.jsx(ss,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Leaderboards"}),e.jsx("p",{className:"text-gray-600",children:"See how you rank among the community"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200 sticky top-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Leaderboard Type"}),e.jsx("div",{className:"space-y-2 mb-6",children:l.map(u=>{const h=u.icon;return e.jsxs("button",{onClick:()=>s(u.id),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${t===u.id?"bg-green-50 text-green-700 border-2 border-green-500":"bg-gray-50 text-gray-700 hover:bg-gray-100 border-2 border-transparent"}`,children:[e.jsx(h,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:u.label})]},u.id)})}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Category"}),e.jsx("div",{className:"space-y-2 mb-6",children:o.map(u=>{const h=u.icon;return e.jsxs("button",{onClick:()=>a(u.id),className:`w-full flex items-center gap-3 px-4 py-2 rounded-lg transition-all text-sm ${r===u.id?"bg-blue-50 text-blue-700 border border-blue-300":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"}`,children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{children:u.label})]},u.id)})}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Time Period"}),e.jsx("div",{className:"space-y-2",children:c.map(u=>e.jsx("button",{onClick:()=>i(u.id),className:`w-full px-4 py-2 rounded-lg transition-all text-sm ${n===u.id?"bg-purple-50 text-purple-700 border border-purple-300 font-medium":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"}`,children:u.label},u.id))})]})}),e.jsxs("div",{className:"lg:col-span-3",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Dd,{className:"w-6 h-6"}),e.jsx("h2",{className:"text-2xl font-bold",children:(d=o.find(u=>u.id===r))==null?void 0:d.label})]}),e.jsx("p",{className:"text-blue-100",children:(m=c.find(u=>u.id===n))==null?void 0:m.label})]}),e.jsxs("div",{className:"p-6",children:[t==="global"&&e.jsx(HN,{category:r,period:n}),t==="regional"&&e.jsx(GN,{category:r,period:n}),t==="friends"&&e.jsx(KN,{category:r,period:n})]})]}),e.jsx("div",{className:"mt-6 bg-gradient-to-r from-yellow-50 to-orange-50 rounded-xl p-6 border border-yellow-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ss,{className:"w-6 h-6 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-1",children:"Climb the Rankings!"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Complete more rides, save more CO, and build your trust score to reach the top of the leaderboard. Top performers get special badges and recognition in the community!"})]})]})})]})]})]})})}function JN({challenge:t,isJoined:s,progress:r,progressPercent:a,isCompleted:n,onJoin:i}){const o=(()=>{switch(t.challenge_type){case"rides":return Fe;case"co2":return ys;case"social":return re;default:return jn}})(),c=()=>t.challenge_type==="rides"?`${t.target_value} rides`:t.challenge_type==="co2"?`${t.target_value}kg CO`:t.challenge_type==="social"?`${t.target_value} friends`:`${t.target_value}`,d=Math.ceil((new Date(t.end_date).getTime()-new Date().getTime())/(1e3*60*60*24));return e.jsxs("div",{className:`bg-white rounded-xl border-2 overflow-hidden transition-all hover:shadow-lg ${n?"border-green-500":s?"border-blue-400":"border-gray-200"}`,children:[t.is_seasonal&&e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 text-white text-sm font-semibold",children:t.season_theme||"Seasonal Challenge"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${n?"bg-green-100":"bg-blue-100"}`,children:n?e.jsx(ee,{className:"w-6 h-6 text-green-600"}):e.jsx(o,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]}),s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Progress"}),e.jsxs("span",{className:"font-semibold text-gray-900",children:[r.toFixed(0),"/",t.target_value]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${n?"bg-green-500":"bg-blue-500"}`,style:{width:`${a}%`}})})]}),n?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700",children:[e.jsx(ee,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Completed!"})]}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:["Reward: ",t.reward_value]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:[d," days left"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(jn,{className:"w-4 h-4 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Goal"})]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:c()})]}),e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-3 border border-yellow-200",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(bt,{className:"w-4 h-4 text-yellow-600"}),e.jsx("span",{className:"text-sm font-medium text-yellow-900",children:"Reward"})]}),e.jsx("p",{className:"text-sm font-semibold text-yellow-800",children:t.reward_value})]}),e.jsx("button",{onClick:i,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold",children:"Join Challenge"})]})]})]})}function QN({onChallengeUpdate:t}){const{user:s}=X(),[r,a]=x.useState([]),[n,i]=x.useState(new Map),[l,o]=x.useState(!0);x.useEffect(()=>{c()},[s]);const c=async()=>{o(!0);try{const{data:m,error:u}=await _.from("challenges").select("*").eq("is_active",!0).gte("end_date",new Date().toISOString()).lte("start_date",new Date().toISOString()).order("created_at",{ascending:!1});if(u)throw u;if(a(m||[]),s){const{data:h}=await _.from("user_challenges").select("*").eq("user_id",s.id),f=new Map;h==null||h.forEach(g=>{f.set(g.challenge_id,g)}),i(f)}}catch(m){console.error("Error loading challenges:",m)}finally{o(!1)}},d=async m=>{if(s)try{const{error:u}=await _.from("user_challenges").insert({user_id:s.id,challenge_id:m,progress:0});if(u)throw u;await c(),t==null||t()}catch(u){console.error("Error joining challenge:",u)}};return l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(m=>e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"bg-gray-200 rounded-xl h-64"})},m))}):r.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(jn,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No active challenges at the moment."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Check back soon for new challenges!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(m=>{const u=n.get(m.id),h=!!u,f=u?Math.min(u.progress/m.target_value*100,100):0;return e.jsx(JN,{challenge:m,isJoined:h,progress:(u==null?void 0:u.progress)||0,progressPercent:f,isCompleted:(u==null?void 0:u.completed)||!1,onJoin:()=>d(m.id)},m.id)})})}function XN(){const{user:t}=X(),[s,r]=x.useState([]),[a,n]=x.useState(!0);x.useEffect(()=>{t&&i()},[t]);const i=async()=>{if(t){n(!0);try{const{data:l,error:o}=await _.from("user_challenges").select(`
          id,
          completed_at,
          reward_claimed,
          challenges:challenge_id (
            title,
            description,
            reward_value,
            badge_icon
          )
        `).eq("user_id",t.id).eq("completed",!0).order("completed_at",{ascending:!1});if(o)throw o;const c=(l==null?void 0:l.map(d=>({id:d.id,completed_at:d.completed_at,reward_claimed:d.reward_claimed,challenge:Array.isArray(d.challenges)?d.challenges[0]:d.challenges})))||[];r(c)}catch(l){console.error("Error loading completed challenges:",l)}finally{n(!1)}}};return a?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(l=>e.jsx("div",{className:"animate-pulse bg-gray-200 rounded-xl h-24"},l))}):s.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(bt,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No completed challenges yet."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Start a challenge to earn rewards!"})]}):e.jsx("div",{className:"space-y-4",children:s.map(l=>{var o,c,d;return e.jsx("div",{className:"bg-white rounded-xl border-2 border-green-300 p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 p-3 bg-green-100 rounded-lg",children:e.jsx(ee,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:(o=l.challenge)==null?void 0:o.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:(c=l.challenge)==null?void 0:c.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:(d=l.challenge)==null?void 0:d.reward_value})]}),e.jsxs("span",{className:"text-gray-500",children:["Completed ",new Date(l.completed_at).toLocaleDateString()]})]})]}),l.reward_claimed&&e.jsx("div",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-semibold",children:"Reward Claimed"})]})},l.id)})})}function ZN(){const{user:t}=X(),[s,r]=x.useState("active"),[a,n]=x.useState({active:0,completed:0,inProgress:0});x.useEffect(()=>{t&&i()},[t]);const i=async()=>{if(t)try{const{data:l}=await _.from("user_challenges").select("completed, progress, challenge_id").eq("user_id",t.id),o=(l==null?void 0:l.filter(m=>m.completed).length)||0,c=(l==null?void 0:l.filter(m=>!m.completed&&m.progress>0).length)||0,{count:d}=await _.from("challenges").select("*",{count:"exact",head:!0}).eq("is_active",!0).gte("end_date",new Date().toISOString()).lte("start_date",new Date().toISOString());n({active:d||0,completed:o,inProgress:c})}catch(l){console.error("Error loading challenge stats:",l)}};return e.jsx(Rt,{children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg",children:e.jsx(jn,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Challenges"}),e.jsx("p",{className:"text-gray-600",children:"Complete challenges to earn badges and rewards"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(de,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.active}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Challenges"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Al,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.inProgress}),e.jsx("p",{className:"text-sm text-gray-600",children:"In Progress"})]})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ee,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.completed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Completed"})]})]})})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>r("active"),className:`px-6 py-3 font-semibold border-b-2 transition-colors ${s==="active"?"border-green-600 text-green-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Active Challenges"}),e.jsx("button",{onClick:()=>r("completed"),className:`px-6 py-3 font-semibold border-b-2 transition-colors ${s==="completed"?"border-green-600 text-green-600":"border-transparent text-gray-600 hover:text-gray-900"}`,children:"Completed"})]})}),s==="active"?e.jsx(QN,{onChallengeUpdate:i}):e.jsx(XN,{}),e.jsx("div",{className:"mt-8 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ss,{className:"w-6 h-6 text-purple-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"How Challenges Work"}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-purple-800",children:[e.jsx("li",{children:" Complete rides, save CO, and connect with others to progress"}),e.jsx("li",{children:" Earn exclusive badges and boost your trust score"}),e.jsx("li",{children:" New seasonal challenges added regularly"}),e.jsx("li",{children:" Compete with friends and the community"})]})]})]})})]})})}class e1{constructor(){this.errorBuffer=[],this.flushInterval=1e4,this.maxBufferSize=20,this.startAutoFlush(),this.setupGlobalErrorHandler()}async logError(s){this.errorBuffer.push(s),console.error("[ErrorTracker]",s.errorType,s.errorMessage),(this.errorBuffer.length>=this.maxBufferSize||s.severity==="critical")&&await this.flush()}async flush(){if(this.errorBuffer.length===0)return;const s=[...this.errorBuffer];this.errorBuffer=[];try{for(const r of s)await _.rpc("log_error",{p_error_type:r.errorType,p_error_message:r.errorMessage,p_error_stack:r.errorStack||null,p_severity:r.severity||"error",p_endpoint:r.endpoint||window.location.pathname,p_metadata:r.metadata||{}})}catch(r){console.error("Failed to flush error logs:",r)}}startAutoFlush(){setInterval(()=>this.flush(),this.flushInterval)}setupGlobalErrorHandler(){typeof window>"u"||(window.addEventListener("error",s=>{var r;this.logError({errorType:"uncaught_error",errorMessage:s.message,errorStack:(r=s.error)==null?void 0:r.stack,severity:"error",endpoint:window.location.pathname,metadata:{filename:s.filename,lineno:s.lineno,colno:s.colno}})}),window.addEventListener("unhandledrejection",s=>{var r,a;this.logError({errorType:"unhandled_promise_rejection",errorMessage:((r=s.reason)==null?void 0:r.message)||String(s.reason),errorStack:(a=s.reason)==null?void 0:a.stack,severity:"error",endpoint:window.location.pathname,metadata:{reason:s.reason}})}))}captureException(s,r){this.logError({errorType:s.name||"Error",errorMessage:s.message,errorStack:s.stack,severity:"error",endpoint:window.location.pathname,metadata:r})}captureMessage(s,r="info",a){this.logError({errorType:"message",errorMessage:s,severity:r,endpoint:window.location.pathname,metadata:a})}async getRecentErrors(s=50){try{const{data:r,error:a}=await _.from("error_logs").select("*").order("created_at",{ascending:!1}).limit(s);if(a)throw a;return r||[]}catch(r){return console.error("Failed to get recent errors:",r),[]}}async getErrorPatterns(){try{const{data:s,error:r}=await _.from("error_patterns").select("*").order("occurrence_count",{ascending:!1}).limit(20);if(r)throw r;return s||[]}catch(s){return console.error("Failed to get error patterns:",s),[]}}}const t1=new e1;class s1 extends x.Component{constructor(s){super(s),this.handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})},this.handleReload=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.handleReportBug=()=>{const r=this.state.error,a=this.state.errorInfo,n={error:r==null?void 0:r.message,stack:r==null?void 0:r.stack,componentStack:a==null?void 0:a.componentStack,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString()};console.log("Bug report:",n),alert("Error details have been logged. Our team will investigate this issue.")},this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){this.setState(a=>({errorInfo:r,errorCount:a.errorCount+1})),t1.captureException(s,{componentStack:r.componentStack,errorBoundary:!0,errorCount:this.state.errorCount+1}),this.props.onError&&this.props.onError(s,r),console.error("Error caught by boundary:",s,r)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;this.state.error;const s=!1;return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-2xl w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-red-600 p-6 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Ce,{className:"w-8 h-8"}),e.jsx("h1",{className:"text-2xl font-bold",children:"Something Went Wrong"})]}),e.jsx("p",{className:"text-red-100",children:"We apologize for the inconvenience. An unexpected error has occurred."})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[s,e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"What you can do:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:""}),e.jsx("span",{children:"Try refreshing the page"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:""}),e.jsx("span",{children:"Go back to the home page and try again"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-600 mt-0.5",children:""}),e.jsx("span",{children:"If the problem persists, please report this bug"})]})]})]}),this.state.errorCount>3&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-yellow-900 mb-1",children:"Multiple Errors Detected"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:["This error has occurred ",this.state.errorCount," times. You may want to refresh the page or clear your browser cache."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:this.handleReset,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Try Again"]}),e.jsxs("button",{onClick:this.handleReload,className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Reload Page"]}),e.jsxs("button",{onClick:this.handleGoHome,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:[e.jsx(Md,{className:"w-4 h-4"}),"Go Home"]}),e.jsxs("button",{onClick:this.handleReportBug,className:"flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium",children:[e.jsx(bn,{className:"w-4 h-4"}),"Report Bug"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 text-center pt-4 border-t border-gray-200",children:["Error ID: ",Date.now().toString(36),s]})]})]})})}return this.props.children}}const Qg=x.createContext(void 0);function r1({children:t}){const[s,r]=x.useState(new Map),a=(d,m)=>{r(u=>{const h=new Map(u);return h.set(d,{isLoading:!0,message:m,progress:0}),h})},n=d=>{r(m=>{const u=new Map(m);return u.delete(d),u})},i=(d,m)=>{r(u=>{const h=new Map(u),f=h.get(d);return f&&h.set(d,{...f,progress:m}),h})},l=d=>{var m;return d?((m=s.get(d))==null?void 0:m.isLoading)||!1:s.size>0},o=()=>{const d=Array.from(s.values())[0];return d==null?void 0:d.message},c=()=>{const d=Array.from(s.values())[0];return d==null?void 0:d.progress};return e.jsxs(Qg.Provider,{value:{startLoading:a,stopLoading:n,updateProgress:i,isLoading:l,getMessage:o,getProgress:c},children:[t,l()&&e.jsx(n1,{})]})}function a1(){const t=x.useContext(Qg);if(!t)throw new Error("useLoading must be used within LoadingProvider");return t}function n1(){const{getMessage:t,getProgress:s}=a1(),[r,a]=x.useState(!1);if(x.useEffect(()=>{const l=setTimeout(()=>a(!0),300);return()=>clearTimeout(l)},[]),!r)return null;const n=t(),i=s();return e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-blue-600 text-white px-4 py-3 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(at,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{className:"font-medium",children:n||"Loading..."}),i!==void 0&&i>0&&e.jsxs("span",{className:"text-sm opacity-90",children:["(",i,"%)"]})]}),i!==void 0&&i>0&&e.jsx("div",{className:"mt-2 w-full bg-blue-700 rounded-full h-1",children:e.jsx("div",{className:"bg-white h-1 rounded-full transition-all duration-300",style:{width:`${i}%`}})})]})})}const i1=Xi.isNativePlatform()?Ay:Ty;function ve({children:t}){const{user:s,loading:r}=X();return r?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):s?e.jsx(e.Fragment,{children:t}):e.jsx(kd,{to:"/signin",replace:!0})}function oi({children:t}){const{user:s,loading:r}=X();return r?e.jsx("div",{className:"min-h-screen bg-white flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})}):s?e.jsx(kd,{to:"/",replace:!0}):e.jsx(e.Fragment,{children:t})}function l1(){return e.jsx(i1,{children:e.jsxs(Ny,{children:[e.jsx(oe,{path:"/signin",element:e.jsx(oi,{children:e.jsx(Vj,{})})}),e.jsx(oe,{path:"/signup",element:e.jsx(oi,{children:e.jsx(Yj,{})})}),e.jsx(oe,{path:"/verify-otp",element:e.jsx(oi,{children:e.jsx(Qj,{})})}),e.jsx(oe,{path:"/verify-email",element:e.jsx(Xj,{})}),e.jsx(oe,{path:"/forgot-password",element:e.jsx(oi,{children:e.jsx(Zj,{})})}),e.jsx(oe,{path:"/reset-password",element:e.jsx(ew,{})}),e.jsx(oe,{path:"/",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(iw,{})})})}),e.jsx(oe,{path:"/find-rides",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(hw,{})})})}),e.jsx(oe,{path:"/post-ride",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(fw,{})})})}),e.jsx(oe,{path:"/request-ride",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(pw,{})})})}),e.jsx(oe,{path:"/my-rides",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(vw,{})})})}),e.jsx(oe,{path:"/messages",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(_w,{})})})}),e.jsx(oe,{path:"/profile",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(Kw,{})})})}),e.jsx(oe,{path:"/user/:userId",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(Jw,{})})})}),e.jsx(oe,{path:"/security",element:e.jsx(ve,{children:e.jsx(Xw,{})})}),e.jsx(oe,{path:"/preferences",element:e.jsx(ve,{children:e.jsx(yN,{})})}),e.jsx(oe,{path:"/analytics",element:e.jsx(ve,{children:e.jsx(eN,{})})}),e.jsx(oe,{path:"/leaderboards",element:e.jsx(ve,{children:e.jsx(YN,{})})}),e.jsx(oe,{path:"/challenges",element:e.jsx(ve,{children:e.jsx(ZN,{})})}),e.jsx(oe,{path:"/rides/:rideId",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(aN,{})})})}),e.jsx(oe,{path:"/bookings/:bookingId",element:e.jsx(ve,{children:e.jsx(Rt,{children:e.jsx(lN,{})})})}),e.jsx(oe,{path:"/terms",element:e.jsx(oN,{})}),e.jsx(oe,{path:"/privacy",element:e.jsx(cN,{})}),e.jsx(oe,{path:"/admin/beta",element:e.jsx(ve,{children:e.jsx(bN,{})})}),e.jsx(oe,{path:"/admin/feedback",element:e.jsx(ve,{children:e.jsx(vN,{})})}),e.jsx(oe,{path:"/admin/diagnostics",element:e.jsx(ve,{children:e.jsx(jN,{})})}),e.jsx(oe,{path:"/admin",element:e.jsx(ve,{children:e.jsx(SN,{})})}),e.jsx(oe,{path:"/admin/users",element:e.jsx(ve,{children:e.jsx(CN,{})})}),e.jsx(oe,{path:"/admin/bugs",element:e.jsx(ve,{children:e.jsx(EN,{})})}),e.jsx(oe,{path:"/admin/verifications",element:e.jsx(ve,{children:e.jsx(RN,{})})}),e.jsx(oe,{path:"/admin/safety",element:e.jsx(ve,{children:e.jsx(PN,{})})}),e.jsx(oe,{path:"/admin/safety/report/:reportId",element:e.jsx(ve,{children:e.jsx(TN,{})})}),e.jsx(oe,{path:"/admin/safety/dashboard",element:e.jsx(ve,{children:e.jsx(AN,{})})}),e.jsx(oe,{path:"/admin/analytics",element:e.jsx(ve,{children:e.jsx(DN,{})})}),e.jsx(oe,{path:"/admin/activity",element:e.jsx(ve,{children:e.jsx($N,{})})}),e.jsx(oe,{path:"/admin/bulk-operations",element:e.jsx(ve,{children:e.jsx(IN,{})})}),e.jsx(oe,{path:"/admin/performance",element:e.jsx(ve,{children:e.jsx(ON,{})})})]})})}function o1(){return e.jsx(s1,{children:e.jsx(r1,{children:e.jsx(uj,{children:e.jsx(hj,{children:e.jsx(l1,{})})})})})}let c1=!1;function d1(t,s){window.Sentry&&c1&&window.Sentry.captureException(t,{extra:s})}class u1 extends x.Component{constructor(s){super(s),this.handleRefresh=()=>{window.location.reload()},this.handleGoHome=()=>{window.location.href="/"},this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),d1(s,{componentStack:r.componentStack})}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ce,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"We encountered an unexpected error. Please try refreshing the page or return to the home screen."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:this.handleRefresh,className:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),"Refresh"]}),e.jsxs("button",{onClick:this.handleGoHome,className:"flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Md,{className:"w-4 h-4"}),"Go Home"]})]}),this.state.error&&e.jsxs("details",{className:"mt-6 text-left",children:[e.jsx("summary",{className:"text-sm text-gray-500 cursor-pointer hover:text-gray-700",children:"Technical details"}),e.jsx("pre",{className:"mt-2 p-3 bg-gray-100 rounded-lg text-xs text-gray-700 overflow-auto max-h-32",children:this.state.error.message})]})]})}):this.props.children}}Gx(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(u1,{children:e.jsx(o1,{})})}));
